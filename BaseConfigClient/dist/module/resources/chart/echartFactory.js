define(["require", "exports", "text!./enlarge.html", "../../common/app/main.app", "../../../core/server/enum/DataType", "echarts", "lodash", "../../../core/entity/Resource", "./enlarge.controller", "../../common/services/resource.service", "moment"], function (require, exports, enlargeHtml, main_app_1, DataType_1, echarts, _, Resource_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var dataSelectResult = (function () {
        function dataSelectResult() {
        }
        return dataSelectResult;
    }());
    exports.dataSelectResult = dataSelectResult;
    var EchartFactory = (function () {
        function EchartFactory($timeout, layer, i18nFactory, $q, resourceService) {
            this.$timeout = $timeout;
            this.layer = layer;
            this.i18nFactory = i18nFactory;
            this.$q = $q;
            this.resourceService = resourceService;
            this.charts = {};
            this.currentDataType = DataType_1.DateType.ALL;
            this.currentDeviceType = Resource_1.ResourcePageType.ALL.value;
        }
        EchartFactory.prototype.init = function (config) {
            var dom = document.getElementById(config.name);
            var path = config.path;
            var ele = echarts.init(dom);
            ele.showLoading('default', {
                text: "图表数据正在努力加载..."
            });
            this.resourceService.getEchartConfig(path).then(function (data) {
                ele.setOption(data);
            });
        };
        EchartFactory.prototype.initChart = function (option) {
            if (!!option && !!option.config && !_.isEmpty(echarts)) {
                var domString = "#" + option.name + " canvas";
                var canvas = $(domString)[0];
                var dom = document.getElementById(option.name);
                if (this.charts[option.name] && canvas) {
                    this.charts[option.name].setOption(option.config);
                }
                else if (dom) {
                    this.charts[option.name] = echarts.init(dom);
                    this.charts[option.name].setOption(option.config);
                }
            }
        };
        EchartFactory.prototype.getInitRequire = function () {
            var getChartDataParams = {
                start: moment().subtract(30, 'days').format('YYYY-MM-DD 00:00:00'),
                end: moment().format('YYYY-MM-DD hh:mm:ss'),
                type: this.currentDeviceType,
                timeStamp: this.currentDataType
            };
            return this.resourceService.getChartData(getChartDataParams);
        };
        EchartFactory.prototype.sliceArray = function (data) {
            var newArray = [];
            data.forEach(function (item, index) {
                if (typeof (item) == "number" || typeof (item) == "string") {
                    newArray = data.slice(-5);
                }
                else {
                    newArray[index] = item.slice(-5);
                }
            });
            return newArray;
        };
        EchartFactory.prototype.getUnitNum = function (data) {
            var _loop_1 = function (i) {
                var everyData = data[i];
                switch (typeof (everyData)) {
                    case "number": {
                        var result = [];
                        result = data.map(function (item) {
                            return Math.ceil(item / 10000);
                        });
                        return { value: result };
                    }
                    case "object": {
                        var result_1 = [];
                        data.forEach(function (item, idx) {
                            result_1[idx] = item.map(function (itm) {
                                return Math.ceil(itm / 10000);
                            });
                        });
                        return { value: result_1 };
                    }
                }
            };
            for (var i = 0; i < data.length; i++) {
                var state_1 = _loop_1(i);
                if (typeof state_1 === "object")
                    return state_1.value;
            }
        };
        EchartFactory.prototype.enlarge = function ($scope, name, data) {
            var that = this;
            var scope = $scope.$new();
            var enlargeKey = data;
            scope.enlarge = enlargeKey;
            if (enlargeKey) {
                var skin = 'enlargeEchart no-scroll';
                var area = ["1200px", "700px"];
                if (enlargeKey.name == "AllRankList") {
                    scope.enlarge = angular.copy(data);
                    area = ["751px", "511px"];
                }
                this.currentLayerIndex = this.layer.open({
                    type: 1,
                    skin: skin,
                    content: enlargeHtml,
                    scope: scope,
                    title: [enlargeKey.title, "background-color:#2D87F9;color:#fff"],
                    area: area,
                    end: function () {
                        scope.$destroy();
                    }
                });
            }
            else {
                this.layer.msg("暂无数据");
            }
        };
        EchartFactory.$inject = ['$timeout', 'layer', 'i18nFactory', '$q', 'resourceService'];
        return EchartFactory;
    }());
    main_app_1.app.service('echartFactory', EchartFactory);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvcmVzb3VyY2VzL2NoYXJ0L2VjaGFydEZhY3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBZUE7UUFBQTtRQUtBLENBQUM7UUFBRCx1QkFBQztJQUFELENBTEEsQUFLQyxJQUFBO0lBTFksNENBQWdCO0lBb0I3QjtRQVNJLHVCQUFvQixRQUFrQixFQUMxQixLQUFVLEVBQ1YsV0FBZ0IsRUFDaEIsRUFBTyxFQUNQLGVBQWlDO1lBSnpCLGFBQVEsR0FBUixRQUFRLENBQVU7WUFDMUIsVUFBSyxHQUFMLEtBQUssQ0FBSztZQUNWLGdCQUFXLEdBQVgsV0FBVyxDQUFLO1lBQ2hCLE9BQUUsR0FBRixFQUFFLENBQUs7WUFDUCxvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7WUFWN0MsV0FBTSxHQUEyQixFQUFFLENBQUM7WUFDcEMsb0JBQWUsR0FBVyxtQkFBUSxDQUFDLEdBQUcsQ0FBQztZQUN2QyxzQkFBaUIsR0FBVywyQkFBZ0IsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBU3ZELENBQUM7UUFHTSw0QkFBSSxHQUFYLFVBQVksTUFBVztZQUNuQixJQUFJLEdBQUcsR0FBUSxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRCxJQUFJLElBQUksR0FBVyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQy9CLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDNUIsR0FBRyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUU7Z0JBQ3ZCLElBQUksRUFBRSxlQUFlO2FBQ3hCLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxlQUFlLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLElBQVM7Z0JBQ3RELEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEIsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDO1FBR00saUNB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QUFDO29CQUNuQyxLQUFLLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ25DLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDOUIsQ0FBQztnQkFDRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7b0JBQ3JDLElBQUksRUFBRSxDQUFDO29CQUNQLElBQUksRUFBRSxJQUFJO29CQUNWLE9BQU8sRUFBRSxXQUFXO29CQUNwQixLQUFLLEVBQUUsS0FBSztvQkFFWixLQUFLLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLHFDQUFxQyxDQUFDO29CQUNoRSxJQUFJLEVBQUUsSUFBSTtvQkFDVixHQUFHLEVBQUU7d0JBQ0QsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNyQixDQUFDO2lCQUNKLENBQUMsQ0FBQztZQUNQLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUMxQixDQUFDO1FBQ0wsQ0FBQztRQXRKTSxxQkFBTyxHQUFHLENBQUMsVUFBVSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixDQUFDLENBQUM7UUF1Sm5GLG9CQUFDO0tBeEpELEFBd0pDLElBQUE7SUFFRCxjQUFHLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyIsImZpbGUiOiJtb2R1bGUvcmVzb3VyY2VzL2NoYXJ0L2VjaGFydEZhY3RvcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPGFtZC1kZXBlbmRlbmN5IHBhdGg9XCJ0ZXh0IS4vZW5sYXJnZS5odG1sXCIgbmFtZT1cImVubGFyZ2VIdG1sXCIgLz5cclxuXHJcbmltcG9ydCAnLi9lbmxhcmdlLmNvbnRyb2xsZXInO1xyXG5pbXBvcnQgJy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9yZXNvdXJjZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgYXBwIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcHAvbWFpbi5hcHBcIjtcclxuaW1wb3J0IHsgSVJlc291cmNlU2VydmljZSwgc2VhcmNoQ2hhcnRQYXJhbXMgfSBmcm9tICcuLi8uLi9jb21tb24vc2VydmljZXMvcmVzb3VyY2Uuc2VydmljZSc7XHJcbmltcG9ydCAqIGFzIENoYXJ0T3B0aW9ucyBmcm9tIFwiLi4vLi4vY29tbW9uL2VudW0vRWNoYXJ0Q29uZmlnXCI7XHJcbmltcG9ydCB7IERhdGVUeXBlIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvc2VydmVyL2VudW0vRGF0YVR5cGVcIjtcclxuaW1wb3J0ICogYXMgZWNoYXJ0cyBmcm9tIFwiZWNoYXJ0c1wiO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcclxuaW1wb3J0IFwibW9tZW50XCI7XHJcbmltcG9ydCB7IFJlc291cmNlUGFnZVR5cGUgfSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudGl0eS9SZXNvdXJjZSc7XHJcblxyXG5kZWNsYXJlIGxldCAkOiBhbnksIG1vbWVudDogYW55LCBhbmd1bGFyOiBhbnksIGVubGFyZ2VIdG1sOiBhbnk7XHJcblxyXG5leHBvcnQgY2xhc3MgZGF0YVNlbGVjdFJlc3VsdCB7XHJcbiAgICBzdGFydDogc3RyaW5nO1xyXG4gICAgZW5kOiBzdHJpbmc7XHJcbiAgICB0eXBlOiBzdHJpbmc7XHJcbiAgICB0aW1lU3RhbXA6IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJRWNoYXJ0RmFjdG9yeSB7XHJcbiAgICBpbml0OiAoY29uZmlnOiBDaGFydE9wdGlvbnMuc2V0RW5sYXJnZURhdGEpID0+IHZvaWQ7XHJcbiAgICBpbml0Q2hhcnQ6IChjb25maWc6IENoYXJ0T3B0aW9ucy5zZXRFbmxhcmdlRGF0YSkgPT4gdm9pZDtcclxuICAgIC8vIGNoYW5nZVRoZVVuaXQ6IChkYXRhOiBBcnJheTxhbnk+KSA9PiBBcnJheTxhbnk+O1xyXG4gICAgZ2V0VW5pdE51bTogKGRhdGE6IEFycmF5PGFueT4pID0+IEFycmF5PGFueT47XHJcbiAgICBnZXRJbml0UmVxdWlyZTogKCkgPT4gYW55O1xyXG4gICAgY3VycmVudERhdGFUeXBlOiBzdHJpbmc7XHJcbiAgICBjdXJyZW50RGV2aWNlVHlwZTogc3RyaW5nO1xyXG4gICAgc2xpY2VBcnJheTogKGRhdGE6IEFycmF5PGFueT4pID0+IEFycmF5PGFueT47XHJcbiAgICBGYWNlU29ja2V0SUQ6IHN0cmluZztcclxuICAgIENhclNvY2tldElEOiBzdHJpbmc7XHJcbn1cclxuXHJcbmNsYXNzIEVjaGFydEZhY3RvcnkgaW1wbGVtZW50cyBJRWNoYXJ0RmFjdG9yeSB7XHJcbiAgICBzdGF0aWMgJGluamVjdCA9IFsnJHRpbWVvdXQnLCAnbGF5ZXInLCAnaTE4bkZhY3RvcnknLCAnJHEnLCAncmVzb3VyY2VTZXJ2aWNlJ107XHJcblxyXG4gICAgY2hhcnRzOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XHJcbiAgICBjdXJyZW50RGF0YVR5cGU6IHN0cmluZyA9IERhdGVUeXBlLkFMTDtcclxuICAgIGN1cnJlbnREZXZpY2VUeXBlOiBzdHJpbmcgPSBSZXNvdXJjZVBhZ2VUeXBlLkFMTC52YWx1ZTtcclxuICAgIEZhY2VTb2NrZXRJRDogc3RyaW5nO1xyXG4gICAgQ2FyU29ja2V0SUQ6IHN0cmluZztcclxuICAgIGN1cnJlbnRMYXllckluZGV4OiBudW1iZXI7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlICR0aW1lb3V0OiBGdW5jdGlvbixcclxuICAgICAgICBwcml2YXRlIGxheWVyOiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSBpMThuRmFjdG9yeTogYW55LFxyXG4gICAgICAgIHByaXZhdGUgJHE6IGFueSxcclxuICAgICAgICBwcml2YXRlIHJlc291cmNlU2VydmljZTogSVJlc291cmNlU2VydmljZSkge1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOivt+axgkpTT07mlofku7ZcclxuICAgIHB1YmxpYyBpbml0KGNvbmZpZzogYW55KSB7XHJcbiAgICAgICAgbGV0IGRvbTogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29uZmlnLm5hbWUpO1xyXG4gICAgICAgIGxldCBwYXRoOiBzdHJpbmcgPSBjb25maWcucGF0aDtcclxuICAgICAgICBsZXQgZWxlID0gZWNoYXJ0cy5pbml0KGRvbSk7XHJcbiAgICAgICAgZWxlLnNob3dMb2FkaW5nKCdkZWZhdWx0Jywge1xyXG4gICAgICAgICAgICB0ZXh0OiBcIuWbvuihqOaVsOaNruato+WcqOWKquWKm+WKoOi9vS4uLlwiXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZVNlcnZpY2UuZ2V0RWNoYXJ0Q29uZmlnKHBhdGgpLnRoZW4oKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBlbGUuc2V0T3B0aW9uKGRhdGEpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLy8g6YCa6L+HdHlwZXNjcmlwdOaemuS4vuW9ouaIkOmFjee9ruaWh+S7tlxyXG4gICAgcHVibGljIGluaXRDaGFydChvcHRpb246IENoYXJ0T3B0aW9ucy5zZXRFbmxhcmdlRGF0YSkge1xyXG4gICAgICAgIGlmICghIW9wdGlvbiAmJiAhIW9wdGlvbi5jb25maWcgJiYgIV8uaXNFbXB0eShlY2hhcnRzKSkge1xyXG4gICAgICAgICAgICBsZXQgZG9tU3RyaW5nOiBzdHJpbmcgPSBgIyR7b3B0aW9uLm5hbWV9IGNhbnZhc2A7XHJcbiAgICAgICAgICAgIGxldCBjYW52YXM6IGFueSA9ICQoZG9tU3RyaW5nKVswXTtcclxuICAgICAgICAgICAgbGV0IGRvbTogYW55ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9uLm5hbWUpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jaGFydHNbb3B0aW9uLm5hbWVdICYmIGNhbnZhcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFydHNbb3B0aW9uLm5hbWVdLnNldE9wdGlvbihvcHRpb24uY29uZmlnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChkb20pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhcnRzW29wdGlvbi5uYW1lXSA9IGVjaGFydHMuaW5pdChkb20pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFydHNbb3B0aW9uLm5hbWVdLnNldE9wdGlvbihvcHRpb24uY29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRJbml0UmVxdWlyZSgpIHtcclxuICAgICAgICBsZXQgZ2V0Q2hhcnREYXRhUGFyYW1zID0ge1xyXG4gICAgICAgICAgICBzdGFydDogbW9tZW50KCkuc3VidHJhY3QoMzAsICdkYXlzJykuZm9ybWF0KCdZWVlZLU1NLUREIDAwOjAwOjAwJyksXHJcbiAgICAgICAgICAgIGVuZDogbW9tZW50KCkuZm9ybWF0KCdZWVlZLU1NLUREIGhoOm1tOnNzJyksXHJcbiAgICAgICAgICAgIHR5cGU6IHRoaXMuY3VycmVudERldmljZVR5cGUsXHJcbiAgICAgICAgICAgIHRpbWVTdGFtcDogdGhpcy5jdXJyZW50RGF0YVR5cGVcclxuICAgICAgICB9IGFzIHNlYXJjaENoYXJ0UGFyYW1zO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5yZXNvdXJjZVNlcnZpY2UuZ2V0Q2hhcnREYXRhKGdldENoYXJ0RGF0YVBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgc2xpY2VBcnJheShkYXRhOiBBcnJheTxhbnk+KSB7XHJcbiAgICAgICAgbGV0IG5ld0FycmF5OiBBcnJheTxhbnk+ID0gW107XHJcbiAgICAgICAgZGF0YS5mb3JFYWNoKChpdGVtOiBBcnJheTxudW1iZXIgfCBzdHJpbmc+IHwgQXJyYXk8QXJyYXk8bnVtYmVyIHwgc3RyaW5nPj4sIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAoaXRlbSkgPT0gXCJudW1iZXJcIiB8fCB0eXBlb2YgKGl0ZW0pID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgIG5ld0FycmF5ID0gZGF0YS5zbGljZSgtNSlcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG5ld0FycmF5W2luZGV4XSA9IGl0ZW0uc2xpY2UoLTUpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gbmV3QXJyYXlcclxuICAgIH1cclxuICAgIC8v5Yik5pat5piv5ZCm6ZyA6KaB57uZ5Zu+6KGo5re75Yqg5Y2V5L2NXHJcbiAgICAvLyBwdWJsaWMgY2hhbmdlVGhlVW5pdChkYXRhOiBBcnJheTxhbnk+KSB7XHJcbiAgICAvLyAgICAgbGV0IGhhc1VuaXQgPSB0aGlzLmlmTmVlZFVuaXQoZGF0YSk7XHJcbiAgICAvLyAgICAgbGV0IHJlc3VsdCA9IFtdIGFzIEFycmF5PGFueT47XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coZGF0YSlcclxuICAgIC8vICAgICBpZiAoaGFzVW5pdCkge1xyXG4gICAgLy8gICAgICAgICByZXR1cm4gW2hhc1VuaXQsIGRhdGFdO1xyXG4gICAgLy8gICAgIH0gZWxzZSB7XHJcbiAgICAvLyAgICAgICAgIC8vIOacieWNleS9jVxyXG4gICAgLy8gICAgICAgICBsZXQgcmVzID0gW2hhc1VuaXQsIHRoaXMuZ2V0VW5pdE51bShhbmd1bGFyLmNvcHkoZGF0YSkpXVxyXG4gICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhyZXMsIFwiPT09PT09PT09PT09PT09PT09PVwiKTtcclxuICAgIC8vICAgICAgICAgcmV0dXJuIHJlc1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxuXHJcbiAgICAvL+mAkuW9kuWIpOaWreaVsOaNruS4ultudW0sbnVtXeaIlltbbnVtLG51bV0sW251bSxudW1dXVxyXG4gICAgLy8gcHJpdmF0ZSBpZk5lZWRVbml0KGRhdGE6IEFycmF5PGFueT4pIHtcclxuICAgIC8vICAgICBsZXQgaGFzVW5pdDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLy8gICAgIGRhdGEuZm9yRWFjaCgoZXZlcnlEYXRhOiBhbnkpID0+IHtcclxuICAgIC8vICAgICAgICAgaWYgKHR5cGVvZiAoZXZlcnlEYXRhKSA9PSBcIm51bWJlclwiKSB7XHJcbiAgICAvLyAgICAgICAgICAgICBpZiAoZXZlcnlEYXRhIC8gMTAwMDAgPCAxICYmIGV2ZXJ5RGF0YSAhPSAwKSB7XHJcbiAgICAvLyAgICAgICAgICAgICAgICAgaGFzVW5pdCA9IHRydWU7XHJcbiAgICAvLyAgICAgICAgICAgICB9XHJcbiAgICAvLyAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIChldmVyeURhdGEpID09IFwib2JqZWN0XCIgJiYgIWhhc1VuaXQpIHtcclxuICAgIC8vICAgICAgICAgICAgIGhhc1VuaXQgPSB0aGlzLmlmTmVlZFVuaXQoZXZlcnlEYXRhKSA/IHRoaXMuaWZOZWVkVW5pdChldmVyeURhdGEpIDogZmFsc2U7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICB9KVxyXG4gICAgLy8gICAgIHJldHVybiBoYXNVbml0XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy/kuIDnu7TmlbDnu4Tlkozkuoznu7TmlbDnu4TorqHnrpfljZXkvY3lgLxcclxuICAgIHB1YmxpYyBnZXRVbml0TnVtKGRhdGE6IEFycmF5PGFueT4pIHtcclxuICAgICAgICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgZXZlcnlEYXRhID0gZGF0YVtpXSBhcyBhbnk7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIChldmVyeURhdGEpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwibnVtYmVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gW10gYXMgQXJyYXk8bnVtYmVyPjtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBkYXRhLm1hcCgoaXRlbTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwoaXRlbSAvIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gW10gYXMgQXJyYXk8YW55PjtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLmZvckVhY2goKGl0ZW06IEFycmF5PG51bWJlcj4sIGlkeDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpZHhdID0gaXRlbS5tYXAoKGl0bTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKGl0bSAvIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5L2/55So57yT5a2Y55qE6YWN572u5paH5Lu25a6e546w5pS+5aSn5pWI5p6cXHJcbiAgICBwdWJsaWMgZW5sYXJnZSgkc2NvcGU6IGFueSwgbmFtZTogc3RyaW5nLCBkYXRhOiBhbnkpIHtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXMgYXMgYW55O1xyXG4gICAgICAgIGxldCBzY29wZTogeyBlbmxhcmdlOiBDaGFydE9wdGlvbnMuc2V0RW5sYXJnZURhdGEsICRkZXN0cm95OiBGdW5jdGlvbiB9ID0gJHNjb3BlLiRuZXcoKTtcclxuICAgICAgICBsZXQgZW5sYXJnZUtleTogQ2hhcnRPcHRpb25zLnNldEVubGFyZ2VEYXRhID0gZGF0YTtcclxuXHJcbiAgICAgICAgc2NvcGUuZW5sYXJnZSA9IGVubGFyZ2VLZXk7XHJcblxyXG4gICAgICAgIGlmIChlbmxhcmdlS2V5KSB7XHJcbiAgICAgICAgICAgIGxldCBza2luOiBzdHJpbmcgPSAnZW5sYXJnZUVjaGFydCBuby1zY3JvbGwnO1xyXG4gICAgICAgICAgICBsZXQgYXJlYTogQXJyYXk8c3RyaW5nPiA9IFtcIjEyMDBweFwiLCBcIjcwMHB4XCJdO1xyXG4gICAgICAgICAgICBpZiAoZW5sYXJnZUtleS5uYW1lID09IFwiQWxsUmFua0xpc3RcIikge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuZW5sYXJnZSA9IGFuZ3VsYXIuY29weShkYXRhKTtcclxuICAgICAgICAgICAgICAgIGFyZWEgPSBbXCI3NTFweFwiLCBcIjUxMXB4XCJdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudExheWVySW5kZXggPSB0aGlzLmxheWVyLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogMSxcclxuICAgICAgICAgICAgICAgIHNraW46IHNraW4sXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBlbmxhcmdlSHRtbCxcclxuICAgICAgICAgICAgICAgIHNjb3BlOiBzY29wZSxcclxuICAgICAgICAgICAgICAgIC8vIHRpdGxlOiB0aGlzLmkxOG5GYWN0b3J5KHRpdGxlKSxcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBbZW5sYXJnZUtleS50aXRsZSwgXCJiYWNrZ3JvdW5kLWNvbG9yOiMyRDg3Rjk7Y29sb3I6I2ZmZlwiXSxcclxuICAgICAgICAgICAgICAgIGFyZWE6IGFyZWEsXHJcbiAgICAgICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxheWVyLm1zZyhcIuaaguaXoOaVsOaNrlwiKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuYXBwLnNlcnZpY2UoJ2VjaGFydEZhY3RvcnknLCBFY2hhcnRGYWN0b3J5KTsiXX0=

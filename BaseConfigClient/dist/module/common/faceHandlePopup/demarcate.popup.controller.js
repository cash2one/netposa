define(["require", "exports", "../app/main.app", "../../../core/params/ToolOptionParams", "css!./faceHandlePopup.css", "../../common/services/toolOption.service", "./comparison.factory", "../../common/factory/layerMsg.factory"], function (require, exports, main_app_1, ToolOptionParams_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var DemarcatePopupController = (function () {
        function DemarcatePopupController($scope, layer, toolOptionService, comparisonFactory, layerDec, i18nFactory) {
            var vm = this;
            var $ = angular.element;
            vm.cancelDemarcate = cancelDemarcate;
            vm.demarcateFace = demarcateFace;
            vm.demarcatePoint = [];
            vm.getDemarcateKey = getDemarcateKey;
            $scope.$on("$destroy", function () {
                console.error("销毁了弹出框");
            });
            vm.flag = $scope.flag ? $scope.flag : false;
            vm.demarcateImgUrl = vm.flag ? $scope.imgUrl : "data:image/jpeg;base64," + $scope.data.image;
            vm.file = $scope.file;
            vm.image = $scope.data.image;
            vm.fromDemarcateFaceCtrl = $scope.fromDemarcateFaceCtrl;
            vm.commandType = $scope.commandType;
            vm.detectType = $scope.detectType;
            function cancelDemarcate() {
                layer.close($scope.layerIndex);
                $scope.$destroy();
            }
            function demarcateFace($event, id) {
                if (vm.demarcatePoint.length >= 5) {
                    return;
                }
                var width = $event.target.offsetWidth;
                var height = $event.target.offsetHeight;
                var offsetX = $event.offsetX ? $event.offsetX : $event.originalEvent.layerX;
                var offsetY = $event.offsetY ? $event.offsetY : $event.originalEvent.layerY - $event.target.offsetTop;
                var x = vm.file._info.width * offsetX / width;
                var y = vm.file._info.height * offsetY / height;
                var left = $event.offsetX ? offsetX - 10 : $event.originalEvent.layerX - 10;
                var top = $event.offsetY ? offsetY - 10 + $event.target.offsetTop : $event.originalEvent.layerY - 10;
                var $div = $(id);
                var $span = $("<span>");
                var $img = $("<img>");
                var $em = $("<em>");
                $em.html(vm.demarcatePoint.length + 1);
                $em.css({
                    "position": "absolute",
                    "top": "-14px",
                    "left": 0,
                    "color": "orange",
                    "width": "100%",
                    "textAlign": "center"
                });
                $img[0].src = "../../../images/common/dot.png";
                $span.css({
                    "position": "absolute",
                    'left': left + "px",
                    "lineHeight": 0,
                    "top": top + "px"
                });
                $span.append($img);
                $span.append($em);
                $div.append($span);
                vm.demarcatePoint.push({ x: x, y: y });
                console.log(vm.demarcatePoint);
            }
            function faceBox(demarcatePoint, file) {
                if (demarcatePoint.length < 5) {
                    layerDec.warnInfo(i18nFactory('FDS_00_11_11'));
                    return {};
                }
                var eyeSpace = Math.abs(demarcatePoint[0].x - demarcatePoint[1].x) / 2;
                var leftSide = demarcatePoint[0].x < demarcatePoint[3].x ? demarcatePoint[0].x : demarcatePoint[3].x;
                var rightSide = demarcatePoint[1].x < demarcatePoint[4].x ? demarcatePoint[4].x : demarcatePoint[1].x;
                var topSide = demarcatePoint[0].y < demarcatePoint[1].y ? demarcatePoint[0].y : demarcatePoint[1].y;
                var botSide = demarcatePoint[3].y < demarcatePoint[4].y ? demarcatePoint[4].y : demarcatePoint[3].y;
                var result = new ToolOptionParams_1.DetectFaceParams();
                result.commandType = vm.commandType;
                result.detectType = vm.detectType;
                result.markInfo = {
                    "lefteye": {
                        "x": demarcatePoint[0].x,
                        "y": demarcatePoint[0].y
                    },
                    "righteye": {
                        "x": demarcatePoint[1].x,
                        "y": demarcatePoint[1].y
                    },
                    "nose": {
                        "x": demarcatePoint[2].x,
                        "y": demarcatePoint[2].y
                    },
                    "mouthleft": {
                        "x": demarcatePoint[3].x,
                        "y": demarcatePoint[3].y
                    },
                    "mouthright": {
                        "x": demarcatePoint[4].x,
                        "y": demarcatePoint[4].y
                    },
                    "left": leftSide - eyeSpace > 0 ? leftSide - eyeSpace : 0,
                    "right": rightSide + eyeSpace < file._info.width ? rightSide + eyeSpace : file._info.width,
                    "top": topSide - eyeSpace > 0 ? topSide - eyeSpace : 0,
                    "bottom": botSide + eyeSpace < file._info.height ? botSide + eyeSpace : file._info.height
                };
                if ($scope.flag) {
                    result.imageurl = $scope.imgUrl;
                }
                else {
                    result.imagedata = $scope.data.image;
                }
                return result;
            }
            function getDemarcateKey() {
                if (vm.demarcatePoint.length < 5) {
                    layerDec.warnInfo(i18nFactory('FDS_00_11_11'));
                    return;
                }
                toolOptionService.faceDemarcateDataList(faceBox(vm.demarcatePoint, vm.file)).then(complete);
                function complete(rep) {
                    if (rep.code === 200) {
                        comparisonFactory.getResponse(rep);
                        $scope.$emit(vm.fromDemarcateFaceCtrl, rep);
                    }
                    else {
                        layerDec.failInfo(i18nFactory('FDS_00_11_12'));
                    }
                    layer.close($scope.layerIndex);
                }
            }
        }
        DemarcatePopupController.$inject = [
            '$scope',
            'layer',
            'toolOptionService',
            'comparisonFactory',
            'layerDec',
            'i18nFactory'
        ];
        return DemarcatePopupController;
    }());
    main_app_1.app.controller('demarcatePopupController', DemarcatePopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvY29tbW9uL2ZhY2VIYW5kbGVQb3B1cC9kZW1hcmNhdGUucG9wdXAuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFzQkE7UUFrQ0ksa0NBQVksTUFBVyxFQUNYLEtBQVUsRUFDVixpQkFBcUMsRUFDckMsaUJBQXFDLEVBQ3JDLFFBQW1CLEVBQ25CLFdBQWU7WUFHdkIsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDO1lBQ2QsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztZQUN4QixFQUFFLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztZQUNyQyxFQUFFLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztZQUNqQyxFQUFFLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztZQUN2QixFQUFFLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztZQUVyQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRTtnQkFDbkIsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsQ0FBQztZQUdILEVBQUUsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQzVDLEVBQUUsQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMseUJBQXlCLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDN0YsRUFBRSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQ3RCLEVBQUUsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDN0IsRUFBRSxDQUFDLHFCQUFxQixHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQztZQUN4RCxFQUFFLENB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RDtnQkFFSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMvQixRQUFRLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO29CQUMvQyxNQUFNLENBQUM7Z0JBQ1gsQ0FBQztnQkFDRCxpQkFBaUIsQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzVGLGtCQUFrQixHQUFtQztvQkFDakQsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUVuQixpQkFBaUIsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBRW5DLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsQ0FBQyxDQUFDO29CQUNoRCxDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNKLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7b0JBQ25ELENBQUM7b0JBQ0QsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7Z0JBQ2xDLENBQUM7WUFDTCxDQUFDO1FBRUwsQ0FBQztRQTdMTSxnQ0FBTyxHQUFHO1lBQ2IsUUFBUTtZQUNSLE9BQU87WUFDUCxtQkFBbUI7WUFDbkIsbUJBQW1CO1lBQ25CLFVBQVU7WUFDVixhQUFhO1NBQ2hCLENBQUM7UUF1TE4sK0JBQUM7S0EvTEQsQUErTEMsSUFBQTtJQUVELGNBQUcsQ0FBQyxVQUFVLENBQUMsMEJBQTBCLEVBQUUsd0JBQXdCLENBQUMsQ0FBQyIsImZpbGUiOiJtb2R1bGUvY29tbW9uL2ZhY2VIYW5kbGVQb3B1cC9kZW1hcmNhdGUucG9wdXAuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IHRqIG9uIDIwMTcvNy8xNC5cclxuICovXHJcbmltcG9ydCB7YXBwfSBmcm9tIFwiLi4vYXBwL21haW4uYXBwXCI7XHJcbmltcG9ydCBcImNzcyEuL2ZhY2VIYW5kbGVQb3B1cC5jc3NcIjtcclxuXHJcbmltcG9ydCB7SVRvb2xPcHRpb25TZXJ2aWNlfSBmcm9tIFwiLi4vc2VydmljZXMvdG9vbE9wdGlvbi5zZXJ2aWNlXCJcclxuaW1wb3J0ICBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy90b29sT3B0aW9uLnNlcnZpY2VcIlxyXG5cclxuaW1wb3J0IHtJQ29tcGFyaXNvbkZhY3Rvcnl9IGZyb20gXCIuL2NvbXBhcmlzb24uZmFjdG9yeVwiXHJcbmltcG9ydCBcIi4vY29tcGFyaXNvbi5mYWN0b3J5XCJcclxuXHJcbmltcG9ydCB7UmVzcG9uc2VSZXN1bHR9IGZyb20gXCIuLi8uLi8uLi9jb3JlL3BhcmFtcy9yZXN1bHQvUmVzcG9uc2VSZXN1bHRcIjtcclxuaW1wb3J0IHtGYWNlQ29tcGFyaXNvbn0gZnJvbSBcIi4vY29tcGFyaXNvbk1vZGVsXCJcclxuXHJcbmltcG9ydCB7RGV0ZWN0RmFjZVBhcmFtcywgUG9pbnR9IGZyb20gXCIuLi8uLi8uLi9jb3JlL3BhcmFtcy9Ub29sT3B0aW9uUGFyYW1zXCJcclxuXHJcbmltcG9ydCB7SUxheWVyRGVjfSBmcm9tIFwiLi4vLi4vY29tbW9uL2ZhY3RvcnkvbGF5ZXJNc2cuZmFjdG9yeVwiXHJcbmltcG9ydCBcIi4uLy4uL2NvbW1vbi9mYWN0b3J5L2xheWVyTXNnLmZhY3RvcnlcIlxyXG5cclxuZGVjbGFyZSBsZXQgYW5ndWxhcjogYW55O1xyXG5cclxuY2xhc3MgRGVtYXJjYXRlUG9wdXBDb250cm9sbGVyIHtcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gW1xyXG4gICAgICAgICckc2NvcGUnLFxyXG4gICAgICAgICdsYXllcicsXHJcbiAgICAgICAgJ3Rvb2xPcHRpb25TZXJ2aWNlJyxcclxuICAgICAgICAnY29tcGFyaXNvbkZhY3RvcnknLFxyXG4gICAgICAgICdsYXllckRlYycsXHJcbiAgICAgICAgJ2kxOG5GYWN0b3J5J1xyXG4gICAgXTtcclxuXHJcbiAgICAvL+S8oOWFpeWQjuWPsOWPguaVsFxyXG4gICAgY29tbWFuZFR5cGU6IHN0cmluZztcclxuICAgIGRldGVjdFR5cGU6IHN0cmluZztcclxuXHJcbiAgICAvL+W5v+aSreWIsOeItmNvbnRyb2xsZXLkuovku7blkI1cclxuICAgIGZyb21EZW1hcmNhdGVGYWNlQ3RybDogc3RyaW5nO1xyXG4gICAgLy/plIDmr4HlvLnmoYZcclxuICAgIGNhbmNlbERlbWFyY2F0ZTogRnVuY3Rpb247XHJcbiAgICAvL+imgeagh+WumueahOWbvueJh1xyXG4gICAgZGVtYXJjYXRlSW1nVXJsOiBzdHJpbmc7XHJcbiAgICAvL+agh+WumueCueS9jeWQiOmbhlxyXG4gICAgZGVtYXJjYXRlUG9pbnQ6IEFycmF5PFBvaW50PjtcclxuICAgIC8v5qCH5a6aXHJcbiAgICBkZW1hcmNhdGVGYWNlOiBGdW5jdGlvbjtcclxuXHJcbiAgICAvL+agh+WumuWujOaIkOiOt+WPliBrZXlcclxuICAgIGdldERlbWFyY2F0ZUtleTogRnVuY3Rpb247XHJcbiAgICAvL2ZsYWfkuLp0cnVl5Luj6KGo6YeN5paw5qCH5a6aXHJcbiAgICBmbGFnOiBib29sZWFuO1xyXG5cclxuICAgIGZpbGU6IGFueTtcclxuICAgIC8v5Zu+54mH5pWw5o2uXHJcbiAgICBpbWFnZTogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCRzY29wZTogYW55LFxyXG4gICAgICAgICAgICAgICAgbGF5ZXI6IGFueSxcclxuICAgICAgICAgICAgICAgIHRvb2xPcHRpb25TZXJ2aWNlOiBJVG9vbE9wdGlvblNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBjb21wYXJpc29uRmFjdG9yeTogSUNvbXBhcmlzb25GYWN0b3J5LFxyXG4gICAgICAgICAgICAgICAgbGF5ZXJEZWM6IElMYXllckRlYyxcclxuICAgICAgICAgICAgICAgIGkxOG5GYWN0b3J5OmFueVxyXG4gICAgKSB7XHJcblxyXG4gICAgICAgIGxldCB2bSA9IHRoaXM7XHJcbiAgICAgICAgbGV0ICQgPSBhbmd1bGFyLmVsZW1lbnQ7XHJcbiAgICAgICAgdm0uY2FuY2VsRGVtYXJjYXRlID0gY2FuY2VsRGVtYXJjYXRlO1xyXG4gICAgICAgIHZtLmRlbWFyY2F0ZUZhY2UgPSBkZW1hcmNhdGVGYWNlO1xyXG4gICAgICAgIHZtLmRlbWFyY2F0ZVBvaW50ID0gW107XHJcbiAgICAgICAgdm0uZ2V0RGVtYXJjYXRlS2V5ID0gZ2V0RGVtYXJjYXRlS2V5O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKFwiJGRlc3Ryb3lcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi6ZSA5q+B5LqG5by55Ye65qGGXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL+aOpeaUtueItuS9nOeUqOWfn+WPguaVsFxyXG4gICAgICAgIHZtLmZsYWcgPSAkc2NvcGUuZmxhZyA/ICRzY29wZS5mbGFnIDogZmFsc2U7XHJcbiAgICAgICAgdm0uZGVtYXJjYXRlSW1nVXJsID0gdm0uZmxhZyA/ICRzY29wZS5pbWdVcmwgOiBcImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsXCIgKyAkc2NvcGUuZGF0YS5pbWFnZTtcclxuICAgICAgICB2bS5maWxlID0gJHNjb3BlLmZpbGU7XHJcbiAgICAgICAgdm0uaW1hZ2UgPSAkc2NvcGUuZGF0YS5pbWFnZTtcclxuICAgICAgICB2bS5mcm9tRGVtYXJjYXRlRmFjZUN0cmwgPSAkc2NvcGUuZnJvbURlbWFyY2F0ZUZhY2VDdHJsO1xyXG4gICAgICAgIHZtLmNvbW1hbmRUeXBlID0gJHNjb3BlLmNvbW1hbmRUeXBlO1xyXG4gICAgICAgIHZtLmRldGVjdFR5cGUgPSAkc2NvcGUuZGV0ZWN0VHlwZTtcclxuXHJcbiAgICAgICAgLy/lhbPpl63lvLnlh7rmoYZcclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWxEZW1hcmNhdGUoKSB7XHJcbiAgICAgICAgICAgIGxheWVyLmNsb3NlKCRzY29wZS5sYXllckluZGV4KTtcclxuICAgICAgICAgICAgJHNjb3BlLiRkZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+S6uuiEuOagh+WumiDnlLvngrlcclxuICAgICAgICBmdW5jdGlvbiBkZW1hcmNhdGVGYWNlKCRldmVudDogYW55LCBpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIC8v5Y+q6IO955S75LqU5Liq54K5XHJcbiAgICAgICAgICAgIGlmICh2bS5kZW1hcmNhdGVQb2ludC5sZW5ndGggPj0gNSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v5b2T5YmN5bGV56S65Ye655qE5Zu+54mH5a696auYXHJcbiAgICAgICAgICAgIGxldCB3aWR0aDpudW1iZXIgPSAkZXZlbnQudGFyZ2V0Lm9mZnNldFdpZHRoO1xyXG4gICAgICAgICAgICBsZXQgaGVpZ2h0Om51bWJlciA9ICRldmVudC50YXJnZXQub2Zmc2V0SGVpZ2h0O1xyXG4gICAgICAgICAgICAvL+WFvOWuueeBq+eLkOWIpOaWrW9mZnNldFjmmK/lkKbkuLp1bmRlZmluZWRcclxuICAgICAgICAgICAgbGV0IG9mZnNldFg6bnVtYmVyID0gICRldmVudC5vZmZzZXRYID8gJGV2ZW50Lm9mZnNldFggOiAkZXZlbnQub3JpZ2luYWxFdmVudC5sYXllclg7XHJcbiAgICAgICAgICAgIGxldCBvZmZzZXRZOm51bWJlciA9ICAkZXZlbnQub2Zmc2V0WSA/ICRldmVudC5vZmZzZXRZIDogJGV2ZW50Lm9yaWdpbmFsRXZlbnQubGF5ZXJZIC0gJGV2ZW50LnRhcmdldC5vZmZzZXRUb3A7XHJcblxyXG4gICAgICAgICAgICBsZXQgeDogbnVtYmVyID0gdm0uZmlsZS5faW5mby53aWR0aCAqIG9mZnNldFggLyB3aWR0aDtcclxuICAgICAgICAgICAgbGV0IHk6IG51bWJlciA9IHZtLmZpbGUuX2luZm8uaGVpZ2h0ICogb2Zmc2V0WSAvIGhlaWdodDtcclxuXHJcbiAgICAgICAgICAgIGxldCBsZWZ0Om51bWJlciA9ICRldmVudC5vZmZzZXRYID8gb2Zmc2V0WCAtIDEwIDogJGV2ZW50Lm9yaWdpbmFsRXZlbnQubGF5ZXJYIC0gMTA7XHJcbiAgICAgICAgICAgIGxldCB0b3A6bnVtYmVyID0gJGV2ZW50Lm9mZnNldFkgPyBvZmZzZXRZIC0gMTAgKyAkZXZlbnQudGFyZ2V0Lm9mZnNldFRvcCA6ICRldmVudC5vcmlnaW5hbEV2ZW50LmxheWVyWSAtIDEwO1xyXG5cclxuICAgICAgICAgICAgbGV0ICRkaXYgPSAkKGlkKTtcclxuICAgICAgICAgICAgbGV0ICRzcGFuID0gJChcIjxzcGFuPlwiKTtcclxuICAgICAgICAgICAgbGV0ICRpbWcgPSAkKFwiPGltZz5cIik7XHJcbiAgICAgICAgICAgIGxldCAkZW0gPSAkKFwiPGVtPlwiKTtcclxuICAgICAgICAgICAgJGVtLmh0bWwodm0uZGVtYXJjYXRlUG9pbnQubGVuZ3RoICsgMSk7XHJcbiAgICAgICAgICAgICRlbS5jc3Moe1xyXG4gICAgICAgICAgICAgICAgXCJwb3NpdGlvblwiOiBcImFic29sdXRlXCIsXHJcbiAgICAgICAgICAgICAgICBcInRvcFwiOiBcIi0xNHB4XCIsXHJcbiAgICAgICAgICAgICAgICBcImxlZnRcIjogMCxcclxuICAgICAgICAgICAgICAgIFwiY29sb3JcIjogXCJvcmFuZ2VcIixcclxuICAgICAgICAgICAgICAgIFwid2lkdGhcIjogXCIxMDAlXCIsXHJcbiAgICAgICAgICAgICAgICBcInRleHRBbGlnblwiOiBcImNlbnRlclwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkaW1nWzBdLnNyYyA9IFwiLi4vLi4vLi4vaW1hZ2VzL2NvbW1vbi9kb3QucG5nXCI7XHJcbiAgICAgICAgICAgICRzcGFuLmNzcyh7XHJcbiAgICAgICAgICAgICAgICBcInBvc2l0aW9uXCI6IFwiYWJzb2x1dGVcIixcclxuICAgICAgICAgICAgICAgICdsZWZ0JzogIGxlZnQgKyBcInB4XCIsXHJcbiAgICAgICAgICAgICAgICBcImxpbmVIZWlnaHRcIjowLFxyXG4gICAgICAgICAgICAgICAgXCJ0b3BcIjogIHRvcCArIFwicHhcIlxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzcGFuLmFwcGVuZCgkaW1nKTtcclxuICAgICAgICAgICAgJHNwYW4uYXBwZW5kKCRlbSk7XHJcbiAgICAgICAgICAgICRkaXYuYXBwZW5kKCRzcGFuKTtcclxuICAgICAgICAgICAgLy/kurrohLjmoIflrprngrnkvY3lkIjpm4ZcclxuICAgICAgICAgICAgdm0uZGVtYXJjYXRlUG9pbnQucHVzaCh7eDogeCwgeTogeX0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh2bS5kZW1hcmNhdGVQb2ludCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+S6uuiEuOahhiDkuZ3kuKrlj4LmlbBcclxuICAgICAgICBmdW5jdGlvbiBmYWNlQm94KGRlbWFyY2F0ZVBvaW50OiBBcnJheTxQb2ludD4sIGZpbGU6IGFueSkge1xyXG4gICAgICAgICAgICBpZiAoZGVtYXJjYXRlUG9pbnQubGVuZ3RoIDwgNSkge1xyXG4gICAgICAgICAgICAgICAgbGF5ZXJEZWMud2FybkluZm8oaTE4bkZhY3RvcnkoJ0ZEU18wMF8xMV8xMScpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7fSBhcyBEZXRlY3RGYWNlUGFyYW1zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v5Lik55y86Led56a75LiA5Y2KXHJcbiAgICAgICAgICAgIGxldCBleWVTcGFjZTogbnVtYmVyID0gTWF0aC5hYnMoZGVtYXJjYXRlUG9pbnRbMF0ueCAtIGRlbWFyY2F0ZVBvaW50WzFdLngpIC8gMjtcclxuICAgICAgICAgICAgLy/liKTmlq3mnIDlt6bvvIzmnIDlj7PvvIzmnIDkuIrvvIzmnIDkuItcclxuICAgICAgICAgICAgbGV0IGxlZnRTaWRlOiBudW1iZXIgPSBkZW1hcmNhdGVQb2ludFswXS54IDwgZGVtYXJjYXRlUG9pbnRbM10ueCA/IGRlbWFyY2F0ZVBvaW50WzBdLnggOiBkZW1hcmNhdGVQb2ludFszXS54O1xyXG4gICAgICAgICAgICBsZXQgcmlnaHRTaWRlOiBudW1iZXIgPSBkZW1hcmNhdGVQb2ludFsxXS54IDwgZGVtYXJjYXRlUG9pbnRbNF0ueCA/IGRlbWFyY2F0ZVBvaW50WzRdLnggOiBkZW1hcmNhdGVQb2ludFsxXS54O1xyXG4gICAgICAgICAgICBsZXQgdG9wU2lkZTogbnVtYmVyID0gZGVtYXJjYXRlUG9pbnRbMF0ueSA8IGRlbWFyY2F0ZVBvaW50WzFdLnkgPyBkZW1hcmNhdGVQb2ludFswXS55IDogZGVtYXJjYXRlUG9pbnRbMV0ueTtcclxuICAgICAgICAgICAgbGV0IGJvdFNpZGU6IG51bWJlciA9IGRlbWFyY2F0ZVBvaW50WzNdLnkgPCBkZW1hcmNhdGVQb2ludFs0XS55ID8gZGVtYXJjYXRlUG9pbnRbNF0ueSA6IGRlbWFyY2F0ZVBvaW50WzNdLnk7XHJcblxyXG4gICAgICAgICAgICBsZXQgcmVzdWx0OiBEZXRlY3RGYWNlUGFyYW1zID0gbmV3IERldGVjdEZhY2VQYXJhbXMoKTtcclxuICAgICAgICAgICAgcmVzdWx0LmNvbW1hbmRUeXBlID0gdm0uY29tbWFuZFR5cGU7XHJcbiAgICAgICAgICAgIHJlc3VsdC5kZXRlY3RUeXBlID0gdm0uZGV0ZWN0VHlwZTtcclxuICAgICAgICAgICAgcmVzdWx0Lm1hcmtJbmZvID0ge1xyXG4gICAgICAgICAgICAgICAgXCJsZWZ0ZXllXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBcInhcIjogZGVtYXJjYXRlUG9pbnRbMF0ueCxcclxuICAgICAgICAgICAgICAgICAgICBcInlcIjogZGVtYXJjYXRlUG9pbnRbMF0ueVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwicmlnaHRleWVcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwieFwiOiBkZW1hcmNhdGVQb2ludFsxXS54LFxyXG4gICAgICAgICAgICAgICAgICAgIFwieVwiOiBkZW1hcmNhdGVQb2ludFsxXS55XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXCJub3NlXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBcInhcIjogZGVtYXJjYXRlUG9pbnRbMl0ueCxcclxuICAgICAgICAgICAgICAgICAgICBcInlcIjogZGVtYXJjYXRlUG9pbnRbMl0ueVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwibW91dGhsZWZ0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICBcInhcIjogZGVtYXJjYXRlUG9pbnRbM10ueCxcclxuICAgICAgICAgICAgICAgICAgICBcInlcIjogZGVtYXJjYXRlUG9pbnRbM10ueVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwibW91dGhyaWdodFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJ4XCI6IGRlbWFyY2F0ZVBvaW50WzRdLngsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ5XCI6IGRlbWFyY2F0ZVBvaW50WzRdLnlcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcImxlZnRcIjogbGVmdFNpZGUgLSBleWVTcGFjZSA+IDAgPyBsZWZ0U2lkZSAtIGV5ZVNwYWNlIDogMCxcclxuICAgICAgICAgICAgICAgIFwicmlnaHRcIjogcmlnaHRTaWRlICsgZXllU3BhY2UgPCBmaWxlLl9pbmZvLndpZHRoID8gcmlnaHRTaWRlICsgZXllU3BhY2UgOiBmaWxlLl9pbmZvLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgXCJ0b3BcIjogdG9wU2lkZSAtIGV5ZVNwYWNlID4gMCA/IHRvcFNpZGUgLSBleWVTcGFjZSA6IDAsXHJcbiAgICAgICAgICAgICAgICBcImJvdHRvbVwiOiBib3RTaWRlICsgZXllU3BhY2UgPCBmaWxlLl9pbmZvLmhlaWdodCA/IGJvdFNpZGUgKyBleWVTcGFjZSA6IGZpbGUuX2luZm8uaGVpZ2h0XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmZsYWcpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5pbWFnZXVybCA9ICRzY29wZS5pbWdVcmw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuaW1hZ2VkYXRhID0gJHNjb3BlLmRhdGEuaW1hZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+WPguaVsCcsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+agh+WumuWujOaIkCDojrflj5ZrZXlcclxuICAgICAgICBmdW5jdGlvbiBnZXREZW1hcmNhdGVLZXkoKSB7XHJcbiAgICAgICAgICAgIC8v6YCJ5aSf5LqU5Liq54K55omN5b6A5LiL6LWwXHJcbiAgICAgICAgICAgIGlmICh2bS5kZW1hcmNhdGVQb2ludC5sZW5ndGggPCA1KSB7XHJcbiAgICAgICAgICAgICAgICBsYXllckRlYy53YXJuSW5mbyhpMThuRmFjdG9yeSgnRkRTXzAwXzExXzExJykpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRvb2xPcHRpb25TZXJ2aWNlLmZhY2VEZW1hcmNhdGVEYXRhTGlzdChmYWNlQm94KHZtLmRlbWFyY2F0ZVBvaW50LCB2bS5maWxlKSkudGhlbihjb21wbGV0ZSk7XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlKHJlcDogUmVzcG9uc2VSZXN1bHQ8RmFjZUNvbXBhcmlzb24+KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVwLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmoIflrprnu5PmnpxrZXknLCByZXApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb25GYWN0b3J5LmdldFJlc3BvbnNlKHJlcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/lsIblvpfliLDov5Tlm57nu5Pmnpzlub/mkq3liLDniLbkvZznlKjln59cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQodm0uZnJvbURlbWFyY2F0ZUZhY2VDdHJsLCByZXApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsYXllckRlYy5mYWlsSW5mbyhpMThuRmFjdG9yeSgnRkRTXzAwXzExXzEyJykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGF5ZXIuY2xvc2UoJHNjb3BlLmxheWVySW5kZXgpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG5hcHAuY29udHJvbGxlcignZGVtYXJjYXRlUG9wdXBDb250cm9sbGVyJywgRGVtYXJjYXRlUG9wdXBDb250cm9sbGVyKTsiXX0=

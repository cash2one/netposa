define(["require", "exports", "../../../portrait-tool"], function (require, exports, portrait_tool_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var TraceAnalyzeModel = (function () {
        function TraceAnalyzeModel(points, mapId, layer, opts) {
            this.speed = opts.speed || 100;
            this.opts = opts || {};
            this.mapId = mapId;
            this.points = points || [];
            this.layer = layer;
            this.startMarkUrl = opts.startMarkUrl || '/images/map/map-marker-start.png';
            this.endMarkUrl = opts.endMarkUrl || '/images/map/map-marker-end.png';
            this.normalMarkUrl = opts.normalMarkUrl || '/images/map/map-marker-smallpink.png';
            this.moveUrl = opts.moveUrl || "/images/map/temptracker.png";
            this.showMarkers = opts.showMarkers || false;
            if (angular.isArray(this.points) && this.points.length > 0) {
                this.init();
            }
            else {
                console.error("TraceAnalyzeModel init error: points is null!");
            }
        }
        TraceAnalyzeModel.prototype.init = function () {
            this.id = portrait_tool_1.default.getUUID();
            this.animationLine = new NPMapLib.Symbols.AnimationLine(this.mapId, this.points, this.getAnimationLineOpt(this.points[0], this.opts));
            this.bindEvent();
            this.speed = this.opts.speed || this.speed;
            this.animationLine.setSpeed(this.opts.speed || this.speed);
            this.setLayer();
            if (this.showMarkers) {
                this.initMarkers();
            }
        };
        TraceAnalyzeModel.prototype.initMarkers = function () {
            var markers = [];
            var i, len, point, key, temp = {};
            for (i = 0, len = this.points.length; i < len; i++) {
                point = this.points[i];
                key = getPointKey(point.lat, point.lon);
                if (temp[key] == null) {
                    temp[key] = 0;
                }
                else {
                    temp[key] = temp[key] + 1;
                }
                markers.push(this.createPointMarker(point, (i + 1) + "", i, temp[key], i === (len - 1)));
            }
            this.markers = markers;
            function getPointKey(lat, lon) {
                return lat + "_" + lon;
            }
        };
        TraceAnalyzeModel.prototype.createPointMarker = function (point, label, index, repeat, isEnd) {
            var marker = new NPMapLib.Symbols.Marker(point);
            if (index == 0) {
                marker.setIcon(new NPMapLib.Symbols.Icon(this.startMarkUrl, new NPMapLib.Geometry.Size(32, 32), { anchor: new NPMapLib.Geometry.Size(-14, -29) }));
            }
            else if (isEnd) {
                marker.setIcon(new NPMapLib.Symbols.Icon(this.endMarkUrl, new NPMapLib.Geometry.Size(32, 32), { anchor: new NPMapLib.Geometry.Size(-14, -26) }));
            }
            else {
                marker.setIcon(new NPMapLib.Symbols.Icon(this.normalMarkUrl, new NPMapLib.Geometry.Size(32, 32), { anchor: new NPMapLib.Geometry.Size(-14, -26) }));
                var l = new NPMapLib.Symbols.Label(label, {
                    "position": point,
                    "offset": new NPMapLib.Geometry.Size(2, 16)
                });
                l.setStyle({ fontSize: 12, fontFamily: 'Arail', color: 'white', align: 'center', isBold: true });
                marker.setLabel(l);
            }
            return marker;
        };
        TraceAnalyzeModel.prototype.getAnimationLineOpt = function (point, opts) {
            return {
                headerMarker: this.createHeaderMarker(point),
                color: opts.color || 'red',
                opacity: opts.opacity || 0.8,
                weight: opts.weight || 10
            };
        };
        TraceAnalyzeModel.prototype.createHeaderMarker = function (point) {
            var marker = new NPMapLib.Symbols.Marker(point, { offset: new NPMapLib.Geometry.Size(0, -12) });
            marker.setIcon(new NPMapLib.Symbols.Icon(this.moveUrl, new NPMapLib.Geometry.Size(29, 29)));
            marker.setData({ name: 'move' });
            this.layer.addOverlay(marker);
            return marker;
        };
        TraceAnalyzeModel.prototype.start = function () {
            if (this.animationLine) {
                this.animationLine.start();
            }
        };
        TraceAnalyzeModel.prototype.restart = function () {
            this.clear();
            if (this.animationLine) {
                this.animationLine.restart();
            }
        };
        TraceAnalyzeModel.prototype.pause = function () {
            if (this.animationLine) {
                this.animationLine.pause();
            }
        };
        TraceAnalyzeModel.prototype.stop = function () {
            if (this.animationLine) {
                this.animationLine.stop();
            }
        };
        TraceAnalyzeModel.prototype.clear = function () {
            if (this.markers) {
                var i = void 0, len = void 0;
                for (i = 0, len = this.markers.length; i < len; i++) {
                    this.layer.removeOverlay(this.markers[i]);
                }
            }
        };
        TraceAnalyzeModel.prototype.remove = function () {
            if (this.animationLine) {
                this.animationLine.remove();
            }
            this.animationLine = null;
            this.layer.removeAllOverlays();
            this.points = null;
            this.markers = null;
        };
        TraceAnalyzeModel.prototype.drawMarkerInPreDraw = function (index) {
            if (this.markers) {
                var marker = this.markers[index];
                this.layer.addOverlay(marker);
                marker.showLabel();
            }
        };
        TraceAnalyzeModel.prototype.bindEvent = function () {
            var _this = this;
            if (this.animationLine == null || !this.opts) {
                return;
            }
            if (typeof this.opts.afterDraw === "function") {
                this.animationLine.events.register('afterDraw', function (evt) {
                    _this.opts.afterDraw(evt);
                });
            }
            this.animationLine.events.register('preDraw', function (evt) {
                _this.drawMarkerInPreDraw(evt.index);
                if (typeof _this.opts.preDraw === "function") {
                    _this.opts.preDraw(evt);
                }
            });
            if (typeof this.opts.afterStep === "function") {
                this.animationLine.events.register('afterStep', function (evt) {
                    _this.opts.afterStep(evt);
                });
            }
            if (typeof this.opts.start === "function") {
                this.animationLine.addEventListener(NPMapLib.ANIMATION_EVENT_START, function () {
                    _this.opts.start();
                });
            }
            if (typeof this.opts.pause === "function") {
                this.animationLine.addEventListener(NPMapLib.ANIMATION_EVENT_PAUSE, function () {
                    _this.opts.pause();
                });
            }
            if (typeof this.opts.stop === "function") {
                this.animationLine.addEventListener(NPMapLib.ANIMATION_EVENT_STOP, function () {
                    _this.opts.stop();
                });
            }
            if (typeof this.opts.moving === "function") {
                this.animationLine.addEventListener(NPMapLib.ANIMATION_EVENT_MOVING, this.opts.moving);
            }
            if (typeof this.opts.moved === "function") {
                this.animationLine.addEventListener(NPMapLib.ANIMATION_EVENT_MOVED, this.opts.moved);
            }
        };
        TraceAnalyzeModel.prototype.setLayer = function () {
            if (this.animationLine && this.layer) {
                this.animationLine.setLayer(this.layer);
            }
        };
        TraceAnalyzeModel.prototype.setSpeed = function (speed) {
            if (this.animationLine) {
                this.animationLine.setSpeed(speed || this.speed);
            }
        };
        return TraceAnalyzeModel;
    }());
    var TraceAnalyzeFactory = (function () {
        function TraceAnalyzeFactory(mapAdapter) {
            this.cacheAnimationLine = {};
            this.traceAnalyzeLayer = null;
            this.mapAdapter = mapAdapter;
            this.getTraceAnalyzeLayer();
        }
        TraceAnalyzeFactory.prototype.getTraceAnalyzeLayer = function () {
            if (this.traceAnalyzeLayer == null) {
                this.traceAnalyzeLayer = new NPMapLib.Layers.OverlayLayer(TraceAnalyzeFactory.TRACE_ANALYZE_LAYER_NAME);
                this.mapAdapter.addLayer(this.traceAnalyzeLayer);
            }
            return this.traceAnalyzeLayer;
        };
        TraceAnalyzeFactory.prototype.createTraceAnalyze = function (points, opts) {
            opts = opts || {};
            if (!angular.isArray(points)) {
                console.error("creatTraceAnalyze error: points is not array");
            }
            var model = this.createTraceAnalyzeModel(points, opts);
            this.saveAnimationLine(model.id, model);
            model.layer.setZIndex(201);
            return model.id;
        };
        TraceAnalyzeFactory.prototype.createTraceAnalyzeModel = function (points, opts) {
            return new TraceAnalyzeModel(points, this.mapAdapter.getMapId(), this.getTraceAnalyzeLayer(), opts);
        };
        TraceAnalyzeFactory.prototype.startTraceAnalyze = function (lineId) {
            var model = this.getAnimationLine(lineId);
            if (model) {
                model.start();
            }
        };
        TraceAnalyzeFactory.prototype.reStartTraceAnalyze = function (lineId) {
            var model = this.getAnimationLine(lineId);
            if (model) {
                model.restart();
            }
        };
        TraceAnalyzeFactory.prototype.stopTraceAnalyze = function (lineId) {
            var animationLine = this.getAnimationLine(lineId);
            if (animationLine) {
                animationLine.stop();
            }
        };
        TraceAnalyzeFactory.prototype.pauseTraceAnalyze = function (lineId, flag) {
            var model = this.getAnimationLine(lineId);
            if (model) {
                flag === false ? model.start() : model.pause();
            }
        };
        TraceAnalyzeFactory.prototype.clearTraceAnalyze = function (lineId) {
            var model = this.getAnimationLine(lineId);
            if (model) {
                model.remove();
            }
            this.removeAnimationLine(lineId);
        };
        TraceAnalyzeFactory.prototype.setSpeed = function (lineId, speed) {
            var model = this.getAnimationLine(lineId);
            if (model) {
                model.setSpeed(speed || TraceAnalyzeFactory.DEFAULT_SPEED);
            }
        };
        TraceAnalyzeFactory.prototype.destroy = function () {
            this.cacheAnimationLine = null;
        };
        TraceAnalyzeFactory.prototype.getAnimationLine = function (lineId) {
            return this.cacheAnimationLine[lineId];
        };
        TraceAnalyzeFactory.prototype.saveAnimationLine = function (lineId, traceAnalyzeModel) {
            if (lineId != null) {
                this.cacheAnimationLine[lineId] = traceAnalyzeModel;
            }
            else {
                console.error("TraceAnalyzeFactory.saveAnimationLine fail: lineId is null!");
            }
        };
        TraceAnalyzeFactory.prototype.removeAnimationLine = function (lineId) {
            if (this.cacheAnimationLine[lineId]) {
                delete this.cacheAnimationLine[lineId];
            }
        };
        TraceAnalyzeFactory.TRACE_ANALYZE_LAYER_NAME = "traceAnalyze";
        TraceAnalyzeFactory.DEFAULT_SPEED = 1000;
        return TraceAnalyzeFactory;
    }());
    exports.TraceAnalyzeFactory = TraceAnalyzeFactory;
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvY29tbW9uL21hcC9jb3JlL21vZGVsL3RyYWNlLmFuYWx5emUuZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFrQkE7UUFjSSwyQkFBWSxNQUFzQyxFQUFFLEtBQWEsRUFBRSxLQUFZLEVBQUUsSUFBdUI7WUFDcEcsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLEdBQUcsQ0FBQztZQUMvQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxFQUFzQixDQUFDO1lBQzNDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ25CLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQXFCLENBQUM7WUFDbkMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxJQUFJLGtDQUFrQyxDQUFDO1lBQzVFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxnQ0FBZ0MsQ0FBQztZQUN0RSxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLElBQUksc0NBQXNDLENBQUM7WUFDbEYsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLDZCQUE2QixDQUFDO1lBQzdELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUM7WUFDN0MsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2hCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixPQUFPLENBQUMsS0FBSyxDQUFDLCtDQUErQyxDQUFDLENBQUM7WUFDbkUsQ0FBQztRQUNMLENBQUM7UUFNTyxnQ0FBSSxHQUFaO1lBQ0ksSUFBSSxDQUFDLEVBQUUsR0FBRyx1QkFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDdEksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRWpCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMzQyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFM0QsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBRWhCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQSxDQUFDO2dCQUNqQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkIsQ0FBQztRQUVMLENBQUM7UUFLTyx1Q0FBVyxHQUFuQjtZQUVJLElBQUksT0FBTyxHQUFFLEVBQW1CLENBQUM7WUFFakMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxHQUFHLEVBQStCLENBQUM7WUFDL0QsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNqRCxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkIsR0FBRyxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDeEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2xCLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzlCLENBQUM7Z0JBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0YsQ0FBQztZQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1lBR3ZCLHFCQUFxQixHQUFXLEVBQUUsR0FBVztnQkFDekMsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQzNCLENBQUM7UUFDTCxDQUFDO1FBV08sNkNBQWlCLEdBQXpCLFVBQTBCLEtBQVksRUFBRSxLQUFhLEVBQUUsS0FBYSxFQUFFLE1BQWMsRUFBRSxLQUFlO1lBQ2pHLElBQUksTUFBTSxHQUFHLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRWIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JKLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFFZixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkosQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUdKLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEVBQUcsQ0FBQyxFQUFFLENBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEosSUFBSSxDQUFDLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUU7b0JBQ3RDLFVBQVUsRUFBRSxLQUFLO29CQUNqQixRQUFRLEVBQUUsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUM5QyxDQUFDLENBQUM7Z0JBRUgsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7Z0JBQy9GLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFPdkIsQ0FBQztZQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQVFPLCtDQUFtQixHQUEzQixVQUE0QixLQUE4QixFQUFFLElBQXVCO1lBQy9FLE1BQU0sQ0FBQztnQkFDSCxZQUFZLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQztnQkFDNUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLElBQUksS0FBSztnQkFDMUIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLElBQUksR0FBRztnQkFDNUIsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLElBQUksRUFBRTthQUM1QixDQUFDO1FBQ04sQ0FBQztRQU9PLDhDQUFrQixHQUExQixVQUEyQixLQUE4QjtZQUNyRCxJQUFJLE1BQU0sR0FBRyxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUM5RixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFDLElBQUksRUFBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQTBCLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2xCLENBQUM7UUFLRCxpQ0FBSyxHQUFMO1lBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDL0IsQ0FBQztRQUNMLENBQUM7UUFLRCxtQ0FBTyxHQUFQO1lBRUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDakMsQ0FBQztRQUNMLENBQUM7UUFLRCxpQ0FBSyxHQUFMO1lBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDL0IsQ0FBQztRQUNMLENBQUM7UUFLRCxnQ0FBSSxHQUFKO1lBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDOUIsQ0FBQztRQUNMLENBQUM7UUFLTyxpQ0FBSyxHQUFiO1lBRUksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLFNBQUEsRUFBRSxHQUFHLFNBQUEsQ0FBQztnQkFDWCxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ2xELElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUMsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBTUQsa0NBQU0sR0FBTjtZQUNJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hDLENBQUM7WUFDRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQztZQUUxQixJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDeEIsQ0FBQztRQUVPLCtDQUFtQixHQUEzQixVQUE0QixLQUFhO1lBQ3JDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNmLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUM5QixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDdkIsQ0FBQztRQUNMLENBQUM7UUFFRCxxQ0FBUyxHQUFUO1lBQUEsaUJBZ0RDO1lBL0NHLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLE1BQU0sQ0FBQztZQUNYLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQzVDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUErQjtvQkFDNUUsS0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzdCLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztZQUVELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsVUFBQyxHQUErQjtnQkFFMUUsS0FBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDcEMsRUFBRSxDQUFDLENBQUMsT0FBTyxLQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUMxQyxLQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDM0IsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ0gsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUM1QyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBK0I7b0JBQzVFLEtBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM3QixDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLHFCQUFxQixFQUFFO29CQUVoRSxLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUN0QixDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLHFCQUFxQixFQUFFO29CQUVoRSxLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUN0QixDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLG9CQUFvQixFQUFFO29CQUUvRCxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNyQixDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBRXpDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLHNCQUFzQixFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0YsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFFeEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6RixDQUFDO1FBQ0wsQ0FBQztRQUVPLG9DQUFRLEdBQWhCO1lBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDbkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzVDLENBQUM7UUFDTCxDQUFDO1FBRUQsb0NBQVEsR0FBUixVQUFTLEtBQWE7WUFDbEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDckQsQ0FBQztRQUNMLENBQUM7UUFDTCx3QkFBQztJQUFELENBdlJBLEFBdVJDLElBQUE7SUFLRDtRQVNJLDZCQUFZLFVBQXVCO1lBSDNCLHVCQUFrQixHQUF5QyxFQUFFLENBQUM7WUFDOUQsc0JBQWlCLEdBQWlCLElBQUksQ0FBQztZQUczQyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztZQUM3QixJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUNoQyxDQUFDO1FBRU8sa0RBQW9CLEdBQTVCO1lBQ0ksRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLG1CQUFtQixDQUFDLHdCQUF3QixDQUFDLENBQUM7Z0JBQ3hHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3JELENBQUM7WUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1FBQ2xDLENBQUM7UUFTRCxnREFBa0IsR0FBbEIsVUFBbUIsTUFBc0MsRUFBRSxJQUF1QjtZQUU5RSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQXNCLENBQUM7WUFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDM0IsT0FBTyxDQUFDLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1lBQ2xFLENBQUM7WUFDRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3hDLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNCLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ3BCLENBQUM7UUFRTyxxREFBdUIsR0FBL0IsVUFBZ0MsTUFBc0MsRUFBRSxJQUF1QjtZQUMzRixNQUFNLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4RyxDQUFDO1FBT0QsK0NBQWlCLEdBQWpCLFVBQWtCLE1BQWM7WUFDNUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2xCLENBQUM7UUFDTCxDQUFDO1FBTUQsaURBQW1CLEdBQW5CLFVBQW9CLE1BQWM7WUFDOUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3BCLENBQUM7UUFDTCxDQUFDO1FBTUQsOENBQWdCLEdBQWhCLFVBQWlCLE1BQWM7WUFDM0IsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xELEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hCLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN6QixDQUFDO1FBQ0wsQ0FBQztRQU9ELCtDQUFpQixHQUFqQixVQUFrQixNQUFjLEVBQUUsSUFBYTtZQUMzQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDUixJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNuRCxDQUFDO1FBQ0wsQ0FBQztRQU1ELCtDQUFpQixHQUFqQixVQUFrQixNQUFjO1lBQzVCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNSLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNuQixDQUFDO1lBQ0QsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFFRCxzQ0FBUSxHQUFSLFVBQVMsTUFBYyxFQUFFLEtBQWE7WUFDbEMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksbUJBQW1CLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDL0QsQ0FBQztRQUNMLENBQUM7UUFLRCxxQ0FBTyxHQUFQO1lBQ0ksSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQztRQUNuQyxDQUFDO1FBRU8sOENBQWdCLEdBQXhCLFVBQXlCLE1BQWM7WUFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzQyxDQUFDO1FBRU8sK0NBQWlCLEdBQXpCLFVBQTBCLE1BQWMsRUFBRSxpQkFBb0M7WUFDMUUsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsR0FBRyxpQkFBaUIsQ0FBQztZQUN4RCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osT0FBTyxDQUFDLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1lBQ2pGLENBQUM7UUFDTCxDQUFDO1FBRU8saURBQW1CLEdBQTNCLFVBQTRCLE1BQWM7WUFDdEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0MsQ0FBQztRQUNMLENBQUM7UUF6SWMsNENBQXdCLEdBQUcsY0FBYyxDQUFDO1FBQzFDLGlDQUFhLEdBQUcsSUFBSSxDQUFDO1FBMEl4QywwQkFBQztLQTdJRCxBQTZJQyxJQUFBO0lBN0lZLGtEQUFtQiIsImZpbGUiOiJtb2R1bGUvY29tbW9uL21hcC9jb3JlL21vZGVsL3RyYWNlLmFuYWx5emUuZmFjdG9yeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGRlbGwgb24gMjAxNy82LzcuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHtUcmFjZUFuYWx5emVPcHRzfSBmcm9tIFwiLi4vLi4vbWFwLmludGVyZmFjZVwiO1xyXG5pbXBvcnQgUG9ydHJhaXRUb29sIGZyb20gXCIuLi8uLi8uLi9wb3J0cmFpdC10b29sXCI7XHJcbmltcG9ydCBBbmltYXRpb25MaW5lID0gTlBNYXBMaWIuU3ltYm9scy5BbmltYXRpb25MaW5lO1xyXG5pbXBvcnQgX0FuaW1hdGlvbkxpbmVQcmVEcmF3RXZlbnQgPSBOUE1hcExpYi5TeW1ib2xzLl9BbmltYXRpb25MaW5lUHJlRHJhd0V2ZW50O1xyXG5pbXBvcnQgT3ZlcmxheUxheWVyID0gTlBNYXBMaWIuTGF5ZXJzLk92ZXJsYXlMYXllcjtcclxuaW1wb3J0IFBvaW50ID0gTlBNYXBMaWIuR2VvbWV0cnkuUG9pbnQ7XHJcbmltcG9ydCBMYXllciA9IE5QTWFwTGliLkxheWVyO1xyXG5pbXBvcnQgTWFya2VyID0gTlBNYXBMaWIuU3ltYm9scy5NYXJrZXI7XHJcblxyXG5kZWNsYXJlIGxldCBhbmd1bGFyOiBhbnk7XHJcblxyXG4vKipcclxuICog6L2o6L+55a6e5L6LXHJcbiAqL1xyXG5jbGFzcyBUcmFjZUFuYWx5emVNb2RlbCB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgbWFya2VyczogQXJyYXk8TWFya2VyPjtcclxuICAgIGFuaW1hdGlvbkxpbmU6IEFuaW1hdGlvbkxpbmU7XHJcbiAgICBwb2ludHM6IEFycmF5PE5QTWFwTGliLkdlb21ldHJ5LlBvaW50PjtcclxuICAgIG9wdHM6IFRyYWNlQW5hbHl6ZU9wdHM7XHJcbiAgICBzcGVlZDogbnVtYmVyO1xyXG4gICAgbWFwSWQ6IG51bWJlcjtcclxuICAgIGxheWVyOiBOUE1hcExpYi5MYXllcnMuT3ZlcmxheUxheWVyO1xyXG4gICAgc3RhcnRNYXJrVXJsOiBzdHJpbmc7XHJcbiAgICBlbmRNYXJrVXJsOiBzdHJpbmc7XHJcbiAgICBub3JtYWxNYXJrVXJsOiBzdHJpbmc7XHJcbiAgICBtb3ZlVXJsOnN0cmluZztcclxuICAgIHNob3dNYXJrZXJzOmJvb2xlYW47XHJcbiAgICBjb25zdHJ1Y3Rvcihwb2ludHM6IEFycmF5PE5QTWFwTGliLkdlb21ldHJ5LlBvaW50PiwgbWFwSWQ6IG51bWJlciwgbGF5ZXI6IExheWVyLCBvcHRzPzogVHJhY2VBbmFseXplT3B0cykge1xyXG4gICAgICAgIHRoaXMuc3BlZWQgPSBvcHRzLnNwZWVkIHx8IDEwMDtcclxuICAgICAgICB0aGlzLm9wdHMgPSBvcHRzIHx8IHt9IGFzIFRyYWNlQW5hbHl6ZU9wdHM7XHJcbiAgICAgICAgdGhpcy5tYXBJZCA9IG1hcElkO1xyXG4gICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMubGF5ZXIgPSBsYXllciBhcyBPdmVybGF5TGF5ZXI7XHJcbiAgICAgICAgdGhpcy5zdGFydE1hcmtVcmwgPSBvcHRzLnN0YXJ0TWFya1VybCB8fCAnL2ltYWdlcy9tYXAvbWFwLW1hcmtlci1zdGFydC5wbmcnO1xyXG4gICAgICAgIHRoaXMuZW5kTWFya1VybCA9IG9wdHMuZW5kTWFya1VybCB8fCAnL2ltYWdlcy9tYXAvbWFwLW1hcmtlci1lbmQucG5nJztcclxuICAgICAgICB0aGlzLm5vcm1hbE1hcmtVcmwgPSBvcHRzLm5vcm1hbE1hcmtVcmwgfHwgJy9pbWFnZXMvbWFwL21hcC1tYXJrZXItc21hbGxwaW5rLnBuZyc7XHJcbiAgICAgICAgdGhpcy5tb3ZlVXJsID0gb3B0cy5tb3ZlVXJsIHx8IFwiL2ltYWdlcy9tYXAvdGVtcHRyYWNrZXIucG5nXCI7XHJcbiAgICAgICAgdGhpcy5zaG93TWFya2VycyA9IG9wdHMuc2hvd01hcmtlcnMgfHwgZmFsc2U7XHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh0aGlzLnBvaW50cykgJiYgdGhpcy5wb2ludHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHJhY2VBbmFseXplTW9kZWwgaW5pdCBlcnJvcjogcG9pbnRzIGlzIG51bGwhXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIneWni+WMlui9qOi/ueWIhuaekOWunuS+i1xyXG4gICAgICog5LiA5Liq5a6e5L6L5Y+q5omn6KGM5LiA5qyhXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICB0aGlzLmlkID0gUG9ydHJhaXRUb29sLmdldFVVSUQoKTtcclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUgPSBuZXcgTlBNYXBMaWIuU3ltYm9scy5BbmltYXRpb25MaW5lKHRoaXMubWFwSWQsIHRoaXMucG9pbnRzLCB0aGlzLmdldEFuaW1hdGlvbkxpbmVPcHQodGhpcy5wb2ludHNbMF0sIHRoaXMub3B0cykpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50KCk7XHJcbiAgICAgICAgLy8g6K6+572u6YCf5bqmXHJcbiAgICAgICAgdGhpcy5zcGVlZCA9IHRoaXMub3B0cy5zcGVlZCB8fCB0aGlzLnNwZWVkO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uTGluZS5zZXRTcGVlZCh0aGlzLm9wdHMuc3BlZWQgfHwgdGhpcy5zcGVlZCk7XHJcbiAgICAgICAgLy8g6K6+572u6L2o6L+557q/5pi+56S655qE5Zu+5bGCXHJcbiAgICAgICAgdGhpcy5zZXRMYXllcigpO1xyXG4gICAgICAgIC8vIOWIneWni+WMlui9qOi/ueWIhuaekOeCueS9jVxyXG4gICAgICAgIGlmKHRoaXMuc2hvd01hcmtlcnMpe1xyXG4gICAgICAgICAgICB0aGlzLmluaXRNYXJrZXJzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIneWni+WMlui9qOi/ueWIhuaekOe6v+auteenu+WKqOi3r+W+hOS4iueahOeCueS9jVxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGluaXRNYXJrZXJzKCkge1xyXG4gICAgICAgIC8vIOWIneWni+WMlui9qOi/ueWIhuaekOi/h+eoi+S4reeahOeCueS9jeS/oeaBr1xyXG4gICAgICAgIGxldCBtYXJrZXJzID1bXSBhcyBBcnJheTxNYXJrZXI+O1xyXG4gICAgICAgIC8vIHRlbXDorrDlvZXngrnkvY3lnKjlkIzkuIDkuKrngrnkuIrph43lpI3lh7rnjrDmrKHmlbBcclxuICAgICAgICBsZXQgaSwgbGVuLCBwb2ludCwga2V5LCB0ZW1wID0ge30gYXMgeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBwb2ludCA9IHRoaXMucG9pbnRzW2ldO1xyXG4gICAgICAgICAgICBrZXkgPSBnZXRQb2ludEtleShwb2ludC5sYXQsIHBvaW50Lmxvbik7XHJcbiAgICAgICAgICAgIGlmICh0ZW1wW2tleV0gPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGVtcFtrZXldID0gMDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRlbXBba2V5XSA9IHRlbXBba2V5XSArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbWFya2Vycy5wdXNoKHRoaXMuY3JlYXRlUG9pbnRNYXJrZXIocG9pbnQsIChpICsgMSkgKyBcIlwiLCBpLCB0ZW1wW2tleV0sIGkgPT09IChsZW4gLSAxKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1hcmtlcnMgPSBtYXJrZXJzO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UG9pbnRLZXkobGF0OiBudW1iZXIsIGxvbjogbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsYXQgKyBcIl9cIiArIGxvbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rot6/lvoTkuIrnmoTngrnkvY3lrp7kvotcclxuICAgICAqIEBwYXJhbSBwb2ludFxyXG4gICAgICogQHBhcmFtIGxhYmVsXHJcbiAgICAgKiBAcGFyYW0gaW5kZXhcclxuICAgICAqIEBwYXJhbSByZXBlYXQg5ZCM5LiA5Liq54K55L2N55qE5Ye6546w5qyh5pWwXHJcbiAgICAgKiBAcmV0dXJucyB7TlBNYXBMaWIuU3ltYm9scy5NYXJrZXJ9XHJcbiAgICAgKiBUT0RPIOmHjOmdouWvueS6juS9jeenu+eahOaVsOWtl+i/mOmcgOimgee7n+S4gFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNyZWF0ZVBvaW50TWFya2VyKHBvaW50OiBQb2ludCwgbGFiZWw6IHN0cmluZywgaW5kZXg6IG51bWJlciwgcmVwZWF0OiBudW1iZXIsIGlzRW5kPzogYm9vbGVhbikge1xyXG4gICAgICAgIGxldCBtYXJrZXIgPSBuZXcgTlBNYXBMaWIuU3ltYm9scy5NYXJrZXIocG9pbnQpO1xyXG4gICAgICAgIGlmIChpbmRleCA9PSAwKSB7XHJcbiAgICAgICAgICAgIC8vIOi1t+eCueWbvuagh1xyXG4gICAgICAgICAgICBtYXJrZXIuc2V0SWNvbihuZXcgTlBNYXBMaWIuU3ltYm9scy5JY29uKHRoaXMuc3RhcnRNYXJrVXJsLCBuZXcgTlBNYXBMaWIuR2VvbWV0cnkuU2l6ZSgzMiwgMzIpLCB7YW5jaG9yOiBuZXcgTlBNYXBMaWIuR2VvbWV0cnkuU2l6ZSgtMTQsIC0yOSl9KSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpc0VuZCkge1xyXG4gICAgICAgICAgICAvLyDnu4jngrnlm77moIdcclxuICAgICAgICAgICAgbWFya2VyLnNldEljb24obmV3IE5QTWFwTGliLlN5bWJvbHMuSWNvbih0aGlzLmVuZE1hcmtVcmwsIG5ldyBOUE1hcExpYi5HZW9tZXRyeS5TaXplKDMyLCAzMiksIHthbmNob3I6IG5ldyBOUE1hcExpYi5HZW9tZXRyeS5TaXplKC0xNCwgLTI2KX0pKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyDmma7pgJrlm77moIdcclxuXHJcbiAgICAgICAgICAgIG1hcmtlci5zZXRJY29uKG5ldyBOUE1hcExpYi5TeW1ib2xzLkljb24odGhpcy5ub3JtYWxNYXJrVXJsLCBuZXcgTlBNYXBMaWIuR2VvbWV0cnkuU2l6ZSgzMiwgMzIpLCB7YW5jaG9yOiBuZXcgTlBNYXBMaWIuR2VvbWV0cnkuU2l6ZSgtMTQgLCAtMjYgKX0pKTtcclxuICAgICAgICAgICAgbGV0IGwgPSBuZXcgTlBNYXBMaWIuU3ltYm9scy5MYWJlbChsYWJlbCwge1xyXG4gICAgICAgICAgICAgICAgXCJwb3NpdGlvblwiOiBwb2ludCxcclxuICAgICAgICAgICAgICAgIFwib2Zmc2V0XCI6IG5ldyBOUE1hcExpYi5HZW9tZXRyeS5TaXplKDIsIDE2KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGwuc2V0U3R5bGUoe2ZvbnRTaXplOiAxMiwgZm9udEZhbWlseTogJ0FyYWlsJywgY29sb3I6ICd3aGl0ZScsIGFsaWduOiAnY2VudGVyJywgaXNCb2xkOiB0cnVlfSk7XHJcbiAgICAgICAgICAgIG1hcmtlci5zZXRMYWJlbChsKTtcclxuXHJcbiAgICAgICAgICAgIC8vIG1hcmtlci5zZXRMYWJlbChuZXcgTlBNYXBMaWIuU3ltYm9scy5MYWJlbChsYWJlbCwge1xyXG4gICAgICAgICAgICAvLyAgICAgXCJwb3NpdGlvblwiOiBwb2ludCxcclxuICAgICAgICAgICAgLy8gICAgIFwib2Zmc2V0XCI6IG5ldyBOUE1hcExpYi5HZW9tZXRyeS5TaXplKDIwLCAyMClcclxuICAgICAgICAgICAgLy8gICAgIC8vXCJvZmZzZXRcIjogbmV3IE5QTWFwTGliLkdlb21ldHJ5LlNpemUoMzAsICgwICsgMjAgKiByZXBlYXQpKVxyXG4gICAgICAgICAgICAvLyB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBtYXJrZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bliqjnlLvnur/phY3nva7lj4LmlbBcclxuICAgICAqIEBwYXJhbSBwb2ludFxyXG4gICAgICogQHBhcmFtIG9wdHNcclxuICAgICAqIEByZXR1cm5zIHt7aGVhZGVyTWFya2VyOiBOUE1hcExpYi5TeW1ib2xzLk1hcmtlciwgY29sb3I6IChzdHJpbmd8c3RyaW5nKSwgb3BhY2l0eTogbnVtYmVyLCB3ZWlnaHQ6IG51bWJlcn19XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgZ2V0QW5pbWF0aW9uTGluZU9wdChwb2ludDogTlBNYXBMaWIuR2VvbWV0cnkuUG9pbnQsIG9wdHM/OiBUcmFjZUFuYWx5emVPcHRzKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaGVhZGVyTWFya2VyOiB0aGlzLmNyZWF0ZUhlYWRlck1hcmtlcihwb2ludCksXHJcbiAgICAgICAgICAgIGNvbG9yOiBvcHRzLmNvbG9yIHx8ICdyZWQnLFxyXG4gICAgICAgICAgICBvcGFjaXR5OiBvcHRzLm9wYWNpdHkgfHwgMC44LFxyXG4gICAgICAgICAgICB3ZWlnaHQ6IG9wdHMud2VpZ2h0IHx8IDEwXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuS4gOS4quaWsOeahOi9pui+huWbvuaghywg5bm25Yqg6L295Yiw5Zyw5Zu+5LitXHJcbiAgICAgKiBAcGFyYW0gcG9pbnQg5Yid5aeL54K55L2NXHJcbiAgICAgKiBAcmV0dXJucyB7TlBNYXBMaWIuU3ltYm9scy5NYXJrZXJ9XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlSGVhZGVyTWFya2VyKHBvaW50OiBOUE1hcExpYi5HZW9tZXRyeS5Qb2ludCkge1xyXG4gICAgICAgIGxldCBtYXJrZXIgPSBuZXcgTlBNYXBMaWIuU3ltYm9scy5NYXJrZXIocG9pbnQsIHtvZmZzZXQ6IG5ldyBOUE1hcExpYi5HZW9tZXRyeS5TaXplKDAsIC0xMil9KTtcclxuICAgICAgICBtYXJrZXIuc2V0SWNvbihuZXcgTlBNYXBMaWIuU3ltYm9scy5JY29uKHRoaXMubW92ZVVybCwgbmV3IE5QTWFwTGliLkdlb21ldHJ5LlNpemUoMjksIDI5KSkpO1xyXG4gICAgICAgIG1hcmtlci5zZXREYXRhKHtuYW1lOidtb3ZlJ30pO1xyXG4gICAgICAgIHRoaXMubGF5ZXIuYWRkT3ZlcmxheShtYXJrZXIgYXMgTlBNYXBMaWIuT3ZlcmxheSk7XHJcbiAgICAgICAgcmV0dXJuIG1hcmtlcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWQr+WKqOi9qOi/ueWIhuaekFxyXG4gICAgICovXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25MaW5lKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uTGluZS5zdGFydCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmHjeaWsOW8gOWni+aJp+ihjOi9qOi/ueWIhuaekFxyXG4gICAgICovXHJcbiAgICByZXN0YXJ0KCkge1xyXG4gICAgICAgIC8vIOa4hemZpOWcsOWbvuS4iueahOeXlei/uVxyXG4gICAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25MaW5lKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uTGluZS5yZXN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pqC5YGc6L2o6L+55YiG5p6QXHJcbiAgICAgKi9cclxuICAgIHBhdXNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbkxpbmUpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLnBhdXNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YGc5q2i5Lyw6K6h5YiG5p6QXHJcbiAgICAgKi9cclxuICAgIHN0b3AoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTGluZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUuc3RvcCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa4hemZpOi9qOi/uSwg5L2G5piv5LiN6ZSA5q+B5a6e5L6LXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY2xlYXIoKSB7XHJcbiAgICAgICAgLy8g5riF6Zmk54K55L2NXHJcbiAgICAgICAgaWYgKHRoaXMubWFya2Vycykge1xyXG4gICAgICAgICAgICBsZXQgaSwgbGVuO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLm1hcmtlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXIucmVtb3ZlT3ZlcmxheSh0aGlzLm1hcmtlcnNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF6Zmk6L2o6L+55YiG5p6Q5YaF5a65XHJcbiAgICAgKiDmraTmk43kvZzkvJrplIDmr4HmiYDmnInotYTmupAsIOmcgOimgemHjeaWsOaWsOW7uuWunuS+i+aJjeiDvei/m+ihjOi9qOi/ueWIhuaekFxyXG4gICAgICovXHJcbiAgICByZW1vdmUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYW5pbWF0aW9uTGluZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uTGluZSA9IG51bGw7XHJcbiAgICAgICAgLy8g56e76Zmk5YW25LuW57yT5a2Y55qE5YaF5a65XHJcbiAgICAgICAgdGhpcy5sYXllci5yZW1vdmVBbGxPdmVybGF5cygpO1xyXG4gICAgICAgIHRoaXMucG9pbnRzID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1hcmtlcnMgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZHJhd01hcmtlckluUHJlRHJhdyhpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubWFya2Vycykge1xyXG4gICAgICAgICAgICBsZXQgbWFya2VyID0gdGhpcy5tYXJrZXJzW2luZGV4XTtcclxuICAgICAgICAgICAgdGhpcy5sYXllci5hZGRPdmVybGF5KG1hcmtlcik7XHJcbiAgICAgICAgICAgIG1hcmtlci5zaG93TGFiZWwoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYmluZEV2ZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbkxpbmUgPT0gbnVsbCB8fCAhdGhpcy5vcHRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdHMuYWZ0ZXJEcmF3ID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLmV2ZW50cy5yZWdpc3RlcignYWZ0ZXJEcmF3JywgKGV2dDogX0FuaW1hdGlvbkxpbmVQcmVEcmF3RXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0cy5hZnRlckRyYXcoZXZ0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUuZXZlbnRzLnJlZ2lzdGVyKCdwcmVEcmF3JywgKGV2dDogX0FuaW1hdGlvbkxpbmVQcmVEcmF3RXZlbnQpID0+IHtcclxuICAgICAgICAgICAgLy8g5Li75Yqo57uY5Yi25LiA5Liq5Zu+5qCHXHJcbiAgICAgICAgICAgIHRoaXMuZHJhd01hcmtlckluUHJlRHJhdyhldnQuaW5kZXgpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0cy5wcmVEcmF3ID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3B0cy5wcmVEcmF3KGV2dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0cy5hZnRlclN0ZXAgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUuZXZlbnRzLnJlZ2lzdGVyKCdhZnRlclN0ZXAnLCAoZXZ0OiBfQW5pbWF0aW9uTGluZVByZURyYXdFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRzLmFmdGVyU3RlcChldnQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdHMuc3RhcnQgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUuYWRkRXZlbnRMaXN0ZW5lcihOUE1hcExpYi5BTklNQVRJT05fRVZFTlRfU1RBUlQsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8g5b6F5rWL6K+V5pWI5p6cXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdHMuc3RhcnQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRzLnBhdXNlID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLmFkZEV2ZW50TGlzdGVuZXIoTlBNYXBMaWIuQU5JTUFUSU9OX0VWRU5UX1BBVVNFLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPIOW+hea1i+ivleaViOaenFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRzLnBhdXNlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0cy5zdG9wID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLmFkZEV2ZW50TGlzdGVuZXIoTlBNYXBMaWIuQU5JTUFUSU9OX0VWRU5UX1NUT1AsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8g5b6F5rWL6K+V5pWI5p6cXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdHMuc3RvcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdHMubW92aW5nID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgLy8gVE9ETyDlvoXmtYvor5XmlYjmnpxcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLmFkZEV2ZW50TGlzdGVuZXIoTlBNYXBMaWIuQU5JTUFUSU9OX0VWRU5UX01PVklORywgdGhpcy5vcHRzLm1vdmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRzLm1vdmVkID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgLy8gVE9ETyDlvoXmtYvor5XmlYjmnpxcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25MaW5lLmFkZEV2ZW50TGlzdGVuZXIoTlBNYXBMaWIuQU5JTUFUSU9OX0VWRU5UX01PVkVELCB0aGlzLm9wdHMubW92ZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldExheWVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGlvbkxpbmUgJiYgdGhpcy5sYXllcikge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkxpbmUuc2V0TGF5ZXIodGhpcy5sYXllcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFNwZWVkKHNwZWVkOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5hbmltYXRpb25MaW5lKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0aW9uTGluZS5zZXRTcGVlZChzcGVlZCB8fCB0aGlzLnNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDovajov7nliIbmnpDlt6XljoLnsbtcclxuICovXHJcbmV4cG9ydCBjbGFzcyBUcmFjZUFuYWx5emVGYWN0b3J5IHtcclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBUUkFDRV9BTkFMWVpFX0xBWUVSX05BTUUgPSBcInRyYWNlQW5hbHl6ZVwiO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgREVGQVVMVF9TUEVFRCA9IDEwMDA7XHJcblxyXG4gICAgcHJpdmF0ZSBtYXBBZGFwdGVyOiBJTWFwQWRhcHRlcjtcclxuICAgIHByaXZhdGUgY2FjaGVBbmltYXRpb25MaW5lOiB7IFtrZXk6IHN0cmluZ106IFRyYWNlQW5hbHl6ZU1vZGVsIH0gPSB7fTtcclxuICAgIHByaXZhdGUgdHJhY2VBbmFseXplTGF5ZXI6IE92ZXJsYXlMYXllciA9IG51bGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IobWFwQWRhcHRlcjogSU1hcEFkYXB0ZXIpIHtcclxuICAgICAgICB0aGlzLm1hcEFkYXB0ZXIgPSBtYXBBZGFwdGVyO1xyXG4gICAgICAgIHRoaXMuZ2V0VHJhY2VBbmFseXplTGF5ZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFRyYWNlQW5hbHl6ZUxheWVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnRyYWNlQW5hbHl6ZUxheWVyID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy50cmFjZUFuYWx5emVMYXllciA9IG5ldyBOUE1hcExpYi5MYXllcnMuT3ZlcmxheUxheWVyKFRyYWNlQW5hbHl6ZUZhY3RvcnkuVFJBQ0VfQU5BTFlaRV9MQVlFUl9OQU1FKTtcclxuICAgICAgICAgICAgdGhpcy5tYXBBZGFwdGVyLmFkZExheWVyKHRoaXMudHJhY2VBbmFseXplTGF5ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy50cmFjZUFuYWx5emVMYXllcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuWKqOeUu+e6v1xyXG4gICAgICogQHBhcmFtIG1hcElkXHJcbiAgICAgKiBAcGFyYW0gcG9pbnRzXHJcbiAgICAgKiBAcGFyYW0gb3B0c1xyXG4gICAgICogQHJldHVybnMgbGluZUlkOiDliJvlu7rnmoRhbmltYXRpb25MaW5l55qE5ZSv5LiA5qCH6K+GXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZVRyYWNlQW5hbHl6ZShwb2ludHM6IEFycmF5PE5QTWFwTGliLkdlb21ldHJ5LlBvaW50Piwgb3B0cz86IFRyYWNlQW5hbHl6ZU9wdHMpIHtcclxuXHJcbiAgICAgICAgb3B0cyA9IG9wdHMgfHwge30gYXMgVHJhY2VBbmFseXplT3B0cztcclxuICAgICAgICBpZiAoIWFuZ3VsYXIuaXNBcnJheShwb2ludHMpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJjcmVhdFRyYWNlQW5hbHl6ZSBlcnJvcjogcG9pbnRzIGlzIG5vdCBhcnJheVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcy5jcmVhdGVUcmFjZUFuYWx5emVNb2RlbChwb2ludHMsIG9wdHMpO1xyXG4gICAgICAgIHRoaXMuc2F2ZUFuaW1hdGlvbkxpbmUobW9kZWwuaWQsIG1vZGVsKTtcclxuICAgICAgICBtb2RlbC5sYXllci5zZXRaSW5kZXgoMjAxKTtcclxuICAgICAgICByZXR1cm4gbW9kZWwuaWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rovajov7nliIbmnpDlrp7kvotcclxuICAgICAqIEBwYXJhbSBwb2ludHNcclxuICAgICAqIEBwYXJhbSBvcHRzXHJcbiAgICAgKiBAcmV0dXJucyB7VHJhY2VBbmFseXplTW9kZWx9XHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgY3JlYXRlVHJhY2VBbmFseXplTW9kZWwocG9pbnRzOiBBcnJheTxOUE1hcExpYi5HZW9tZXRyeS5Qb2ludD4sIG9wdHM/OiBUcmFjZUFuYWx5emVPcHRzKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUcmFjZUFuYWx5emVNb2RlbChwb2ludHMsIHRoaXMubWFwQWRhcHRlci5nZXRNYXBJZCgpLCB0aGlzLmdldFRyYWNlQW5hbHl6ZUxheWVyKCksIG9wdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5byA5aeL6L2o6L+55YiG5p6QXHJcbiAgICAgKiBAcGFyYW0gbGluZUlkXHJcbiAgICAgKiBUT0RPIOi/mOmcgOiAg+iZkeW3sue7j+acieato+WcqOi/kOihjOeahOi9qOi/ueWIhuaekOeahOaDheWGtVxyXG4gICAgICovXHJcbiAgICBzdGFydFRyYWNlQW5hbHl6ZShsaW5lSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXMuZ2V0QW5pbWF0aW9uTGluZShsaW5lSWQpO1xyXG4gICAgICAgIGlmIChtb2RlbCkge1xyXG4gICAgICAgICAgICBtb2RlbC5zdGFydCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiwg+eUqOWOn+WunuS+iyDph43mlrDov5vooYzovajov7nliIbmnpDmvJTnpLpcclxuICAgICAqIEBwYXJhbSBsaW5lSWRcclxuICAgICAqL1xyXG4gICAgcmVTdGFydFRyYWNlQW5hbHl6ZShsaW5lSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBtb2RlbCA9IHRoaXMuZ2V0QW5pbWF0aW9uTGluZShsaW5lSWQpO1xyXG4gICAgICAgIGlmIChtb2RlbCkge1xyXG4gICAgICAgICAgICBtb2RlbC5yZXN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YGc5q2i6L2o6L+55YiG5p6QXHJcbiAgICAgKiBAcGFyYW0gbGluZUlkXHJcbiAgICAgKi9cclxuICAgIHN0b3BUcmFjZUFuYWx5emUobGluZUlkOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYW5pbWF0aW9uTGluZSA9IHRoaXMuZ2V0QW5pbWF0aW9uTGluZShsaW5lSWQpO1xyXG4gICAgICAgIGlmIChhbmltYXRpb25MaW5lKSB7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvbkxpbmUuc3RvcCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaaguWBnOi9qOi/ueWIhuaekFxyXG4gICAgICogQHBhcmFtIGxpbmVJZFxyXG4gICAgICogQHBhcmFtIGZsYWcgdHJ1ZSjmmoLlgZwpL2ZhbHNlKOe7p+e7rSlcclxuICAgICAqL1xyXG4gICAgcGF1c2VUcmFjZUFuYWx5emUobGluZUlkOiBzdHJpbmcsIGZsYWc6IGJvb2xlYW4pIHtcclxuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzLmdldEFuaW1hdGlvbkxpbmUobGluZUlkKTtcclxuICAgICAgICBpZiAobW9kZWwpIHtcclxuICAgICAgICAgICAgZmxhZyA9PT0gZmFsc2UgPyBtb2RlbC5zdGFydCgpIDogbW9kZWwucGF1c2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuIXpmaTovajov7nliIbmnpDnur9cclxuICAgICAqIEBwYXJhbSBsaW5lSWRcclxuICAgICAqL1xyXG4gICAgY2xlYXJUcmFjZUFuYWx5emUobGluZUlkOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbW9kZWwgPSB0aGlzLmdldEFuaW1hdGlvbkxpbmUobGluZUlkKTtcclxuICAgICAgICBpZiAobW9kZWwpIHtcclxuICAgICAgICAgICAgbW9kZWwucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVtb3ZlQW5pbWF0aW9uTGluZShsaW5lSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNwZWVkKGxpbmVJZDogc3RyaW5nLCBzcGVlZDogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IG1vZGVsID0gdGhpcy5nZXRBbmltYXRpb25MaW5lKGxpbmVJZCk7XHJcbiAgICAgICAgaWYgKG1vZGVsKSB7XHJcbiAgICAgICAgICAgIG1vZGVsLnNldFNwZWVkKHNwZWVkIHx8IFRyYWNlQW5hbHl6ZUZhY3RvcnkuREVGQVVMVF9TUEVFRCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6ZSA5q+B5q2k5bel5Y6C5a6e5L6LXHJcbiAgICAgKi9cclxuICAgIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5jYWNoZUFuaW1hdGlvbkxpbmUgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0QW5pbWF0aW9uTGluZShsaW5lSWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlQW5pbWF0aW9uTGluZVtsaW5lSWRdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2F2ZUFuaW1hdGlvbkxpbmUobGluZUlkOiBzdHJpbmcsIHRyYWNlQW5hbHl6ZU1vZGVsOiBUcmFjZUFuYWx5emVNb2RlbCkge1xyXG4gICAgICAgIGlmIChsaW5lSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlQW5pbWF0aW9uTGluZVtsaW5lSWRdID0gdHJhY2VBbmFseXplTW9kZWw7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlRyYWNlQW5hbHl6ZUZhY3Rvcnkuc2F2ZUFuaW1hdGlvbkxpbmUgZmFpbDogbGluZUlkIGlzIG51bGwhXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZUFuaW1hdGlvbkxpbmUobGluZUlkOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAodGhpcy5jYWNoZUFuaW1hdGlvbkxpbmVbbGluZUlkXSkge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYWNoZUFuaW1hdGlvbkxpbmVbbGluZUlkXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59Il19

define(["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var ClusterMarkerFactory = (function () {
        function ClusterMarkerFactory(mapAdapter) {
            this.points = [];
            this.markers = [];
            this.mapAdapter = mapAdapter;
        }
        ClusterMarkerFactory.prototype.getSystemPointByID = function (objectId) {
            if (!this.points && this.points.length <= 0)
                return null;
            var points = this.points;
            var i, len, result;
            for (i = 0, len = points.length; i < len; i++) {
                if (points[i].ObjectID === objectId) {
                    result = points[i];
                    break;
                }
            }
            return result;
        };
        ClusterMarkerFactory.prototype.setPoints = function (points) {
            var i, len, _points = this.points, temp;
            for (i = 0, len = points.length; i < len; i++) {
                temp = points[i];
                if (temp.ObjectID && (temp.Lon != 0 || temp.Lat != 0)) {
                    _points.push(temp);
                }
            }
        };
        ClusterMarkerFactory.prototype.getPoints = function () {
            return this.points || [];
        };
        ClusterMarkerFactory.prototype.removePointByParams = function (paramName, paramValue) {
            if (!this.points && this.points.length <= 0)
                return;
            var i, len, temp;
            for (i = 0, len = this.points.length; i < len; i++) {
                temp = this.points[i];
                if (!temp) {
                    console.log(i, "不存在", this.points);
                }
                if (temp[paramName] != null && temp[paramName] === paramValue) {
                    this.points.splice(i, 1);
                    i--;
                    len--;
                }
            }
        };
        ClusterMarkerFactory.prototype.removePointByPoints = function (points) {
            if (!this.points && this.points.length <= 0)
                return;
            var arr = [];
            this.points.forEach(function (tempPoint) {
                var s = false;
                points.forEach(function (delPoint) {
                    if (tempPoint.ID === delPoint.ID) {
                        s = true;
                    }
                });
                if (!s) {
                    arr.push(tempPoint);
                }
            });
            this.points = arr;
            console.log(this.points);
        };
        ClusterMarkerFactory.prototype.addPoint = function (point) {
            var index = this.getPointIndexInPoints(point);
            if (index === -1) {
                this.points.push(point);
            }
            else {
                this.points[index] = point;
            }
        };
        ClusterMarkerFactory.prototype.createClusterMarker = function (lon, lat, markType, model) {
            var result = this.mapAdapter.createClusterMarker({
                lon: lon,
                lat: lat
            }, { markType: markType });
            result.ID = model.ID;
            result.ObjectName = model.ObjectName || '此设备无名称';
            result.ObjectID = model.ObjectID;
            result.Descrption = model.Descrption;
            result.ObjectType = model.ObjectType;
            result.TaskStatus = model.TaskStatus;
            result.ObjectState = model.ObjectState;
            result.LayerType = model.LayerType;
            return result;
        };
        ;
        ClusterMarkerFactory.prototype.getPointIndexInPoints = function (point) {
            if (!this.points && this.points.length <= 0 && point)
                return;
            var i, len, points = this.points, result = -1;
            for (i = 0, len = points.length; i < len; i++) {
                if (point.ObjectID === points[i].ObjectID) {
                    result = i;
                }
            }
            return result;
        };
        ClusterMarkerFactory.prototype.createClusterMarkers = function (points) {
            var i, len, temp, result = [];
            for (i = 0, len = points.length; i < len; i++) {
                temp = points[i];
                if (temp && temp.Lat && temp.Lon) {
                    result.push(this.createClusterMarker(temp.Lon, temp.Lat, temp.LayerType, temp));
                }
                else {
                    console.log(temp);
                }
            }
            return result;
        };
        ClusterMarkerFactory.prototype.createClusterPoints = function (points) {
            return new NPMapLib.Symbols.ClusterPoints(points, { threshold: 0 });
        };
        ClusterMarkerFactory.prototype.getClusterPoints = function (points) {
            if (points && points.length > 0) {
                return this.createClusterPoints(this.createClusterMarkers(points));
            }
            else {
                return null;
            }
        };
        return ClusterMarkerFactory;
    }());
    exports.ClusterMarkerFactory = ClusterMarkerFactory;
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvY29tbW9uL21hcC9jb3JlL21vZGVsL2NsdXN0ZXIuZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFNQTtRQU9JLDhCQUFZLFVBQXVCO1lBSjNCLFdBQU0sR0FBdUIsRUFBRSxDQUFDO1lBQ2hDLFlBQU8sR0FBa0MsRUFBRSxDQUFDO1lBSWhELElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQ2pDLENBQUM7UUFPTSxpREFBa0IsR0FBekIsVUFBMEIsUUFBZ0I7WUFDdEMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBRXpELElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDekIsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sQ0FBQztZQUNuQixHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDNUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUNsQyxNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNuQixLQUFLLENBQUM7Z0JBQ1YsQ0FBQztZQUNMLENBQUM7WUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2xCLENBQUM7UUFPTSx3Q0FBUyxHQUFoQixVQUFpQixNQUEwQjtZQUN2QyxJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDO1lBQ3hDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FB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SUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDcEYsQ0FBQztnQkFBQSxJQUFJLENBQUEsQ0FBQztvQkFDRixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUNyQixDQUFDO1lBQ0wsQ0FBQztZQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEIsQ0FBQztRQUVPLGtEQUFtQixHQUEzQixVQUE0QixNQUE2QztZQUNyRSxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsRUFBQyxTQUFTLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN0RSxDQUFDO1FBT00sK0NBQWdCLEdBQXZCLFVBQXdCLE1BQTBCO1lBQzlDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLE1BQU0sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDdkUsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDaEIsQ0FBQztRQUNMLENBQUM7UUFDTCwyQkFBQztJQUFELENBaEtBLEFBZ0tDLElBQUE7SUFoS1ksb0RBQW9CIiwiZmlsZSI6Im1vZHVsZS9jb21tb24vbWFwL2NvcmUvbW9kZWwvY2x1c3Rlci5mYWN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTeXN0ZW1Qb2ludH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2NvcmUvZW50aXR5L1N5c3RlbVBvaW50XCI7XHJcbmltcG9ydCB7Q2x1c3Rlck1hcmtlckV4fSBmcm9tIFwiLi4vLi4vbWFwLmludGVyZmFjZVwiO1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgZGVsbCBvbiAyMDE3LzQvMjcuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQ2x1c3Rlck1hcmtlckZhY3Rvcnkge1xyXG5cclxuICAgIC8vIOS4tOaXtuWcqOi/memHjOe8k+WtmHBvaW50c+aVsOe7hFxyXG4gICAgcHJpdmF0ZSBwb2ludHM6IEFycmF5PFN5c3RlbVBvaW50PiA9IFtdO1xyXG4gICAgcHJpdmF0ZSBtYXJrZXJzOkFycmF5PE5QTWFwTGliLlN5bWJvbHMuTWFya2VyPiA9IFtdO1xyXG4gICAgcHJpdmF0ZSBtYXBBZGFwdGVyOiBJTWFwQWRhcHRlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihtYXBBZGFwdGVyOiBJTWFwQWRhcHRlcikge1xyXG4gICAgICAgIHRoaXMubWFwQWRhcHRlciA9IG1hcEFkYXB0ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmoLnmja7kvKDlhaXnmoTlj4LmlbDmib7liLDlr7nlupTnmoTngrnkvY1cclxuICAgICAqIOm7mOiupOWPquWPluacgOWFiOWMuemFjeWIsOeahOaVsOaNrlxyXG4gICAgICogQHJldHVybnMge251bGx9XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTeXN0ZW1Qb2ludEJ5SUQob2JqZWN0SWQ6IHN0cmluZyk6IFN5c3RlbVBvaW50IHtcclxuICAgICAgICBpZiAoIXRoaXMucG9pbnRzICYmIHRoaXMucG9pbnRzLmxlbmd0aCA8PSAwKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgbGV0IHBvaW50cyA9IHRoaXMucG9pbnRzO1xyXG4gICAgICAgIGxldCBpLCBsZW4sIHJlc3VsdDtcclxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHBvaW50c1tpXS5PYmplY3RJRCA9PT0gb2JqZWN0SWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHBvaW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJbmlrDlop7ngrnkvY3kv6Hmga9cclxuICAgICAqIOWdkOagh+S4uuepuueahOeCueS9jeS/oeaBr+S4jeWinuWKoOWIsOe8k+WtmOS4rVxyXG4gICAgICogQHBhcmFtIHBvaW50c1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0UG9pbnRzKHBvaW50czogQXJyYXk8U3lzdGVtUG9pbnQ+KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGksIGxlbiwgX3BvaW50cyA9IHRoaXMucG9pbnRzLCB0ZW1wO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB0ZW1wID0gcG9pbnRzW2ldO1xyXG4gICAgICAgICAgICBpZiAodGVtcC5PYmplY3RJRCAmJiAodGVtcC5Mb24gIT0gMCB8fCB0ZW1wLkxhdCAhPSAwKSkge1xyXG4gICAgICAgICAgICAgICAgX3BvaW50cy5wdXNoKHRlbXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRQb2ludHMoKTogQXJyYXk8U3lzdGVtUG9pbnQ+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wb2ludHMgfHwgW107XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlbW92ZVBvaW50QnlQYXJhbXMocGFyYW1OYW1lOiBzdHJpbmcsIHBhcmFtVmFsdWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5wb2ludHMgJiYgdGhpcy5wb2ludHMubGVuZ3RoIDw9IDApIHJldHVybjtcclxuICAgICAgICBsZXQgaSwgbGVuLCB0ZW1wOiBhbnk7XHJcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdGVtcCA9IHRoaXMucG9pbnRzW2ldO1xyXG4gICAgICAgICAgICBpZiAoIXRlbXApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGksIFwi5LiN5a2Y5ZyoXCIsIHRoaXMucG9pbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGVtcFtwYXJhbU5hbWVdICE9IG51bGwgJiYgdGVtcFtwYXJhbU5hbWVdID09PSBwYXJhbVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvaW50cy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICBsZW4tLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlUG9pbnRCeVBvaW50cyhwb2ludHM6IEFycmF5PFN5c3RlbVBvaW50Pik6IHZvaWQge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMucG9pbnRzICYmIHRoaXMucG9pbnRzLmxlbmd0aCA8PSAwKSByZXR1cm47XHJcbiAgICAgICAgbGV0IGFyciA9IFtdIGFzIEFycmF5PFN5c3RlbVBvaW50PjtcclxuICAgICAgICB0aGlzLnBvaW50cy5mb3JFYWNoKCh0ZW1wUG9pbnQ6IFN5c3RlbVBvaW50KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHBvaW50cy5mb3JFYWNoKChkZWxQb2ludDogU3lzdGVtUG9pbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wUG9pbnQuSUQgPT09IGRlbFBvaW50LklEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZighcyl7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaCh0ZW1wUG9pbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5wb2ludHMgPSBhcnI7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5wb2ludHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRQb2ludChwb2ludDogU3lzdGVtUG9pbnQpOiB2b2lkIHtcclxuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLmdldFBvaW50SW5kZXhJblBvaW50cyhwb2ludCk7XHJcbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLnBvaW50cy5wdXNoKHBvaW50KTsgLy8g5paw5aKeXHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucG9pbnRzW2luZGV4XSA9IHBvaW50OyAvLyDnm7TmjqXmm7/mjaJcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuiBmuWQiOeCueS9jVxyXG4gICAgICogQHBhcmFtIGxvblxyXG4gICAgICogQHBhcmFtIGxhdFxyXG4gICAgICogQHBhcmFtIG1hcmtUeXBlXHJcbiAgICAgKiBAcGFyYW0gbW9kZWxcclxuICAgICAqIEByZXR1cm5zIHthbnl9XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjcmVhdGVDbHVzdGVyTWFya2VyKGxvbjogbnVtYmVyLCBsYXQ6IG51bWJlciwgbWFya1R5cGU6IHN0cmluZywgbW9kZWw6IFN5c3RlbVBvaW50KTogQ2x1c3Rlck1hcmtlckV4IHtcclxuICAgICAgICBsZXQgcmVzdWx0OiBDbHVzdGVyTWFya2VyRXggPSB0aGlzLm1hcEFkYXB0ZXIuY3JlYXRlQ2x1c3Rlck1hcmtlcih7XHJcbiAgICAgICAgICAgIGxvbjogbG9uLFxyXG4gICAgICAgICAgICBsYXQ6IGxhdFxyXG4gICAgICAgIH0sIHttYXJrVHlwZTogbWFya1R5cGV9KSBhcyBDbHVzdGVyTWFya2VyRXg7XHJcbiAgICAgICAgcmVzdWx0LklEID0gbW9kZWwuSUQ7XHJcbiAgICAgICAgcmVzdWx0Lk9iamVjdE5hbWUgPSBtb2RlbC5PYmplY3ROYW1lIHx8ICfmraTorr7lpIfml6DlkI3np7AnO1xyXG4gICAgICAgIHJlc3VsdC5PYmplY3RJRCA9IG1vZGVsLk9iamVjdElEO1xyXG4gICAgICAgIHJlc3VsdC5EZXNjcnB0aW9uID0gbW9kZWwuRGVzY3JwdGlvbjtcclxuICAgICAgICByZXN1bHQuT2JqZWN0VHlwZSA9IG1vZGVsLk9iamVjdFR5cGU7XHJcbiAgICAgICAgcmVzdWx0LlRhc2tTdGF0dXMgPSBtb2RlbC5UYXNrU3RhdHVzO1xyXG4gICAgICAgIHJlc3VsdC5PYmplY3RTdGF0ZSA9IG1vZGVsLk9iamVjdFN0YXRlO1xyXG4gICAgICAgIHJlc3VsdC5MYXllclR5cGUgPSBtb2RlbC5MYXllclR5cGU7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRQb2ludEluZGV4SW5Qb2ludHMocG9pbnQ6IFN5c3RlbVBvaW50KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnBvaW50cyAmJiB0aGlzLnBvaW50cy5sZW5ndGggPD0gMCAmJiBwb2ludCkgcmV0dXJuO1xyXG4gICAgICAgIGxldCBpLCBsZW4sIHBvaW50cyA9IHRoaXMucG9pbnRzLCByZXN1bHQgPSAtMTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHBvaW50Lk9iamVjdElEID09PSBwb2ludHNbaV0uT2JqZWN0SUQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUNsdXN0ZXJNYXJrZXJzKHBvaW50czogQXJyYXk8U3lzdGVtUG9pbnQ+KTogQXJyYXk8TlBNYXBMaWIuU3ltYm9scy5DbHVzdGVyTWFya2VyPiB7XHJcbiAgICAgICAgbGV0IGksIGxlbiwgdGVtcCwgcmVzdWx0ID0gW10gYXMgQXJyYXk8TlBNYXBMaWIuU3ltYm9scy5DbHVzdGVyTWFya2VyPjtcclxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdGVtcCA9IHBvaW50c1tpXTtcclxuICAgICAgICAgICAgaWYgKHRlbXAgJiYgdGVtcC5MYXQgJiYgdGVtcC5Mb24pIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuY3JlYXRlQ2x1c3Rlck1hcmtlcih0ZW1wLkxvbiwgdGVtcC5MYXQsIHRlbXAuTGF5ZXJUeXBlLCB0ZW1wKSk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGVtcClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlQ2x1c3RlclBvaW50cyhwb2ludHM6IEFycmF5PE5QTWFwTGliLlN5bWJvbHMuQ2x1c3Rlck1hcmtlcj4pIHtcclxuICAgICAgICByZXR1cm4gbmV3IE5QTWFwTGliLlN5bWJvbHMuQ2x1c3RlclBvaW50cyhwb2ludHMsIHt0aHJlc2hvbGQ6IDB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPluiBmuWQiOeCueS9jeaVsOaNrlxyXG4gICAgICogQHBhcmFtIHBvaW50c1xyXG4gICAgICogQHJldHVybnMge05QTWFwTGliLlN5bWJvbHMuQ2x1c3RlclBvaW50c31cclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldENsdXN0ZXJQb2ludHMocG9pbnRzOiBBcnJheTxTeXN0ZW1Qb2ludD4pIHtcclxuICAgICAgICBpZiAocG9pbnRzICYmIHBvaW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNsdXN0ZXJQb2ludHModGhpcy5jcmVhdGVDbHVzdGVyTWFya2Vycyhwb2ludHMpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=

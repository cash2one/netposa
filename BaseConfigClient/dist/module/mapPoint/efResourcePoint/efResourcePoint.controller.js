define(["require", "exports", "text!./efResourcePointMore.html", "../../common/app/main.app", "../../common/factory/attribute.factory", "../../../core/server/enum/SocketResultTypeEnum", "css!./style/efResourcePoint.css", "../../common/services/task.service", "./efResourcePointMore.controller", "../../common/services/analysis.service", "../../common/services/resourceRetrieval.service"], function (require, exports, efResourcePointMore, main_app_1, attribute_factory_1, SocketResultTypeEnum_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Promise = require('es6-promise');
    var EFResourcePointController = (function () {
        function EFResourcePointController($scope, $timeout, mylayer, deviceSocketServer, userInfoCacheFactory, socketFactory, taskService, layer, resourceRetrievalService, analysisService) {
            var _this = this;
            this.$scope = $scope;
            this.$timeout = $timeout;
            this.mylayer = mylayer;
            this.deviceSocketServer = deviceSocketServer;
            this.userInfoCacheFactory = userInfoCacheFactory;
            this.socketFactory = socketFactory;
            this.taskService = taskService;
            this.layer = layer;
            this.resourceRetrievalService = resourceRetrievalService;
            this.analysisService = analysisService;
            this.ShowAlarmStatus = false;
            this.dataList = [];
            this.alarmdataList = [];
            this.isSubcribeEFenceLog = false;
            this.isSubcribeAlarmLog = false;
            this.dataListTotal = 0;
            this.alarmdataListTotal = 0;
            this.searchParams = {
                currentPage: 1,
                keyWord: '',
                orderBy: {
                    isAsc: false,
                },
                pageSize: 10,
                taskId: '',
                startTime: '',
                endTime: '',
                ArObjectID: [],
                isFirstSearch: true,
                userId: '',
            };
            this.PersonAlarmParams = {};
            this.attributeFactory = new attribute_factory_1.AttributeFactory();
            this.deviceName = this.$scope.PointDeTail.Name;
            this.deviceInfo = this.$scope.PointDeTail;
            this.deviceId = this.$scope.PointDeTail.ID;
            var marker = this.$scope.marker;
            this.subscribeEleCollect();
            this.subscribeWifiAlarm();
            $scope.$on('$destroy', function () {
                _this.wifiCollectParam.isCancel = true;
                _this.wifiAlarmParam.isCancel = true;
                var self = _this;
                if (_this.isSubcribeEFenceLog) {
                    _this.deviceSocketServer.getWifiInfo(_this.wifiCollectParam).then(function (res) {
                        if (!!res) {
                            console.log("close EFenceLog sokit");
                            self.socketFactory.unSubscribe('SubcribeEFenceLog');
                            _this.isSubcribeEFenceLog = false;
                        }
                    });
                }
                if (_this.isSubcribeAlarmLog) {
                    _this.deviceSocketServer.getWifiInfo(_this.wifiAlarmParam).then(function (res) {
                        if (!!res) {
                            console.log("close EFenceAlaLog sokit");
                            self.socketFactory.unSubscribe('SubcribeAlarmLog');
                            _this.isSubcribeAlarmLog = false;
                        }
                    });
                }
            });
            var time = this.attributeFactory.getCrossTrainTime(0);
            this.startTime = time.startTime;
            this.endTime = time.endTime;
            this.searchParams.userId = this.userInfoCacheFactory.getCurrentUserId();
            this.searchParams.startTime = this.startTime;
            this.searchParams.endTime = this.endTime;
            this.searchParams.ArObjectID.push(this.deviceId);
            this.getServerMessage(this.searchParams);
            this.PersonAlarmParams.startTime = this.startTime;
            this.PersonAlarmParams.endTime = this.endTime;
            this.PersonAlarmParams.arrCameraId = [this.deviceId];
            this.PersonAlarmParams.pageSize = 10;
            this.PersonAlarmParams.currentPage = 1;
            this.PersonAlarmParams.alarmType = 'EFENCE';
            this.getServerAlarmMessage(this.PersonAlarmParams);
        }
        EFResourcePointController.prototype.getServerMessage = function (searchParams) {
            var self = this;
            this.resourceRetrievalService.advancedSearchByEFence(searchParams)
                .then(function (res) {
                if ((res.code === 200) && (typeof res.data.EFENCE !== 'undefined') && (res.data.EFENCE.TotalCount > 0)) {
                    self.dataListTotal = res.data.EFENCE.TotalCount;
                    var arr = [], data = res.data.EFENCE.Result;
                    for (var i = 0; i < data.length; i++) {
                        var obj = {};
                        obj.IMSI = data[i].eFenceLog.IMSI;
                        obj.IMEI = data[i].eFenceLog.IMEI;
                        obj.AcqTime = data[i].eFenceLog.AcqTime;
                        arr.push(obj);
                    }
                    self.dataList = arr;
                }
            });
        };
        EFResourcePointController.prototype.getServerAlarmMessage = function (searchParams) {
            var self = this;
            this.analysisService.searchPersonAlarm(this.PersonAlarmParams).then(function (res) {
                if (res.code === 200) {
                    self.alarmdataListTotal = res.data.TotalCount;
                    for (var i = 0; i < res.data.Result.length; i++) {
                        var dataarr = res.data.Result[i].AlarmLog.Notes.split("_");
                        res.data.Result[i].AlarmLog.IMEI = dataarr[0];
                        res.data.Result[i].AlarmLog.IMSI = dataarr[1];
                    }
                    self.alarmdataList = res.data.Result;
                }
            });
        };
        EFResourcePointController.prototype.subscribeEleCollect = function () {
            var _this = this;
            this.wifiCollectParam = {
                userID: this.userInfoCacheFactory.getCurrentUserId(),
                objectID: [this.deviceId],
                isCancel: false,
                socketType: SocketResultTypeEnum_1.SocketResultTypeEnum.SubscribeEFenceLog
            };
            this.deviceSocketServer.getWifiInfo(this.wifiCollectParam).then(function (res) {
                if (!!res) {
                    _this.isSubcribeEFenceLog = true;
                    _this.socketFactory.subscribe(SocketResultTypeEnum_1.SocketResultTypeEnum.SubscribeEFenceLog, function (data) {
                        _this.$timeout(function () {
                            _this.dataList = data.concat(_this.dataList);
                            _this.dataListTotal += data.length;
                            console.log('SubcribeEFenceLog', data, _this.dataList.length);
                        });
                    });
                }
            });
        };
        EFResourcePointController.prototype.subscribeWifiAlarm = function () {
            var _this = this;
            this.wifiAlarmParam = {
                userID: this.userInfoCacheFactory.getCurrentUserId(),
                objectID: [this.deviceId],
                isCancel: false,
                socketType: SocketResultTypeEnum_1.SocketResultTypeEnum.SubscribeAlarmLog,
                alarmType: SocketResultTypeEnum_1.AlarmType.Efence
            };
            this.deviceSocketServer.getWifiInfo(this.wifiAlarmParam).then(function (res) {
                if (!!res) {
                    _this.isSubcribeAlarmLog = true;
                    _this.socketFactory.subscribe(SocketResultTypeEnum_1.SocketResultTypeEnum.SubscribeAlarmLog, function (data) {
                        if (_this.deviceId != data[0].AlarmLog.ObjectID) {
                            return;
                        }
                        _this.$timeout(function () {
                            _this.alarmdataList = data.concat(_this.alarmdataList);
                            _this.alarmdataListTotal += data.length;
                        });
                    });
                }
            });
        };
        EFResourcePointController.prototype.showAlarm = function () {
            this.ShowAlarmStatus = !this.ShowAlarmStatus;
        };
        EFResourcePointController.prototype.lookMoreCollect = function () {
            var scope = this.$scope.$new();
            scope.index = "efResourcePointMore";
            scope.ID = this.deviceId;
            scope.switchStatus = true;
            scope.name = this.deviceName;
            this.layer.open({
                type: 1,
                skin: 'no-scroll',
                title: ['历史信息', 'font-weight: bold;background-color: #F6F8FB;color: #606060;height: 40px;'],
                area: ['955px', '535px'],
                content: efResourcePointMore,
                scope: scope,
                end: function () {
                    scope.$destroy();
                }
            });
        };
        EFResourcePointController.prototype.lookMoreAlarm = function () {
            var scope = this.$scope.$new();
            scope.index = "efResourcePointMore";
            scope.switchStatus = false;
            scope.ID = this.deviceId;
            scope.name = this.deviceName;
            this.layer.open({
                type: 1,
                skin: 'no-scroll',
                title: ['历史信息', 'font-weight: bold;background-color: #F6F8FB;color: #606060;height: 40px;'],
                area: ['955px', '535px'],
                content: efResourcePointMore,
                scope: scope,
                end: function () {
                    scope.$destroy();
                }
            });
        };
        EFResourcePointController.prototype.mapWifiPopulClose = function () {
            console.log('exit efres popup');
        };
        EFResourcePointController.$inject = ['$scope', '$timeout', 'mylayer', 'deviceSocketServer', 'userInfoCacheFactory', 'socketFactory', 'taskService', 'layer', 'resourceRetrievalService', 'analysisService'];
        return EFResourcePointController;
    }());
    main_app_1.app.controller('efResourcePointController', EFResourcePointController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvbWFwUG9pbnQvZWZSZXNvdXJjZVBvaW50L2VmUmVzb3VyY2VQb2ludC5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztJQXFCQSxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7SUFJckM7UUF1Q0ksbUNBQW9CLE1BQVcsRUFDWCxRQUFrQixFQUNsQixPQUFZLEVBQ1osa0JBQWlDLEVBQ2pDLG9CQUEwQyxFQUMxQyxhQUE2QixFQUM3QixXQUF5QixFQUN6QixLQUFTLEVBQ1Qsd0JBQTRCLEVBQzVCLGVBQW1CO1lBVHZDLGlCQThEQztZQTlEbUIsV0FBTSxHQUFOLE1BQU0sQ0FBSztZQUNYLGFBQVEsR0FBUixRQUFRLENBQVU7WUFDbEIsWUFBTyxHQUFQLE9BQU8sQ0FBSztZQUNaLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBZTtZQUNqQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1lBQzFDLGtCQUFhLEdBQWIsYUFBYSxDQUFnQjtZQUM3QixnQkFBVyxHQUFYLFdBQVcsQ0FBYztZQUN6QixVQUFLLEdBQUwsS0FBSyxDQUFJO1lBQ1QsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUFJO1lBQzVCLG9CQUFlLEdBQWYsZUFBZSxDQUFJO1lBOUN2QyxvQkFBZSxHQUFZLEtBQUssQ0FBQztZQUlqQyxhQUFRLEdBQWdCLEVBQUUsQ0FBQztZQUMzQixrQkFBYSxHQUFlLEVBQUUsQ0FBQztZQUsvQix3QkFBbUIsR0FBVyxLQUFLLENBQUM7WUFDcEMsdUJBQWtCLEdBQVcsS0FBSyxDQUFDO1lBRW5DLGtCQUFhLEdBQUcsQ0FBQyxDQUFDO1lBRWxCLHVCQUFrQixHQUFHLENBQUMsQ0FBQztZQUN2QixpQkFBWSxHQUEyQjtnQkFDbkMsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsT0FBTyxFQUFFO29CQUNMLEtBQUssRUFBRSxLQUFLO2lCQUNmO2dCQUNELFFBQVEsRUFBRSxF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QUFhLEdBQXBCO1lBRUksSUFBSSxLQUFLLEdBQWtHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDOUgsS0FBSyxDQUFDLEtBQUssR0FBRyxxQkFBcUIsQ0FBQztZQUNwQyxLQUFLLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztZQUMzQixLQUFLLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDekIsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQzdCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO2dCQUNaLElBQUksRUFBRSxDQUFDO2dCQUNQLElBQUksRUFBRSxXQUFXO2dCQUNqQixLQUFLLEVBQUUsQ0FBQyxNQUFNLEVBQUUsMEVBQTBFLENBQUM7Z0JBQzNGLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUM7Z0JBQ3hCLE9BQU8sRUFBRSxtQkFBbUI7Z0JBQzVCLEtBQUssRUFBRSxLQUFLO2dCQUNaLEdBQUcsRUFBRTtvQkFDRCxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ3JCLENBQUM7YUFDSixDQUFDLENBQUM7UUFDUCxDQUFDO1FBRU0scURBQWlCLEdBQXhCO1lBQ0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3BDLENBQUM7UUE3T00saUNBQU8sR0FBRyxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLG9CQUFvQixFQUFFLHNCQUFzQixFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLDBCQUEwQixFQUFDLGlCQUFpQixDQUFDLENBQUM7UUErTzVMLGdDQUFDO0tBaFBELEFBZ1BDLElBQUE7SUFFRCxjQUFHLENBQUMsVUFBVSxDQUFDLDJCQUEyQixFQUFFLHlCQUF5QixDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlL21hcFBvaW50L2VmUmVzb3VyY2VQb2ludC9lZlJlc291cmNlUG9pbnQuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8YW1kLWRlcGVuZGVuY3kgcGF0aD1cInRleHQhLi9lZlJlc291cmNlUG9pbnRNb3JlLmh0bWxcIiBuYW1lPVwiZWZSZXNvdXJjZVBvaW50TW9yZVwiIC8+XHJcbmltcG9ydCB7YXBwfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgJ2NzcyEuL3N0eWxlL2VmUmVzb3VyY2VQb2ludC5jc3MnO1xyXG5pbXBvcnQgICAnLi4vLi4vY29tbW9uL3NlcnZpY2VzL3Rhc2suc2VydmljZSc7XHJcbmltcG9ydCB7SVRhc2tTZXJ2aWNlfSBmcm9tICcuLi8uLi9jb21tb24vc2VydmljZXMvdGFzay5zZXJ2aWNlJztcclxuLy8g5by55qGGXHJcbmltcG9ydCAnLi9lZlJlc291cmNlUG9pbnRNb3JlLmNvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBJZGV2aWNlU29ja2V0IH0gZnJvbSAnLi4vLi4vY29tbW9uL3NlcnZpY2VzL2RldmljZVNvY2tldC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSVVzZXJJbmZvQ2FjaGVGYWN0b3J5IH0gZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3RvcnkvdXNlcmluZm8uY2FjaGUuZmFjdG9yeSc7XHJcbmltcG9ydCB7IElTb2NrZXRGYWN0b3J5IH0gZnJvbSAnLi4vLi4vY29tbW9uL2ZhY3Rvcnkvc29ja2V0LmZhY3RvcnknO1xyXG4vLyBtb2NrXHJcbi8vIGltcG9ydCB7IE1vY2tMaXN0LCBNb2NrQWxhcm1MaXN0fSBmcm9tIFwiLi9UZXN0RW51bVwiXHJcblxyXG4vLyDmo4DntKLlj4LmlbBcclxuaW1wb3J0IHsgRWxlY3Ryb25pY1NlYXJjaFBhcmFtcywgTWFza0xpc3QgfSBmcm9tICcuLi8uLi9yZXNvdXJjZVJldHJpZXZhbC9zZWFyY2gvYWR2YW5jZWRTZWFyY2gvYWRWYW5jZVNlYXJjaEVudW0nO1xyXG5pbXBvcnQgeyBBbGFybVJlc3VsdEluZm8sIFBlcnNvbkFsYXJtUGFyYW1zLCBQZXJzb25BbGFybVJlc3VsdCB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9QZXJzb25BbGFybUVudW1cIjtcclxuaW1wb3J0IFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2FuYWx5c2lzLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQXR0cmlidXRlRmFjdG9yeSB9IGZyb20gXCIuLi8uLi9jb21tb24vZmFjdG9yeS9hdHRyaWJ1dGUuZmFjdG9yeVwiO1xyXG4vLyDor7fmsYLlnLDlnYBcclxuaW1wb3J0ICcuLi8uLi9jb21tb24vc2VydmljZXMvcmVzb3VyY2VSZXRyaWV2YWwuc2VydmljZSc7XHJcbmltcG9ydCB7QWxhcm1UeXBlLCBTb2NrZXRSZXN1bHRUeXBlRW51bX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvc2VydmVyL2VudW0vU29ja2V0UmVzdWx0VHlwZUVudW1cIjtcclxubGV0IFByb21pc2UgPSByZXF1aXJlKCdlczYtcHJvbWlzZScpO1xyXG5cclxuZGVjbGFyZSBsZXQgJDogYW55LCBlZlJlc291cmNlUG9pbnRNb3JlOiBhbnkscmVxdWlyZTphbnk7XHJcblxyXG5jbGFzcyBFRlJlc291cmNlUG9pbnRDb250cm9sbGVyIHtcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCAnJHRpbWVvdXQnLCAnbXlsYXllcicsICdkZXZpY2VTb2NrZXRTZXJ2ZXInLCAndXNlckluZm9DYWNoZUZhY3RvcnknLCAnc29ja2V0RmFjdG9yeScsICd0YXNrU2VydmljZScsICdsYXllcicsICdyZXNvdXJjZVJldHJpZXZhbFNlcnZpY2UnLCdhbmFseXNpc1NlcnZpY2UnXTtcclxuICAgIFNob3dBbGFybVN0YXR1czogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgZGV2aWNlTmFtZTpzdHJpbmc7XHJcbiAgICBkZXZpY2VJbmZvOmFueTtcclxuICAgIGRldmljZUlkOnN0cmluZztcclxuICAgIGRhdGFMaXN0OiBBcnJheTxhbnk+ID0gIFtdOy8vTW9ja0xpc3QoMjApO1xyXG4gICAgYWxhcm1kYXRhTGlzdDogQXJyYXk8YW55PiA9IFtdOy8vIE1vY2tBbGFybUxpc3QoMjApO1xyXG4gICAgLy8gc2Nva2V0IOWPguaVsFxyXG4gICAgd2lmaUNvbGxlY3RQYXJhbTphbnk7XHJcbiAgICB3aWZpQWxhcm1QYXJhbTphbnk7XHJcbiAgICAvLyDmmK/lkKborqLpmIVcclxuICAgIGlzU3ViY3JpYmVFRmVuY2VMb2c6Ym9vbGVhbiA9IGZhbHNlO1xyXG4gICAgaXNTdWJjcmliZUFsYXJtTG9nOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8vIOWOhuWPsuaKk+aLjeaAu+aVsFxyXG4gICAgZGF0YUxpc3RUb3RhbCA9IDA7XHJcbiAgICAvLyDmiqXorabmgLvmlbBcclxuICAgIGFsYXJtZGF0YUxpc3RUb3RhbCA9IDA7XHJcbiAgICBzZWFyY2hQYXJhbXM6IEVsZWN0cm9uaWNTZWFyY2hQYXJhbXMgPSB7XHJcbiAgICAgICAgY3VycmVudFBhZ2U6IDEsXHJcbiAgICAgICAga2V5V29yZDogJycsXHJcbiAgICAgICAgb3JkZXJCeToge1xyXG4gICAgICAgICAgICBpc0FzYzogZmFsc2UsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYWdlU2l6ZTogMTAsXHJcbiAgICAgICAgdGFza0lkOiAnJyxcclxuICAgICAgICBzdGFydFRpbWU6ICcnLFxyXG4gICAgICAgIGVuZFRpbWU6ICcnLFxyXG4gICAgICAgIEFyT2JqZWN0SUQ6IFtdLFxyXG4gICAgICAgIGlzRmlyc3RTZWFyY2g6IHRydWUsXHJcbiAgICAgICAgdXNlcklkOiAnJyxcclxuICAgIH0vLyDmn6Xor6Llj4LmlbBcclxuICAgIFBlcnNvbkFsYXJtUGFyYW1zOiBQZXJzb25BbGFybVBhcmFtcyA9IHt9IGFzIFBlcnNvbkFsYXJtUGFyYW1zO1xyXG4gICAgLy8g5YWs55So5pa55rOVXHJcbiAgICBhdHRyaWJ1dGVGYWN0b3J5OiBBdHRyaWJ1dGVGYWN0b3J5ID0gbmV3IEF0dHJpYnV0ZUZhY3RvcnkoKTtcclxuICAgIC8vIOaXpeacn+aPkuS7tiDml7bpl7RcclxuICAgIHN0YXJ0VGltZTogc3RyaW5nO1xyXG4gICAgZW5kVGltZTogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgJHNjb3BlOiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlICR0aW1lb3V0OiBGdW5jdGlvbixcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgbXlsYXllcjogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkZXZpY2VTb2NrZXRTZXJ2ZXI6IElkZXZpY2VTb2NrZXQsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIHVzZXJJbmZvQ2FjaGVGYWN0b3J5OklVc2VySW5mb0NhY2hlRmFjdG9yeSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgc29ja2V0RmFjdG9yeTogSVNvY2tldEZhY3RvcnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRhc2tTZXJ2aWNlOiBJVGFza1NlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxheWVyOmFueSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVzb3VyY2VSZXRyaWV2YWxTZXJ2aWNlOmFueSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgYW5hbHlzaXNTZXJ2aWNlOmFueVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICB0aGlzLmRldmljZU5hbWUgPSB0aGlzLiRzY29wZS5Qb2ludERlVGFpbC5OYW1lO1xyXG4gICAgICAgIHRoaXMuZGV2aWNlSW5mbyA9IHRoaXMuJHNjb3BlLlBvaW50RGVUYWlsO1xyXG4gICAgICAgIHRoaXMuZGV2aWNlSWQgPSB0aGlzLiRzY29wZS5Qb2ludERlVGFpbC5JRDtcclxuICAgICAgICBsZXQgbWFya2VyOmFueSA9IHRoaXMuJHNjb3BlLm1hcmtlcjtcclxuXHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVFbGVDb2xsZWN0KCk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVXaWZpQWxhcm0oKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knICwoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMud2lmaUNvbGxlY3RQYXJhbS5pc0NhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMud2lmaUFsYXJtUGFyYW0uaXNDYW5jZWwgPSB0cnVlO1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgIC8vIOWPlua2iOiuoumYhVxyXG4gICAgICAgICAgICBpZiAodGhpcy5pc1N1YmNyaWJlRUZlbmNlTG9nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRldmljZVNvY2tldFNlcnZlci5nZXRXaWZpSW5mbyh0aGlzLndpZmlDb2xsZWN0UGFyYW0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghIXJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNsb3NlIEVGZW5jZUxvZyBzb2tpdFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zb2NrZXRGYWN0b3J5LnVuU3Vic2NyaWJlKCdTdWJjcmliZUVGZW5jZUxvZycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzU3ViY3JpYmVFRmVuY2VMb2cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzU3ViY3JpYmVBbGFybUxvZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VTb2NrZXRTZXJ2ZXIuZ2V0V2lmaUluZm8odGhpcy53aWZpQWxhcm1QYXJhbSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhcmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2xvc2UgRUZlbmNlQWxhTG9nIHNva2l0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNvY2tldEZhY3RvcnkudW5TdWJzY3JpYmUoJ1N1YmNyaWJlQWxhcm1Mb2cnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1N1YmNyaWJlQWxhcm1Mb2cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v6K6+572u5pe26Ze05o+S5Lu26buY6K6k5pe26Ze0IFxyXG4gICAgICAgIGxldCB0aW1lID0gdGhpcy5hdHRyaWJ1dGVGYWN0b3J5LmdldENyb3NzVHJhaW5UaW1lKDApO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGltZS5zdGFydFRpbWU7XHJcbiAgICAgICAgdGhpcy5lbmRUaW1lID0gdGltZS5lbmRUaW1lO1xyXG4gICAgICAgIC8v5Yid5aeL5YyW6buY6K6k6K+35rGC5pWw5o2uXHJcbiAgICAgICAgdGhpcy5zZWFyY2hQYXJhbXMudXNlcklkID0gdGhpcy51c2VySW5mb0NhY2hlRmFjdG9yeS5nZXRDdXJyZW50VXNlcklkKCk7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hQYXJhbXMuc3RhcnRUaW1lID0gdGhpcy5zdGFydFRpbWU7XHJcbiAgICAgICAgdGhpcy5zZWFyY2hQYXJhbXMuZW5kVGltZSA9IHRoaXMuZW5kVGltZTtcclxuICAgICAgICB0aGlzLnNlYXJjaFBhcmFtcy5Bck9iamVjdElELnB1c2godGhpcy5kZXZpY2VJZCk7XHJcbiAgICAgICAgdGhpcy5nZXRTZXJ2ZXJNZXNzYWdlKHRoaXMuc2VhcmNoUGFyYW1zKTtcclxuICAgICAgICAvLyDmiqXorabor7fmsYLlj4LmlbBcclxuICAgICAgICB0aGlzLlBlcnNvbkFsYXJtUGFyYW1zLnN0YXJ0VGltZSA9IHRoaXMuc3RhcnRUaW1lO1xyXG4gICAgICAgIHRoaXMuUGVyc29uQWxhcm1QYXJhbXMuZW5kVGltZSA9IHRoaXMuZW5kVGltZTtcclxuICAgICAgICB0aGlzLlBlcnNvbkFsYXJtUGFyYW1zLmFyckNhbWVyYUlkID0gW3RoaXMuZGV2aWNlSWRdO1xyXG4gICAgICAgIHRoaXMuUGVyc29uQWxhcm1QYXJhbXMucGFnZVNpemUgPSAxMDtcclxuICAgICAgICB0aGlzLlBlcnNvbkFsYXJtUGFyYW1zLmN1cnJlbnRQYWdlID0gMTtcclxuICAgICAgICB0aGlzLlBlcnNvbkFsYXJtUGFyYW1zLmFsYXJtVHlwZSA9ICdFRkVOQ0UnO1xyXG4gICAgICAgIHRoaXMuZ2V0U2VydmVyQWxhcm1NZXNzYWdlKHRoaXMuUGVyc29uQWxhcm1QYXJhbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9u6K+35rGC55S15Zu05Y6G5Y+y5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0ge0VsZWN0cm9uaWNTZWFyY2hQYXJhbXN9IEVsZWN0cm9uaWNTZWFyY2hQYXJhbXMg6K+35rGC5Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRTZXJ2ZXJNZXNzYWdlKHNlYXJjaFBhcmFtczogRWxlY3Ryb25pY1NlYXJjaFBhcmFtcykge1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLnJlc291cmNlUmV0cmlldmFsU2VydmljZS5hZHZhbmNlZFNlYXJjaEJ5RUZlbmNlKHNlYXJjaFBhcmFtcylcclxuICAgICAgICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHJlcy5jb2RlID09PSAyMDApICYmICh0eXBlb2YgcmVzLmRhdGEuRUZFTkNFICE9PSAndW5kZWZpbmVkJykgJiYgKHJlcy5kYXRhLkVGRU5DRS5Ub3RhbENvdW50ID4gMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGFMaXN0VG90YWwgPSByZXMuZGF0YS5FRkVOQ0UuVG90YWxDb3VudDtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYXJyOiBBcnJheTxhbnk+ID0gW10sIGRhdGE6IGFueSA9IHJlcy5kYXRhLkVGRU5DRS5SZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMDtpPGRhdGEubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvYmo6YW55PXt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouSU1TSSA9IGRhdGFbaV0uZUZlbmNlTG9nLklNU0k7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5JTUVJID0gZGF0YVtpXS5lRmVuY2VMb2cuSU1FSTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLkFjcVRpbWUgPSBkYXRhW2ldLmVGZW5jZUxvZy5BY3FUaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmRhdGFMaXN0ID0gYXJyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGRlc2NyaXB0aW9u6K+35rGC55S15Zu05Y6G5Y+y5oql6K2m5pWw5o2uXHJcbiAgICAgKiBAcGFyYW0ge1BlcnNvbkFsYXJtUGFyYW1zfSBQZXJzb25BbGFybVBhcmFtcyDor7fmsYLlj4LmlbBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldFNlcnZlckFsYXJtTWVzc2FnZShzZWFyY2hQYXJhbXM6IFBlcnNvbkFsYXJtUGFyYW1zKSB7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuYW5hbHlzaXNTZXJ2aWNlLnNlYXJjaFBlcnNvbkFsYXJtKHRoaXMuUGVyc29uQWxhcm1QYXJhbXMpLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmFsYXJtZGF0YUxpc3RUb3RhbCA9IHJlcy5kYXRhLlRvdGFsQ291bnQ7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcy5kYXRhLlJlc3VsdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkYXRhYXJyID0gcmVzLmRhdGEuUmVzdWx0W2ldLkFsYXJtTG9nLk5vdGVzLnNwbGl0KFwiX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXMuZGF0YS5SZXN1bHRbaV0uQWxhcm1Mb2cuSU1FSSA9IGRhdGFhcnJbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzLmRhdGEuUmVzdWx0W2ldLkFsYXJtTG9nLklNU0kgPSBkYXRhYXJyWzFdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VsZi5hbGFybWRhdGFMaXN0ID0gcmVzLmRhdGEuUmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy/nlLXlm7Tph4fpm4ZcclxuICAgIHByaXZhdGUgc3Vic2NyaWJlRWxlQ29sbGVjdCgpe1xyXG4gICAgICAgIHRoaXMud2lmaUNvbGxlY3RQYXJhbSA9IHtcclxuICAgICAgICAgICAgdXNlcklEOnRoaXMudXNlckluZm9DYWNoZUZhY3RvcnkuZ2V0Q3VycmVudFVzZXJJZCgpLFxyXG4gICAgICAgICAgICBvYmplY3RJRDogW3RoaXMuZGV2aWNlSWRdLFxyXG4gICAgICAgICAgICBpc0NhbmNlbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHNvY2tldFR5cGU6U29ja2V0UmVzdWx0VHlwZUVudW0uU3Vic2NyaWJlRUZlbmNlTG9nXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmRldmljZVNvY2tldFNlcnZlci5nZXRXaWZpSW5mbyh0aGlzLndpZmlDb2xsZWN0UGFyYW0pLnRoZW4oKHJlcyk9PntcclxuICAgICAgICAgICAgaWYgKCEhcmVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzU3ViY3JpYmVFRmVuY2VMb2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb2NrZXRGYWN0b3J5LnN1YnNjcmliZShTb2NrZXRSZXN1bHRUeXBlRW51bS5TdWJzY3JpYmVFRmVuY2VMb2csKGRhdGE6YW55KT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGFMaXN0ID0gZGF0YS5jb25jYXQodGhpcy5kYXRhTGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YUxpc3RUb3RhbCArPWRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3ViY3JpYmVFRmVuY2VMb2cnLCBkYXRhLHRoaXMuZGF0YUxpc3QubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8v55S15Zu05oql6K2mXHJcbiAgICBwcml2YXRlIHN1YnNjcmliZVdpZmlBbGFybSgpe1xyXG4gICAgICAgIHRoaXMud2lmaUFsYXJtUGFyYW0gPSB7XHJcbiAgICAgICAgICAgIHVzZXJJRDp0aGlzLnVzZXJJbmZvQ2FjaGVGYWN0b3J5LmdldEN1cnJlbnRVc2VySWQoKSxcclxuICAgICAgICAgICAgb2JqZWN0SUQ6IFt0aGlzLmRldmljZUlkXSxcclxuICAgICAgICAgICAgaXNDYW5jZWw6IGZhbHNlLFxyXG4gICAgICAgICAgICBzb2NrZXRUeXBlOlNvY2tldFJlc3VsdFR5cGVFbnVtLlN1YnNjcmliZUFsYXJtTG9nLFxyXG4gICAgICAgICAgICBhbGFybVR5cGU6QWxhcm1UeXBlLkVmZW5jZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5kZXZpY2VTb2NrZXRTZXJ2ZXIuZ2V0V2lmaUluZm8odGhpcy53aWZpQWxhcm1QYXJhbSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghIXJlcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc1N1YmNyaWJlQWxhcm1Mb2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zb2NrZXRGYWN0b3J5LnN1YnNjcmliZShTb2NrZXRSZXN1bHRUeXBlRW51bS5TdWJzY3JpYmVBbGFybUxvZywgKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRldmljZUlkICE9IGRhdGFbMF0uQWxhcm1Mb2cuT2JqZWN0SUQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsYXJtZGF0YUxpc3QgPSBkYXRhLmNvbmNhdCh0aGlzLmFsYXJtZGF0YUxpc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFsYXJtZGF0YUxpc3RUb3RhbCArPWRhdGEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHB1YmxpYyBzaG93QWxhcm0oKSB7XHJcbiAgICAgICAgdGhpcy5TaG93QWxhcm1TdGF0dXMgPSAhdGhpcy5TaG93QWxhcm1TdGF0dXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGxvb2tNb3JlQ29sbGVjdCgpIHtcclxuICAgICAgICAvLyDpu5jorqTmmL7npLrlvLnmoYZcclxuICAgICAgICBsZXQgc2NvcGU6IHtcclxuICAgICAgICAgICAgbGF5ZXI6IGFueTsgaW5kZXg6IHN0cmluZywgJGRlc3Ryb3k6IEZ1bmN0aW9uLCBJRDogYW55LCBzd2l0Y2hTdGF0dXM6IGJvb2xlYW4sIG5hbWU6IHN0cmluZ30gPSB0aGlzLiRzY29wZS4kbmV3KCk7XHJcbiAgICAgICAgc2NvcGUuaW5kZXggPSBcImVmUmVzb3VyY2VQb2ludE1vcmVcIjtcclxuICAgICAgICBzY29wZS5JRD10aGlzLmRldmljZUlkO1xyXG4gICAgICAgIHNjb3BlLnN3aXRjaFN0YXR1cz10cnVlO1xyXG4gICAgICAgIHNjb3BlLm5hbWUgPSB0aGlzLmRldmljZU5hbWU7XHJcbiAgICAgICAgdGhpcy5sYXllci5vcGVuKHtcclxuICAgICAgICAgICAgdHlwZTogMSxcclxuICAgICAgICAgICAgc2tpbjogJ25vLXNjcm9sbCcsXHJcbiAgICAgICAgICAgIHRpdGxlOiBbJ+WOhuWPsuS/oeaBrycsICdmb250LXdlaWdodDogYm9sZDtiYWNrZ3JvdW5kLWNvbG9yOiAjRjZGOEZCO2NvbG9yOiAjNjA2MDYwO2hlaWdodDogNDBweDsnXSxcclxuICAgICAgICAgICAgYXJlYTogWyc5NTVweCcsICc1MzVweCddLCAgICAgICAgICBcclxuICAgICAgICAgICAgY29udGVudDogZWZSZXNvdXJjZVBvaW50TW9yZSxcclxuICAgICAgICAgICAgc2NvcGU6IHNjb3BlLFxyXG4gICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLiRkZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbG9va01vcmVBbGFybSgpIHtcclxuICAgICAgICAvLyDpu5jorqTmmL7npLrlvLnmoYZcclxuICAgICAgICBsZXQgc2NvcGU6IHsgbGF5ZXI6IGFueTsgaW5kZXg6IHN0cmluZywgJGRlc3Ryb3k6IEZ1bmN0aW9uLCBJRDogYW55LCBzd2l0Y2hTdGF0dXM6IGJvb2xlYW4sIG5hbWU6c3RyaW5nfSA9IHRoaXMuJHNjb3BlLiRuZXcoKTtcclxuICAgICAgICBzY29wZS5pbmRleCA9IFwiZWZSZXNvdXJjZVBvaW50TW9yZVwiO1xyXG4gICAgICAgIHNjb3BlLnN3aXRjaFN0YXR1cyA9IGZhbHNlO1xyXG4gICAgICAgIHNjb3BlLklEID0gdGhpcy5kZXZpY2VJZDtcclxuICAgICAgICBzY29wZS5uYW1lID0gdGhpcy5kZXZpY2VOYW1lO1xyXG4gICAgICAgIHRoaXMubGF5ZXIub3Blbih7XHJcbiAgICAgICAgICAgIHR5cGU6IDEsXHJcbiAgICAgICAgICAgIHNraW46ICduby1zY3JvbGwnLFxyXG4gICAgICAgICAgICB0aXRsZTogWyfljoblj7Lkv6Hmga8nLCAnZm9udC13ZWlnaHQ6IGJvbGQ7YmFja2dyb3VuZC1jb2xvcjogI0Y2RjhGQjtjb2xvcjogIzYwNjA2MDtoZWlnaHQ6IDQwcHg7J10sXHJcbiAgICAgICAgICAgIGFyZWE6IFsnOTU1cHgnLCAnNTM1cHgnXSwgXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IGVmUmVzb3VyY2VQb2ludE1vcmUsXHJcbiAgICAgICAgICAgIHNjb3BlOiBzY29wZSxcclxuICAgICAgICAgICAgZW5kOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG1hcFdpZmlQb3B1bENsb3NlKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdleGl0IGVmcmVzIHBvcHVwJyk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5hcHAuY29udHJvbGxlcignZWZSZXNvdXJjZVBvaW50Q29udHJvbGxlcicsIEVGUmVzb3VyY2VQb2ludENvbnRyb2xsZXIpOyJdfQ==

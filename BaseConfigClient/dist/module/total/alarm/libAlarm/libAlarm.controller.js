define(["require", "exports", "../../../common/app/main.app", "../../../common/services/total.service", "../../totalFactory/doEcharts", "angular", "echarts"], function (require, exports, main_app_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var echarts = require("echarts");
    var SearchParams = (function () {
        function SearchParams() {
        }
        return SearchParams;
    }());
    var LibAlarmController = (function () {
        function LibAlarmController($scope, totalService, echartService, $timeout) {
            var vm = this;
            vm.formatDataList = formatDataList;
            vm.changeTimeBtn = changeTimeBtn;
            vm.showCustomTime = showCustomTime;
            vm.startTime = '';
            vm.duration = 'THIRY_DAYS';
            vm.endTime = '';
            vm.isNoData = true;
            vm.dataPaging = dataPaging;
            vm.currentPage = 1;
            vm.pageSize = 15;
            vm.prePage = prePage;
            vm.nextPage = nextPage;
            function _getSearchParams() {
                var result = new SearchParams();
                result.duration = vm.duration;
                result.startTime = vm.startTime;
                result.endTime = vm.endTime;
                result.groupType = "GROUP_BY_BIZLIB";
                console.log('传参', result);
                return [result];
            }
            function getDataList() {
                totalService.getAlarmDataList(_getSearchParams()).then(complete);
                function complete(rep) {
                    console.log('设备报警请求成功', rep);
                    if (rep.code === 200 && rep.data) {
                        vm.isNoData = false;
                        formatDataList(rep.data);
                    }
                    else {
                        vm.isNoData = true;
                    }
                }
            }
            getDataList();
            function dataPaging(formatData, currentPage) {
                var allData = formatData.length;
                var pageNumber = Math.ceil(allData / vm.pageSize);
                var showArr = [];
                if (currentPage < 1) {
                    currentPage = 1;
                    vm.currentPage = 1;
                }
                else if (currentPage > pageNumber) {
                    currentPage = pageNumber;
                    vm.currentPage = pageNumber;
                }
                for (var i = (currentPage - 1) * vm.pageSize; i < vm.pageSize * currentPage; i++) {
                    if (formatData[i] !== undefined) {
                        showArr.push(formatData[i]);
                    }
                }
                console.log('数据分页', showArr);
                return showArr;
            }
            function prePage() {
                vm.currentPage--;
                getDataList();
            }
            function nextPage() {
                vm.currentPage++;
                getDataList();
            }
            function changeTimeBtn(duration) {
                vm.duration = duration;
                console.log('按钮', vm.duration);
                getDataList();
            }
            function showCustomTime() {
                console.log('自定义时间开始', vm.startTime);
                console.log('自定义时间结束', vm.endTime);
                vm.duration = "CUSTOMIZE";
                getDataList();
            }
            function formatDataList(originalData) {
                var xAxisData = [];
                var allNum = [];
                var onlineNum = [];
                var showArr = dataPaging(originalData.GROUP_BY_BIZLIB, vm.currentPage);
                console.log('库警数', vm.currentPage);
                showArr.forEach(function (item, index) {
                    xAxisData.push(item.bizLib);
                    allNum.push(item.allAlarmNum);
                    onlineNum.push(item.validAlarmNum);
                });
                var formatData = {
                    seriesNameOne: '全部',
                    seriesNameTwo: '有效',
                    gridLeft: '5%',
                    gridRight: '5%',
                    xAxisName: '',
                    yAxisName: '',
                    colorTwo: ['#8cdcff'],
                    colorOne: ['#40c4ff'],
                    xAxisData: xAxisData,
                    allNum: allNum,
                    onlineNum: onlineNum
                };
                echartService.drawEchart(echartService.echartPileBarOption(formatData), 'alarm-4');
            }
        }
        LibAlarmController.$inject = ['$scope', 'totalService', 'echartService', '$timeout'];
        return LibAlarmController;
    }());
    main_app_1.app.controller('libAlarmController', LibAlarmController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvdG90YWwvYWxhcm0vbGliQWxhcm0vbGliQWxhcm0uY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFpQkEsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRWpDO1FBQUE7UUFLQSxDQUFDO1FBQUQsbUJBQUM7SUFBRCxDQUxBLEFBS0MsSUFBQTtJQUVEO1FBdUNJLDRCQUFZLE1BQVcsRUFBRSxZQUEyQixFQUFFLGFBQTRCLEVBQUMsUUFBWTtZQUMzRixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7WUFFZCxFQUFFLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztZQUNuQyxFQUFFLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztZQUNqQyxFQUFFLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztZQUduQyxFQUFFLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNsQixFQUFFLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQztZQUMzQixFQUFFLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUNoQixFQUFFLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUVuQixFQUFFLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztZQUMzQixFQUFFLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNuQixFQUFFLENBQUMsUUFBUSxHQUFFLEVBQUUsQ0FBQztZQUVoQixFQUFFLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUNyQixFQUFFLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUd2QjtnQkFDSSxJQUFJLE1BQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO2dCQUVoQyxNQUFNLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBQzlCLE1BQU0sQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDaEMsTUFBTSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUMs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QyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsRUFBQyxTQUFTLENBQUMsQ0FBQztZQUN0RixDQUFDO1FBQ0wsQ0FBQztRQTlLTSwwQkFBTyxHQUFHLENBQUMsUUFBUSxFQUFFLGNBQWMsRUFBQyxlQUFlLEVBQUMsVUFBVSxDQUFDLENBQUM7UUErSzNFLHlCQUFDO0tBaExELEFBZ0xDLElBQUE7SUFFRCxjQUFHLENBQUMsVUFBVSxDQUFDLG9CQUFvQixFQUFFLGtCQUFrQixDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlL3RvdGFsL2FsYXJtL2xpYkFsYXJtL2xpYkFsYXJtLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBkZWxsIG9uIDIwMTcvNC8yMS5cclxuICovXHJcblxyXG5pbXBvcnQge2FwcH0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9hcHAvbWFpbi5hcHBcIjtcclxuXHJcbmltcG9ydCB7SVRvdGFsU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy90b3RhbC5zZXJ2aWNlXCJcclxuaW1wb3J0IFwiLi4vLi4vLi4vY29tbW9uL3NlcnZpY2VzL3RvdGFsLnNlcnZpY2VcIlxyXG5cclxuaW1wb3J0IHtJRWNoYXJ0U2VydmljZX0gZnJvbSBcIi4uLy4uL3RvdGFsRmFjdG9yeS9kb0VjaGFydHNcIlxyXG5pbXBvcnQgXCIuLi8uLi90b3RhbEZhY3RvcnkvZG9FY2hhcnRzXCJcclxuaW1wb3J0IHtSZXNwb25zZVJlc3VsdH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQge0FsYXJtUmVzcG9uc2UsQWxhcm1Hcm91cEJ5Qml6TGlifSBmcm9tIFwiLi4vLi4vdG90YWxGYWN0b3J5L3RvdGFsUmVzcG9uc2VcIlxyXG5cclxuaW1wb3J0IFwiYW5ndWxhclwiO1xyXG5pbXBvcnQgXCJlY2hhcnRzXCI7XHJcbmRlY2xhcmUgbGV0IHJlcXVpcmU6IGFueTtcclxubGV0IGVjaGFydHMgPSByZXF1aXJlKFwiZWNoYXJ0c1wiKTtcclxuXHJcbmNsYXNzIFNlYXJjaFBhcmFtcyB7XHJcbiAgICBkdXJhdGlvbjogc3RyaW5nO1xyXG4gICAgc3RhcnRUaW1lOnN0cmluZztcclxuICAgIGVuZFRpbWU6c3RyaW5nO1xyXG4gICAgZ3JvdXBUeXBlOnN0cmluZztcclxufVxyXG5cclxuY2xhc3MgTGliQWxhcm1Db250cm9sbGVyIHtcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCAndG90YWxTZXJ2aWNlJywnZWNoYXJ0U2VydmljZScsJyR0aW1lb3V0J107XHJcblxyXG4gICAgLy/moLzlvI/ljJbmlbDmja5cclxuICAgIGZvcm1hdERhdGFMaXN0OkZ1bmN0aW9uO1xyXG5cclxuICAgIC8v5YiH5o2i5LiN5ZCM5pe26Ze05oyJ6ZKuXHJcbiAgICBjaGFuZ2VUaW1lQnRuOkZ1bmN0aW9uO1xyXG5cclxuICAgIC8v5bGV56S66Ieq5a6a5LmJ5pe26Ze05q615pWw5o2uXHJcbiAgICBzaG93Q3VzdG9tVGltZTpGdW5jdGlvbjtcclxuXHJcbiAgICAvL+W8gOWni+aXtumXtFxyXG4gICAgc3RhcnRUaW1lOnN0cmluZztcclxuICAgIC8v57uT5p2f5pe26Ze0XHJcbiAgICBlbmRUaW1lOnN0cmluZztcclxuICAgIC8v5Yy65Z+f5ZCNXHJcbiAgICBhcmVhTmFtZTpzdHJpbmc7XHJcbiAgICAvL+WMuuWfn2NvZGVcclxuICAgIGFyZWFDb2RlOnN0cmluZztcclxuICAgIC8v5pe26Ze05q61XHJcbiAgICBkdXJhdGlvbjpzdHJpbmc7XHJcblxyXG4gICAgLy/ml6DmlbDmja7ml7blsZXnpLpcclxuICAgIGlzTm9EYXRhOmJvb2xlYW47XHJcblxyXG4gICAgLy8g5pWw5o2u5YiG6aG1XHJcbiAgICBkYXRhUGFnaW5nOkZ1bmN0aW9uO1xyXG4gICAgLy/lvZPliY3pobXmlbBcclxuICAgIGN1cnJlbnRQYWdlOm51bWJlcjtcclxuICAgIC8v5q+P6aG15bGV56S65pWwXHJcbiAgICBwYWdlU2l6ZTpudW1iZXI7XHJcblxyXG4gICAgLy/kuIrkuIDkuKpcclxuICAgIHByZVBhZ2U6IEZ1bmN0aW9uO1xyXG5cclxuICAgIC8v5LiL5LiA5LiqXHJcbiAgICBuZXh0UGFnZTogRnVuY3Rpb247XHJcblxyXG4gICAgY29uc3RydWN0b3IoJHNjb3BlOiBhbnksIHRvdGFsU2VydmljZTogSVRvdGFsU2VydmljZSwgZWNoYXJ0U2VydmljZTpJRWNoYXJ0U2VydmljZSwkdGltZW91dDphbnkpIHtcclxuICAgICAgICBsZXQgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5mb3JtYXREYXRhTGlzdCA9IGZvcm1hdERhdGFMaXN0O1xyXG4gICAgICAgIHZtLmNoYW5nZVRpbWVCdG4gPSBjaGFuZ2VUaW1lQnRuO1xyXG4gICAgICAgIHZtLnNob3dDdXN0b21UaW1lID0gc2hvd0N1c3RvbVRpbWU7XHJcblxyXG4gICAgICAgIC8v6buY6K6k5YC8XHJcbiAgICAgICAgdm0uc3RhcnRUaW1lID0gJyc7XHJcbiAgICAgICAgdm0uZHVyYXRpb24gPSAnVEhJUllfREFZUyc7XHJcbiAgICAgICAgdm0uZW5kVGltZSA9ICcnO1xyXG4gICAgICAgIHZtLmlzTm9EYXRhID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdm0uZGF0YVBhZ2luZyA9IGRhdGFQYWdpbmc7XHJcbiAgICAgICAgdm0uY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgIHZtLnBhZ2VTaXplID0xNTtcclxuXHJcbiAgICAgICAgdm0ucHJlUGFnZSA9IHByZVBhZ2U7XHJcbiAgICAgICAgdm0ubmV4dFBhZ2UgPSBuZXh0UGFnZTtcclxuXHJcbiAgICAgICAgLy8g5ZCR5ZCO5Y+w5Lyg55qE5Y+C5pWwXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFNlYXJjaFBhcmFtcygpOkFycmF5PFNlYXJjaFBhcmFtcz57XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBuZXcgU2VhcmNoUGFyYW1zKCk7XHJcblxyXG4gICAgICAgICAgICByZXN1bHQuZHVyYXRpb24gPSB2bS5kdXJhdGlvbjtcclxuICAgICAgICAgICAgcmVzdWx0LnN0YXJ0VGltZSA9IHZtLnN0YXJ0VGltZTtcclxuICAgICAgICAgICAgcmVzdWx0LmVuZFRpbWUgPSB2bS5lbmRUaW1lO1xyXG4gICAgICAgICAgICByZXN1bHQuZ3JvdXBUeXBlID0gXCJHUk9VUF9CWV9CSVpMSUJcIjtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ+S8oOWPgicscmVzdWx0KTtcclxuICAgICAgICAgICAgcmV0dXJuIFtyZXN1bHRdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy/ojrflj5bmlbDmja7liJfooahcclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhTGlzdCgpe1xyXG4gICAgICAgICAgICB0b3RhbFNlcnZpY2UuZ2V0QWxhcm1EYXRhTGlzdChfZ2V0U2VhcmNoUGFyYW1zKCkpLnRoZW4oY29tcGxldGUpO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZShyZXA6UmVzcG9uc2VSZXN1bHQ8QWxhcm1SZXNwb25zZT4pe1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+iuvuWkh+aKpeitpuivt+axguaIkOWKnycscmVwKTtcclxuICAgICAgICAgICAgICAgIGlmKHJlcC5jb2RlID09PSAyMDAgJiYgcmVwLmRhdGEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzTm9EYXRhID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0RGF0YUxpc3QocmVwLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNOb0RhdGEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBnZXREYXRhTGlzdCgpO1xyXG5cclxuICAgICAgICAvLyDmlbDmja7liIbpobUg5qC55o2u6aG15pWw5bGV56S65a+55bqU5pWw5o2uXHJcbiAgICAgICAgZnVuY3Rpb24gZGF0YVBhZ2luZyhmb3JtYXREYXRhOkFycmF5PGFueT4sY3VycmVudFBhZ2U6bnVtYmVyKXtcclxuICAgICAgICAgICAgLy/mgLvmlbDmja7mnaHmlbBcclxuICAgICAgICAgICAgbGV0IGFsbERhdGE6bnVtYmVyID0gZm9ybWF0RGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgIC8v5pWw5o2u5oC76aG15pWwXHJcbiAgICAgICAgICAgIGxldCBwYWdlTnVtYmVyOm51bWJlciA9IE1hdGguY2VpbChhbGxEYXRhIC8gdm0ucGFnZVNpemUpO1xyXG4gICAgICAgICAgICAvL+avj+asoeWxleekuueahOaVsOaNrlxyXG4gICAgICAgICAgICBsZXQgc2hvd0FycjpBcnJheTxhbnk+ID0gW107XHJcblxyXG4gICAgICAgICAgICBpZihjdXJyZW50UGFnZSA8IDEpe1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgICAgICAgICAgdm0uY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYoY3VycmVudFBhZ2UgPiBwYWdlTnVtYmVyKXtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlID0gcGFnZU51bWJlcjtcclxuICAgICAgICAgICAgICAgIHZtLmN1cnJlbnRQYWdlID0gcGFnZU51bWJlcjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IChjdXJyZW50UGFnZSAtIDEpICogdm0ucGFnZVNpemU7IGkgPCB2bS5wYWdlU2l6ZSAqIGN1cnJlbnRQYWdlOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmKGZvcm1hdERhdGFbaV0gIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0Fyci5wdXNoKGZvcm1hdERhdGFbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5pWw5o2u5YiG6aG1JyxzaG93QXJyKVxyXG4gICAgICAgICAgICByZXR1cm4gc2hvd0FycjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOiuvuWkh+aKpeitpuaVsOaNruWIh+aNoiDkuIrkuIDpobVcclxuICAgICAgICBmdW5jdGlvbiBwcmVQYWdlKCl7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRQYWdlLS07XHJcbiAgICAgICAgICAgIGdldERhdGFMaXN0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyDorr7lpIfmiqXorabmlbDmja7liIfmjaIg5LiL5LiA6aG1XHJcbiAgICAgICAgZnVuY3Rpb24gbmV4dFBhZ2UoKXtcclxuICAgICAgICAgICAgdm0uY3VycmVudFBhZ2UrKztcclxuICAgICAgICAgICAgZ2V0RGF0YUxpc3QoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8v54K55Ye75LiN5ZCM5pe26Ze05q615oyJ6ZKuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hhbmdlVGltZUJ0bihkdXJhdGlvbjpzdHJpbmcpe1xyXG4gICAgICAgICAgICB2bS5kdXJhdGlvbiA9IGR1cmF0aW9uO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5oyJ6ZKuJyx2bS5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgIGdldERhdGFMaXN0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+iHquWumuS5ieaXtumXtFxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dDdXN0b21UaW1lKCl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfoh6rlrprkuYnml7bpl7TlvIDlp4snLHZtLnN0YXJ0VGltZSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfoh6rlrprkuYnml7bpl7Tnu5PmnZ8nLHZtLmVuZFRpbWUpO1xyXG4gICAgICAgICAgICB2bS5kdXJhdGlvbiA9IFwiQ1VTVE9NSVpFXCI7XHJcbiAgICAgICAgICAgIGdldERhdGFMaXN0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+W6k+itpuaVsOWbvuihqOa4suafk1xyXG4gICAgICAgIGZ1bmN0aW9uIGZvcm1hdERhdGFMaXN0KG9yaWdpbmFsRGF0YTpBbGFybVJlc3BvbnNlKXtcclxuICAgICAgICAgICAgbGV0IHhBeGlzRGF0YTpBcnJheTxhbnk+ID0gW107XHJcbiAgICAgICAgICAgIGxldCBhbGxOdW06QXJyYXk8YW55PiA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgb25saW5lTnVtOkFycmF5PGFueT4gPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGxldCBzaG93QXJyOkFycmF5PG9iamVjdD4gPSBkYXRhUGFnaW5nKG9yaWdpbmFsRGF0YS5HUk9VUF9CWV9CSVpMSUIsdm0uY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5bqT6K2m5pWwJyx2bS5jdXJyZW50UGFnZSk7XHJcblxyXG4gICAgICAgICAgICBzaG93QXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW06QWxhcm1Hcm91cEJ5Qml6TGliLCBpbmRleDpudW1iZXIpIHtcclxuICAgICAgICAgICAgICAgIHhBeGlzRGF0YS5wdXNoKGl0ZW0uYml6TGliKTtcclxuICAgICAgICAgICAgICAgIGFsbE51bS5wdXNoKGl0ZW0uYWxsQWxhcm1OdW0pO1xyXG4gICAgICAgICAgICAgICAgb25saW5lTnVtLnB1c2goaXRlbS52YWxpZEFsYXJtTnVtKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgZm9ybWF0RGF0YTpvYmplY3QgPXtcclxuICAgICAgICAgICAgICAgIHNlcmllc05hbWVPbmU6J+WFqOmDqCcsXHJcbiAgICAgICAgICAgICAgICBzZXJpZXNOYW1lVHdvOifmnInmlYgnLFxyXG4gICAgICAgICAgICAgICAgZ3JpZExlZnQ6ICc1JScsXHJcbiAgICAgICAgICAgICAgICBncmlkUmlnaHQ6ICc1JScsXHJcbiAgICAgICAgICAgICAgICB4QXhpc05hbWU6ICcnLFxyXG4gICAgICAgICAgICAgICAgeUF4aXNOYW1lOiAnJyxcclxuICAgICAgICAgICAgICAgIGNvbG9yVHdvOiBbJyM4Y2RjZmYnXSxcclxuICAgICAgICAgICAgICAgIGNvbG9yT25lOiBbJyM0MGM0ZmYnXSxcclxuICAgICAgICAgICAgICAgIC8veOi9tOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgeEF4aXNEYXRhOnhBeGlzRGF0YSxcclxuICAgICAgICAgICAgICAgIC8v5YWo6YOo5pWw5o2uXHJcbiAgICAgICAgICAgICAgICBhbGxOdW06YWxsTnVtLFxyXG4gICAgICAgICAgICAgICAgLy/mnInmlYjmiJbov5DooYzmlbDmja5cclxuICAgICAgICAgICAgICAgIG9ubGluZU51bTpvbmxpbmVOdW1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGVjaGFydFNlcnZpY2UuZHJhd0VjaGFydChlY2hhcnRTZXJ2aWNlLmVjaGFydFBpbGVCYXJPcHRpb24oZm9ybWF0RGF0YSksJ2FsYXJtLTQnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmFwcC5jb250cm9sbGVyKCdsaWJBbGFybUNvbnRyb2xsZXInLCBMaWJBbGFybUNvbnRyb2xsZXIpOyJdfQ==

define(["require", "exports", "text!./map.popup.html", "../../common/app/main.app", "../../common/map/map.main", "../../common/enum/MapConfigJsonEnum", "../../../core/entity/SystemPoint", "../../../core/enum/ObjectType", "../../common/directive/tree/tree-params", "../../../core/enum/TreeType", "../../../core/enum/LayerType", "./map.popup.controller", "../../common/services/map.service", "../../common/services/connectTree.service", "./../../common/directive/tree/tree.directive.service", "./../../common/factory/map.event.factory"], function (require, exports, PopupHtml, main_app_1, map_main_1, MapConfigJsonEnum_1, SystemPoint_1, ObjectType_1, tree_params_1, TreeType_1, LayerType_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var Promise = require('es6-promise');
    var MapResourcePointController = (function () {
        function MapResourcePointController($scope, $timeout, $compile, mapService, connectTreeService, treeDirectiveService, mapEventFactory) {
            var _this = this;
            this.$scope = $scope;
            this.$timeout = $timeout;
            this.$compile = $compile;
            this.mapService = mapService;
            this.connectTreeService = connectTreeService;
            this.treeDirectiveService = treeDirectiveService;
            this.mapEventFactory = mapEventFactory;
            this.mapId = "MapResourcePointMap";
            this.mapConfigName = MapConfigJsonEnum_1.MapConfigJsonEnum.MAPCONFIG;
            this.systemList = [];
            this.systemListMap = {};
            this.winInfoMap = {};
            this.selectDeviceType = ObjectType_1.ObjectType.Camera.value;
            this.deviceTypelist = [
                ObjectType_1.ObjectType.Camera,
                ObjectType_1.ObjectType.Wifi,
                ObjectType_1.ObjectType.RmpGate,
                ObjectType_1.ObjectType.ElectronicFence
            ];
            this.deviceTypeMap = ObjectType_1.ObjectType;
            this.treeParams = new tree_params_1.TreeDataParams();
            this.$scope.$on('close.map.point.popup', function (event, model, ID, flag) {
                delete _this.winInfoMap[model.ObjectID];
                _this.map.getInfoWindowByID(ID).close();
                _this.map.removeMarker(model);
                if (flag) {
                    _this.map.renderMarker(model);
                    _this.savePoint(model);
                }
                else {
                    if (_this.systemListMap[model.ObjectID]) {
                        _this.map.renderMarker(_this.systemListMap[model.ObjectID]);
                    }
                }
            });
            this.$scope.$on("$destroy", function () {
                _this.mapEventFactory.destroy();
                _this.map.destroy();
            });
            this.initMap();
            this.initTreeData();
        }
        MapResourcePointController.prototype.initMap = function () {
            var _this = this;
            console.log(1111);
            var _self = this;
            Promise.all([
                _self.mapService.getMapConfig(_self.mapConfigName),
                _self.mapService.getSystemPoints()
            ]).then(function (res) {
                _self.map = new map_main_1.NPGisMapMain();
                _self.map.init(_this.mapId, res[0]);
                if (res[1].code === 200) {
                    _self.systemList = res[1].data;
                    _self.systemList.forEach(function (item, index) {
                        _self.systemListMap[item.ObjectID] = item;
                        if (item.LayerType === LayerType_1.LayerType.LampPost.value) {
                            _self.systemList.splice(index, 1);
                        }
                    });
                }
                _self.mapEventFactory.init(_self.map);
                _self.map.renderMarkers(_self.systemList, {
                    click: _self.clickMarkersCallback.bind(_self)
                });
            });
        };
        MapResourcePointController.prototype.clickMarkersCallback = function (marker) {
            var point = marker.getPosition();
            var model = new SystemPoint_1.SystemPoint();
            model.ID = marker.ID;
            model.LayerType = marker.LayerType;
            model.ObjectID = marker.ObjectID;
            model.ObjectName = marker.ObjectName;
            model.ObjectState = marker.ObjectState;
            model.ObjectType = marker.ObjectType;
            model.TaskStatus = marker.TaskStatus;
            model.Lon = point.lon;
            model.Lat = point.lat;
            this.createPopup(point, model);
        };
        MapResourcePointController.prototype.initTreeData = function () {
            var _this = this;
            this.treeParams.treeId = 'MapDeviceSelectTree';
            this.treeParams.treeDatas = [];
            this.treeParams.isShowIcon = true;
            this.treeParams.isShowLine = false;
            this.treeParams.checkEnable = false;
            this.treeParams.isSingleSelect = false;
            this.treeParams.isSimpleData = true;
            this.treeParams.treeInitComplete = function (treeId) {
            };
            this.treeParams.addDiyDom = function (treeId, treeNode) {
                _this.treeDirectiveService.addDiyDomIsConfiStatus(treeId, treeNode, 'isConfigPoint');
            };
            this.treeParams.onDblClick = function (event, treeId, treeNode) {
                if (!treeNode.isConfigPoint) {
                    return false;
                }
                var point = _this.systemListMap[treeNode.ID];
                var p = new NPMapLib.Geometry.Point(point.Lon, point.Lat);
                _this.map.setCenter(p, _this.map.getZoom());
                _this.createPopup(p, point);
            };
            this.treeParams.beforeMouseDown = function (treeId, treeNode) {
                if (!treeNode ||
                    !(treeNode.treeType === TreeType_1.TreeType.camera.value ||
                        treeNode.treeType === TreeType_1.TreeType.wifi.value ||
                        treeNode.treeType === TreeType_1.TreeType.ElectronicFence.value ||
                        treeNode.treeType === TreeType_1.TreeType.rmpGate.value)) {
                    return false;
                }
                _this.map.startLocate(treeNode.Name).then(function (point) {
                    var newMaker = {};
                    newMaker.Lat = point.lat;
                    newMaker.Lon = point.lon;
                    newMaker.ObjectName = treeNode.Name;
                    newMaker.ObjectID = treeNode.ID;
                    switch (treeNode.treeType) {
                        case TreeType_1.TreeType.camera.value:
                            newMaker.LayerType = treeNode.CameraType || LayerType_1.LayerType.Camera.value;
                            newMaker.ObjectType = ObjectType_1.ObjectType.Camera.value;
                            break;
                        case TreeType_1.TreeType.ElectronicFence.value:
                            newMaker.LayerType = LayerType_1.LayerType.ElectronicFence.value;
                            newMaker.ObjectType = ObjectType_1.ObjectType.ElectronicFence.value;
                            break;
                        case TreeType_1.TreeType.wifi.value:
                            newMaker.LayerType = LayerType_1.LayerType.WiFi.value;
                            newMaker.ObjectType = ObjectType_1.ObjectType.Wifi.value;
                            break;
                        case TreeType_1.TreeType.rmpGate.value:
                            newMaker.LayerType = LayerType_1.LayerType.RmpGate.value;
                            newMaker.ObjectType = ObjectType_1.ObjectType.RmpGate.value;
                            break;
                    }
                    if (_this.systemListMap[treeNode.ID]) {
                        _this.map.removeMarker(_this.systemListMap[treeNode.ID]);
                    }
                    if (_this.winInfoMap[treeNode.ID]) {
                        _this.map.getInfoWindowByID(_this.winInfoMap[treeNode.ID]).close();
                    }
                    console.log(treeNode, newMaker);
                    _this.map.renderMarker(newMaker);
                    _this.createPopup(point, newMaker);
                });
                return false;
            };
            this.getDeviceTreeData();
        };
        MapResourcePointController.prototype.changeSelectDevice = function (item) {
            this.selectDeviceType = item.value;
            this.setTreeDataForType();
        };
        MapResourcePointController.prototype.createPopup = function (point, data) {
            var scope = this.$scope.$new();
            scope.model = data;
            var winInfo = this.mapEventFactory.createPopup(point, scope, PopupHtml);
            scope.ID = winInfo;
            this.winInfoMap[data.ObjectID] = winInfo;
        };
        MapResourcePointController.prototype.compileDomSize = function (ele) {
            var domEle = $(ele);
            $('body').append(domEle);
            var size = {
                width: domEle.outerWidth(),
                height: domEle.outerHeight()
            };
            domEle.remove();
            return size;
        };
        MapResourcePointController.prototype.getDeviceTreeData = function () {
            var _this = this;
            var _self = this;
            Promise.all([
                _self.connectTreeService.findAreaCamera(),
                _self.connectTreeService.findAreaWithWifi(),
                _self.connectTreeService.findAreaWithRmpgate(),
                _self.connectTreeService.findAreaWithElectronicfence()
            ]).then(function (res) {
                _self.cameraTreeData = res[0];
                _self.wifiTreeData = res[1];
                _self.rmpgateTreeData = res[2];
                _self.efenceTreeData = res[3];
            }).then(function () {
                _this.setTreeDataForType();
            });
        };
        MapResourcePointController.prototype.setTreeDataForType = function () {
            var _this = this;
            if (this.selectDeviceType === ObjectType_1.ObjectType.Camera.value) {
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.cameraTreeData;
                });
            }
            if (this.selectDeviceType === ObjectType_1.ObjectType.Wifi.value) {
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.wifiTreeData;
                });
            }
            if (this.selectDeviceType === ObjectType_1.ObjectType.RmpGate.value) {
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.rmpgateTreeData;
                });
            }
            if (this.selectDeviceType === ObjectType_1.ObjectType.ElectronicFence.value) {
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.efenceTreeData;
                });
            }
        };
        MapResourcePointController.prototype.savePoint = function (model) {
            var _this = this;
            this.mapService.saveOrUpdateSystemPoint(model).then(function (res) {
                if (res.code === 200) {
                    console.info(model.ObjectName, model.Lon, model.Lat, '保存成功！');
                    if (!model.ID) {
                        var treeNode = _this.treeDirectiveService.getNodeByParam(_this.treeParams.treeId, 'ID', model.ObjectID);
                        if (treeNode)
                            treeNode.isConfigPoint = true;
                        _this.treeDirectiveService.addDiyDomIsConfiStatus(_this.treeParams.treeId, treeNode, 'isConfigPoint');
                    }
                }
            });
        };
        MapResourcePointController.$inject = ['$scope', '$timeout', '$compile', 'mapService', 'connectTreeService', 'treeDirectiveService', 'mapEventFactory'];
        return MapResourcePointController;
    }());
    main_app_1.app.controller("mapResourcePointController", MapResourcePointController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9tYXAtcmVzb3VyY2UvbWFwcG9pbnQuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUE4QkEsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBR3JDO1FBMEJJLG9DQUFvQixNQUFXLEVBQVUsUUFBYSxFQUFVLFFBQWEsRUFDakUsVUFBdUIsRUFDdkIsa0JBQXVDLEVBQVUsb0JBQTJDLEVBQzVGLGVBQWlDO1lBSDdDLGlCQXdCQztZQXhCbUIsV0FBTSxHQUFOLE1BQU0sQ0FBSztZQUFVLGFBQVEsR0FBUixRQUFRLENBQUs7WUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFLO1lBQ2pFLGVBQVUsR0FBVixVQUFVLENBQWE7WUFDdkIsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFxQjtZQUFVLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBdUI7WUFDNUYsb0JBQWUsR0FBZixlQUFlLENBQWtCO1lBMUI3QyxVQUFLLEdBQVcscUJBQXFCLENBQUM7WUFDdEMsa0JBQWEsR0FBVyxxQ0FBaUIsQ0FBQyxTQUFTLENBQUM7WUFDcEQsZUFBVSxHQUF1QixFQUFFLENBQUM7WUFDcEMsa0JBQWEsR0FBbUMsRUFBRSxDQUFDO1lBQ25ELGVBQVUsR0FBOEIsRUFBRSxDQUFDO1lBSTNDLHFCQUFnQixHQUFXLHVCQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUNuRCxtQkFBYyxHQUFnQjtnQkFDMUIsdUJBQVUsQ0FBQyxNQUFNO2dCQUNqQix1QkFBVSxDQUFDLElBQUk7Z0JBQ2YsdUJBQVUsQ0FBQyxPQUFPO2dCQUNsQix1QkFBVSxDQUFDLGVBQWU7YUFDN0IsQ0FBQztZQUNGLGtCQUFhLEdBQTRCLHVCQUFVLENBQUM7WUFDcEQsZUFBVSxHQUF3QixJQUFJLDRCQUFjLEVBQUUsQ0FBQztZQVluRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxVQUFDLEtBQVUs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Q0FBQyxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQTt3QkFDMUcsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDOzRCQUFDLFFBQVEsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO3dCQUM1QyxLQUFJLENBQUMsb0JBQW9CLENBQUMsc0JBQXNCLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLGVBQWUsQ0FBQyxDQUFBO29CQUN2RyxDQUFDO2dCQUNMLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFwUE0sa0NBQU8sR0FBRyxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxvQkFBb0IsRUFBRSxzQkFBc0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1FBc1B2SSxpQ0FBQztLQXZQRCxBQXVQQyxJQUFBO0lBRUQsY0FBRyxDQUFDLFVBQVUsQ0FBQyw0QkFBNEIsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDIiwiZmlsZSI6Im1vZHVsZS9iYXNlY29uZmlnL21hcC1yZXNvdXJjZS9tYXBwb2ludC5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxhbWQtZGVwZW5kZW5jeSBwYXRoPVwidGV4dCEuL21hcC5wb3B1cC5odG1sXCIgbmFtZT1cIlBvcHVwSHRtbFwiIC8+XHJcblxyXG5cclxuXHJcbmltcG9ydCBcIi4vbWFwLnBvcHVwLmNvbnRyb2xsZXJcIlxyXG5pbXBvcnQgeyBhcHAgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgeyBOUEdpc01hcE1haW4gfSBmcm9tIFwiLi4vLi4vY29tbW9uL21hcC9tYXAubWFpblwiO1xyXG5pbXBvcnQgeyBNYXBDb25maWdNb2RlbCB9IGZyb20gXCIuLi8uLi9jb21tb24vbWFwL2NvcmUvbW9kZWwvbWFwLmNvbmZpZy5tb2RlbFwiO1xyXG5pbXBvcnQgeyBJTWFwU2VydmljZSB9IGZyb20gXCIuLi8uLi9jb21tb24vc2VydmljZXMvbWFwLnNlcnZpY2VcIjtcclxuaW1wb3J0IFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL21hcC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IE1hcENvbmZpZ0pzb25FbnVtIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9lbnVtL01hcENvbmZpZ0pzb25FbnVtXCI7XHJcbmltcG9ydCB7IFN5c3RlbVBvaW50IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L1N5c3RlbVBvaW50XCI7XHJcbmltcG9ydCB7IEJhY2tSZXNwb25zZUJvZHksIFJlc3BvbnNlUmVzdWx0IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQgeyBPYmplY3RUeXBlIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bS9PYmplY3RUeXBlXCI7XHJcbmltcG9ydCB7IENhbWVyYUV4IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L0NhbWVyYUV4XCI7XHJcbmltcG9ydCB7IEFyZWFFeCB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9BcmVhRXhcIjtcclxuaW1wb3J0IHsgUm1wR2F0ZUV4IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L1JtcEdhdGVFeFwiO1xyXG5pbXBvcnQgeyBFbnVtIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bS9FbnVtXCI7XHJcbmltcG9ydCB7IFRyZWVEYXRhUGFyYW1zIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdHJlZS90cmVlLXBhcmFtc1wiO1xyXG5pbXBvcnQgeyBFbGVjdHJvbmljRmVuY2VFeCB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9FbGVjdHJvbmljRmVuY2VFeFwiO1xyXG5pbXBvcnQgeyBXaWZpRXggfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9lbnRpdHkvZXgvV2lmaUV4XCI7XHJcbmltcG9ydCB7IFRyZWVUeXBlIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bS9UcmVlVHlwZVwiO1xyXG5pbXBvcnQgeyBJQ29ubmVjdFRyZWVTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9jb25uZWN0VHJlZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9jb25uZWN0VHJlZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IExheWVyVHlwZSB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudW0vTGF5ZXJUeXBlXCI7XHJcbmltcG9ydCB7IElUcmVlRGlyZWN0aXZlU2VydmljZSB9IGZyb20gJy4vLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUuZGlyZWN0aXZlLnNlcnZpY2UnO1xyXG5pbXBvcnQgJy4vLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUuZGlyZWN0aXZlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJTWFwRXZlbnRGYWN0b3J5IH0gZnJvbSAnLi8uLi8uLi9jb21tb24vZmFjdG9yeS9tYXAuZXZlbnQuZmFjdG9yeSc7XHJcbmltcG9ydCAnLi8uLi8uLi9jb21tb24vZmFjdG9yeS9tYXAuZXZlbnQuZmFjdG9yeSc7XHJcblxyXG5sZXQgUHJvbWlzZSA9IHJlcXVpcmUoJ2VzNi1wcm9taXNlJyk7XHJcbmRlY2xhcmUgbGV0IHJlcXVpcmU6IGFueSwgJDogYW55LCBQb3B1cEh0bWw6IGFueTtcclxuXHJcbmNsYXNzIE1hcFJlc291cmNlUG9pbnRDb250cm9sbGVyIHtcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCAnJHRpbWVvdXQnLCAnJGNvbXBpbGUnLCAnbWFwU2VydmljZScsICdjb25uZWN0VHJlZVNlcnZpY2UnLCAndHJlZURpcmVjdGl2ZVNlcnZpY2UnLCAnbWFwRXZlbnRGYWN0b3J5J107XHJcbiAgICBtYXA6IE5QR2lzTWFwTWFpbjtcclxuICAgIG1hcElkOiBzdHJpbmcgPSBcIk1hcFJlc291cmNlUG9pbnRNYXBcIjtcclxuICAgIG1hcENvbmZpZ05hbWU6IHN0cmluZyA9IE1hcENvbmZpZ0pzb25FbnVtLk1BUENPTkZJRztcclxuICAgIHN5c3RlbUxpc3Q6IEFycmF5PFN5c3RlbVBvaW50PiA9IFtdO1xyXG4gICAgc3lzdGVtTGlzdE1hcDogeyBba2V5OiBzdHJpbmddOiBTeXN0ZW1Qb2ludCB9ID0ge307XHJcbiAgICB3aW5JbmZvTWFwOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge307XHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjIOiuvuWkh+adg+mZkOebuOWFs1xyXG4gICAgICovXHJcbiAgICBzZWxlY3REZXZpY2VUeXBlOiBzdHJpbmcgPSBPYmplY3RUeXBlLkNhbWVyYS52YWx1ZTtcclxuICAgIGRldmljZVR5cGVsaXN0OiBBcnJheTxFbnVtPiA9IFtcclxuICAgICAgICBPYmplY3RUeXBlLkNhbWVyYSxcclxuICAgICAgICBPYmplY3RUeXBlLldpZmksXHJcbiAgICAgICAgT2JqZWN0VHlwZS5SbXBHYXRlLFxyXG4gICAgICAgIE9iamVjdFR5cGUuRWxlY3Ryb25pY0ZlbmNlXHJcbiAgICBdO1xyXG4gICAgZGV2aWNlVHlwZU1hcDogeyBba2V5OiBzdHJpbmddOiBFbnVtIH0gPSBPYmplY3RUeXBlO1xyXG4gICAgdHJlZVBhcmFtczogVHJlZURhdGFQYXJhbXM8YW55PiA9IG5ldyBUcmVlRGF0YVBhcmFtcygpO1xyXG4gICAgY2FtZXJhVHJlZURhdGE6IEFycmF5PEFyZWFFeCB8IENhbWVyYUV4PjtcclxuICAgIHdpZmlUcmVlRGF0YTogQXJyYXk8QXJlYUV4IHwgV2lmaUV4PjtcclxuICAgIHJtcGdhdGVUcmVlRGF0YTogQXJyYXk8QXJlYUV4IHwgUm1wR2F0ZUV4PjtcclxuICAgIGVmZW5jZVRyZWVEYXRhOiBBcnJheTxBcmVhRXggfCBFbGVjdHJvbmljRmVuY2VFeD47XHJcbiAgICBtb3VzZVdpbkluZm86IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlICRzY29wZTogYW55LCBwcml2YXRlICR0aW1lb3V0OiBhbnksIHByaXZhdGUgJGNvbXBpbGU6IGFueSxcclxuICAgICAgICBwcml2YXRlIG1hcFNlcnZpY2U6IElNYXBTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgY29ubmVjdFRyZWVTZXJ2aWNlOiBJQ29ubmVjdFRyZWVTZXJ2aWNlLCBwcml2YXRlIHRyZWVEaXJlY3RpdmVTZXJ2aWNlOiBJVHJlZURpcmVjdGl2ZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSBtYXBFdmVudEZhY3Rvcnk6IElNYXBFdmVudEZhY3RvcnlcclxuICAgICkge1xyXG4gICAgICAgIHRoaXMuJHNjb3BlLiRvbignY2xvc2UubWFwLnBvaW50LnBvcHVwJywgKGV2ZW50OiBhbnksIG1vZGVsOiBTeXN0ZW1Qb2ludCwgSUQ6IHN0cmluZywgZmxhZz86IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMud2luSW5mb01hcFttb2RlbC5PYmplY3RJRF07XHJcbiAgICAgICAgICAgIHRoaXMubWFwLmdldEluZm9XaW5kb3dCeUlEKElEKS5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLm1hcC5yZW1vdmVNYXJrZXIobW9kZWwpO1xyXG4gICAgICAgICAgICBpZiAoZmxhZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXAucmVuZGVyTWFya2VyKG1vZGVsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZVBvaW50KG1vZGVsKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN5c3RlbUxpc3RNYXBbbW9kZWwuT2JqZWN0SURdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAucmVuZGVyTWFya2VyKHRoaXMuc3lzdGVtTGlzdE1hcFttb2RlbC5PYmplY3RJRF0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy4kc2NvcGUuJG9uKFwiJGRlc3Ryb3lcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm1hcEV2ZW50RmFjdG9yeS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMubWFwLmRlc3Ryb3koKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmluaXRNYXAoKTtcclxuICAgICAgICB0aGlzLmluaXRUcmVlRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHRpdGxlIOWIneWni+WcsOWbvlxyXG4gICAgICovXHJcbiAgICBpbml0TWFwKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKDExMTEpXHJcbiAgICAgICAgbGV0IF9zZWxmID0gdGhpcyBhcyBNYXBSZXNvdXJjZVBvaW50Q29udHJvbGxlcjtcclxuICAgICAgICBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgIF9zZWxmLm1hcFNlcnZpY2UuZ2V0TWFwQ29uZmlnKF9zZWxmLm1hcENvbmZpZ05hbWUpLFxyXG4gICAgICAgICAgICBfc2VsZi5tYXBTZXJ2aWNlLmdldFN5c3RlbVBvaW50cygpXHJcbiAgICAgICAgXSkudGhlbigocmVzOiBbTWFwQ29uZmlnTW9kZWwsIFJlc3BvbnNlUmVzdWx0PEFycmF5PFN5c3RlbVBvaW50Pj5dKSA9PiB7XHJcbiAgICAgICAgICAgIF9zZWxmLm1hcCA9IG5ldyBOUEdpc01hcE1haW4oKTtcclxuICAgICAgICAgICAgX3NlbGYubWFwLmluaXQodGhpcy5tYXBJZCwgcmVzWzBdKTtcclxuICAgICAgICAgICAgaWYgKHJlc1sxXS5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIF9zZWxmLnN5c3RlbUxpc3QgPSByZXNbMV0uZGF0YTtcclxuICAgICAgICAgICAgICAgIF9zZWxmLnN5c3RlbUxpc3QuZm9yRWFjaCgoaXRlbTogU3lzdGVtUG9pbnQsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfc2VsZi5zeXN0ZW1MaXN0TWFwW2l0ZW0uT2JqZWN0SURdID0gaXRlbTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5MYXllclR5cGUgPT09IExheWVyVHlwZS5MYW1wUG9zdC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfc2VsZi5zeXN0ZW1MaXN0LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfc2VsZi5tYXBFdmVudEZhY3RvcnkuaW5pdChfc2VsZi5tYXApO1xyXG4gICAgICAgICAgICBfc2VsZi5tYXAucmVuZGVyTWFya2Vycyhfc2VsZi5zeXN0ZW1MaXN0LCB7XHJcbiAgICAgICAgICAgICAgICBjbGljazogX3NlbGYuY2xpY2tNYXJrZXJzQ2FsbGJhY2suYmluZChfc2VsZilcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjbGlja01hcmtlcnNDYWxsYmFjayhtYXJrZXI6IE5QTWFwTGliLlN5bWJvbHMuQ2x1c3Rlck1hcmtlciAmIFN5c3RlbVBvaW50KSB7XHJcbiAgICAgICAgbGV0IHBvaW50ID0gbWFya2VyLmdldFBvc2l0aW9uKCk7XHJcbiAgICAgICAgbGV0IG1vZGVsID0gbmV3IFN5c3RlbVBvaW50KCk7XHJcbiAgICAgICAgbW9kZWwuSUQgPSBtYXJrZXIuSUQ7XHJcbiAgICAgICAgbW9kZWwuTGF5ZXJUeXBlID0gbWFya2VyLkxheWVyVHlwZTtcclxuICAgICAgICBtb2RlbC5PYmplY3RJRCA9IG1hcmtlci5PYmplY3RJRDtcclxuICAgICAgICBtb2RlbC5PYmplY3ROYW1lID0gbWFya2VyLk9iamVjdE5hbWU7XHJcbiAgICAgICAgbW9kZWwuT2JqZWN0U3RhdGUgPSBtYXJrZXIuT2JqZWN0U3RhdGU7XHJcbiAgICAgICAgbW9kZWwuT2JqZWN0VHlwZSA9IG1hcmtlci5PYmplY3RUeXBlO1xyXG4gICAgICAgIG1vZGVsLlRhc2tTdGF0dXMgPSBtYXJrZXIuVGFza1N0YXR1cztcclxuICAgICAgICBtb2RlbC5Mb24gPSBwb2ludC5sb247XHJcbiAgICAgICAgbW9kZWwuTGF0ID0gcG9pbnQubGF0XHJcbiAgICAgICAgdGhpcy5jcmVhdGVQb3B1cChwb2ludCwgbW9kZWwpXHJcbiAgICB9XHJcblxyXG5cclxuICAgIGluaXRUcmVlRGF0YSgpIHtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMudHJlZUlkID0gJ01hcERldmljZVNlbGVjdFRyZWUnO1xyXG4gICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlRGF0YXMgPSBbXTtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMuaXNTaG93SWNvbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy50cmVlUGFyYW1zLmlzU2hvd0xpbmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMuY2hlY2tFbmFibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMuaXNTaW5nbGVTZWxlY3QgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMuaXNTaW1wbGVEYXRhID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMudHJlZUluaXRDb21wbGV0ZSA9ICh0cmVlSWQ6IHN0cmluZyk6IHZvaWQgPT4ge1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy50cmVlUGFyYW1zLmFkZERpeURvbSA9ICh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRyZWVEaXJlY3RpdmVTZXJ2aWNlLmFkZERpeURvbUlzQ29uZmlTdGF0dXModHJlZUlkLCB0cmVlTm9kZSwgJ2lzQ29uZmlnUG9pbnQnKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRyZWVQYXJhbXMub25EYmxDbGljayA9IChldmVudDogRXZlbnQsIHRyZWVJZDogc3RyaW5nLCB0cmVlTm9kZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdHJlZU5vZGUuaXNDb25maWdQb2ludCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHBvaW50ID0gdGhpcy5zeXN0ZW1MaXN0TWFwW3RyZWVOb2RlLklEXTtcclxuICAgICAgICAgICAgbGV0IHAgPSBuZXcgTlBNYXBMaWIuR2VvbWV0cnkuUG9pbnQocG9pbnQuTG9uLCBwb2ludC5MYXQpO1xyXG4gICAgICAgICAgICB0aGlzLm1hcC5zZXRDZW50ZXIocCwgdGhpcy5tYXAuZ2V0Wm9vbSgpKTtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVQb3B1cChwLCBwb2ludClcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50cmVlUGFyYW1zLmJlZm9yZU1vdXNlRG93biA9ICh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRyZWVOb2RlIHx8XHJcbiAgICAgICAgICAgICAgICAhKFxyXG4gICAgICAgICAgICAgICAgICAgIHRyZWVOb2RlLnRyZWVUeXBlID09PSBUcmVlVHlwZS5jYW1lcmEudmFsdWUgfHxcclxuICAgICAgICAgICAgICAgICAgICB0cmVlTm9kZS50cmVlVHlwZSA9PT0gVHJlZVR5cGUud2lmaS52YWx1ZSB8fFxyXG4gICAgICAgICAgICAgICAgICAgIHRyZWVOb2RlLnRyZWVUeXBlID09PSBUcmVlVHlwZS5FbGVjdHJvbmljRmVuY2UudmFsdWUgfHxcclxuICAgICAgICAgICAgICAgICAgICB0cmVlTm9kZS50cmVlVHlwZSA9PT0gVHJlZVR5cGUucm1wR2F0ZS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubWFwLnN0YXJ0TG9jYXRlKHRyZWVOb2RlLk5hbWUpLnRoZW4oKHBvaW50OiBOUE1hcExpYi5HZW9tZXRyeS5Qb2ludCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IG5ld01ha2VyID0ge30gYXMgU3lzdGVtUG9pbnQ7XHJcbiAgICAgICAgICAgICAgICBuZXdNYWtlci5MYXQgPSBwb2ludC5sYXQ7XHJcbiAgICAgICAgICAgICAgICBuZXdNYWtlci5Mb24gPSBwb2ludC5sb247XHJcbiAgICAgICAgICAgICAgICBuZXdNYWtlci5PYmplY3ROYW1lID0gdHJlZU5vZGUuTmFtZTtcclxuICAgICAgICAgICAgICAgIG5ld01ha2VyLk9iamVjdElEID0gdHJlZU5vZGUuSUQ7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRyZWVOb2RlLnRyZWVUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBUcmVlVHlwZS5jYW1lcmEudmFsdWU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01ha2VyLkxheWVyVHlwZSA9IHRyZWVOb2RlLkNhbWVyYVR5cGUgfHwgTGF5ZXJUeXBlLkNhbWVyYS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TWFrZXIuT2JqZWN0VHlwZSA9IE9iamVjdFR5cGUuQ2FtZXJhLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRyZWVUeXBlLkVsZWN0cm9uaWNGZW5jZS52YWx1ZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TWFrZXIuTGF5ZXJUeXBlID0gTGF5ZXJUeXBlLkVsZWN0cm9uaWNGZW5jZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3TWFrZXIuT2JqZWN0VHlwZSA9IE9iamVjdFR5cGUuRWxlY3Ryb25pY0ZlbmNlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRyZWVUeXBlLndpZmkudmFsdWU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01ha2VyLkxheWVyVHlwZSA9IExheWVyVHlwZS5XaUZpLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdNYWtlci5PYmplY3RUeXBlID0gT2JqZWN0VHlwZS5XaWZpLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFRyZWVUeXBlLnJtcEdhdGUudmFsdWU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld01ha2VyLkxheWVyVHlwZSA9IExheWVyVHlwZS5SbXBHYXRlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdNYWtlci5PYmplY3RUeXBlID0gT2JqZWN0VHlwZS5SbXBHYXRlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN5c3RlbUxpc3RNYXBbdHJlZU5vZGUuSURdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAucmVtb3ZlTWFya2VyKHRoaXMuc3lzdGVtTGlzdE1hcFt0cmVlTm9kZS5JRF0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy53aW5JbmZvTWFwW3RyZWVOb2RlLklEXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLmdldEluZm9XaW5kb3dCeUlEKHRoaXMud2luSW5mb01hcFt0cmVlTm9kZS5JRF0pLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0cmVlTm9kZSwgbmV3TWFrZXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tYXAucmVuZGVyTWFya2VyKG5ld01ha2VyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlUG9wdXAocG9pbnQsIG5ld01ha2VyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RGV2aWNlVHJlZURhdGEoKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGFuZ2VTZWxlY3REZXZpY2UoaXRlbTogRW51bSkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0RGV2aWNlVHlwZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgdGhpcy5zZXRUcmVlRGF0YUZvclR5cGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVBvcHVwKHBvaW50OiBOUE1hcExpYi5HZW9tZXRyeS5Qb2ludCwgZGF0YTogU3lzdGVtUG9pbnQpIHtcclxuICAgICAgICBsZXQgc2NvcGU6IHsgbW9kZWw6IFN5c3RlbVBvaW50LCBJRDogc3RyaW5nLCAkZGVzdHJveTogRnVuY3Rpb24gfSA9IHRoaXMuJHNjb3BlLiRuZXcoKTtcclxuICAgICAgICBzY29wZS5tb2RlbCA9IGRhdGE7XHJcbiAgICAgICAgbGV0IHdpbkluZm8gPSB0aGlzLm1hcEV2ZW50RmFjdG9yeS5jcmVhdGVQb3B1cChwb2ludCwgc2NvcGUsIFBvcHVwSHRtbClcclxuICAgICAgICBzY29wZS5JRCA9IHdpbkluZm87XHJcbiAgICAgICAgdGhpcy53aW5JbmZvTWFwW2RhdGEuT2JqZWN0SURdID0gd2luSW5mbztcclxuICAgIH1cclxuXHJcbiAgICBjb21waWxlRG9tU2l6ZShlbGU6IGFueSk6IHsgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIgfSB7XHJcbiAgICAgICAgbGV0IGRvbUVsZSA9ICQoZWxlKTtcclxuICAgICAgICAkKCdib2R5JykuYXBwZW5kKGRvbUVsZSk7XHJcbiAgICAgICAgbGV0IHNpemUgPSB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBkb21FbGUub3V0ZXJXaWR0aCgpLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IGRvbUVsZS5vdXRlckhlaWdodCgpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRvbUVsZS5yZW1vdmUoKTtcclxuICAgICAgICByZXR1cm4gc2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXREZXZpY2VUcmVlRGF0YSgpIHtcclxuICAgICAgICBsZXQgX3NlbGYgPSB0aGlzIGFzIE1hcFJlc291cmNlUG9pbnRDb250cm9sbGVyO1xyXG4gICAgICAgIFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgX3NlbGYuY29ubmVjdFRyZWVTZXJ2aWNlLmZpbmRBcmVhQ2FtZXJhKCksXHJcbiAgICAgICAgICAgIF9zZWxmLmNvbm5lY3RUcmVlU2VydmljZS5maW5kQXJlYVdpdGhXaWZpKCksXHJcbiAgICAgICAgICAgIF9zZWxmLmNvbm5lY3RUcmVlU2VydmljZS5maW5kQXJlYVdpdGhSbXBnYXRlKCksXHJcbiAgICAgICAgICAgIF9zZWxmLmNvbm5lY3RUcmVlU2VydmljZS5maW5kQXJlYVdpdGhFbGVjdHJvbmljZmVuY2UoKVxyXG4gICAgICAgIF0pLnRoZW4oKHJlczogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICAgICAgICBfc2VsZi5jYW1lcmFUcmVlRGF0YSA9IHJlc1swXTtcclxuICAgICAgICAgICAgX3NlbGYud2lmaVRyZWVEYXRhID0gcmVzWzFdO1xyXG4gICAgICAgICAgICBfc2VsZi5ybXBnYXRlVHJlZURhdGEgPSByZXNbMl07XHJcbiAgICAgICAgICAgIF9zZWxmLmVmZW5jZVRyZWVEYXRhID0gcmVzWzNdO1xyXG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldFRyZWVEYXRhRm9yVHlwZSgpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRUcmVlRGF0YUZvclR5cGUoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0RGV2aWNlVHlwZSA9PT0gT2JqZWN0VHlwZS5DYW1lcmEudmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWVQYXJhbXMudHJlZURhdGFzID0gdGhpcy5jYW1lcmFUcmVlRGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdERldmljZVR5cGUgPT09IE9iamVjdFR5cGUuV2lmaS52YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlRGF0YXMgPSB0aGlzLndpZmlUcmVlRGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdERldmljZVR5cGUgPT09IE9iamVjdFR5cGUuUm1wR2F0ZS52YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlRGF0YXMgPSB0aGlzLnJtcGdhdGVUcmVlRGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdERldmljZVR5cGUgPT09IE9iamVjdFR5cGUuRWxlY3Ryb25pY0ZlbmNlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlUGFyYW1zLnRyZWVEYXRhcyA9IHRoaXMuZWZlbmNlVHJlZURhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNhdmVQb2ludChtb2RlbDogU3lzdGVtUG9pbnQpIHtcclxuICAgICAgICB0aGlzLm1hcFNlcnZpY2Uuc2F2ZU9yVXBkYXRlU3lzdGVtUG9pbnQobW9kZWwpLnRoZW4oKHJlczogQmFja1Jlc3BvbnNlQm9keTxzdHJpbmcgfCBib29sZWFuPikgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKG1vZGVsLk9iamVjdE5hbWUsIG1vZGVsLkxvbiwgbW9kZWwuTGF0LCAn5L+d5a2Y5oiQ5Yqf77yBJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1vZGVsLklEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRyZWVOb2RlOiBhbnkgPSB0aGlzLnRyZWVEaXJlY3RpdmVTZXJ2aWNlLmdldE5vZGVCeVBhcmFtKHRoaXMudHJlZVBhcmFtcy50cmVlSWQsICdJRCcsIG1vZGVsLk9iamVjdElEKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlTm9kZSkgdHJlZU5vZGUuaXNDb25maWdQb2ludCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmVlRGlyZWN0aXZlU2VydmljZS5hZGREaXlEb21Jc0NvbmZpU3RhdHVzKHRoaXMudHJlZVBhcmFtcy50cmVlSWQsIHRyZWVOb2RlLCAnaXNDb25maWdQb2ludCcpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuYXBwLmNvbnRyb2xsZXIoXCJtYXBSZXNvdXJjZVBvaW50Q29udHJvbGxlclwiLCBNYXBSZXNvdXJjZVBvaW50Q29udHJvbGxlcik7Il19

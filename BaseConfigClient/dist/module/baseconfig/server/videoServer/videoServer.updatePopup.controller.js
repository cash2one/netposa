define(["require", "exports", "../../../common/app/main.app", "../../../common/directive/tree/tree-params", "../../../../core/entity/ex/VideoServerEx", "../../../../core/entity/Area", "../../../../core/enum/VideoServerType", "../../../common/services/videoServer.service", "../../../common/services/area.service", "angular"], function (require, exports, main_app_1, tree_params_1, VideoServerEx_1, Area_1, VideoServerType_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var VideoServerUpdatePopupController = (function () {
        function VideoServerUpdatePopupController($scope, serverService, $timeout, areaService) {
            this.$scope = $scope;
            this.serverService = serverService;
            this.$timeout = $timeout;
            this.areaService = areaService;
            this.isUpdate = false;
            this.videoServerTypeList = [];
            this.ProxyList = [];
            this.ProxyList = this.$scope.proxyListForVideo;
            for (var key in VideoServerType_1.VideoServerType) {
                this.videoServerTypeList.push(VideoServerType_1.VideoServerType[key]);
            }
            this.areaTreeDatas = new tree_params_1.TreeDataParams(true);
            this.areaTreeDatas.treeId = 'modalArea';
            this.areaTreeDatas.onClick = treeSelectNode;
            this.areaTreeDatas.treeInitComplete = treeInitComplete;
            if (this.$scope.updateModalParams.isUpdate) {
                this.currentServe = this.$scope.updateModalParams.updateModel;
                this.areaTreeDatas.defaultSelectTreeId = this.currentServe.AreaID;
                this.areaTreeDatas.isDefaultSelected = true;
            }
            else {
                this.currentServe = new VideoServerEx_1.VideoServerEx();
                this.currentServe.AreaModel = new Area_1.Area();
                if (this.$scope.updateModalParams.defaultDatas) {
                    this.areaTreeDatas.defaultSelectTreeId = this.$scope.updateModalParams.defaultDatas.areaId;
                    this.areaTreeDatas.isDefaultSelected = true;
                }
            }
            console.log("%c =====VideoServerUpdatePopupController $scope=====start==============", "color:blue");
            console.log("初始化 ctrl 传过来的参数");
            console.log(this.currentServe);
            console.log("%c =========end===============", "color:blue");
            var self_this = this;
            $scope.$on("$destroy", function () {
                console.log("%c =====VideoServerUpdatePopupController $scope.$destroy=====start==============", "color:green");
                console.log("销毁了弹出框");
                console.log("%c =========end===============", "color:green");
            });
            this.getAreaTree();
            function treeInitComplete(treeId) {
                console.log("%c ===treeInitComplete=======start==============", 'color:green');
                console.log(treeId);
                console.log("=========end===============");
            }
            function treeSelectNode(event, treeId, treeNode) {
                console.log("treeSelectNode  treeId", treeId);
                console.log("treeSelectNode 回调函数", treeNode);
                self_this.$timeout(function () {
                    self_this.setVideoServerArea(treeNode);
                });
            }
        }
        VideoServerUpdatePopupController.prototype.commitSaveOrUpdate = function () {
            var _this = this;
            console.log(this.currentServe);
            var checkStr = this.validateParams(this.currentServe);
            if (checkStr) {
                console.log("=======checkStr===result==============");
                console.log(checkStr + "未填写");
                console.log("=========end===============");
                return;
            }
            else {
                console.log("=======checkStr===result==============");
                console.log("参数全已经填写");
                console.log("=========end===============");
            }
            this.currentServe.AreaID = this.currentServe.AreaModel.ID;
            if (this.currentServe.ID) {
                console.log("=========更新===============");
                this.serverService.update(this.currentServe).then(function (resp) {
                    if (resp.Code == 200) {
                        _this.closeUpdateModel(true);
                    }
                });
            }
            else {
                console.log("===========新加=============");
                this.serverService.save(this.currentServe).then(function (resp) {
                    if (resp.Code == 200) {
                        _this.closeUpdateModel(true);
                    }
                });
            }
        };
        ;
        VideoServerUpdatePopupController.prototype.closeUpdateModel = function (isCommit) {
            this.$scope.$emit('closeServerUpdateModel', { isCommit: isCommit });
        };
        VideoServerUpdatePopupController.prototype.getAreaTree = function (keyword) {
            var reqParams = {
                keyword: ''
            };
            if (keyword) {
                reqParams.keyword = keyword;
            }
            var self_this = this;
            this.areaService.findListTree(reqParams).then(function (resp) {
                self_this.setModalAreaTree(resp);
            });
        };
        VideoServerUpdatePopupController.prototype.changeIsShowAreaTree = function () {
            this.areaTreeDatas.isShow = !this.areaTreeDatas.isShow;
            console.log(this.currentServe);
        };
        ;
        VideoServerUpdatePopupController.prototype.setVideoServerArea = function (area) {
            this.currentServe.AreaModel = new Area_1.Area();
            this.currentServe.AreaModel.ID = area.ID;
            this.currentServe.AreaModel.Name = area.Name;
            this.currentServe.AreaID = area.ID;
            console.log(this.currentServe);
        };
        ;
        VideoServerUpdatePopupController.prototype.setModalAreaTree = function (data) {
            this.areaTreeDatas.treeDatas = data;
        };
        VideoServerUpdatePopupController.prototype.validateParams = function (model) {
            if (!model.AreaModel) {
                return 'AreaModel';
            }
            if (!model.Code) {
                return 'Code';
            }
            if (!model.IpAddress) {
                return 'IpAddress';
            }
            if (!model.Name) {
                return 'Name';
            }
            if (!model.Port) {
                return 'Port';
            }
            if (!model.Pwd) {
                return 'Pwd';
            }
            if (!model.Uid) {
                return 'Uid';
            }
            if (!model.VideoServerType) {
                return 'VideoServerType';
            }
            return '';
        };
        VideoServerUpdatePopupController.$inject = ['$scope', 'videoServerService', '$timeout', 'areaService'];
        return VideoServerUpdatePopupController;
    }());
    main_app_1.app
        .controller('videoServerUpdatePopupController', VideoServerUpdatePopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9zZXJ2ZXIvdmlkZW9TZXJ2ZXIvdmlkZW9TZXJ2ZXIudXBkYXRlUG9wdXAuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFpQkE7UUFZSSwwQ0FBb0IsTUFBVSxFQUFTLGFBQWlCLEVBQVMsUUFBWSxFQUFTLFdBQXdCO1lBQTFGLFdBQU0sR0FBTixNQUFNLENBQUk7WUFBUyxrQkFBYSxHQUFiLGFBQWEsQ0FBSTtZQUFTLGFBQVEsR0FBUixRQUFRLENBQUk7WUFBUyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtZQVY5RyxhQUFRLEdBQVcsS0FBSyxDQUFDO1lBUXpCLHdCQUFtQixHQUFlLEVBQUUsQ0FBQztZQUNyQyxjQUFTLEdBQXFCLEVBQUUsQ0FBQztZQUU3QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUM7WUFFL0MsR0FBRyxDQUFBLENBQUMsSUFBSSxHQUFHLElBQUksaUNBQWUsQ0FBQyxDQUFBLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsaUNBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hELENBQUM7WUFHRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksNEJBQWMsQ0FBUyxJQUFJLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUM7WUFDeEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsY0FBYyxDQUFDO1lBQzVDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7WUFJdkQsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO2dCQUN2QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsV0FB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TyxHQUFHLENBQUMsUUFBUSxFQUFDLG9CQUFvQixFQUFDLFVBQVUsRUFBQyxhQUFhLENBQUMsQ0FBQztRQWtMOUUsdUNBQUM7S0FuTEQsQUFtTEMsSUFBQTtJQUNELGNBQUc7U0FDRSxVQUFVLENBQUMsa0NBQWtDLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQyIsImZpbGUiOiJtb2R1bGUvYmFzZWNvbmZpZy9zZXJ2ZXIvdmlkZW9TZXJ2ZXIvdmlkZW9TZXJ2ZXIudXBkYXRlUG9wdXAuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW1wb3J0IHthcHB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBwL21haW4uYXBwXCI7XHJcbmltcG9ydCAnLi4vLi4vLi4vY29tbW9uL3NlcnZpY2VzL3ZpZGVvU2VydmVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgJy4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9hcmVhLnNlcnZpY2UnO1xyXG5pbXBvcnQgJ2FuZ3VsYXInO1xyXG5cclxuaW1wb3J0IHtJQXJlYVNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vc2VydmljZXMvYXJlYS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7SVRyZWVEYXRhUGFyYW1zLCBUcmVlRGF0YVBhcmFtc30gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdHJlZS90cmVlLXBhcmFtc1wiO1xyXG5pbXBvcnQge1ZpZGVvU2VydmVyRXh9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudGl0eS9leC9WaWRlb1NlcnZlckV4XCI7XHJcbmltcG9ydCB7QXJlYX0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvZW50aXR5L0FyZWFcIjtcclxuaW1wb3J0IHtBcmVhRXh9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudGl0eS9leC9BcmVhRXhcIjtcclxuaW1wb3J0IHtFbnVtfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnVtL0VudW1cIjtcclxuaW1wb3J0IHtWaWRlb1NlcnZlclR5cGV9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudW0vVmlkZW9TZXJ2ZXJUeXBlXCI7XHJcbmltcG9ydCB7UHJveHlTZXJ2ZXJ9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudGl0eS9Qcm94eVNlcnZlclwiO1xyXG5kZWNsYXJlIGxldCBhbmd1bGFyOiBhbnk7XHJcblxyXG5jbGFzcyBWaWRlb1NlcnZlclVwZGF0ZVBvcHVwQ29udHJvbGxlcntcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCd2aWRlb1NlcnZlclNlcnZpY2UnLCckdGltZW91dCcsJ2FyZWFTZXJ2aWNlJ107XHJcbiAgICBpc1VwZGF0ZTpib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY3VycmVudFNlcnZlOlZpZGVvU2VydmVyRXg7XHJcblxyXG4gICAgLy8tLS0tLS0tc3RhcnQtLS0t5qCRIOe7k+aehCDmjqfku7Yg5Y+C5pWwXHJcbiAgICBhcmVhVHJlZURhdGFzOklUcmVlRGF0YVBhcmFtczxBcmVhRXg+O1xyXG4gICAgLy8tLS0tLS0tZW5kXHJcblxyXG4gICAgdmlkZW9TZXJ2ZXJUeXBlTGlzdDpBcnJheTxFbnVtPiA9IFtdO1xyXG4gICAgUHJveHlMaXN0OkFycmF5PFByb3h5U2VydmVyPj0gW107XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlICRzY29wZTphbnkscHJpdmF0ZSBzZXJ2ZXJTZXJ2aWNlOmFueSxwcml2YXRlICR0aW1lb3V0OmFueSxwcml2YXRlIGFyZWFTZXJ2aWNlOklBcmVhU2VydmljZSl7XHJcbiAgICAgICAgdGhpcy5Qcm94eUxpc3QgPSB0aGlzLiRzY29wZS5wcm94eUxpc3RGb3JWaWRlbztcclxuICAgICAgICAvLyDliJ3lp4vljJYg57G75Z6L6YCJ5oupXHJcbiAgICAgICAgZm9yKGxldCBrZXkgaW4gVmlkZW9TZXJ2ZXJUeXBlKXtcclxuICAgICAgICAgICAgdGhpcy52aWRlb1NlcnZlclR5cGVMaXN0LnB1c2goVmlkZW9TZXJ2ZXJUeXBlW2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL+agkee7k+aehOWPguaVsOWIneWni+WMllxyXG4gICAgICAgIC8v5Yid5aeL5YyWIGFyZWEg5qCR5pWw5o2uXHJcbiAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzID0gbmV3IFRyZWVEYXRhUGFyYW1zPEFyZWFFeD4odHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLnRyZWVJZCA9ICdtb2RhbEFyZWEnO1xyXG4gICAgICAgIHRoaXMuYXJlYVRyZWVEYXRhcy5vbkNsaWNrID0gdHJlZVNlbGVjdE5vZGU7XHJcbiAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLnRyZWVJbml0Q29tcGxldGUgPSB0cmVlSW5pdENvbXBsZXRlO1xyXG5cclxuICAgICAgICAvLyDliJ3lp4vljJYgY3RybCDkvKDov4fmnaXnmoTlj4LmlbBcclxuXHJcbiAgICAgICAgaWYodGhpcy4kc2NvcGUudXBkYXRlTW9kYWxQYXJhbXMuaXNVcGRhdGUpe1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZSA9IHRoaXMuJHNjb3BlLnVwZGF0ZU1vZGFsUGFyYW1zLnVwZGF0ZU1vZGVsO1xyXG4gICAgICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHRoaXMuY3VycmVudFNlcnZlLkFyZWFJRDtcclxuICAgICAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLmlzRGVmYXVsdFNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2VydmUgPSBuZXcgVmlkZW9TZXJ2ZXJFeCgpO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhTW9kZWwgPSBuZXcgQXJlYSgpO1xyXG4gICAgICAgICAgICBpZih0aGlzLiRzY29wZS51cGRhdGVNb2RhbFBhcmFtcy5kZWZhdWx0RGF0YXMpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLmRlZmF1bHRTZWxlY3RUcmVlSWQgPSB0aGlzLiRzY29wZS51cGRhdGVNb2RhbFBhcmFtcy5kZWZhdWx0RGF0YXMuYXJlYUlkO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLmlzRGVmYXVsdFNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyA9PT09PVZpZGVvU2VydmVyVXBkYXRlUG9wdXBDb250cm9sbGVyICRzY29wZT09PT09c3RhcnQ9PT09PT09PT09PT09PVwiLFwiY29sb3I6Ymx1ZVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIuWIneWni+WMliBjdHJsIOS8oOi/h+adpeeahOWPguaVsFwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRTZXJ2ZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCIlYyA9PT09PT09PT1lbmQ9PT09PT09PT09PT09PT1cIixcImNvbG9yOmJsdWVcIik7XHJcbiAgICAgICAgLy8tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIGxldCBzZWxmX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgICRzY29wZS4kb24oXCIkZGVzdHJveVwiLCBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjID09PT09VmlkZW9TZXJ2ZXJVcGRhdGVQb3B1cENvbnRyb2xsZXIgJHNjb3BlLiRkZXN0cm95PT09PT1zdGFydD09PT09PT09PT09PT09XCIsXCJjb2xvcjpncmVlblwiKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCLplIDmr4HkuoblvLnlh7rmoYZcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiJWMgPT09PT09PT09ZW5kPT09PT09PT09PT09PT09XCIsXCJjb2xvcjpncmVlblwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5nZXRBcmVhVHJlZSgpO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tZW5kIC0tLS0tLVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdHJlZUluaXRDb21wbGV0ZSh0cmVlSWQ6c3RyaW5nKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCIlYyA9PT10cmVlSW5pdENvbXBsZXRlPT09PT09PXN0YXJ0PT09PT09PT09PT09PT1cIiwnY29sb3I6Z3JlZW4nKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codHJlZUlkKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT1lbmQ9PT09PT09PT09PT09PT1cIiwpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uICB0cmVlU2VsZWN0Tm9kZShldmVudDogTW91c2VFdmVudCwgdHJlZUlkOiBzdHJpbmcsIHRyZWVOb2RlOiBBcmVhKSAge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyZWVTZWxlY3ROb2RlICB0cmVlSWRcIiwgdHJlZUlkKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0cmVlU2VsZWN0Tm9kZSDlm57osIPlh73mlbBcIiwgdHJlZU5vZGUpO1xyXG4gICAgICAgICAgICBzZWxmX3RoaXMuJHRpbWVvdXQoKCk9PntcclxuICAgICAgICAgICAgICAgIHNlbGZfdGhpcy5zZXRWaWRlb1NlcnZlckFyZWEodHJlZU5vZGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbW1pdFNhdmVPclVwZGF0ZSgpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFNlcnZlKTtcclxuICAgICAgICBsZXQgY2hlY2tTdHIgPSB0aGlzLnZhbGlkYXRlUGFyYW1zKHRoaXMuY3VycmVudFNlcnZlKTtcclxuICAgICAgICBpZihjaGVja1N0cil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PWNoZWNrU3RyPT09cmVzdWx0PT09PT09PT09PT09PT1cIiwpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhjaGVja1N0ciArIFwi5pyq5aGr5YaZXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PWVuZD09PT09PT09PT09PT09PVwiLCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09Y2hlY2tTdHI9PT1yZXN1bHQ9PT09PT09PT09PT09PVwiLCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5Y+C5pWw5YWo5bey57uP5aGr5YaZXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PWVuZD09PT09PT09PT09PT09PVwiLCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhSUQgPSB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhTW9kZWwuSUQ7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudFNlcnZlLklEKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT3mm7TmlrA9PT09PT09PT09PT09PT1cIik7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmVyU2VydmljZS51cGRhdGUodGhpcy5jdXJyZW50U2VydmUpLnRoZW4oKHJlc3A6YW55KT0+e1xyXG4gICAgICAgICAgICAgICAgaWYocmVzcC5Db2RlID09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZVVwZGF0ZU1vZGVsKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT09PeaWsOWKoD09PT09PT09PT09PT1cIik7XHJcbiAgICAgICAgICAgIHRoaXMuc2VydmVyU2VydmljZS5zYXZlKHRoaXMuY3VycmVudFNlcnZlKS50aGVuKChyZXNwOmFueSk9PntcclxuICAgICAgICAgICAgICAgIGlmKHJlc3AuQ29kZSA9PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VVcGRhdGVNb2RlbCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG4gICAgY2xvc2VVcGRhdGVNb2RlbChpc0NvbW1pdDpib29sZWFuKXtcclxuICAgICAgICB0aGlzLiRzY29wZS4kZW1pdCgnY2xvc2VTZXJ2ZXJVcGRhdGVNb2RlbCcse2lzQ29tbWl0OmlzQ29tbWl0fSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYXJlYSB0cmVlXHJcbiAgICBnZXRBcmVhVHJlZShrZXl3b3JkPzpzdHJpbmcpe1xyXG4gICAgICAgIGxldCByZXFQYXJhbXMgPXtcclxuICAgICAgICAgICAga2V5d29yZDonJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYoa2V5d29yZCl7XHJcbiAgICAgICAgICAgIHJlcVBhcmFtcy5rZXl3b3JkID0ga2V5d29yZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHNlbGZfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hcmVhU2VydmljZS5maW5kTGlzdFRyZWUocmVxUGFyYW1zKS50aGVuKChyZXNwOkFycmF5PEFyZWFFeD4pPT57XHJcbiAgICAgICAgICAgIHNlbGZfdGhpcy5zZXRNb2RhbEFyZWFUcmVlKHJlc3ApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOaUueWPmOaYvuekuiBhcmVhVHJlZVxyXG4gICAgY2hhbmdlSXNTaG93QXJlYVRyZWUoKXtcclxuICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMuaXNTaG93ID0gIXRoaXMuYXJlYVRyZWVEYXRhcy5pc1Nob3c7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5jdXJyZW50U2VydmUpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBhcmVhIOmAieaLqeaUueWPmFxyXG4gICAgc2V0VmlkZW9TZXJ2ZXJBcmVhKGFyZWE6QXJlYSl7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50U2VydmUuQXJlYU1vZGVsID0gbmV3IEFyZWEoKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhTW9kZWwuSUQgPSBhcmVhLklEO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFNlcnZlLkFyZWFNb2RlbC5OYW1lID0gYXJlYS5OYW1lO1xyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhSUQgPSBhcmVhLklEO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFNlcnZlKTtcclxuICAgIH07XHJcblxyXG4gICAgLy9hcmVhIOaVsOaNrui1i+WAvFxyXG4gICAgc2V0TW9kYWxBcmVhVHJlZShkYXRhOmFueSl7XHJcbiAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLnRyZWVEYXRhcyAgPSBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8v6aqM6K+B5a2X5q616ZmQ5Yi277yM6L+U5Zue5o+Q56S66K+tXHJcbiAgICB2YWxpZGF0ZVBhcmFtcyhtb2RlbDpWaWRlb1NlcnZlckV4KTpzdHJpbmd7XHJcblxyXG4gICAgICAgIGlmKCFtb2RlbC5BcmVhTW9kZWwpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ0FyZWFNb2RlbCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5Db2RlKXtcclxuICAgICAgICAgICAgcmV0dXJuICdDb2RlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIW1vZGVsLklwQWRkcmVzcyl7XHJcbiAgICAgICAgICAgIHJldHVybiAnSXBBZGRyZXNzJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIW1vZGVsLk5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ05hbWUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighbW9kZWwuUG9ydCl7XHJcbiAgICAgICAgICAgIHJldHVybiAnUG9ydCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5Qd2Qpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ1B3ZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5VaWQpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ1VpZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5WaWRlb1NlcnZlclR5cGUpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ1ZpZGVvU2VydmVyVHlwZSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG5hcHBcclxuICAgIC5jb250cm9sbGVyKCd2aWRlb1NlcnZlclVwZGF0ZVBvcHVwQ29udHJvbGxlcicsIFZpZGVvU2VydmVyVXBkYXRlUG9wdXBDb250cm9sbGVyKTsiXX0=

define(["require", "exports", "../../../common/app/main.app", "../../../common/directive/tree/tree-params", "../../../../core/entity/ex/IvsServerEx", "../../../../core/entity/Area", "../../../../core/enum/IvsServerType", "../../../common/services/area.service", "../../../common/services/ivsServer.service", "../../../common/services/proxyServer.service", "angular"], function (require, exports, main_app_1, tree_params_1, IvsServerEx_1, Area_1, IvsServerType_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var IvsServerUpdateModalController = (function () {
        function IvsServerUpdateModalController($scope, proxyServerService, ivsServerService, $timeout, areaService) {
            this.$scope = $scope;
            this.proxyServerService = proxyServerService;
            this.ivsServerService = ivsServerService;
            this.$timeout = $timeout;
            this.areaService = areaService;
            this.isUpdate = false;
            this.ivsServerTypeList = [];
            this.proxyServerList = [];
            for (var key in IvsServerType_1.IvsServerType) {
                this.ivsServerTypeList.push(IvsServerType_1.IvsServerType[key]);
            }
            this.areaTreeDatas = new tree_params_1.TreeDataParams(true);
            this.areaTreeDatas.treeId = 'modalArea';
            this.areaTreeDatas.onClick = treeSelectNode;
            this.areaTreeDatas.treeInitComplete = treeInitComplete;
            if (this.$scope.updateModalParams.isUpdate) {
                this.currentServe = this.$scope.updateModalParams.updateModel;
                this.areaTreeDatas.defaultSelectTreeId = this.currentServe.AreaID;
                this.areaTreeDatas.isDefaultSelected = true;
            }
            else {
                this.currentServe = new IvsServerEx_1.IvsServerEx();
                this.currentServe.AreaModel = new Area_1.Area();
                if (this.$scope.updateModalParams.defaultDatas) {
                    this.areaTreeDatas.defaultSelectTreeId = this.$scope.updateModalParams.defaultDatas.areaId;
                    this.areaTreeDatas.isDefaultSelected = true;
                }
            }
            console.log("%c =====VideoServerUpdatePopupController $scope=====start==============", "color:blue");
            console.log("初始化 ctrl 传过来的参数");
            console.log(this.currentServe);
            console.log(this.areaTreeDatas);
            console.log("%c =========end===============", "color:blue");
            var self_this = this;
            $scope.$on("$destroy", function () {
                console.log("%c =====VideoServerUpdatePopupController $scope.$destroy=====start==============", "color:green");
                console.log("销毁了弹出框");
                console.log("%c =========end===============", "color:green");
            });
            this.getProxyServerList();
            this.getAreaTree();
            function treeInitComplete(treeId) {
                console.log("%c ===ivs tree =======start==============", 'color:green');
                console.log(treeId);
                console.log("=========end===============");
            }
            function treeSelectNode(event, treeId, treeNode) {
                console.log("treeSelectNode  treeId", treeId);
                console.log("treeSelectNode 回调函数", treeNode);
                self_this.$timeout(function () {
                    self_this.setIvsServerArea(treeNode);
                });
            }
        }
        IvsServerUpdateModalController.prototype.setIvsServerArea = function (area) {
            this.currentServe.AreaModel = new Area_1.Area();
            this.currentServe.AreaModel.ID = area.ID;
            this.currentServe.AreaModel.Name = area.Name;
            this.currentServe.AreaID = area.ID;
            console.log(this.currentServe);
        };
        ;
        IvsServerUpdateModalController.prototype.commitSaveOrUpdate = function () {
            var _this = this;
            console.log(this.currentServe);
            var checkStr = this.validateParams(this.currentServe);
            if (checkStr) {
                console.log("=======checkStr===result==============");
                console.log(checkStr + "未填写");
                console.log("=========end===============");
                return;
            }
            else {
                console.log("=======checkStr===result==============");
                console.log("参数全已经填写");
                console.log("=========end===============");
            }
            if (this.currentServe.ID) {
                console.log("=========更新===============");
                this.ivsServerService.update(this.currentServe).then(function (resp) {
                    if (resp.code == 200) {
                        _this.closeUpdateModel(true);
                    }
                });
            }
            else {
                console.log("===========新加=============");
                this.ivsServerService.save(this.currentServe).then(function (resp) {
                    if (resp.code == 200) {
                        _this.closeUpdateModel(true);
                    }
                });
            }
        };
        ;
        IvsServerUpdateModalController.prototype.closeUpdateModel = function (isCommit) {
            this.$scope.$emit('closeServerUpdateModel', { isCommit: isCommit });
        };
        IvsServerUpdateModalController.prototype.getAreaTree = function (keyword) {
            var reqParams = {
                keyword: ''
            };
            if (keyword) {
                reqParams.keyword = keyword;
            }
            var self_this = this;
            this.areaService.findListTree(reqParams).then(function (resp) {
                self_this.setModalAreaTree(resp);
            });
        };
        IvsServerUpdateModalController.prototype.changeIsShowAreaTree = function () {
            this.areaTreeDatas.isShow = !this.areaTreeDatas.isShow;
            console.log(this.currentServe);
        };
        ;
        IvsServerUpdateModalController.prototype.setModalAreaTree = function (data) {
            this.areaTreeDatas.treeDatas = data;
        };
        IvsServerUpdateModalController.prototype.getProxyServerList = function () {
            var _this = this;
            this.proxyServerService.findAll().then(function (resp) {
                if (resp.code == 200) {
                    _this.proxyServerList = resp.data;
                }
            });
        };
        IvsServerUpdateModalController.prototype.validateParams = function (model) {
            if (!model.AreaModel) {
                return 'AreaModel';
            }
            if (!model.Code) {
                return 'Code';
            }
            if (!model.IpAddress) {
                return 'IpAddress';
            }
            if (!model.Name) {
                return 'Name';
            }
            if (!model.Port) {
                return 'Port';
            }
            if (!model.Pwd) {
                return 'Pwd';
            }
            if (!model.Uid) {
                return 'Uid';
            }
            if (!model.ServerType) {
                return 'ServerType';
            }
            return '';
        };
        IvsServerUpdateModalController.$inject = ['$scope', 'proxyServerService', 'ivsServerService', '$timeout', 'areaService'];
        return IvsServerUpdateModalController;
    }());
    main_app_1.app
        .controller('ivsServerUpdateModalController', IvsServerUpdateModalController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9zZXJ2ZXIvaXZzU2VydmVyL2l2c1NlcnZlci51cGRhdGVNb2RhbC5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztJQXlCQTtRQVlJLHdDQUFvQixNQUFVLEVBQVMsa0JBQXNDLEVBQVUsZ0JBQWtDLEVBQVMsUUFBWSxFQUFTLFdBQXdCO1lBQTNKLFdBQU0sR0FBTixNQUFNLENBQUk7WUFBUyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1lBQVUscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtZQUFTLGFBQVEsR0FBUixRQUFRLENBQUk7WUFBUyxnQkFBVyxHQUFYLFdBQVcsQ0FBYTtZQVgvSyxhQUFRLEdBQVcsS0FBSyxDQUFDO1lBTXpCLHNCQUFpQixHQUFlLEVBQUUsQ0FBQztZQUNuQyxvQkFBZSxHQUFzQixFQUFFLENBQUM7WUFPcEMsR0FBRyxDQUFBLENBQUMsSUFBSSxHQUFHLElBQUksNkJBQWEsQ0FBQyxDQUFBLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsNkJBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3BELENBQUM7WUFHRCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksNEJBQWMsQ0FBUyxJQUFJLENBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUM7WUFDeEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQUcsY0FBYyxDQUFDO1lBQzVDLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7WUFHdkQsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQSxDQUFDO2dCQUN2QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDO2dCQUM5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O1lBQ2pCLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQSxDQUFDO2dCQUNYLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDakIsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFBLENBQUM7Z0JBQ2xCLE1BQU0sQ0FBQyxZQUFZLENBQUM7WUFDeEIsQ0FBQztZQUVELE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDZCxDQUFDO1FBMUtNLHNDQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUMsb0JBQW9CLEVBQUMsa0JBQWtCLEVBQUMsVUFBVSxFQUFDLGFBQWEsQ0FBQyxDQUFDO1FBMktqRyxxQ0FBQztLQXJMRCxBQXFMQyxJQUFBO0lBQ0QsY0FBRztTQUNFLFVBQVUsQ0FBQyxnQ0FBZ0MsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDIiwiZmlsZSI6Im1vZHVsZS9iYXNlY29uZmlnL3NlcnZlci9pdnNTZXJ2ZXIvaXZzU2VydmVyLnVwZGF0ZU1vZGFsLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcbmltcG9ydCB7YXBwfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgJy4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9hcmVhLnNlcnZpY2UnO1xyXG5pbXBvcnQgJy4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9pdnNTZXJ2ZXIuc2VydmljZSc7XHJcbmltcG9ydCAnLi4vLi4vLi4vY29tbW9uL3NlcnZpY2VzL3Byb3h5U2VydmVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgJ2FuZ3VsYXInO1xyXG5cclxuaW1wb3J0IHtJQXJlYVNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vc2VydmljZXMvYXJlYS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7SUl2c1NlcnZlclNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vc2VydmljZXMvaXZzU2VydmVyLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtJUHJveHlTZXJ2ZXJTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL3NlcnZpY2VzL3Byb3h5U2VydmVyLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtJVHJlZURhdGFQYXJhbXMsIFRyZWVEYXRhUGFyYW1zfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUtcGFyYW1zXCI7XHJcbmltcG9ydCB7SXZzU2VydmVyRXh9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudGl0eS9leC9JdnNTZXJ2ZXJFeFwiO1xyXG5pbXBvcnQge0FyZWFFeH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L0FyZWFFeFwiO1xyXG5pbXBvcnQge0VudW19IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL2VudW0vRW51bVwiO1xyXG5pbXBvcnQge1Byb3h5U2VydmVyfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnRpdHkvUHJveHlTZXJ2ZXJcIjtcclxuaW1wb3J0IHtBcmVhfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnRpdHkvQXJlYVwiO1xyXG5pbXBvcnQge1Jlc3BvbnNlUmVzdWx0fSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9wYXJhbXMvcmVzdWx0L1Jlc3BvbnNlUmVzdWx0XCI7XHJcbmltcG9ydCB7SXZzU2VydmVyVHlwZX0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvZW51bS9JdnNTZXJ2ZXJUeXBlXCI7XHJcbmltcG9ydCB7SXZzU2VydmVyfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnRpdHkvSXZzU2VydmVyXCI7XHJcbmltcG9ydCB7VXBkYXRlTW9kYWxQYXJhbXN9IGZyb20gXCIuLi9tYWluL3NlcnZlclVwZGF0ZU1vZGFsLnBhcmFtc1wiO1xyXG5cclxuZGVjbGFyZSBsZXQgYW5ndWxhcjogYW55O1xyXG5cclxuXHJcbmNsYXNzIEl2c1NlcnZlclVwZGF0ZU1vZGFsQ29udHJvbGxlcntcclxuICAgIGlzVXBkYXRlOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGN1cnJlbnRTZXJ2ZTpJdnNTZXJ2ZXJFeDtcclxuXHJcbiAgICAvLy0tLS0tLS1zdGFydC0tLS3moJEg57uT5p6EIOaOp+S7tiDlj4LmlbBcclxuICAgIGFyZWFUcmVlRGF0YXM6SVRyZWVEYXRhUGFyYW1zPEFyZWFFeD47XHJcblxyXG4gICAgaXZzU2VydmVyVHlwZUxpc3Q6QXJyYXk8RW51bT4gPSBbXTtcclxuICAgIHByb3h5U2VydmVyTGlzdDpBcnJheTxQcm94eVNlcnZlcj4gPSBbXTtcclxuICAgIC8vLS0tLS0tLWVuZFxyXG4gICAgc3RhdGljICRpbmplY3QgPSBbJyRzY29wZScsJ3Byb3h5U2VydmVyU2VydmljZScsJ2l2c1NlcnZlclNlcnZpY2UnLCckdGltZW91dCcsJ2FyZWFTZXJ2aWNlJ107XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkc2NvcGU6YW55LHByaXZhdGUgcHJveHlTZXJ2ZXJTZXJ2aWNlOklQcm94eVNlcnZlclNlcnZpY2UsIHByaXZhdGUgaXZzU2VydmVyU2VydmljZTpJSXZzU2VydmVyU2VydmljZSxwcml2YXRlICR0aW1lb3V0OmFueSxwcml2YXRlIGFyZWFTZXJ2aWNlOklBcmVhU2VydmljZSl7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+WMliDnsbvlnovpgInmi6lcclxuICAgICAgICBmb3IobGV0IGtleSBpbiBJdnNTZXJ2ZXJUeXBlKXtcclxuICAgICAgICAgICAgdGhpcy5pdnNTZXJ2ZXJUeXBlTGlzdC5wdXNoKEl2c1NlcnZlclR5cGVba2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8v5qCR57uT5p6E5Y+C5pWw5Yid5aeL5YyWXHJcbiAgICAgICAgLy/liJ3lp4vljJYgYXJlYSDmoJHmlbDmja5cclxuICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMgPSBuZXcgVHJlZURhdGFQYXJhbXM8QXJlYUV4Pih0cnVlKTtcclxuICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMudHJlZUlkID0gJ21vZGFsQXJlYSc7XHJcbiAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLm9uQ2xpY2sgPSB0cmVlU2VsZWN0Tm9kZTtcclxuICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMudHJlZUluaXRDb21wbGV0ZSA9IHRyZWVJbml0Q29tcGxldGU7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+WMliBjdHJsIOS8oOi/h+adpeeahOWPguaVsFxyXG4gICAgICAgIGlmKHRoaXMuJHNjb3BlLnVwZGF0ZU1vZGFsUGFyYW1zLmlzVXBkYXRlKXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2VydmUgPSB0aGlzLiRzY29wZS51cGRhdGVNb2RhbFBhcmFtcy51cGRhdGVNb2RlbDtcclxuICAgICAgICAgICAgdGhpcy5hcmVhVHJlZURhdGFzLmRlZmF1bHRTZWxlY3RUcmVlSWQgPSB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhSUQ7XHJcbiAgICAgICAgICAgIHRoaXMuYXJlYVRyZWVEYXRhcy5pc0RlZmF1bHRTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNlcnZlID0gbmV3IEl2c1NlcnZlckV4KCk7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNlcnZlLkFyZWFNb2RlbCA9IG5ldyBBcmVhKCk7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuJHNjb3BlLnVwZGF0ZU1vZGFsUGFyYW1zLmRlZmF1bHREYXRhcyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHRoaXMuJHNjb3BlLnVwZGF0ZU1vZGFsUGFyYW1zLmRlZmF1bHREYXRhcy5hcmVhSWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFyZWFUcmVlRGF0YXMuaXNEZWZhdWx0U2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcIiVjID09PT09VmlkZW9TZXJ2ZXJVcGRhdGVQb3B1cENvbnRyb2xsZXIgJHNjb3BlPT09PT1zdGFydD09PT09PT09PT09PT09XCIsXCJjb2xvcjpibHVlXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwi5Yid5aeL5YyWIGN0cmwg5Lyg6L+H5p2l55qE5Y+C5pWwXCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuY3VycmVudFNlcnZlKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFyZWFUcmVlRGF0YXMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiJWMgPT09PT09PT09ZW5kPT09PT09PT09PT09PT09XCIsXCJjb2xvcjpibHVlXCIpO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgICAgICBsZXQgc2VsZl90aGlzID0gdGhpcztcclxuICAgICAgICAkc2NvcGUuJG9uKFwiJGRlc3Ryb3lcIiwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCIlYyA9PT09PVZpZGVvU2VydmVyVXBkYXRlUG9wdXBDb250cm9sbGVyICRzY29wZS4kZGVzdHJveT09PT09c3RhcnQ9PT09PT09PT09PT09PVwiLFwiY29sb3I6Z3JlZW5cIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi6ZSA5q+B5LqG5by55Ye65qGGXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjID09PT09PT09PWVuZD09PT09PT09PT09PT09PVwiLFwiY29sb3I6Z3JlZW5cIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0UHJveHlTZXJ2ZXJMaXN0KCk7XHJcbiAgICAgICAgdGhpcy5nZXRBcmVhVHJlZSgpO1xyXG4gICAgICAgIC8vLS0tLS0tLS0tZW5kIC0tLS0tLVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB0cmVlSW5pdENvbXBsZXRlKHRyZWVJZDpzdHJpbmcpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiVjID09PWl2cyB0cmVlID09PT09PT1zdGFydD09PT09PT09PT09PT09XCIsJ2NvbG9yOmdyZWVuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRyZWVJZCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09ZW5kPT09PT09PT09PT09PT09XCIsKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHRyZWVTZWxlY3ROb2RlKGV2ZW50OiBNb3VzZUV2ZW50LCB0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGU6IEFyZWEpICB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidHJlZVNlbGVjdE5vZGUgIHRyZWVJZFwiLCB0cmVlSWQpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyZWVTZWxlY3ROb2RlIOWbnuiwg+WHveaVsFwiLCB0cmVlTm9kZSk7XHJcbiAgICAgICAgICAgIHNlbGZfdGhpcy4kdGltZW91dCgoKT0+e1xyXG4gICAgICAgICAgICAgICAgc2VsZl90aGlzLnNldEl2c1NlcnZlckFyZWEodHJlZU5vZGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEl2c1NlcnZlckFyZWEoYXJlYTpBcmVhKXtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTZXJ2ZS5BcmVhTW9kZWwgPSBuZXcgQXJlYSgpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFNlcnZlLkFyZWFNb2RlbC5JRCA9IGFyZWEuSUQ7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50U2VydmUuQXJlYU1vZGVsLk5hbWUgPSBhcmVhLk5hbWU7XHJcblxyXG4gICAgICAgIHRoaXMuY3VycmVudFNlcnZlLkFyZWFJRCA9IGFyZWEuSUQ7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5jdXJyZW50U2VydmUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb21taXRTYXZlT3JVcGRhdGUoKXtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRTZXJ2ZSk7XHJcbiAgICAgICAgbGV0IGNoZWNrU3RyID0gdGhpcy52YWxpZGF0ZVBhcmFtcyh0aGlzLmN1cnJlbnRTZXJ2ZSk7XHJcbiAgICAgICAgaWYoY2hlY2tTdHIpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIj09PT09PT1jaGVja1N0cj09PXJlc3VsdD09PT09PT09PT09PT09XCIsKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coY2hlY2tTdHIgKyBcIuacquWhq+WGmVwiKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT1lbmQ9PT09PT09PT09PT09PT1cIiwpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PWNoZWNrU3RyPT09cmVzdWx0PT09PT09PT09PT09PT1cIiwpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIuWPguaVsOWFqOW3sue7j+Whq+WGmVwiKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT1lbmQ9PT09PT09PT09PT09PT1cIiwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0aGlzLmN1cnJlbnRTZXJ2ZS5JRCl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT095pu05pawPT09PT09PT09PT09PT09XCIpO1xyXG4gICAgICAgICAgICB0aGlzLml2c1NlcnZlclNlcnZpY2UudXBkYXRlKHRoaXMuY3VycmVudFNlcnZlKS50aGVuKChyZXNwOmFueSk9PntcclxuICAgICAgICAgICAgICAgIGlmKHJlc3AuY29kZSA9PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VVcGRhdGVNb2RlbCh0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT3mlrDliqA9PT09PT09PT09PT09XCIpO1xyXG4gICAgICAgICAgICB0aGlzLml2c1NlcnZlclNlcnZpY2Uuc2F2ZSh0aGlzLmN1cnJlbnRTZXJ2ZSkudGhlbigocmVzcDphbnkpPT57XHJcbiAgICAgICAgICAgICAgICBpZihyZXNwLmNvZGUgPT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlVXBkYXRlTW9kZWwodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG4gICAgY2xvc2VVcGRhdGVNb2RlbChpc0NvbW1pdDpib29sZWFuKXtcclxuICAgICAgICB0aGlzLiRzY29wZS4kZW1pdCgnY2xvc2VTZXJ2ZXJVcGRhdGVNb2RlbCcse2lzQ29tbWl0OmlzQ29tbWl0fSk7XHJcbiAgICB9XHJcbiAgICAvLy0tLS0tLS0tLS0tLSBhcmVhVHJlZSBkYXRhXHJcbiAgICBnZXRBcmVhVHJlZShrZXl3b3JkPzpzdHJpbmcpe1xyXG4gICAgICAgIGxldCByZXFQYXJhbXMgPXtcclxuICAgICAgICAgIGtleXdvcmQ6JydcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmKGtleXdvcmQpe1xyXG4gICAgICAgICAgICByZXFQYXJhbXMua2V5d29yZCA9IGtleXdvcmQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBzZWxmX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuYXJlYVNlcnZpY2UuZmluZExpc3RUcmVlKHJlcVBhcmFtcykudGhlbigocmVzcDpBcnJheTxBcmVhRXg+KT0+e1xyXG5cclxuICAgICAgICAgICAgc2VsZl90aGlzLnNldE1vZGFsQXJlYVRyZWUocmVzcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5pS55Y+Y5pi+56S6IGFyZWFUcmVlXHJcbiAgICBjaGFuZ2VJc1Nob3dBcmVhVHJlZSgpe1xyXG4gICAgICAgIHRoaXMuYXJlYVRyZWVEYXRhcy5pc1Nob3cgPSAhdGhpcy5hcmVhVHJlZURhdGFzLmlzU2hvdztcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmN1cnJlbnRTZXJ2ZSk7XHJcbiAgICB9O1xyXG4gICAgLy8tLS0tLS0tLS0tLS0gYXJlYVRyZWUgZGF0YVxyXG4gICAgc2V0TW9kYWxBcmVhVHJlZShkYXRhOkFycmF5PEFyZWFFeD4pe1xyXG4gICAgICAgIHRoaXMuYXJlYVRyZWVEYXRhcy50cmVlRGF0YXMgID0gZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQcm94eVNlcnZlckxpc3QoKXtcclxuICAgICAgICB0aGlzLnByb3h5U2VydmVyU2VydmljZS5maW5kQWxsKCkudGhlbigocmVzcDpSZXNwb25zZVJlc3VsdDxBcnJheTxQcm94eVNlcnZlcj4+KT0+e1xyXG4gICAgICAgICAgICBpZihyZXNwLmNvZGUgPT0gMjAwKXtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJveHlTZXJ2ZXJMaXN0ID0gIHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLy/pqozor4HlrZfmrrXpmZDliLbvvIzov5Tlm57mj5DnpLror61cclxuICAgIHZhbGlkYXRlUGFyYW1zKG1vZGVsOkl2c1NlcnZlckV4KTpzdHJpbmd7XHJcblxyXG4gICAgICAgIGlmKCFtb2RlbC5BcmVhTW9kZWwpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ0FyZWFNb2RlbCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5Db2RlKXtcclxuICAgICAgICAgICAgcmV0dXJuICdDb2RlJztcclxuICAgICAgICB9XHJcbiAgICAvKiAgICBpZighbW9kZWwuRGVzY3JpcHRpb24pe1xyXG4gICAgICAgICAgICByZXR1cm4gJ0lwQWRkcmVzcyc7XHJcbiAgICAgICAgfSovXHJcbiAgICAgICAgaWYoIW1vZGVsLklwQWRkcmVzcyl7XHJcbiAgICAgICAgICAgIHJldHVybiAnSXBBZGRyZXNzJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIW1vZGVsLk5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ05hbWUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighbW9kZWwuUG9ydCl7XHJcbiAgICAgICAgICAgIHJldHVybiAnUG9ydCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5Qd2Qpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ1B3ZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5VaWQpe1xyXG4gICAgICAgICAgICByZXR1cm4gJ1VpZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFtb2RlbC5TZXJ2ZXJUeXBlKXtcclxuICAgICAgICAgICAgcmV0dXJuICdTZXJ2ZXJUeXBlJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG5hcHBcclxuICAgIC5jb250cm9sbGVyKCdpdnNTZXJ2ZXJVcGRhdGVNb2RhbENvbnRyb2xsZXInLCBJdnNTZXJ2ZXJVcGRhdGVNb2RhbENvbnRyb2xsZXIpOyJdfQ==

define(["require", "exports", "../../common/app/main.app", "../../common/directive/tree/tree-params", "../../../core/enum/TreeType", "../../../core/enum/ObjectType", "../../common/directive/tree/tree.directive.service", "../../common/services/connectTree.service", "../../common/factory/layerMsg.factory"], function (require, exports, main_app_1, tree_params_1, TreeType_1, ObjectType_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var ElePopupController = (function () {
        function ElePopupController($scope, areaService, $timeout, electronicfenceService, treeService, connectTreeService, layerDec) {
            this.$scope = $scope;
            this.areaService = areaService;
            this.$timeout = $timeout;
            this.electronicfenceService = electronicfenceService;
            this.treeService = treeService;
            this.connectTreeService = connectTreeService;
            this.layerDec = layerDec;
            this.cacheChangeNodes = {};
            this.type = $scope.type;
            this.rightSelectTreeNodeId = null;
            this.initTreeParams();
            this.getLeftTreeData();
            this.getRightTreeData();
        }
        ElePopupController.prototype.initTreeParams = function () {
            var _this = this;
            this.leftTreeParams = new tree_params_1.TreeDataParams(true);
            this.leftTreeParams.treeId = "devicePopupLeftTree";
            this.leftTreeParams.isShowIcon = true;
            this.leftTreeParams.isShowLine = false;
            this.leftTreeParams.isSimpleData = true;
            this.leftTreeParams.checkEnable = false;
            this.leftTreeParams.isSingleSelect = false;
            this.leftTreeParams.editEnable = true;
            this.leftTreeParams.showRemoveBtn = false;
            this.leftTreeParams.showRenameBtn = false;
            this.leftTreeParams.beforeDrop = beforeDropRule;
            this.leftTreeParams.beforeDrag = beforeDragRule;
            if (this.type === TreeType_1.TreeType.lamp.value) {
                this.leftTreeParams.addDiyDom = function (treeId, treeNode) {
                    _this.treeService.addDiyDomIsConfiStatus(treeId, treeNode);
                };
            }
            this.rightTreeParams = new tree_params_1.TreeDataParams(true);
            this.rightTreeParams.treeId = "devicePopupRightTree";
            this.rightTreeParams.isShowIcon = true;
            this.rightTreeParams.isShowLine = false;
            this.rightTreeParams.isSimpleData = true;
            this.rightTreeParams.checkEnable = false;
            this.rightTreeParams.isSingleSelect = false;
            this.rightTreeParams.editEnable = true;
            this.rightTreeParams.showRemoveBtn = false;
            this.rightTreeParams.showRenameBtn = false;
            this.rightTreeParams.beforeDrop = beforeDropRule;
            this.rightTreeParams.beforeDrag = beforeDragRule;
            var _self = this;
            function beforeDropRule(treeId, treeNodes, targetNode) {
                if (treeId == _self.leftTreeParams.treeId) {
                    return false;
                }
                if (_self.type === TreeType_1.TreeType.lamp.value && targetNode.treeType !== TreeType_1.TreeType.lamp.value) {
                    return false;
                }
                if (_self.type === TreeType_1.TreeType.area.value && targetNode.treeType !== TreeType_1.TreeType.area.value) {
                    return false;
                }
                var newNodeList = [];
                var updateNodeList = [];
                treeNodes.forEach(function (item) {
                    item.ParentID = targetNode.ID;
                    item.isConfigLamp = true;
                    var node = _self.treeService.getNodeByParam(treeId, 'ID', item.ID);
                    if (node) {
                        updateNodeList.push(item);
                    }
                    else {
                        newNodeList.push(item);
                    }
                });
                if (updateNodeList.length > 0) {
                    _self.$timeout(function () {
                        _self.treeService.removeNodes(treeId, updateNodeList);
                        _self.treeService.addNodes(treeId, updateNodeList, targetNode);
                    });
                }
                if (newNodeList.length > 0) {
                    _self.treeService.addNodes(treeId, newNodeList, targetNode);
                }
                if (_self.type === TreeType_1.TreeType.lamp.value) {
                    _self.updateTreeDiyDom(treeId, treeNodes);
                }
                _self.changeNodesParentID(treeNodes, targetNode.ID);
                return false;
            }
            function beforeDragRule(treeId, treeNodes) {
                var flag = true;
                if (treeNodes && treeNodes.length > 0) {
                    var i = void 0, len = void 0, treeType = TreeType_1.TreeType.ElectronicFence.value;
                    for (i = 0, len = treeNodes.length; i < len; i++) {
                        if (treeNodes[i].treeType !== treeType) {
                            flag = false;
                            break;
                        }
                    }
                }
                else {
                    flag = false;
                }
                return flag;
            }
        };
        ElePopupController.prototype.updateTreeDiyDom = function (treeId, treeNodes) {
            var _this = this;
            this.$timeout(function () {
                treeNodes.forEach(function (item) {
                    _this.leftTreeParams.addDiyDom(treeId, item);
                });
            });
        };
        ElePopupController.prototype.changeNodesParentID = function (treeNodes, parentId) {
            if (!treeNodes || treeNodes.length <= 0)
                return;
            var i, len, temp, originParentId;
            for (i = 0, len = treeNodes.length; i < len; i++) {
                if (this.type === TreeType_1.TreeType.area.value) {
                    temp = treeNodes[i];
                    originParentId = temp.AreaID;
                    temp.ParentID = parentId;
                    temp.AreaID = parentId;
                }
                else if (this.type === TreeType_1.TreeType.lamp.value) {
                    temp = treeNodes[i];
                    if (!temp.JsonUserData.lampPost) {
                        var lampPost = {};
                        lampPost.ObjectId = parentId;
                        lampPost.ObjectType = ObjectType_1.ObjectType.LampPost.value;
                        lampPost.RelatedObjectId = temp.ID;
                        lampPost.RelatedObjectType = ObjectType_1.ObjectType.ElectronicFence.value;
                        temp.JsonUserData.lampPost = lampPost;
                        originParentId = "";
                        temp.ParentID = parentId;
                    }
                    else {
                        originParentId = temp.JsonUserData.lampPost.ID;
                        temp.ParentID = parentId;
                        temp.JsonUserData.lampPost.ID = parentId;
                    }
                }
                this.addOrUpdateTreeChangeCache({ id: temp.ID, parentId: temp.ParentID, originParentId: originParentId, deviceReId: temp.JsonUserData.DeviceReId });
            }
        };
        ElePopupController.prototype.addOrUpdateTreeChangeCache = function (model) {
            if (this.cacheChangeNodes[model.id]) {
                this.cacheChangeNodes[model.id].parentId = model.parentId;
            }
            else {
                this.cacheChangeNodes[model.id] = model;
            }
        };
        ElePopupController.prototype.submit = function () {
            var _this = this;
            var key, temp, models = [], P;
            if (this.type === 'area') {
                for (key in this.cacheChangeNodes) {
                    temp = this.cacheChangeNodes[key];
                    models.push({ id: temp.id, areaId: temp.parentId });
                }
                if (models.length > 0) {
                    P = this.electronicfenceService.updateElectronicAreaID(models);
                }
                else {
                    this.layerDec.warnInfo("没有选择任何区域");
                    this.cancel(false);
                }
            }
            else {
                for (key in this.cacheChangeNodes) {
                    temp = this.cacheChangeNodes[key];
                    models.push({ id: temp.id, lampId: temp.parentId, deviceReId: temp.deviceReId });
                }
                if (models.length > 0) {
                    P = this.electronicfenceService.updateElectronicLampID(models);
                }
                else {
                    this.layerDec.warnInfo("没有选择任何立杆");
                    this.cancel(false);
                }
            }
            if (P) {
                P.then(function (res) {
                    if (res && res.code === 200) {
                        _this.cancel(true);
                    }
                    else {
                        console.error("eleService.updateElectronic error", res);
                    }
                });
            }
        };
        ElePopupController.prototype.cancel = function (flag) {
            this.$scope.$emit('device.closePopup', flag);
        };
        ElePopupController.prototype.getLeftTreeData = function () {
            var _this = this;
            this.electronicfenceService.findAll().then(function (res) {
                _this.$timeout(function () {
                    _this.leftTreeParams.treeDatas = res;
                });
            });
        };
        ElePopupController.prototype.getRightTreeData = function () {
            var _this = this;
            var P;
            if (this.type === 'lamp') {
                P = this.connectTreeService.findLampTreeWithElectronicfence();
            }
            else {
                P = this.connectTreeService.findAreaWithElectronicfence();
            }
            P.then(function (datas) {
                _this.$timeout(function () {
                    _this.rightTreeParams.treeDatas = datas;
                });
            });
        };
        ElePopupController.$inject = ['$scope', 'areaService',
            '$timeout', 'electronicfenceService',
            'treeDirectiveService', 'connectTreeService', 'layerDec'];
        return ElePopupController;
    }());
    main_app_1.app.controller("baseConfigElePopup", ElePopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9lbGVjdHJvbmljZmVuY2UvZWxlLnBvcHVwRWxlY3Ryb25pYy5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztJQWtDQTtRQVNJLDRCQUNZLE1BQVcsRUFBVSxXQUF5QixFQUM5QyxRQUFhLEVBQVUsc0JBQStDLEVBQ3RFLFdBQWtDLEVBQ2xDLGtCQUF1QyxFQUN2QyxRQUFtQjtZQUpuQixXQUFNLEdBQU4sTUFBTSxDQUFLO1lBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWM7WUFDOUMsYUFBUSxHQUFSLFFBQVEsQ0FBSztZQUFVLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBeUI7WUFDdEUsZ0JBQVcsR0FBWCxXQUFXLENBQXVCO1lBQ2xDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBcUI7WUFDdkMsYUFBUSxHQUFSLFFBQVEsQ0FBVztZQU4vQixxQkFBZ0IsR0FBRyxFQUEyQixDQUFDO1lBUTNDLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztZQUN4QixJQUFJLENBQUMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDNUIsQ0FBQztRQUNPLDJDQUFjLEdBQXRCO1lBQUEsaUJBcUZDO1lBcEZHLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSw0QkFBYyxDQUFvQixJQUFJLENBQUMsQ0FBQztZQUNsRSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxxQkFBcUIsQ0FBQztZQUNuRCxJQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7WUFDdEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxHQUFHLElBQUks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QyxDQUFDLENBQUM7UUFDUCxDQUFDO1FBQ08sNkNBQWdCLEdBQXhCO1lBQUEsaUJBYUM7WUFaRyxJQUFJLENBQU0sQ0FBQztZQUNYLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDdkIsQ0FBQyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQywrQkFBK0IsRUFBRSxDQUFBO1lBQ2pFLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLDJCQUEyQixFQUFFLENBQUE7WUFDN0QsQ0FBQztZQUVELENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxLQUFpQjtnQkFDckIsS0FBSSxDQUFDLFFBQVEsQ0FBQztvQkFDVixLQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQzNDLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDO1FBek5NLDBCQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUUsYUFBYTtZQUNyQyxVQUFVLEVBQUUsd0JBQXdCO1lBQ3BDLHNCQUFzQixFQUFFLG9CQUFvQixFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBd05sRSx5QkFBQztLQTNORCxBQTJOQyxJQUFBO0lBQ0QsY0FBRyxDQUFDLFVBQVUsQ0FBQyxvQkFBb0IsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDIiwiZmlsZSI6Im1vZHVsZS9iYXNlY29uZmlnL2VsZWN0cm9uaWNmZW5jZS9lbGUucG9wdXBFbGVjdHJvbmljLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhcHAgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgeyBUcmVlRGF0YVBhcmFtcyB9IGZyb20gXCIuLi8uLi9jb21tb24vZGlyZWN0aXZlL3RyZWUvdHJlZS1wYXJhbXNcIjtcclxuaW1wb3J0IHsgRWxlY3Ryb25pY0ZlbmNlIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L0VsZWN0cm9uaWNGZW5jZVwiO1xyXG5pbXBvcnQgeyBJQXJlYVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2FyZWEuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBFbGVjdHJvbmljRmVuY2VFeCB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9FbGVjdHJvbmljRmVuY2VFeFwiO1xyXG5pbXBvcnQgeyBBcmVhRXggfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9lbnRpdHkvZXgvQXJlYUV4XCI7XHJcbmltcG9ydCB7IExhbXBFeCB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9MYW1wRXhcIjtcclxuaW1wb3J0IHsgSUVsZWN0cm9uaWNGZW5jZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2VsZWN0cm9uaWNmZW5jZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdHJlZS90cmVlLmRpcmVjdGl2ZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IElUcmVlRGlyZWN0aXZlU2VydmljZSB9IGZyb20gXCIuLi8uLi9jb21tb24vZGlyZWN0aXZlL3RyZWUvdHJlZS5kaXJlY3RpdmUuc2VydmljZVwiO1xyXG5pbXBvcnQge0VsZWN0cm9uaWNGZW5jZUNoYW5nZUFyZWFJRE1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9wYXJhbXMvRWxlY3Ryb25pY0ZlbmNlUGFyYW1zXCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlUmVzdWx0IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQgeyBUcmVlVHlwZSB9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudW0vVHJlZVR5cGVcIjtcclxuaW1wb3J0IHsgSUNvbm5lY3RUcmVlU2VydmljZSB9IGZyb20gXCIuLi8uLi9jb21tb24vc2VydmljZXMvY29ubmVjdFRyZWUuc2VydmljZVwiO1xyXG5pbXBvcnQgXCIuLi8uLi9jb21tb24vc2VydmljZXMvY29ubmVjdFRyZWUuc2VydmljZVwiO1xyXG5cclxuaW1wb3J0IHsgUmVsYXRpb24gfSBmcm9tICcuLi8uLi8uLi9jb3JlL2VudGl0eS9EZXZpY2VSZWxhdGlvbic7XHJcbmltcG9ydCB7T2JqZWN0VHlwZX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW51bS9PYmplY3RUeXBlXCI7XHJcbmltcG9ydCB7SUxheWVyRGVjfSBmcm9tIFwiLi4vLi4vY29tbW9uL2ZhY3RvcnkvbGF5ZXJNc2cuZmFjdG9yeVwiO1xyXG5pbXBvcnQgIFwiLi4vLi4vY29tbW9uL2ZhY3RvcnkvbGF5ZXJNc2cuZmFjdG9yeVwiO1xyXG50eXBlIEFyZWFFbGVjdHJvbmljRmVuY2VFeCA9IEFyZWFFeCAmIEVsZWN0cm9uaWNGZW5jZUV4O1xyXG5cclxuaW50ZXJmYWNlIEFyZWFJRENhY2hlTW9kZWwge1xyXG4gICAgaWQ6IHN0cmluZztcclxuICAgIHBhcmVudElkOiBzdHJpbmc7XHJcbiAgICBvcmlnaW5QYXJlbnRJZDogc3RyaW5nO1xyXG4gICAgZGV2aWNlUmVJZD86IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIEFyZWFJRENhY2hlQ29sbGVjdGlvbiB7XHJcbiAgICBba2V5OiBzdHJpbmddOiBBcmVhSURDYWNoZU1vZGVsO1xyXG59XHJcblxyXG5cclxuY2xhc3MgRWxlUG9wdXBDb250cm9sbGVyIHtcclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCAnYXJlYVNlcnZpY2UnLFxyXG4gICAgICAgICckdGltZW91dCcsICdlbGVjdHJvbmljZmVuY2VTZXJ2aWNlJyxcclxuICAgICAgICAndHJlZURpcmVjdGl2ZVNlcnZpY2UnLCAnY29ubmVjdFRyZWVTZXJ2aWNlJywgJ2xheWVyRGVjJ107XHJcbiAgICByaWdodFNlbGVjdFRyZWVOb2RlSWQ6IHN0cmluZztcclxuICAgIGxlZnRUcmVlUGFyYW1zOiBUcmVlRGF0YVBhcmFtczxFbGVjdHJvbmljRmVuY2U+O1xyXG4gICAgcmlnaHRUcmVlUGFyYW1zOiBUcmVlRGF0YVBhcmFtczxhbnk+O1xyXG4gICAgdHlwZTogc3RyaW5nO1xyXG4gICAgY2FjaGVDaGFuZ2VOb2RlcyA9IHt9IGFzIEFyZWFJRENhY2hlQ29sbGVjdGlvbjtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgJHNjb3BlOiBhbnksIHByaXZhdGUgYXJlYVNlcnZpY2U6IElBcmVhU2VydmljZSxcclxuICAgICAgICBwcml2YXRlICR0aW1lb3V0OiBhbnksIHByaXZhdGUgZWxlY3Ryb25pY2ZlbmNlU2VydmljZTogSUVsZWN0cm9uaWNGZW5jZVNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSB0cmVlU2VydmljZTogSVRyZWVEaXJlY3RpdmVTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgY29ubmVjdFRyZWVTZXJ2aWNlOiBJQ29ubmVjdFRyZWVTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgbGF5ZXJEZWM6IElMYXllckRlY1xyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy50eXBlID0gJHNjb3BlLnR5cGU7XHJcbiAgICAgICAgdGhpcy5yaWdodFNlbGVjdFRyZWVOb2RlSWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaW5pdFRyZWVQYXJhbXMoKTtcclxuICAgICAgICB0aGlzLmdldExlZnRUcmVlRGF0YSgpO1xyXG4gICAgICAgIHRoaXMuZ2V0UmlnaHRUcmVlRGF0YSgpO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBpbml0VHJlZVBhcmFtcygpIHtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zID0gbmV3IFRyZWVEYXRhUGFyYW1zPEVsZWN0cm9uaWNGZW5jZUV4Pih0cnVlKTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnRyZWVJZCA9IFwiZGV2aWNlUG9wdXBMZWZ0VHJlZVwiO1xyXG4gICAgICAgIHRoaXMubGVmdFRyZWVQYXJhbXMuaXNTaG93SWNvbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5pc1Nob3dMaW5lID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5pc1NpbXBsZURhdGEgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubGVmdFRyZWVQYXJhbXMuY2hlY2tFbmFibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmlzU2luZ2xlU2VsZWN0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5lZGl0RW5hYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnNob3dSZW1vdmVCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnNob3dSZW5hbWVCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmJlZm9yZURyb3AgPSBiZWZvcmVEcm9wUnVsZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmJlZm9yZURyYWcgPSBiZWZvcmVEcmFnUnVsZTtcclxuICAgICAgICBpZih0aGlzLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUpe1xyXG4gICAgICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmFkZERpeURvbSA9ICh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlU2VydmljZS5hZGREaXlEb21Jc0NvbmZpU3RhdHVzKHRyZWVJZCwgdHJlZU5vZGUpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMgPSBuZXcgVHJlZURhdGFQYXJhbXM8QXJlYUVsZWN0cm9uaWNGZW5jZUV4Pih0cnVlKTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy50cmVlSWQgPSBcImRldmljZVBvcHVwUmlnaHRUcmVlXCI7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuaXNTaG93SWNvbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuaXNTaG93TGluZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmlzU2ltcGxlRGF0YSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuY2hlY2tFbmFibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5pc1NpbmdsZVNlbGVjdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmVkaXRFbmFibGUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLnNob3dSZW1vdmVCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5zaG93UmVuYW1lQnRuID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuYmVmb3JlRHJvcCA9IGJlZm9yZURyb3BSdWxlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmJlZm9yZURyYWcgPSBiZWZvcmVEcmFnUnVsZTtcclxuICAgICAgICBsZXQgX3NlbGYgPSB0aGlzIGFzIEVsZVBvcHVwQ29udHJvbGxlcjtcclxuICAgICAgICBmdW5jdGlvbiBiZWZvcmVEcm9wUnVsZSh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGVzOiBBcnJheTxFbGVjdHJvbmljRmVuY2VFeD4sIHRhcmdldE5vZGU6IExhbXBFeCAmIEFyZWFFeCAmIEVsZWN0cm9uaWNGZW5jZUV4KSB7XHJcbiAgICAgICAgICAgIGlmICh0cmVlSWQgPT0gX3NlbGYubGVmdFRyZWVQYXJhbXMudHJlZUlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKF9zZWxmLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUgJiYgdGFyZ2V0Tm9kZS50cmVlVHlwZSAhPT0gVHJlZVR5cGUubGFtcC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfc2VsZi50eXBlID09PSBUcmVlVHlwZS5hcmVhLnZhbHVlICYmIHRhcmdldE5vZGUudHJlZVR5cGUgIT09IFRyZWVUeXBlLmFyZWEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgbmV3Tm9kZUxpc3QgPSBbXSBhcyBBcnJheTxFbGVjdHJvbmljRmVuY2VFeD47XHJcbiAgICAgICAgICAgIGxldCB1cGRhdGVOb2RlTGlzdCA9IFtdIGFzIEFycmF5PEVsZWN0cm9uaWNGZW5jZUV4PjtcclxuICAgICAgICAgICAgdHJlZU5vZGVzLmZvckVhY2goKGl0ZW06IEVsZWN0cm9uaWNGZW5jZUV4fGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5QYXJlbnRJRCA9IHRhcmdldE5vZGUuSUQ7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmlzQ29uZmlnTGFtcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IF9zZWxmLnRyZWVTZXJ2aWNlLmdldE5vZGVCeVBhcmFtKHRyZWVJZCwgJ0lEJywgaXRlbS5JRCkgYXMgRWxlY3Ryb25pY0ZlbmNlRXg7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU5vZGVMaXN0LnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZUxpc3QucHVzaChpdGVtKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHVwZGF0ZU5vZGVMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIF9zZWxmLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfc2VsZi50cmVlU2VydmljZS5yZW1vdmVOb2Rlcyh0cmVlSWQsIHVwZGF0ZU5vZGVMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBfc2VsZi50cmVlU2VydmljZS5hZGROb2Rlcyh0cmVlSWQsIHVwZGF0ZU5vZGVMaXN0LCB0YXJnZXROb2RlKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5ld05vZGVMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIF9zZWxmLnRyZWVTZXJ2aWNlLmFkZE5vZGVzKHRyZWVJZCwgbmV3Tm9kZUxpc3QsIHRhcmdldE5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKF9zZWxmLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgX3NlbGYudXBkYXRlVHJlZURpeURvbSh0cmVlSWQsIHRyZWVOb2Rlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3NlbGYuY2hhbmdlTm9kZXNQYXJlbnRJRCh0cmVlTm9kZXMsIHRhcmdldE5vZGUuSUQpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGJlZm9yZURyYWdSdWxlKHRyZWVJZDogc3RyaW5nLCB0cmVlTm9kZXM6IEFycmF5PEVsZWN0cm9uaWNGZW5jZUV4Pikge1xyXG4gICAgICAgICAgICBsZXQgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0cmVlTm9kZXMgJiYgdHJlZU5vZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGxldCBpLCBsZW4sIHRyZWVUeXBlID0gVHJlZVR5cGUuRWxlY3Ryb25pY0ZlbmNlLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdHJlZU5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWVOb2Rlc1tpXS50cmVlVHlwZSAhPT0gdHJlZVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZsYWc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVzYyDmibnph4/ljrvmm7TmlrBkaXlEb23nirbmgIFcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0cmVlSWRcclxuICAgICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gdHJlZU5vZGVzXHJcbiAgICAgKi9cclxuICAgIHVwZGF0ZVRyZWVEaXlEb20odHJlZUlkOiBzdHJpbmcsIHRyZWVOb2RlczogQXJyYXk8YW55Pikge1xyXG4gICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0cmVlTm9kZXMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmFkZERpeURvbSh0cmVlSWQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGNoYW5nZU5vZGVzUGFyZW50SUQodHJlZU5vZGVzOiBhbnksIHBhcmVudElkOiBzdHJpbmcpIHtcclxuICAgICAgICBpZiAoIXRyZWVOb2RlcyB8fCB0cmVlTm9kZXMubGVuZ3RoIDw9IDApIHJldHVybjtcclxuICAgICAgICBsZXQgaSwgbGVuLCB0ZW1wLCBvcmlnaW5QYXJlbnRJZDtcclxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSB0cmVlTm9kZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gVHJlZVR5cGUuYXJlYS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGVtcCA9IHRyZWVOb2Rlc1tpXTtcclxuICAgICAgICAgICAgICAgIG9yaWdpblBhcmVudElkID0gdGVtcC5BcmVhSUQ7XHJcbiAgICAgICAgICAgICAgICB0ZW1wLlBhcmVudElEID0gcGFyZW50SWQ7XHJcbiAgICAgICAgICAgICAgICB0ZW1wLkFyZWFJRCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gVHJlZVR5cGUubGFtcC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGVtcCA9IHRyZWVOb2Rlc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmICghdGVtcC5Kc29uVXNlckRhdGEubGFtcFBvc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGFtcFBvc3QgPSB7fSBhcyBSZWxhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBsYW1wUG9zdC5PYmplY3RJZCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICAgICAgICAgIGxhbXBQb3N0Lk9iamVjdFR5cGUgPSBPYmplY3RUeXBlLkxhbXBQb3N0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGxhbXBQb3N0LlJlbGF0ZWRPYmplY3RJZCA9IHRlbXAuSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFtcFBvc3QuUmVsYXRlZE9iamVjdFR5cGUgPSBPYmplY3RUeXBlLkVsZWN0cm9uaWNGZW5jZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wLkpzb25Vc2VyRGF0YS5sYW1wUG9zdCA9IGxhbXBQb3N0O1xyXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpblBhcmVudElkID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wLlBhcmVudElEID0gcGFyZW50SWQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpblBhcmVudElkID0gdGVtcC5Kc29uVXNlckRhdGEubGFtcFBvc3QuSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5QYXJlbnRJRCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXAuSnNvblVzZXJEYXRhLmxhbXBQb3N0LklEID0gcGFyZW50SWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmFkZE9yVXBkYXRlVHJlZUNoYW5nZUNhY2hlKHsgaWQ6IHRlbXAuSUQsIHBhcmVudElkOiB0ZW1wLlBhcmVudElELCBvcmlnaW5QYXJlbnRJZDogb3JpZ2luUGFyZW50SWQsIGRldmljZVJlSWQ6IHRlbXAuSnNvblVzZXJEYXRhLkRldmljZVJlSWQgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBhZGRPclVwZGF0ZVRyZWVDaGFuZ2VDYWNoZShtb2RlbDogQXJlYUlEQ2FjaGVNb2RlbCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlQ2hhbmdlTm9kZXNbbW9kZWwuaWRdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVDaGFuZ2VOb2Rlc1ttb2RlbC5pZF0ucGFyZW50SWQgPSBtb2RlbC5wYXJlbnRJZDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlQ2hhbmdlTm9kZXNbbW9kZWwuaWRdID0gbW9kZWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN1Ym1pdCgpIHtcclxuICAgICAgICBsZXQga2V5LCB0ZW1wLCBtb2RlbHMgPSBbXSBhcyBBcnJheTxFbGVjdHJvbmljRmVuY2VDaGFuZ2VBcmVhSURNb2RlbD4sIFA6IGFueTtcclxuICAgICAgICBpZiAodGhpcy50eXBlID09PSAnYXJlYScpIHtcclxuICAgICAgICAgICAgZm9yIChrZXkgaW4gdGhpcy5jYWNoZUNoYW5nZU5vZGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wID0gdGhpcy5jYWNoZUNoYW5nZU5vZGVzW2tleV07XHJcbiAgICAgICAgICAgICAgICBtb2RlbHMucHVzaCh7IGlkOiB0ZW1wLmlkLCBhcmVhSWQ6IHRlbXAucGFyZW50SWQgfSBhcyBFbGVjdHJvbmljRmVuY2VDaGFuZ2VBcmVhSURNb2RlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1vZGVscy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBQID0gdGhpcy5lbGVjdHJvbmljZmVuY2VTZXJ2aWNlLnVwZGF0ZUVsZWN0cm9uaWNBcmVhSUQobW9kZWxzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJEZWMud2FybkluZm8oXCLmsqHmnInpgInmi6nku7vkvZXljLrln59cIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGtleSBpbiB0aGlzLmNhY2hlQ2hhbmdlTm9kZXMpIHtcclxuICAgICAgICAgICAgICAgIHRlbXAgPSB0aGlzLmNhY2hlQ2hhbmdlTm9kZXNba2V5XTtcclxuICAgICAgICAgICAgICAgIG1vZGVscy5wdXNoKHsgaWQ6IHRlbXAuaWQsIGxhbXBJZDogdGVtcC5wYXJlbnRJZCwgZGV2aWNlUmVJZDogdGVtcC5kZXZpY2VSZUlkIH0gYXMgRWxlY3Ryb25pY0ZlbmNlQ2hhbmdlQXJlYUlETW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtb2RlbHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgUCA9IHRoaXMuZWxlY3Ryb25pY2ZlbmNlU2VydmljZS51cGRhdGVFbGVjdHJvbmljTGFtcElEKG1vZGVscyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyRGVjLndhcm5JbmZvKFwi5rKh5pyJ6YCJ5oup5Lu75L2V56uL5p2GXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChQKSB7XHJcbiAgICAgICAgICAgIFAudGhlbigocmVzOiBSZXNwb25zZVJlc3VsdDxib29sZWFuPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJlbGVTZXJ2aWNlLnVwZGF0ZUVsZWN0cm9uaWMgZXJyb3JcIiwgcmVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgY2FuY2VsKGZsYWc/OiBib29sZWFuKSB7XHJcbiAgICAgICAgdGhpcy4kc2NvcGUuJGVtaXQoJ2RldmljZS5jbG9zZVBvcHVwJywgZmxhZyk7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIGdldExlZnRUcmVlRGF0YSgpIHtcclxuICAgICAgICB0aGlzLmVsZWN0cm9uaWNmZW5jZVNlcnZpY2UuZmluZEFsbCgpLnRoZW4oKHJlczogQXJyYXk8RWxlY3Ryb25pY0ZlbmNlRXg+KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy50cmVlRGF0YXMgPSByZXM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBnZXRSaWdodFRyZWVEYXRhKCkge1xyXG4gICAgICAgIGxldCBQOiBhbnk7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ2xhbXAnKSB7XHJcbiAgICAgICAgICAgIFAgPSB0aGlzLmNvbm5lY3RUcmVlU2VydmljZS5maW5kTGFtcFRyZWVXaXRoRWxlY3Ryb25pY2ZlbmNlKClcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBQID0gdGhpcy5jb25uZWN0VHJlZVNlcnZpY2UuZmluZEFyZWFXaXRoRWxlY3Ryb25pY2ZlbmNlKClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFAudGhlbigoZGF0YXM6IEFycmF5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy50cmVlRGF0YXMgPSBkYXRhcztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG5hcHAuY29udHJvbGxlcihcImJhc2VDb25maWdFbGVQb3B1cFwiLCBFbGVQb3B1cENvbnRyb2xsZXIpOyJdfQ==

define(["require", "exports", "../../common/app/main.app", "../../common/directive/tree/tree-params", "../../common/services/unit.service"], function (require, exports, main_app_1, tree_params_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var UnitPopupController = (function () {
        function UnitPopupController($scope, $rootScope, unitService, $q, $timeout, areaService) {
            $scope.$on("$destroy", function () {
            });
            var vm = this;
            vm.curdType = $scope.curdType;
            vm.Unit = {};
            vm.treeParams = new tree_params_1.TreeDataParams();
            vm.treeParams.treeId = "unitPopupAreaTree";
            vm.treeParams.onClick = treeSelectNode;
            if (vm.curdType === 'add' && $scope.currentArea) {
                vm.Unit.ParentArea = {};
                vm.Unit.ParentArea.ID = $scope.currentArea.ID;
                vm.Unit.ParentArea.Name = $scope.currentArea.Name;
                vm.submit = saveUnit;
                areaService.findListTree().then(function (datas) {
                    $timeout(function () {
                        vm.treeParams.treeDatas = datas;
                        vm.treeParams.defaultSelectTreeId = vm.Unit.ParentArea.ID;
                    });
                });
            }
            else if (vm.curdType === 'edit' && $scope.currentUnit) {
                vm.submit = editUnit;
                $q.all([unitService.get($scope.currentUnit.ID), areaService.findListTree()])
                    .then(function (res) {
                    console.error(res);
                    var r0 = res[0];
                    var r1 = res[1];
                    if (r0.code !== 200) {
                        return $q.reject(r0.code);
                    }
                    $timeout(function () {
                        if (r0.data) {
                            vm.Unit = r0.data;
                            vm.treeParams.treeDatas = r1;
                            if (vm.Unit && vm.Unit.ParentArea) {
                                vm.treeParams.defaultSelectTreeId = vm.Unit.ParentArea.ID;
                            }
                        }
                    });
                });
            }
            vm.cancel = cancelAreaPopup;
            function treeSelectNode(event, treeId, treeNode) {
                $timeout(function () {
                    vm.Unit.ParentArea = treeNode;
                    vm.isShowAreaTree = false;
                });
            }
            function saveUnit() {
                if (!validate())
                    return;
                unitService.save(vm.Unit).then(complete).then(closePopup);
                function complete(res) {
                    if (res.code === 200) {
                        return null;
                    }
                    else {
                        return $q.reject(res.code);
                    }
                }
                function closePopup() {
                    $rootScope.$broadcast('unit.closePopup', true);
                }
            }
            function editUnit() {
                if (!validate())
                    return;
                unitService.edit(vm.Unit).then(complete).then(closePopup);
                function complete(res) {
                    if (res.code === 200) {
                        return null;
                    }
                    else {
                        return $q.reject(res.code);
                    }
                }
                function closePopup() {
                    $rootScope.$broadcast('unit.closePopup', true);
                }
            }
            function validate() {
                var result = true;
                if (!vm.Unit.Code) {
                    result = false;
                }
                else if (!vm.Unit.Name) {
                    result = false;
                }
                return result;
            }
            function cancelAreaPopup() {
                $rootScope.$broadcast('unit.closePopup');
            }
        }
        UnitPopupController.$inject = ['$scope', '$rootScope', 'unitService', '$q', '$timeout', 'areaService'];
        return UnitPopupController;
    }());
    main_app_1.app
        .controller('unitPopupController', UnitPopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy91bml0L3VuaXQucG9wdXAuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFhQTtRQVNJLDZCQUFZLE1BQVcsRUFBRSxVQUFlLEVBQUUsV0FBeUIsRUFBRSxFQUFPLEVBQUUsUUFBYSxFQUFFLFdBQXlCO1lBRWxILE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1lBR0gsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDO1lBQ2QsRUFBRSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1lBQzlCLEVBQUUsQ0FBQyxJQUFJLEdBQUcsRUFBWSxDQUFDO1lBRXZCLEVBQUUsQ0FBQyxVQUFVLEdBQUcsSUFBSSw0QkFBYyxFQUFVLENBQUM7WUFDN0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsbUJBQW1CLENBQUM7WUFDM0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsY0FBYyxDQUFDO1lBRXZDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEtBQUssS0FBSyxJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUM5QyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFVLENBQUM7Z0JBQ2hDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztnQkFDOUMsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDO2dCQUNsRCxFQUFFLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQztnQkFHckIsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQW9CO29CQUNqRCxRQUFRLENBQUM7d0JBQ0wsRUFBRSxDQUFDLFVBQVUsQ0FB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QkFBQztLQTFIRCxBQTBIQyxJQUFBO0lBRUQsY0FBRztTQUNFLFVBQVUsQ0FBQyxxQkFBcUIsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDIiwiZmlsZSI6Im1vZHVsZS9iYXNlY29uZmlnL3VuaXQvdW5pdC5wb3B1cC5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZGVsbCBvbiAyMDE3LzMvMjkuXHJcbiAqL1xyXG5pbXBvcnQge2FwcH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9hcHAvbWFpbi5hcHBcIjtcclxuaW1wb3J0ICcuLi8uLi9jb21tb24vc2VydmljZXMvdW5pdC5zZXJ2aWNlJztcclxuaW1wb3J0IHtJVW5pdFNlcnZpY2V9IGZyb20gXCIuLi8uLi9jb21tb24vc2VydmljZXMvdW5pdC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7QXJlYX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L0FyZWFcIjtcclxuaW1wb3J0IHtBcmVhRXh9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9BcmVhRXhcIjtcclxuaW1wb3J0IHtVbml0RXh9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9Vbml0RXhcIjtcclxuaW1wb3J0IHtSZXNwb25zZVJlc3VsdH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQge0lBcmVhU2VydmljZX0gZnJvbSBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9hcmVhLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtUcmVlRGF0YVBhcmFtcywgSVRyZWVEYXRhUGFyYW1zfSBmcm9tIFwiLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUtcGFyYW1zXCI7XHJcblxyXG5jbGFzcyBVbml0UG9wdXBDb250cm9sbGVye1xyXG4gICAgc3RhdGljICRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJ3VuaXRTZXJ2aWNlJywgJyRxJywgJyR0aW1lb3V0JywgJ2FyZWFTZXJ2aWNlJ107XHJcbiAgICBjdXJkVHlwZTogc3RyaW5nO1xyXG4gICAgVW5pdDogVW5pdEV4O1xyXG4gICAgc3VibWl0OiBGdW5jdGlvbjtcclxuICAgIGNhbmNlbDogRnVuY3Rpb247XHJcbiAgICB0cmVlUGFyYW1zOiBJVHJlZURhdGFQYXJhbXM8QXJlYUV4PjtcclxuICAgIGlzU2hvd0FyZWFUcmVlOiBib29sZWFuO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCRzY29wZTogYW55LCAkcm9vdFNjb3BlOiBhbnksIHVuaXRTZXJ2aWNlOiBJVW5pdFNlcnZpY2UsICRxOiBhbnksICR0aW1lb3V0OiBhbnksIGFyZWFTZXJ2aWNlOiBJQXJlYVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbihcIiRkZXN0cm95XCIsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+WMluWPguaVsCwg5LuOcGFyZW50U2NvcGXkuK3ojrflj5bliLDlj4LmlbBcclxuICAgICAgICB2YXIgdm0gPSB0aGlzOyAvLyDkvb/nlKh0aGlz5pu/5LujJHNjb3BlXHJcbiAgICAgICAgdm0uY3VyZFR5cGUgPSAkc2NvcGUuY3VyZFR5cGU7XHJcbiAgICAgICAgdm0uVW5pdCA9IHt9IGFzIFVuaXRFeDtcclxuXHJcbiAgICAgICAgdm0udHJlZVBhcmFtcyA9IG5ldyBUcmVlRGF0YVBhcmFtczxBcmVhRXg+KCk7XHJcbiAgICAgICAgdm0udHJlZVBhcmFtcy50cmVlSWQgPSBcInVuaXRQb3B1cEFyZWFUcmVlXCI7XHJcbiAgICAgICAgdm0udHJlZVBhcmFtcy5vbkNsaWNrID0gdHJlZVNlbGVjdE5vZGU7XHJcblxyXG4gICAgICAgIGlmICh2bS5jdXJkVHlwZSA9PT0gJ2FkZCcgJiYgJHNjb3BlLmN1cnJlbnRBcmVhKSB7XHJcbiAgICAgICAgICAgIHZtLlVuaXQuUGFyZW50QXJlYSA9IHt9IGFzIEFyZWE7XHJcbiAgICAgICAgICAgIHZtLlVuaXQuUGFyZW50QXJlYS5JRCA9ICRzY29wZS5jdXJyZW50QXJlYS5JRDtcclxuICAgICAgICAgICAgdm0uVW5pdC5QYXJlbnRBcmVhLk5hbWUgPSAkc2NvcGUuY3VycmVudEFyZWEuTmFtZTtcclxuICAgICAgICAgICAgdm0uc3VibWl0ID0gc2F2ZVVuaXQ7XHJcblxyXG4gICAgICAgICAgICAvLyDmn6Xor6LmoJHnu5PngrnmlbDmja7lho3liJ3lp4vljJZcclxuICAgICAgICAgICAgYXJlYVNlcnZpY2UuZmluZExpc3RUcmVlKCkudGhlbigoZGF0YXM6IEFycmF5PEFyZWFFeD4pPT4ge1xyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoKCk9PntcclxuICAgICAgICAgICAgICAgICAgICB2bS50cmVlUGFyYW1zLnRyZWVEYXRhcyA9IGRhdGFzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnRyZWVQYXJhbXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHZtLlVuaXQuUGFyZW50QXJlYS5JRDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmICh2bS5jdXJkVHlwZSA9PT0gJ2VkaXQnICYmICRzY29wZS5jdXJyZW50VW5pdCkge1xyXG4gICAgICAgICAgICB2bS5zdWJtaXQgPSBlZGl0VW5pdDtcclxuXHJcbiAgICAgICAgICAgICRxLmFsbChbdW5pdFNlcnZpY2UuZ2V0KCRzY29wZS5jdXJyZW50VW5pdC5JRCksIGFyZWFTZXJ2aWNlLmZpbmRMaXN0VHJlZSgpXSlcclxuICAgICAgICAgICAgICAgIC50aGVuKChyZXM6IFtSZXNwb25zZVJlc3VsdDxVbml0RXg+LCBBcnJheTxBcmVhRXg+XSk9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByMCA9IHJlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcjEgPSByZXNbMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHIwLmNvZGUgIT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocjAuY29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dCgoKT0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIwLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLlVuaXQgPSByMC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udHJlZVBhcmFtcy50cmVlRGF0YXMgPSByMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5Vbml0ICYmIHZtLlVuaXQuUGFyZW50QXJlYSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRyZWVQYXJhbXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHZtLlVuaXQuUGFyZW50QXJlYS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsQXJlYVBvcHVwO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0cmVlU2VsZWN0Tm9kZShldmVudDogTW91c2VFdmVudCwgdHJlZUlkOiBzdHJpbmcsIHRyZWVOb2RlOiBBcmVhRXgpe1xyXG4gICAgICAgICAgICAkdGltZW91dCgoKT0+e1xyXG4gICAgICAgICAgICAgICAgdm0uVW5pdC5QYXJlbnRBcmVhID0gdHJlZU5vZGU7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1Nob3dBcmVhVHJlZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZVVuaXQoKSB7XHJcbiAgICAgICAgICAgIGlmICghdmFsaWRhdGUoKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdW5pdFNlcnZpY2Uuc2F2ZSh2bS5Vbml0KS50aGVuKGNvbXBsZXRlKS50aGVuKGNsb3NlUG9wdXApO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGUocmVzOiBSZXNwb25zZVJlc3VsdDxzdHJpbmc+KSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXMuY29kZSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICAvLyDosIPnlKjlhbPpl63nqpflj6Pkuovku7ZcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzLmNvZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBvcHVwKCl7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3VuaXQuY2xvc2VQb3B1cCcsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBlZGl0VW5pdCgpIHtcclxuICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZSgpKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB1bml0U2VydmljZS5lZGl0KHZtLlVuaXQpLnRoZW4oY29tcGxldGUpLnRoZW4oY2xvc2VQb3B1cCk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZShyZXM6IFJlc3BvbnNlUmVzdWx0PHN0cmluZz4pe1xyXG4gICAgICAgICAgICAgICAgaWYocmVzLmNvZGUgPT09IDIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlcy5jb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VQb3B1cCgpe1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1bml0LmNsb3NlUG9wdXAnLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKCkge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYoIXZtLlVuaXQuQ29kZSl7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfWVsc2UgaWYoIXZtLlVuaXQuTmFtZSl7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsQXJlYVBvcHVwKCkge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3VuaXQuY2xvc2VQb3B1cCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuYXBwXHJcbiAgICAuY29udHJvbGxlcigndW5pdFBvcHVwQ29udHJvbGxlcicsIFVuaXRQb3B1cENvbnRyb2xsZXIpOyJdfQ==

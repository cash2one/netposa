define(["require", "exports", "../../common/app/main.app", "../../common/directive/tree/tree-params", "../../../core/enum/TreeType", "../../../core/enum/ObjectType", "../../common/directive/tree/tree.directive.service", "../../common/services/connectTree.service", "../../common/factory/layerMsg.factory"], function (require, exports, main_app_1, tree_params_1, TreeType_1, ObjectType_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var CameraPopupController = (function () {
        function CameraPopupController($scope, areaService, $timeout, cameraService, treeService, connectTreeService, layerDec) {
            this.$scope = $scope;
            this.areaService = areaService;
            this.$timeout = $timeout;
            this.cameraService = cameraService;
            this.treeService = treeService;
            this.connectTreeService = connectTreeService;
            this.layerDec = layerDec;
            this.cacheChangeNodes = {};
            this.type = $scope.type;
            this.rightSelectTreeNodeId = null;
            this.initTreeParams();
            this.getLeftTreeData();
            this.getRightTreeData();
        }
        CameraPopupController.prototype.initTreeParams = function () {
            var _this = this;
            this.leftTreeParams = new tree_params_1.TreeDataParams(true);
            this.leftTreeParams.treeId = "devicePopupLeftTree";
            this.leftTreeParams.isShowIcon = true;
            this.leftTreeParams.isShowLine = false;
            this.leftTreeParams.isSimpleData = true;
            this.leftTreeParams.checkEnable = false;
            this.leftTreeParams.isSingleSelect = false;
            this.leftTreeParams.editEnable = true;
            this.leftTreeParams.showRemoveBtn = false;
            this.leftTreeParams.showRenameBtn = false;
            this.leftTreeParams.beforeDrop = beforeDropRule;
            this.leftTreeParams.beforeDrag = beforeDragRule;
            if (this.type === TreeType_1.TreeType.lamp.value) {
                this.leftTreeParams.addDiyDom = function (treeId, treeNode) {
                    _this.treeService.addDiyDomIsConfiStatus(treeId, treeNode);
                };
            }
            this.rightTreeParams = new tree_params_1.TreeDataParams(true);
            this.rightTreeParams.treeId = "devicePopupRightTree";
            this.rightTreeParams.isShowIcon = true;
            this.rightTreeParams.isShowLine = false;
            this.rightTreeParams.isSimpleData = true;
            this.rightTreeParams.checkEnable = false;
            this.rightTreeParams.isSingleSelect = false;
            this.rightTreeParams.editEnable = true;
            this.rightTreeParams.showRemoveBtn = false;
            this.rightTreeParams.showRenameBtn = false;
            this.rightTreeParams.beforeDrop = beforeDropRule;
            this.rightTreeParams.beforeDrag = beforeDragRule;
            var _self = this;
            function beforeDropRule(treeId, treeNodes, targetNode) {
                if (treeId == _self.leftTreeParams.treeId) {
                    return false;
                }
                if (_self.type === TreeType_1.TreeType.lamp.value && targetNode.treeType !== TreeType_1.TreeType.lamp.value) {
                    return false;
                }
                if (_self.type === TreeType_1.TreeType.area.value && targetNode.treeType !== TreeType_1.TreeType.area.value) {
                    return false;
                }
                var newNodeList = [];
                var updateNodeList = [];
                treeNodes.forEach(function (item) {
                    item.isConfigLamp = true;
                    item.ParentID = targetNode.ID;
                    var node = _self.treeService.getNodeByParam(treeId, 'ID', item.ID);
                    if (node) {
                        updateNodeList.push(item);
                    }
                    else {
                        newNodeList.push(item);
                    }
                });
                if (updateNodeList.length > 0) {
                    _self.$timeout(function () {
                        _self.treeService.removeNodes(treeId, updateNodeList);
                        _self.treeService.addNodes(treeId, updateNodeList, targetNode);
                    });
                }
                if (newNodeList.length > 0) {
                    _self.treeService.addNodes(treeId, newNodeList, targetNode);
                }
                if (_self.type === TreeType_1.TreeType.lamp.value) {
                    _self.updateTreeDiyDom(treeId, treeNodes);
                }
                _self.changeNodesParentID(treeNodes, targetNode.ID);
                return false;
            }
            function beforeDragRule(treeId, treeNodes) {
                var flag = true;
                if (treeNodes && treeNodes.length > 0) {
                    var i = void 0, len = void 0, treeType = TreeType_1.TreeType.camera.value;
                    for (i = 0, len = treeNodes.length; i < len; i++) {
                        if (treeNodes[i].treeType !== treeType) {
                            flag = false;
                            break;
                        }
                    }
                }
                else {
                    flag = false;
                }
                return flag;
            }
        };
        CameraPopupController.prototype.updateTreeDiyDom = function (treeId, treeNodes) {
            var _this = this;
            this.$timeout(function () {
                treeNodes.forEach(function (item) {
                    console.log(item);
                    _this.leftTreeParams.addDiyDom(treeId, item);
                });
            });
        };
        CameraPopupController.prototype.changeNodesParentID = function (treeNodes, parentId) {
            if (!treeNodes || treeNodes.length <= 0)
                return;
            var i, len, temp, originParentId;
            for (i = 0, len = treeNodes.length; i < len; i++) {
                if (this.type === TreeType_1.TreeType.area.value) {
                    temp = treeNodes[i];
                    originParentId = temp.AreaID;
                    temp.ParentID = parentId;
                    temp.AreaID = parentId;
                }
                else if (this.type === TreeType_1.TreeType.lamp.value) {
                    temp = treeNodes[i];
                    if (!temp.JsonUserData.lampPost) {
                        var lampPost = {};
                        lampPost.ObjectId = parentId;
                        lampPost.ObjectType = ObjectType_1.ObjectType.LampPost.value;
                        lampPost.RelatedObjectId = temp.ID;
                        lampPost.RelatedObjectType = ObjectType_1.ObjectType.Camera.value;
                        temp.JsonUserData.lampPost = lampPost;
                        originParentId = "";
                        temp.ParentID = parentId;
                    }
                    else {
                        originParentId = temp.JsonUserData.lampPost.ID;
                        temp.ParentID = parentId;
                        temp.JsonUserData.lampPost.ID = parentId;
                    }
                }
                this.addOrUpdateTreeChangeCache({
                    id: temp.ID,
                    parentId: temp.ParentID,
                    originParentId: originParentId,
                    deviceReId: temp.JsonUserData.DeviceReId
                });
            }
        };
        CameraPopupController.prototype.addOrUpdateTreeChangeCache = function (model) {
            if (this.cacheChangeNodes[model.id]) {
                this.cacheChangeNodes[model.id].parentId = model.parentId;
            }
            else {
                this.cacheChangeNodes[model.id] = model;
            }
        };
        CameraPopupController.prototype.submit = function () {
            var _this = this;
            var key, temp, models = [], P;
            if (this.type === 'area') {
                for (key in this.cacheChangeNodes) {
                    temp = this.cacheChangeNodes[key];
                    models.push({ id: temp.id, areaId: temp.parentId });
                }
                if (models.length > 0) {
                    P = this.cameraService.updateCameraAreaID(models);
                }
                else {
                    this.layerDec.warnInfo("没有选择任何区域");
                    this.cancel(false);
                }
            }
            else {
                for (key in this.cacheChangeNodes) {
                    temp = this.cacheChangeNodes[key];
                    models.push({
                        id: temp.id,
                        lampId: temp.parentId,
                        deviceReId: temp.deviceReId
                    });
                }
                if (models.length > 0) {
                    P = this.cameraService.updateCameraLampID(models);
                }
                else {
                    this.layerDec.warnInfo("没有选择任何立杆");
                    this.cancel(false);
                }
            }
            if (P) {
                P.then(function (res) {
                    if (res && res.code === 200) {
                        _this.cancel(true);
                    }
                    else {
                        console.error("cameraService.updateRmpGateAreaID error", res);
                    }
                });
            }
        };
        CameraPopupController.prototype.cancel = function (flag) {
            this.$scope.$emit('device.closePopup', flag);
        };
        CameraPopupController.prototype.getLeftTreeData = function () {
            var _this = this;
            this.cameraService.findAll().then(function (res) {
                _this.$timeout(function () {
                    _this.leftTreeParams.treeDatas = res;
                });
            });
        };
        CameraPopupController.prototype.getRightTreeData = function () {
            var _this = this;
            var P;
            if (this.type === 'lamp') {
                P = this.connectTreeService.findLampTreeWithCamera();
            }
            else {
                P = this.connectTreeService.findAreaCamera();
            }
            P.then(function (datas) {
                _this.$timeout(function () {
                    _this.rightTreeParams.treeDatas = datas;
                });
            });
        };
        CameraPopupController.$inject = ['$scope', 'areaService', '$timeout', 'cameraService', 'treeDirectiveService', 'connectTreeService', 'layerDec'];
        return CameraPopupController;
    }());
    main_app_1.app.controller("baseConfigCameraPopup", CameraPopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9jYW1lcmEvY2FtZXJhLnBvcHVwQ2FtZXJhLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBdUNBO1FBUUksK0JBQW9CLE1BQVcsRUFBVSxXQUF5QixFQUM5QyxRQUFhLEVBQVUsYUFBNkIsRUFDcEQsV0FBa0MsRUFDbEMsa0JBQXVDLEVBQ3ZDLFFBQW1CO1lBSm5CLFdBQU0sR0FBTixNQUFNLENBQUs7WUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBYztZQUM5QyxhQUFRLEdBQVIsUUFBUSxDQUFLO1lBQVUsa0JBQWEsR0FBYixhQUFhLENBQWdCO1lBQ3BELGdCQUFXLEdBQVgsV0FBVyxDQUF1QjtZQUNsQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQXFCO1lBQ3ZDLGFBQVEsR0FBUixRQUFRLENBQVc7WUFOdkMscUJBQWdCLEdBQUcsRUFBMkIsQ0FBQztZQU8zQyxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDeEIsSUFBSSxDQUFDLHFCQUFxQixHQUFHLElBQUksQ0FBQztZQUNsQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQzVCLENBQUM7UUFFTyw4Q0FBYyxHQUF0QjtZQUFBLGlCQTBGQztZQXpGRyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksNEJBQWMsQ0FBNkIsSUFBSSxDQUFDLENBQUM7WUFDM0UsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcscUJBQXFCLENBQUM7WUFDbkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztZQUN2QyxJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDeEMsSUFB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QztnQkFDeEMsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUM7UUFFTyxnREFBZ0IsR0FBeEI7WUFBQSxpQkFhQztZQVpHLElBQUksQ0FBTSxDQUFDO1lBQ1gsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixDQUFDLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLHNCQUFzQixFQUFFLENBQUE7WUFDeEQsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLENBQUMsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsY0FBYyxFQUFFLENBQUE7WUFDaEQsQ0FBQztZQUVELENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxLQUFpQjtnQkFDckIsS0FBSSxDQUFDLFFBQVEsQ0FBQztvQkFDVixLQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7Z0JBQzNDLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDO1FBNU9NLDZCQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsc0JBQXNCLEVBQUUsb0JBQW9CLEVBQUUsVUFBVSxDQUFDLENBQUM7UUE2T3RJLDRCQUFDO0tBOU9ELEFBOE9DLElBQUE7SUFFRCxjQUFHLENBQUMsVUFBVSxDQUFDLHVCQUF1QixFQUFFLHFCQUFxQixDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlL2Jhc2Vjb25maWcvY2FtZXJhL2NhbWVyYS5wb3B1cENhbWVyYS5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHthcHB9IGZyb20gXCIuLi8uLi9jb21tb24vYXBwL21haW4uYXBwXCI7XHJcbmltcG9ydCB7VHJlZURhdGFQYXJhbXN9IGZyb20gXCIuLi8uLi9jb21tb24vZGlyZWN0aXZlL3RyZWUvdHJlZS1wYXJhbXNcIjtcclxuaW1wb3J0IHtDYW1lcmF9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9DYW1lcmFcIjtcclxuaW1wb3J0IHtJQXJlYVNlcnZpY2V9IGZyb20gXCIuLi8uLi9jb21tb24vc2VydmljZXMvYXJlYS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7Q2FtZXJhRXh9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9DYW1lcmFFeFwiO1xyXG5pbXBvcnQge0FyZWFFeH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L0FyZWFFeFwiO1xyXG5pbXBvcnQge0xhbXBFeH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L0xhbXBFeFwiO1xyXG5pbXBvcnQge0lDYW1lcmFTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2NhbWVyYS5zZXJ2aWNlXCI7XHJcbmltcG9ydCBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdHJlZS90cmVlLmRpcmVjdGl2ZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7SVRyZWVEaXJlY3RpdmVTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUuZGlyZWN0aXZlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtDYW1lcmFDaGFuZ2VBcmVhSURNb2RlbH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL0NhbWVyYVBhcmFtc1wiO1xyXG5pbXBvcnQge1Jlc3BvbnNlUmVzdWx0fSBmcm9tIFwiLi4vLi4vLi4vY29yZS9wYXJhbXMvcmVzdWx0L1Jlc3BvbnNlUmVzdWx0XCI7XHJcbmltcG9ydCB7VHJlZVR5cGV9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudW0vVHJlZVR5cGVcIjtcclxuaW1wb3J0IHtJQ29ubmVjdFRyZWVTZXJ2aWNlfSBmcm9tIFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2Nvbm5lY3RUcmVlLnNlcnZpY2VcIjtcclxuaW1wb3J0IFwiLi4vLi4vY29tbW9uL3NlcnZpY2VzL2Nvbm5lY3RUcmVlLnNlcnZpY2VcIjtcclxuLyoqXHJcbiAqIENyZWF0ZWQgYnkgZGVsbCBvbiAyMDE3LzUvOS5cclxuICovXHJcbmltcG9ydCB7UmVsYXRpb259IGZyb20gJy4uLy4uLy4uL2NvcmUvZW50aXR5L0RldmljZVJlbGF0aW9uJztcclxuaW1wb3J0IHtPYmplY3RUeXBlfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9lbnVtL09iamVjdFR5cGVcIjtcclxuaW1wb3J0IHtJTGF5ZXJEZWN9IGZyb20gXCIuLi8uLi9jb21tb24vZmFjdG9yeS9sYXllck1zZy5mYWN0b3J5XCI7XHJcbmltcG9ydCBcIi4uLy4uL2NvbW1vbi9mYWN0b3J5L2xheWVyTXNnLmZhY3RvcnlcIjtcclxuXHJcbmRlY2xhcmUgbGV0IGFuZ3VsYXI6IGFueTtcclxuXHJcbnR5cGUgQXJlYUNhbWVyYUV4ID0gQXJlYUV4ICYgQ2FtZXJhRXg7XHJcblxyXG5pbnRlcmZhY2UgQXJlYUlEQ2FjaGVNb2RlbCB7XHJcbiAgICBpZDogc3RyaW5nO1xyXG4gICAgcGFyZW50SWQ6IHN0cmluZztcclxuICAgIG9yaWdpblBhcmVudElkOiBzdHJpbmc7XHJcbiAgICBkZXZpY2VSZUlkPzogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQXJlYUlEQ2FjaGVDb2xsZWN0aW9uIHtcclxuICAgIFtrZXk6IHN0cmluZ106IEFyZWFJRENhY2hlTW9kZWw7XHJcbn1cclxuXHJcblxyXG5jbGFzcyBDYW1lcmFQb3B1cENvbnRyb2xsZXIge1xyXG4gICAgc3RhdGljICRpbmplY3QgPSBbJyRzY29wZScsICdhcmVhU2VydmljZScsICckdGltZW91dCcsICdjYW1lcmFTZXJ2aWNlJywgJ3RyZWVEaXJlY3RpdmVTZXJ2aWNlJywgJ2Nvbm5lY3RUcmVlU2VydmljZScsICdsYXllckRlYyddO1xyXG4gICAgcmlnaHRTZWxlY3RUcmVlTm9kZUlkOiBzdHJpbmc7XHJcbiAgICBsZWZ0VHJlZVBhcmFtczogVHJlZURhdGFQYXJhbXM8Q2FtZXJhPjtcclxuICAgIHJpZ2h0VHJlZVBhcmFtczogVHJlZURhdGFQYXJhbXM8YW55PjtcclxuICAgIHR5cGU6IHN0cmluZztcclxuICAgIGNhY2hlQ2hhbmdlTm9kZXMgPSB7fSBhcyBBcmVhSURDYWNoZUNvbGxlY3Rpb247XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkc2NvcGU6IGFueSwgcHJpdmF0ZSBhcmVhU2VydmljZTogSUFyZWFTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSAkdGltZW91dDogYW55LCBwcml2YXRlIGNhbWVyYVNlcnZpY2U6IElDYW1lcmFTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0cmVlU2VydmljZTogSVRyZWVEaXJlY3RpdmVTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBjb25uZWN0VHJlZVNlcnZpY2U6IElDb25uZWN0VHJlZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxheWVyRGVjOiBJTGF5ZXJEZWMpIHtcclxuICAgICAgICB0aGlzLnR5cGUgPSAkc2NvcGUudHlwZTtcclxuICAgICAgICB0aGlzLnJpZ2h0U2VsZWN0VHJlZU5vZGVJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pbml0VHJlZVBhcmFtcygpO1xyXG4gICAgICAgIHRoaXMuZ2V0TGVmdFRyZWVEYXRhKCk7XHJcbiAgICAgICAgdGhpcy5nZXRSaWdodFRyZWVEYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0VHJlZVBhcmFtcygpIHtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zID0gbmV3IFRyZWVEYXRhUGFyYW1zPExhbXBFeCAmIEFyZWFFeCAmIENhbWVyYUV4Pih0cnVlKTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnRyZWVJZCA9IFwiZGV2aWNlUG9wdXBMZWZ0VHJlZVwiO1xyXG4gICAgICAgIHRoaXMubGVmdFRyZWVQYXJhbXMuaXNTaG93SWNvbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5pc1Nob3dMaW5lID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5pc1NpbXBsZURhdGEgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMubGVmdFRyZWVQYXJhbXMuY2hlY2tFbmFibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmlzU2luZ2xlU2VsZWN0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sZWZ0VHJlZVBhcmFtcy5lZGl0RW5hYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnNob3dSZW1vdmVCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnNob3dSZW5hbWVCdG4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmJlZm9yZURyb3AgPSBiZWZvcmVEcm9wUnVsZTtcclxuICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmJlZm9yZURyYWcgPSBiZWZvcmVEcmFnUnVsZTtcclxuICAgICAgICBpZih0aGlzLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUpe1xyXG4gICAgICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmFkZERpeURvbSA9ICh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmVlU2VydmljZS5hZGREaXlEb21Jc0NvbmZpU3RhdHVzKHRyZWVJZCwgdHJlZU5vZGUpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zID0gbmV3IFRyZWVEYXRhUGFyYW1zPEFyZWFDYW1lcmFFeD4odHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMudHJlZUlkID0gXCJkZXZpY2VQb3B1cFJpZ2h0VHJlZVwiO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmlzU2hvd0ljb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmlzU2hvd0xpbmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5pc1NpbXBsZURhdGEgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmNoZWNrRW5hYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuaXNTaW5nbGVTZWxlY3QgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5lZGl0RW5hYmxlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5zaG93UmVtb3ZlQnRuID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5yaWdodFRyZWVQYXJhbXMuc2hvd1JlbmFtZUJ0biA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLmJlZm9yZURyb3AgPSBiZWZvcmVEcm9wUnVsZTtcclxuICAgICAgICB0aGlzLnJpZ2h0VHJlZVBhcmFtcy5iZWZvcmVEcmFnID0gYmVmb3JlRHJhZ1J1bGU7XHJcbiAgICAgICAgbGV0IF9zZWxmID0gdGhpcyBhcyBDYW1lcmFQb3B1cENvbnRyb2xsZXI7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGJlZm9yZURyb3BSdWxlKHRyZWVJZDogc3RyaW5nLCB0cmVlTm9kZXM6IEFycmF5PENhbWVyYUV4PiwgdGFyZ2V0Tm9kZTogTGFtcEV4ICYgQXJlYUV4ICYgQ2FtZXJhRXgpOiBib29sZWFuIHtcclxuICAgICAgICAgICAgaWYgKHRyZWVJZCA9PSBfc2VsZi5sZWZ0VHJlZVBhcmFtcy50cmVlSWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKF9zZWxmLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUgJiYgdGFyZ2V0Tm9kZS50cmVlVHlwZSAhPT0gVHJlZVR5cGUubGFtcC52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChfc2VsZi50eXBlID09PSBUcmVlVHlwZS5hcmVhLnZhbHVlICYmIHRhcmdldE5vZGUudHJlZVR5cGUgIT09IFRyZWVUeXBlLmFyZWEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IG5ld05vZGVMaXN0ID0gW10gYXMgQXJyYXk8Q2FtZXJhRXg+O1xyXG4gICAgICAgICAgICBsZXQgdXBkYXRlTm9kZUxpc3QgPSBbXSBhcyBBcnJheTxDYW1lcmFFeD47XHJcbiAgICAgICAgICAgIHRyZWVOb2Rlcy5mb3JFYWNoKChpdGVtOiBDYW1lcmFFeCB8IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5pc0NvbmZpZ0xhbXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5QYXJlbnRJRCA9IHRhcmdldE5vZGUuSUQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IF9zZWxmLnRyZWVTZXJ2aWNlLmdldE5vZGVCeVBhcmFtKHRyZWVJZCwgJ0lEJywgaXRlbS5JRCkgYXMgQ2FtZXJhRXg7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU5vZGVMaXN0LnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3Tm9kZUxpc3QucHVzaChpdGVtKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKHVwZGF0ZU5vZGVMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIF9zZWxmLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfc2VsZi50cmVlU2VydmljZS5yZW1vdmVOb2Rlcyh0cmVlSWQsIHVwZGF0ZU5vZGVMaXN0KTtcclxuICAgICAgICAgICAgICAgICAgICBfc2VsZi50cmVlU2VydmljZS5hZGROb2Rlcyh0cmVlSWQsIHVwZGF0ZU5vZGVMaXN0LCB0YXJnZXROb2RlKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5ld05vZGVMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIF9zZWxmLnRyZWVTZXJ2aWNlLmFkZE5vZGVzKHRyZWVJZCwgbmV3Tm9kZUxpc3QsIHRhcmdldE5vZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKF9zZWxmLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgX3NlbGYudXBkYXRlVHJlZURpeURvbSh0cmVlSWQsIHRyZWVOb2Rlcyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIF9zZWxmLmNoYW5nZU5vZGVzUGFyZW50SUQodHJlZU5vZGVzLCB0YXJnZXROb2RlLklEKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBiZWZvcmVEcmFnUnVsZSh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGVzOiBBcnJheTxDYW1lcmFFeD4pIHtcclxuICAgICAgICAgICAgbGV0IGZsYWcgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodHJlZU5vZGVzICYmIHRyZWVOb2Rlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSwgbGVuLCB0cmVlVHlwZSA9IFRyZWVUeXBlLmNhbWVyYS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHRyZWVOb2Rlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmVlTm9kZXNbaV0udHJlZVR5cGUgIT09IHRyZWVUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmbGFnO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBkZXNjIOaJuemHj+WOu+abtOaWsGRpeURvbeeKtuaAgVxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHRyZWVJZFxyXG4gICAgICogQHBhcmFtIHtBcnJheTxhbnk+fSB0cmVlTm9kZXNcclxuICAgICAqL1xyXG4gICAgdXBkYXRlVHJlZURpeURvbSh0cmVlSWQ6IHN0cmluZywgdHJlZU5vZGVzOiBBcnJheTxhbnk+KSB7XHJcbiAgICAgICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRyZWVOb2Rlcy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGl0ZW0pXHJcbiAgICAgICAgICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLmFkZERpeURvbSh0cmVlSWQsIGl0ZW0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGFuZ2VOb2Rlc1BhcmVudElEKHRyZWVOb2RlczogYW55LCBwYXJlbnRJZDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKCF0cmVlTm9kZXMgfHwgdHJlZU5vZGVzLmxlbmd0aCA8PSAwKSByZXR1cm47XHJcbiAgICAgICAgbGV0IGksIGxlbiwgdGVtcCwgb3JpZ2luUGFyZW50SWQ7XHJcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gdHJlZU5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09IFRyZWVUeXBlLmFyZWEudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRlbXAgPSB0cmVlTm9kZXNbaV07XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5QYXJlbnRJZCA9IHRlbXAuQXJlYUlEO1xyXG4gICAgICAgICAgICAgICAgdGVtcC5QYXJlbnRJRCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICAgICAgdGVtcC5BcmVhSUQgPSBwYXJlbnRJZDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPT09IFRyZWVUeXBlLmxhbXAudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRlbXAgPSB0cmVlTm9kZXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRlbXAuSnNvblVzZXJEYXRhLmxhbXBQb3N0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxhbXBQb3N0ID0ge30gYXMgUmVsYXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgbGFtcFBvc3QuT2JqZWN0SWQgPSBwYXJlbnRJZDtcclxuICAgICAgICAgICAgICAgICAgICBsYW1wUG9zdC5PYmplY3RUeXBlID0gT2JqZWN0VHlwZS5MYW1wUG9zdC52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBsYW1wUG9zdC5SZWxhdGVkT2JqZWN0SWQgPSB0ZW1wLklEO1xyXG4gICAgICAgICAgICAgICAgICAgIGxhbXBQb3N0LlJlbGF0ZWRPYmplY3RUeXBlID0gT2JqZWN0VHlwZS5DYW1lcmEudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5Kc29uVXNlckRhdGEubGFtcFBvc3QgPSBsYW1wUG9zdDtcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5QYXJlbnRJZCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcC5QYXJlbnRJRCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5QYXJlbnRJZCA9IHRlbXAuSnNvblVzZXJEYXRhLmxhbXBQb3N0LklEO1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXAuUGFyZW50SUQgPSBwYXJlbnRJZDtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wLkpzb25Vc2VyRGF0YS5sYW1wUG9zdC5JRCA9IHBhcmVudElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5hZGRPclVwZGF0ZVRyZWVDaGFuZ2VDYWNoZSh7XHJcbiAgICAgICAgICAgICAgICBpZDogdGVtcC5JRCxcclxuICAgICAgICAgICAgICAgIHBhcmVudElkOiB0ZW1wLlBhcmVudElELFxyXG4gICAgICAgICAgICAgICAgb3JpZ2luUGFyZW50SWQ6IG9yaWdpblBhcmVudElkLFxyXG4gICAgICAgICAgICAgICAgZGV2aWNlUmVJZDogdGVtcC5Kc29uVXNlckRhdGEuRGV2aWNlUmVJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhZGRPclVwZGF0ZVRyZWVDaGFuZ2VDYWNoZShtb2RlbDogQXJlYUlEQ2FjaGVNb2RlbCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlQ2hhbmdlTm9kZXNbbW9kZWwuaWRdKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVDaGFuZ2VOb2Rlc1ttb2RlbC5pZF0ucGFyZW50SWQgPSBtb2RlbC5wYXJlbnRJZDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlQ2hhbmdlTm9kZXNbbW9kZWwuaWRdID0gbW9kZWw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN1Ym1pdCgpIHtcclxuICAgICAgICBsZXQga2V5LCB0ZW1wLCBtb2RlbHMgPSBbXSBhcyBBcnJheTxDYW1lcmFDaGFuZ2VBcmVhSURNb2RlbD4sIFA6IGFueTtcclxuICAgICAgICBpZiAodGhpcy50eXBlID09PSAnYXJlYScpIHtcclxuICAgICAgICAgICAgZm9yIChrZXkgaW4gdGhpcy5jYWNoZUNoYW5nZU5vZGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wID0gdGhpcy5jYWNoZUNoYW5nZU5vZGVzW2tleV07XHJcbiAgICAgICAgICAgICAgICBtb2RlbHMucHVzaCh7aWQ6IHRlbXAuaWQsIGFyZWFJZDogdGVtcC5wYXJlbnRJZH0gYXMgQ2FtZXJhQ2hhbmdlQXJlYUlETW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtb2RlbHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgUCA9IHRoaXMuY2FtZXJhU2VydmljZS51cGRhdGVDYW1lcmFBcmVhSUQobW9kZWxzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJEZWMud2FybkluZm8oXCLmsqHmnInpgInmi6nku7vkvZXljLrln59cIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbChmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGtleSBpbiB0aGlzLmNhY2hlQ2hhbmdlTm9kZXMpIHtcclxuICAgICAgICAgICAgICAgIHRlbXAgPSB0aGlzLmNhY2hlQ2hhbmdlTm9kZXNba2V5XTtcclxuICAgICAgICAgICAgICAgIG1vZGVscy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogdGVtcC5pZCxcclxuICAgICAgICAgICAgICAgICAgICBsYW1wSWQ6IHRlbXAucGFyZW50SWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlUmVJZDogdGVtcC5kZXZpY2VSZUlkXHJcbiAgICAgICAgICAgICAgICB9IGFzIENhbWVyYUNoYW5nZUFyZWFJRE1vZGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobW9kZWxzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIFAgPSB0aGlzLmNhbWVyYVNlcnZpY2UudXBkYXRlQ2FtZXJhTGFtcElEKG1vZGVscyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyRGVjLndhcm5JbmZvKFwi5rKh5pyJ6YCJ5oup5Lu75L2V56uL5p2GXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChQKSB7XHJcbiAgICAgICAgICAgIFAudGhlbigocmVzOiBSZXNwb25zZVJlc3VsdDxib29sZWFuPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJjYW1lcmFTZXJ2aWNlLnVwZGF0ZVJtcEdhdGVBcmVhSUQgZXJyb3JcIiwgcmVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbChmbGFnPzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuJHNjb3BlLiRlbWl0KCdkZXZpY2UuY2xvc2VQb3B1cCcsIGZsYWcpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TGVmdFRyZWVEYXRhKCkge1xyXG4gICAgICAgIHRoaXMuY2FtZXJhU2VydmljZS5maW5kQWxsKCkudGhlbigocmVzOiBBcnJheTxDYW1lcmFFeD4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxlZnRUcmVlUGFyYW1zLnRyZWVEYXRhcyA9IHJlcztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSaWdodFRyZWVEYXRhKCkge1xyXG4gICAgICAgIGxldCBQOiBhbnk7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ2xhbXAnKSB7XHJcbiAgICAgICAgICAgIFAgPSB0aGlzLmNvbm5lY3RUcmVlU2VydmljZS5maW5kTGFtcFRyZWVXaXRoQ2FtZXJhKClcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBQID0gdGhpcy5jb25uZWN0VHJlZVNlcnZpY2UuZmluZEFyZWFDYW1lcmEoKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgUC50aGVuKChkYXRhczogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmlnaHRUcmVlUGFyYW1zLnRyZWVEYXRhcyA9IGRhdGFzO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG59XHJcblxyXG5hcHAuY29udHJvbGxlcihcImJhc2VDb25maWdDYW1lcmFQb3B1cFwiLCBDYW1lcmFQb3B1cENvbnRyb2xsZXIpOyJdfQ==

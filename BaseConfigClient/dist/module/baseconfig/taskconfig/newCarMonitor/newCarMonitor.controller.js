define(["require", "exports", "text!../../eventRule/eventRule.popup.html", "../../../common/app/main.app", "../../../../core/server/TaskModel", "../../../../core/server/enum/AuditStatus", "../../../../core/server/enum/TaskStatus", "../../../../core/server/enum/TaskType", "moment", "../../eventRule/eventRule.popup.controller", "css!../../style/new-car-monitor.css", "../../../common/factory/userinfo.cache.factory", "../../../common/services/task.service", "../../../common/services/user.service"], function (require, exports, eventRuleTpl, main_app_1, TaskModel_1, AuditStatus_1, TaskStatus_1, TaskType_1, moment) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var ICarOptions = (function () {
        function ICarOptions() {
        }
        ICarOptions.BlackList = { value: 'BlackList', text: '黑名单' };
        ICarOptions.WhiteList = { value: 'WhiteList', text: '白名单' };
        return ICarOptions;
    }());
    var CarOptions = [
        ICarOptions.BlackList,
        ICarOptions.WhiteList
    ];
    var CarForColor = [
        { value: '0', text: '白色' },
        { value: '1', text: '黄色' },
        { value: '2', text: '蓝色' },
        { value: '3', text: '黑色' },
        { value: '101', text: '绿色' },
        { value: '4', text: '其他' },
    ];
    var NewCarMonitor = (function () {
        function NewCarMonitor($scope, $state, $stateParams, $timeout, layer, layerDec, userInfoCacheFactory, taskService, userService) {
            var _this = this;
            this.$scope = $scope;
            this.$state = $state;
            this.$stateParams = $stateParams;
            this.$timeout = $timeout;
            this.layer = layer;
            this.layerDec = layerDec;
            this.userInfoCacheFactory = userInfoCacheFactory;
            this.taskService = taskService;
            this.userService = userService;
            this.taskConfigAuditKey = "toolOption.myCheck";
            this.taskCaseModel = true;
            this.CarTaskType = CarOptions;
            this.TaskModel = new TaskModel_1.CarMonitor();
            this.CarForColor = CarForColor;
            this.isWhiteList = false;
            this.setUserAuditList = function () {
                _this.userService.getListByFuncAuthCode(_this.taskConfigAuditKey).then(function (resp) {
                    if (resp && resp.code == 200) {
                        _this.userAuditList = resp.data;
                    }
                    else {
                        _this.userAuditList = [];
                    }
                });
            };
            this.setUserAuditList();
            this.initTaskModel(this.$stateParams.taskId);
            this.$scope.$on('close.eventRule.popup', function (event, isFresh, eventRule) {
                _this.layer.close(_this.layerIndex);
                if (isFresh) {
                    _this.TaskModel.EventRule = eventRule;
                }
            });
        }
        NewCarMonitor.prototype.initTaskModel = function (id) {
            var _this = this;
            if (id) {
                this.taskService.findCarById(id).then(function (res) {
                    if (res.code === 200) {
                        _this.TaskModel = res.data;
                        _this.TaskModel.OperateType = 'Update';
                        _this.TaskModel.ID = _this.$stateParams.taskId;
                        _this.TaskModel.TaskType = TaskType_1.TaskType.CarMonitor.value;
                    }
                });
            }
            else {
                this.TaskModel.AreaID = this.$stateParams.areaId;
                this.TaskModel.TaskType = TaskType_1.TaskType.CarMonitor.value;
                this.TaskModel.OperateType = 'Add';
            }
        };
        NewCarMonitor.prototype.changeMonitorType = function (type) {
            this.isWhiteList = (type === ICarOptions.WhiteList.value);
        };
        NewCarMonitor.prototype.uploadImage = function (event) {
            var _this = this;
            var from = new FormData();
            from.append('image', event.target.files[0]);
            from.append('storeType', 'LOC');
            from.append('imageCategory', 'CaptureImage');
            from.append('commandType', 'SearchAccessLog');
            from.append('detectType', 'Face');
            this.taskService.uploadCarPhoto(from).then(function (res) {
                if (res.code === 200) {
                    _this.$timeout(function () {
                        _this.TaskModel.CarPhoto = res.data;
                    });
                }
            });
        };
        NewCarMonitor.prototype.addEventRule = function () {
            var scope = this.$scope.$new();
            scope.isTask = true;
            scope.eventRule = this.TaskModel.EventRule;
            this.layerIndex = this.layer.open({
                type: 1,
                content: eventRuleTpl,
                scope: scope,
                skin: "no-scroll",
                title: "选择联动策略",
                area: ["780px", "auto"],
                end: function () {
                    scope.$destroy();
                }
            });
        };
        NewCarMonitor.prototype.newTaskSubmit = function () {
            var _this = this;
            if (!this.TaskModel.ListType) {
                return this.layerDec.warnInfo('请选择布控类型！');
            }
            if (!this.TaskModel.PlateColor) {
                return this.layerDec.warnInfo('请选择车牌颜色！');
            }
            if (!this.TaskModel.AuditUser) {
                return this.layerDec.warnInfo('请选择审核人！');
            }
            if (!this.TaskModel.ValidTimeStart && !this.TaskModel.ValidTimeEnd) {
                return this.layerDec.warnInfo('请选择有效时间！');
            }
            if (this.TaskModel.ValidTimeStart >= this.TaskModel.ValidTimeEnd) {
                return this.layerDec.warnInfo('请选择正确的时间范围！');
            }
            if (!this.isWhiteList) {
                if (!this.TaskModel.EventRule) {
                    return this.layerDec.warnInfo('请选择联动策略！');
                }
            }
            this.TaskModel.CreateTime = moment().format('YYYY-MM-DD hh:mm:ss');
            var params = {};
            params.taskModel = this.TaskModel;
            params.eventRule = this.TaskModel.EventRule;
            params.taskModel.CreateUserID = this.userInfoCacheFactory.getCurrentUserId();
            if (params.taskModel.AuditUser === params.taskModel.CreateUserID) {
                params.taskModel.AuditStatus = AuditStatus_1.AuditStatus.Verified.value;
                params.taskModel.Status = TaskStatus_1.TaskStatus.Run.value;
            }
            else {
                params.taskModel.AuditStatus = AuditStatus_1.AuditStatus.Verifing.value;
                params.taskModel.Status = TaskStatus_1.TaskStatus.Waiting.value;
            }
            this.TaskModel.IsLongEffective = false;
            this.TaskModel.TaskType = TaskType_1.TaskType.CarMonitor.value;
            this.taskService.addOrUpdateCarTask(params).then(function (res) {
                if (res.code === 200) {
                    _this.newTaskCancel();
                }
            });
        };
        NewCarMonitor.prototype.newTaskCancel = function () {
            this.$state.go('baseconfig.task');
        };
        NewCarMonitor.$inject = ['$scope', '$state', '$stateParams',
            '$timeout', 'layer',
            'layerDec', 'userInfoCacheFactory', 'taskService', 'userService'];
        return NewCarMonitor;
    }());
    main_app_1.app.controller('newCarMonitor', NewCarMonitor);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy90YXNrY29uZmlnL25ld0Nhck1vbml0b3IvbmV3Q2FyTW9uaXRvci5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztJQXNCQTtRQUFBO1FBR0EsQ0FBQztRQUZVLHFCQUFTLEdBQWUsRUFBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQztRQUMxRCxxQkFBUyxHQUFlLEVBQUMsS0FBSyxFQUFDLFdBQVcsRUFBQyxJQUFJLEVBQUMsS0FBSyxFQUFDLENBQUM7UUFDbEUsa0JBQUM7S0FIRCxBQUdDLElBQUE7SUFDRCxJQUFNLFVBQVUsR0FBdUI7UUFDbkMsV0FBVyxDQUFDLFNBQVM7UUFDckIsV0FBVyxDQUFDLFNBQVM7S0FDeEIsQ0FBQztJQUNGLElBQU0sV0FBVyxHQUFnQjtRQUM3QixFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztRQUN4QixFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztRQUN4QixFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztRQUN4QixFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztRQUN4QixFQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztRQUMxQixFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQztLQUMzQixDQUFDO0lBTUY7UUFhSSx1QkFBb0IsTUFBVyxFQUNYLE1BQVcsRUFDWCxZQUFpQixFQUNqQixRQUFhLEVBQ2IsS0FBVSxFQUNWLFFBQW1CLEVBQ25CLG9CQUEyQyxFQUMzQyxXQUF5QixFQUN6QixXQUF5QjtZQVI3QyxpQkFpQkM7WUFqQm1CLFdBQU0sR0FBTixNQUFNLENBQUs7WUFDWCxXQUFNLEdBQU4sTUFBTSxDQUFLO1lB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QUNsRCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osTUFBTSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEdBQUcseUJBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDO2dCQUMxRCxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyx1QkFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUE7WUFDdEQsQ0FBQztZQUNELElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztZQUN2QyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxtQkFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUM7WUFDcEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxHQUE2QjtnQkFDM0UsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNuQixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7Z0JBQ3hCLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFFRCxxQ0FBYSxHQUFiO1lBQ0ksSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUNyQyxDQUFDO1FBckpNLHFCQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLGNBQWM7WUFDaEQsVUFBVSxFQUFFLE9BQU87WUFDbkIsVUFBVSxFQUFFLHNCQUFzQixFQUFFLGFBQWEsRUFBRSxhQUFhLENBQUMsQ0FBQztRQXFKMUUsb0JBQUM7S0F4SkQsQUF3SkMsSUFBQTtJQUVELGNBQUcsQ0FBQyxVQUFVLENBQUMsZUFBZSxFQUFFLGFBQWEsQ0FBQyxDQUFDIiwiZmlsZSI6Im1vZHVsZS9iYXNlY29uZmlnL3Rhc2tjb25maWcvbmV3Q2FyTW9uaXRvci9uZXdDYXJNb25pdG9yLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPGFtZC1kZXBlbmRlbmN5IHBhdGg9XCJ0ZXh0IS4uLy4uL2V2ZW50UnVsZS9ldmVudFJ1bGUucG9wdXAuaHRtbFwiIG5hbWU9XCJldmVudFJ1bGVUcGxcIiAvPlxyXG5pbXBvcnQgXCIuLi8uLi9ldmVudFJ1bGUvZXZlbnRSdWxlLnBvcHVwLmNvbnRyb2xsZXJcIjtcclxuaW1wb3J0IFwiY3NzIS4uLy4uL3N0eWxlL25ldy1jYXItbW9uaXRvci5jc3NcIjtcclxuaW1wb3J0IHthcHB9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vYXBwL21haW4uYXBwXCI7XHJcblxyXG5pbXBvcnQge0V2ZW50UnVsZUV4fSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnRpdHkvZXgvRXZlbnRSdWxlRXhcIjtcclxuaW1wb3J0IHtFbnVtfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9lbnVtL0VudW1cIjtcclxuaW1wb3J0IHtJVGFza09wdGlvbn0gZnJvbSBcIi4uL21haW4vdGFza0NUeXBlT3B0aW9uc1wiO1xyXG5pbXBvcnQge0Nhck1vbml0b3J9IGZyb20gXCIuLi8uLi8uLi8uLi9jb3JlL3NlcnZlci9UYXNrTW9kZWxcIjtcclxuaW1wb3J0IHtBdWRpdFN0YXR1c30gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvc2VydmVyL2VudW0vQXVkaXRTdGF0dXNcIjtcclxuaW1wb3J0IHtUYXNrU3RhdHVzfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9zZXJ2ZXIvZW51bS9UYXNrU3RhdHVzXCI7XHJcbmltcG9ydCB7SUxheWVyRGVjfSBmcm9tIFwiLi4vLi4vLi4vY29tbW9uL2ZhY3RvcnkvbGF5ZXJNc2cuZmFjdG9yeVwiO1xyXG5pbXBvcnQge0lVc2VySW5mb0NhY2hlRmFjdG9yeX0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9mYWN0b3J5L3VzZXJpbmZvLmNhY2hlLmZhY3RvcnlcIjtcclxuaW1wb3J0IFwiLi4vLi4vLi4vY29tbW9uL2ZhY3RvcnkvdXNlcmluZm8uY2FjaGUuZmFjdG9yeVwiO1xyXG5pbXBvcnQge0lUYXNrU2VydmljZX0gZnJvbSBcIi4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy90YXNrLnNlcnZpY2VcIjtcclxuaW1wb3J0IFwiLi4vLi4vLi4vY29tbW9uL3NlcnZpY2VzL3Rhc2suc2VydmljZVwiO1xyXG5pbXBvcnQge0JhY2tSZXNwb25zZUJvZHksIFJlc3BvbnNlUmVzdWx0fSBmcm9tIFwiLi4vLi4vLi4vLi4vY29yZS9wYXJhbXMvcmVzdWx0L1Jlc3BvbnNlUmVzdWx0XCI7XHJcbmltcG9ydCB7VXNlcn0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvZW50aXR5L1VzZXJcIjtcclxuaW1wb3J0IHtJVXNlclNlcnZpY2V9IGZyb20gXCIuLi8uLi8uLi9jb21tb24vc2VydmljZXMvdXNlci5zZXJ2aWNlXCI7XHJcbmltcG9ydCBcIi4uLy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy91c2VyLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtUYXNrVHlwZX0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvcmUvc2VydmVyL2VudW0vVGFza1R5cGVcIjtcclxuaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudCc7XHJcbmNsYXNzIElDYXJPcHRpb25ze1xyXG4gICAgc3RhdGljIEJsYWNrTGlzdDpJVGFza09wdGlvbiA9IHt2YWx1ZTogJ0JsYWNrTGlzdCcsIHRleHQ6ICfpu5HlkI3ljZUnfTtcclxuICAgIHN0YXRpYyBXaGl0ZUxpc3Q6SVRhc2tPcHRpb24gPSB7dmFsdWU6J1doaXRlTGlzdCcsdGV4dDon55m95ZCN5Y2VJ307XHJcbn1cclxuY29uc3QgQ2FyT3B0aW9uczogQXJyYXk8SVRhc2tPcHRpb24+ID0gW1xyXG4gICAgSUNhck9wdGlvbnMuQmxhY2tMaXN0LFxyXG4gICAgSUNhck9wdGlvbnMuV2hpdGVMaXN0XHJcbl07XHJcbmNvbnN0IENhckZvckNvbG9yOiBBcnJheTxFbnVtPiA9IFtcclxuICAgIHt2YWx1ZTogJzAnLCB0ZXh0OiAn55m96ImyJ30sXHJcbiAgICB7dmFsdWU6ICcxJywgdGV4dDogJ+m7hOiJsid9LFxyXG4gICAge3ZhbHVlOiAnMicsIHRleHQ6ICfok53oibInfSxcclxuICAgIHt2YWx1ZTogJzMnLCB0ZXh0OiAn6buR6ImyJ30sXHJcbiAgICB7dmFsdWU6ICcxMDEnLCB0ZXh0OiAn57u/6ImyJ30sXHJcbiAgICB7dmFsdWU6ICc0JywgdGV4dDogJ+WFtuS7lid9LFxyXG5dO1xyXG5cclxuXHJcbmRlY2xhcmUgbGV0IGV2ZW50UnVsZVRwbDogYW55LCBhbmd1bGFyOiBhbnk7XHJcblxyXG5cclxuY2xhc3MgTmV3Q2FyTW9uaXRvciB7XHJcbiAgICBzdGF0aWMgJGluamVjdCA9IFsnJHNjb3BlJywgJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLFxyXG4gICAgICAgICckdGltZW91dCcsICdsYXllcicsXHJcbiAgICAgICAgJ2xheWVyRGVjJywgJ3VzZXJJbmZvQ2FjaGVGYWN0b3J5JywgJ3Rhc2tTZXJ2aWNlJywgJ3VzZXJTZXJ2aWNlJ107XHJcblxyXG4gICAgdGFza0NvbmZpZ0F1ZGl0S2V5OiBzdHJpbmcgPSBcInRvb2xPcHRpb24ubXlDaGVja1wiO1xyXG4gICAgdGFza0Nhc2VNb2RlbDogYm9vbGVhbiA9IHRydWU7IC8vIHRydWU65paw5bu6IGZhbHNlOue8lui+kVxyXG4gICAgQ2FyVGFza1R5cGU6IEFycmF5PElUYXNrT3B0aW9uPiA9IENhck9wdGlvbnM7XHJcbiAgICBUYXNrTW9kZWw6IENhck1vbml0b3IgPSBuZXcgQ2FyTW9uaXRvcigpO1xyXG4gICAgQ2FyRm9yQ29sb3I6IEFycmF5PEVudW0+ID0gQ2FyRm9yQ29sb3I7XHJcbiAgICB1c2VyQXVkaXRMaXN0OiBBcnJheTxVc2VyPjtcclxuICAgIGlzV2hpdGVMaXN0OmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGxheWVySW5kZXg6bnVtYmVyO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSAkc2NvcGU6IGFueSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgJHN0YXRlOiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlICRzdGF0ZVBhcmFtczogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSAkdGltZW91dDogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsYXllcjogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsYXllckRlYzogSUxheWVyRGVjLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2VySW5mb0NhY2hlRmFjdG9yeTogSVVzZXJJbmZvQ2FjaGVGYWN0b3J5LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB0YXNrU2VydmljZTogSVRhc2tTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSB1c2VyU2VydmljZTogSVVzZXJTZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5zZXRVc2VyQXVkaXRMaXN0KCk7XHJcbiAgICAgICAgdGhpcy5pbml0VGFza01vZGVsKHRoaXMuJHN0YXRlUGFyYW1zLnRhc2tJZCk7XHJcbiAgICAgICAgdGhpcy4kc2NvcGUuJG9uKCdjbG9zZS5ldmVudFJ1bGUucG9wdXAnLCAoZXZlbnQ6IGFueSwgaXNGcmVzaD86IGJvb2xlYW4sIGV2ZW50UnVsZT86IEV2ZW50UnVsZUV4KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubGF5ZXIuY2xvc2UodGhpcy5sYXllckluZGV4KTtcclxuICAgICAgICAgICAgaWYgKGlzRnJlc2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuVGFza01vZGVsLkV2ZW50UnVsZSA9IGV2ZW50UnVsZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRUYXNrTW9kZWwoaWQ/OnN0cmluZykge1xyXG4gICAgICAgIGlmKGlkKXtcclxuICAgICAgICAgICAgdGhpcy50YXNrU2VydmljZS5maW5kQ2FyQnlJZChpZCkudGhlbigocmVzOiBCYWNrUmVzcG9uc2VCb2R5PENhck1vbml0b3I+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXMuY29kZSA9PT0gMjAwKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLlRhc2tNb2RlbCA9IHJlcy5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVGFza01vZGVsLk9wZXJhdGVUeXBlID0gJ1VwZGF0ZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5UYXNrTW9kZWwuSUQgPSB0aGlzLiRzdGF0ZVBhcmFtcy50YXNrSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5UYXNrTW9kZWwuVGFza1R5cGUgPSBUYXNrVHlwZS5DYXJNb25pdG9yLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aGlzLlRhc2tNb2RlbC5BcmVhSUQgPSB0aGlzLiRzdGF0ZVBhcmFtcy5hcmVhSWQ7XHJcbiAgICAgICAgICAgIHRoaXMuVGFza01vZGVsLlRhc2tUeXBlID0gVGFza1R5cGUuQ2FyTW9uaXRvci52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5UYXNrTW9kZWwuT3BlcmF0ZVR5cGUgPSAnQWRkJztcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZU1vbml0b3JUeXBlKHR5cGU6c3RyaW5nKXtcclxuICAgICAgICB0aGlzLmlzV2hpdGVMaXN0ID0gKHR5cGUgPT09IElDYXJPcHRpb25zLldoaXRlTGlzdC52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIGNyZWF0ZSBieSB6eHFcclxuICAgICAqIOiOt+WPluaciSDlrqHmoLjmnYPpmZDnmoQg5Lq65ZGY5YiX6KGoXHJcbiAgICAgKiBAdGltZTogMjAxNy0wNi0xNiAxMDo0NTozNlxyXG4gICAgICogQHJldHVybjogQXJyYXk8VXNlcj5cclxuICAgICAqL1xyXG4gICAgc2V0VXNlckF1ZGl0TGlzdCA9ICgpOiB2b2lkID0+IHtcclxuICAgICAgICB0aGlzLnVzZXJTZXJ2aWNlLmdldExpc3RCeUZ1bmNBdXRoQ29kZSh0aGlzLnRhc2tDb25maWdBdWRpdEtleSkudGhlbigocmVzcDogUmVzcG9uc2VSZXN1bHQ8QXJyYXk8VXNlcj4+KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwICYmIHJlc3AuY29kZSA9PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXNlckF1ZGl0TGlzdCA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXNlckF1ZGl0TGlzdCA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vVE9ETyDkuIrkvKDlm77niYdcclxuICAgIHVwbG9hZEltYWdlKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBsZXQgZnJvbSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZyb20uYXBwZW5kKCdpbWFnZScsIGV2ZW50LnRhcmdldC5maWxlc1swXSk7XHJcbiAgICAgICAgZnJvbS5hcHBlbmQoJ3N0b3JlVHlwZScsICdMT0MnKTtcclxuICAgICAgICBmcm9tLmFwcGVuZCgnaW1hZ2VDYXRlZ29yeScsICdDYXB0dXJlSW1hZ2UnKTtcclxuICAgICAgICBmcm9tLmFwcGVuZCgnY29tbWFuZFR5cGUnLCAnU2VhcmNoQWNjZXNzTG9nJyk7XHJcbiAgICAgICAgZnJvbS5hcHBlbmQoJ2RldGVjdFR5cGUnLCAnRmFjZScpO1xyXG4gICAgICAgIHRoaXMudGFza1NlcnZpY2UudXBsb2FkQ2FyUGhvdG8oZnJvbSkudGhlbigocmVzOiBCYWNrUmVzcG9uc2VCb2R5PGFueT4pID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJHRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuVGFza01vZGVsLkNhclBob3RvID0gcmVzLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZEV2ZW50UnVsZSgpIHtcclxuICAgICAgICBsZXQgc2NvcGU6IHsgaXNUYXNrOiBib29sZWFuLCBldmVudFJ1bGU6IEV2ZW50UnVsZUV4LCAkZGVzdHJveTogRnVuY3Rpb24gfSA9IHRoaXMuJHNjb3BlLiRuZXcoKTtcclxuICAgICAgICBzY29wZS5pc1Rhc2sgPSB0cnVlO1xyXG4gICAgICAgIHNjb3BlLmV2ZW50UnVsZSA9IHRoaXMuVGFza01vZGVsLkV2ZW50UnVsZTtcclxuICAgICAgICB0aGlzLmxheWVySW5kZXggPSB0aGlzLmxheWVyLm9wZW4oe1xyXG4gICAgICAgICAgICB0eXBlOiAxLFxyXG4gICAgICAgICAgICBjb250ZW50OiBldmVudFJ1bGVUcGwsXHJcbiAgICAgICAgICAgIHNjb3BlOiBzY29wZSxcclxuICAgICAgICAgICAgc2tpbjogXCJuby1zY3JvbGxcIixcclxuICAgICAgICAgICAgdGl0bGU6IFwi6YCJ5oup6IGU5Yqo562W55WlXCIsXHJcbiAgICAgICAgICAgIGFyZWE6IFtcIjc4MHB4XCIsIFwiYXV0b1wiXSxcclxuICAgICAgICAgICAgZW5kOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBuZXdUYXNrU3VibWl0KCkge1xyXG4gICAgICAgIGlmICghdGhpcy5UYXNrTW9kZWwuTGlzdFR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXJEZWMud2FybkluZm8oJ+ivt+mAieaLqeW4g+aOp+exu+Wei++8gScpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5UYXNrTW9kZWwuUGxhdGVDb2xvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sYXllckRlYy53YXJuSW5mbygn6K+36YCJ5oup6L2m54mM6aKc6Imy77yBJylcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLlRhc2tNb2RlbC5BdWRpdFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXJEZWMud2FybkluZm8oJ+ivt+mAieaLqeWuoeaguOS6uu+8gScpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCF0aGlzLlRhc2tNb2RlbC5WYWxpZFRpbWVTdGFydCAmJiAhdGhpcy5UYXNrTW9kZWwuVmFsaWRUaW1lRW5kKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXJEZWMud2FybkluZm8oJ+ivt+mAieaLqeacieaViOaXtumXtO+8gScpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuVGFza01vZGVsLlZhbGlkVGltZVN0YXJ0ID49IHRoaXMuVGFza01vZGVsLlZhbGlkVGltZUVuZCl7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxheWVyRGVjLndhcm5JbmZvKCfor7fpgInmi6nmraPnoa7nmoTml7bpl7TojIPlm7TvvIEnKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoIXRoaXMuaXNXaGl0ZUxpc3Qpe1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuVGFza01vZGVsLkV2ZW50UnVsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGF5ZXJEZWMud2FybkluZm8oJ+ivt+mAieaLqeiBlOWKqOetlueVpe+8gScpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5UYXNrTW9kZWwuQ3JlYXRlVGltZSA9IG1vbWVudCgpLmZvcm1hdCgnWVlZWS1NTS1ERCBoaDptbTpzcycpO1xyXG4gICAgICAgIGxldCBwYXJhbXMgPSB7fSBhcyB7IHRhc2tNb2RlbDogQ2FyTW9uaXRvciwgZXZlbnRSdWxlOiBFdmVudFJ1bGVFeCB9O1xyXG4gICAgICAgIHBhcmFtcy50YXNrTW9kZWwgPSB0aGlzLlRhc2tNb2RlbDtcclxuICAgICAgICBwYXJhbXMuZXZlbnRSdWxlID0gdGhpcy5UYXNrTW9kZWwuRXZlbnRSdWxlO1xyXG4gICAgICAgIHBhcmFtcy50YXNrTW9kZWwuQ3JlYXRlVXNlcklEID0gdGhpcy51c2VySW5mb0NhY2hlRmFjdG9yeS5nZXRDdXJyZW50VXNlcklkKCk7XHJcblxyXG4gICAgICAgIGlmIChwYXJhbXMudGFza01vZGVsLkF1ZGl0VXNlciA9PT0gcGFyYW1zLnRhc2tNb2RlbC5DcmVhdGVVc2VySUQpIHtcclxuICAgICAgICAgICAgcGFyYW1zLnRhc2tNb2RlbC5BdWRpdFN0YXR1cyA9IEF1ZGl0U3RhdHVzLlZlcmlmaWVkLnZhbHVlO1xyXG4gICAgICAgICAgICBwYXJhbXMudGFza01vZGVsLlN0YXR1cyA9IFRhc2tTdGF0dXMuUnVuLnZhbHVlXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGFyYW1zLnRhc2tNb2RlbC5BdWRpdFN0YXR1cyA9IEF1ZGl0U3RhdHVzLlZlcmlmaW5nLnZhbHVlO1xyXG4gICAgICAgICAgICBwYXJhbXMudGFza01vZGVsLlN0YXR1cyA9IFRhc2tTdGF0dXMuV2FpdGluZy52YWx1ZVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLlRhc2tNb2RlbC5Jc0xvbmdFZmZlY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLlRhc2tNb2RlbC5UYXNrVHlwZSA9IFRhc2tUeXBlLkNhck1vbml0b3IudmFsdWU7XHJcbiAgICAgICAgdGhpcy50YXNrU2VydmljZS5hZGRPclVwZGF0ZUNhclRhc2socGFyYW1zKS50aGVuKChyZXM6IEJhY2tSZXNwb25zZUJvZHk8c3RyaW5nPikgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uZXdUYXNrQ2FuY2VsKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbmV3VGFza0NhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLiRzdGF0ZS5nbygnYmFzZWNvbmZpZy50YXNrJylcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmFwcC5jb250cm9sbGVyKCduZXdDYXJNb25pdG9yJywgTmV3Q2FyTW9uaXRvcik7XHJcblxyXG4iXX0=

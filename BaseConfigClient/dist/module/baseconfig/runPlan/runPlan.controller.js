define(["require", "exports", "text!./runPlan.popup.html", "../../common/app/main.app", "../../common/directive/page/page-params", "../../../core/params/TimeTemplateParams", "./runPlan.popup.controller", "../../common/services/timeTemplate.service"], function (require, exports, runPlanPopupHtml, main_app_1, page_params_1, TimeTemplateParams_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var RunPlanController = (function () {
        function RunPlanController($scope, $timeout, layer, i18nFactory, timeTemplateService) {
            var _this = this;
            this.$scope = $scope;
            this.$timeout = $timeout;
            this.layer = layer;
            this.i18nFactory = i18nFactory;
            this.timeTemplateService = timeTemplateService;
            this.tableNoData = false;
            this.pageParams = new page_params_1.default();
            this.isSelectAll = false;
            this.getListBySearch = function () {
                _this.findListParams.currentPage = 1;
                _this.getTableListByListParams(_this.findListParams);
            };
            this.initTableParams();
            this.getTableListByListParams(this.findListParams);
        }
        ;
        RunPlanController.prototype.initTableParams = function () {
            this.findListParams = new TimeTemplateParams_1.TimeTemplateListParams();
            this.findListParams.currentPage = this.pageParams.currentPage;
            this.findListParams.pageSize = this.pageParams.pageSize;
            this.ButtonList = [
                { value: 'all', text: '全部' },
                { value: 'peopleControl', text: '人像布控' },
                { value: 'VehicleControl', text: '车辆布控' },
                { value: 'MacControl', text: 'MAC布控' },
                { value: 'peopleStructure', text: '人像结构化' },
                { value: 'VehicleStructure', text: '车辆结构化' },
            ];
            this.tHeadList = [
                { field: "Name", title: "DP_CONFIG_COMMON_03" },
                { field: "Code", title: "DP_CONFIG_COMMON_45" },
                { field: "Description", title: "DP_CONFIG_COMMON_34" },
                { field: "bottoms", title: "DP_CONFIG_COMMON_35" }
            ];
            this.tBodyList = [];
        };
        RunPlanController.prototype.getTableListByListParams = function (reqParams) {
            var _this = this;
            this.timeTemplateService.findByListParams(reqParams).then(function (resp) {
                if (resp.code === 200) {
                    var pageParams = new page_params_1.default();
                    pageParams.setCurrentPage(reqParams.currentPage);
                    pageParams.setPageSize(reqParams.pageSize);
                    pageParams.setTotalCount(resp.data.TotalCount);
                    _this.pageParams = pageParams;
                    _this.findListParams = reqParams;
                    _this.setTBodyList(resp.data.Result);
                }
            });
        };
        ;
        RunPlanController.prototype.deleteById = function (_index) {
            var _this = this;
            var titleStr = this.i18nFactory("DP_CONFIG_RUNPLAN_07", { value: _index.Name });
            this.layer.confirm(titleStr, {
                icon: 0,
                title: this.i18nFactory('DP_CONFIG_COMMON_42'),
                area: ["500px", "200px"],
                btn: [this.i18nFactory('DP_CONFIG_COMMON_05'), this.i18nFactory('DP_CONFIG_COMMON_19')]
            }, function (index) {
                _this.layer.close(index);
                _this.submitDelete([_index.ID]);
            });
        };
        RunPlanController.prototype.deleteByIds = function () {
            var _this = this;
            var selectedDataList = this.getSelectedList();
            if (!selectedDataList || selectedDataList.length == 0) {
                console.error("============", "当前未选择数据");
                return;
            }
            var ids = [];
            selectedDataList.forEach(function (server) {
                ids.push(server.ID);
            });
            var showText = this.i18nFactory("DP_CONFIG_RUNPLAN_08", { value: ids.length });
            this.layer.confirm(showText, {
                icon: 0,
                title: this.i18nFactory('DP_CONFIG_COMMON_42'),
                area: ["500px", "200px"],
                btn: [this.i18nFactory('DP_CONFIG_COMMON_05'), this.i18nFactory('DP_CONFIG_COMMON_19')]
            }, function (index) {
                _this.layer.close(index);
                _this.submitDelete(ids);
            });
        };
        RunPlanController.prototype.submitDelete = function (ids) {
            var _this = this;
            this.timeTemplateService.deleteByIds(ids).then(function (resp) {
                if (resp.code == 200) {
                    _this.findListParams.currentPage = 1;
                    _this.getTableListByListParams(_this.findListParams);
                }
            });
        };
        RunPlanController.prototype.afterChangeCheck = function (resultList, isCheckAll) {
            this.selectedList = resultList;
            this.isSelectAll = isCheckAll;
        };
        ;
        RunPlanController.prototype.getSelectedList = function () {
            var _this = this;
            var selectedDataList = [];
            if (this.selectedList) {
                this.tBodyList.forEach(function (val, index) {
                    if (_this.selectedList[index]) {
                        selectedDataList.push(val);
                    }
                });
            }
            return selectedDataList;
        };
        ;
        RunPlanController.prototype.setTBodyList = function (dataList) {
            console.log(dataList);
            if (dataList && dataList.length > 0) {
                this.tBodyList = dataList;
                this.tableNoData = false;
            }
            else {
                this.tBodyList = [];
                this.tableNoData = true;
            }
        };
        ;
        RunPlanController.prototype.changePage = function (num) {
            this.findListParams.currentPage = num;
            this.getTableListByListParams(this.findListParams);
        };
        RunPlanController.prototype.changePageSize = function (num) {
            this.findListParams.currentPage = 1;
            this.findListParams.pageSize = num;
            this.getTableListByListParams(this.findListParams);
        };
        RunPlanController.prototype.updateModel = function (model) {
            this.openSaveOrUpdateModal(true, model);
        };
        ;
        RunPlanController.prototype.addModel = function () {
            this.openSaveOrUpdateModal(false, null);
        };
        ;
        RunPlanController.prototype.openSaveOrUpdateModal = function (isUpdate, modelData) {
            var _this = this;
            var scope = this.$scope.$new();
            var titleStr = '';
            if (isUpdate) {
                scope.isUpdate = true;
                scope.timeTplModel = modelData;
                titleStr = this.i18nFactory('DP_CONFIG_COMMON_38');
            }
            else {
                scope.isUpdate = false;
                titleStr = this.i18nFactory('DP_CONFIG_COMMON_40');
            }
            this.layer.open({
                type: 1,
                title: titleStr,
                content: runPlanPopupHtml,
                skin: 'update-runPlan-layer',
                scope: scope,
                area: ["auto", "auto"],
                success: function (id) {
                    console.log(id);
                },
                end: function () {
                    scope.$destroy();
                }
            }).then(function (index) {
                _this.openCloseLayerWatch();
                _this.setUpdateLayerIndex(index);
            });
        };
        ;
        RunPlanController.prototype.setUpdateLayerIndex = function (index) {
            this.updateLayerIndex = index;
        };
        ;
        RunPlanController.prototype.closeUpdateLayer = function () {
            this.layer.close(this.updateLayerIndex);
        };
        RunPlanController.prototype.getUpdateLayerIndex = function () {
            return this.updateLayerIndex;
        };
        ;
        RunPlanController.prototype.openCloseLayerWatch = function () {
            var _this = this;
            if (!this.updateLayerIndex) {
                this.$scope.$on('add.runplan.popup', function (even, isFresh) {
                    if (isFresh) {
                        _this.getTableListByListParams(_this.findListParams);
                    }
                    _this.closeUpdateLayer();
                });
            }
        };
        RunPlanController.$inject = ['$scope', '$timeout',
            'layer',
            'i18nFactory',
            'timeTemplateService'];
        return RunPlanController;
    }());
    main_app_1.app.controller('runPlanController', RunPlanController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9ydW5QbGFuL3J1blBsYW4uY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFzQkE7UUF1QkksMkJBQW9CLE1BQVcsRUFDWCxRQUFhLEVBQ2IsS0FBVSxFQUNWLFdBQWdCLEVBQ2hCLG1CQUF5QztZQUo3RCxpQkFPQztZQVBtQixXQUFNLEdBQU4sTUFBTSxDQUFLO1lBQ1gsYUFBUSxHQUFSLFFBQVEsQ0FBSztZQUNiLFVBQUssR0FBTCxLQUFLLENBQUs7WUFDVixnQkFBVyxHQUFYLFdBQVcsQ0FBSztZQUNoQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXNCO1lBdEI3RCxnQkFBVyxHQUFZLEtBQUssQ0FBQztZQUU3QixlQUFVLEdBQWUsSUFBSSxxQkFBVSxFQUFFLENBQUM7WUFPMUMsZ0JBQVcsR0FBWSxLQUFLLENBQUM7WUFvQjdCLG9CQUFlLEdBQUc7Z0JBQ2QsS0FBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO2dCQUNwQyxLQUFJLENBQUMsd0JBQXdCLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3ZELENBQUMsQ0FBQztZQVRFLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUN2QixJQUFJLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7UUFBQSxDQUFDO1FBU0YsMkNBQWUsR0FBZjtZQUNJLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSwyQ0FBc0IsRUFBRSxDQUFDO1lBRW5ELElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1lBQzlELElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1lBRXhELElBQUksQ0FBQyxVQUFVLEdBQUc7Z0JBQ2QsRUFBQyxLQUFLLEVBQUUsS0FBSyxFQUFF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Q0ksTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztRQUNqQyxDQUFDO1FBQUEsQ0FBQztRQUVGLCtDQUFtQixHQUFuQjtZQUFBLGlCQVNDO1lBUkcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxVQUFDLElBQVMsRUFBRSxPQUFpQjtvQkFDOUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQzt3QkFDVixLQUFJLENBQUMsd0JBQXdCLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO29CQUN2RCxDQUFDO29CQUNELEtBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUM1QixDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7UUFDTCxDQUFDO1FBclBNLHlCQUFPLEdBQUcsQ0FBQyxRQUFRLEVBQUUsVUFBVTtZQUNsQyxPQUFPO1lBQ1AsYUFBYTtZQUNiLHFCQUFxQixDQUFDLENBQUM7UUFvUC9CLHdCQUFDO0tBelFELEFBeVFDLElBQUE7SUFFRCxjQUFHLENBQUMsVUFBVSxDQUFDLG1CQUFtQixFQUFFLGlCQUFpQixDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlL2Jhc2Vjb25maWcvcnVuUGxhbi9ydW5QbGFuLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBkZWxsIG9uIDIwMTcvNi8wOC4gdGpcclxuICovXHJcbi8vLyA8YW1kLWRlcGVuZGVuY3kgcGF0aD1cInRleHQhLi9ydW5QbGFuLnBvcHVwLmh0bWxcIiBuYW1lPVwicnVuUGxhblBvcHVwSHRtbFwiIC8+XHJcbmltcG9ydCB7YXBwfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQge0lUYWJsZUhlYWRlcn0gZnJvbSBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdW5pdC10YWJsZS90YWJsZS1wYXJhbXNcIjtcclxuaW1wb3J0ICcuL3J1blBsYW4ucG9wdXAuY29udHJvbGxlcidcclxuaW1wb3J0IHtUaW1lVGVtcGxhdGV9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9UaW1lVGVtcGxhdGVcIjtcclxuaW1wb3J0IFBhZ2VQYXJhbXMgZnJvbSBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvcGFnZS9wYWdlLXBhcmFtc1wiO1xyXG5cclxuaW1wb3J0IHtUaW1lVGVtcGxhdGVMaXN0UGFyYW1zfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9wYXJhbXMvVGltZVRlbXBsYXRlUGFyYW1zXCI7XHJcblxyXG5pbXBvcnQgXCIuLi8uLi9jb21tb24vc2VydmljZXMvdGltZVRlbXBsYXRlLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtJVGltZVRlbXBsYXRlU2VydmljZX0gZnJvbSBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy90aW1lVGVtcGxhdGUuc2VydmljZVwiO1xyXG5pbXBvcnQge1Jlc3BvbnNlUmVzdWx0LCBQYWdlUmVzdWx0fSBmcm9tIFwiLi4vLi4vLi4vY29yZS9wYXJhbXMvcmVzdWx0L1Jlc3BvbnNlUmVzdWx0XCI7XHJcbmltcG9ydCB7VGltZVRlbXBsYXRlRXh9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9UaW1lVGVtcGxhdGVFeFwiO1xyXG5pbXBvcnQge0VudW19IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudW0vRW51bVwiO1xyXG5cclxuXHJcbmRlY2xhcmUgbGV0IHJ1blBsYW5Qb3B1cEh0bWw6IGFueTtcclxuZGVjbGFyZSBsZXQgYW5ndWxhcjogYW55O1xyXG5cclxuY2xhc3MgUnVuUGxhbkNvbnRyb2xsZXIge1xyXG5cclxuICAgIHRIZWFkTGlzdDogQXJyYXk8SVRhYmxlSGVhZGVyPjtcclxuICAgIHRCb2R5TGlzdDogQXJyYXk8VGltZVRlbXBsYXRlPjtcclxuXHJcbiAgICB0YWJsZU5vRGF0YTogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIHBhZ2VQYXJhbXM6IFBhZ2VQYXJhbXMgPSBuZXcgUGFnZVBhcmFtcygpO1xyXG5cclxuICAgIGZpbmRMaXN0UGFyYW1zOiBUaW1lVGVtcGxhdGVMaXN0UGFyYW1zO1xyXG4gICAgLy8g57yW6L6RbGF5ZXIg5LiL5qCHXHJcbiAgICB1cGRhdGVMYXllckluZGV4OiBudW1iZXI7XHJcblxyXG4gICAgc2VsZWN0ZWRMaXN0OiBBcnJheTxib29sZWFuPjtcclxuICAgIGlzU2VsZWN0QWxsOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvLyDmqKHmnb/nsbvlnotcclxuICAgIEJ1dHRvbkxpc3Q6IEFycmF5PEVudW0+O1xyXG5cclxuICAgIHN0YXRpYyAkaW5qZWN0ID0gWyckc2NvcGUnLCAnJHRpbWVvdXQnLFxyXG4gICAgICAgICdsYXllcicsXHJcbiAgICAgICAgJ2kxOG5GYWN0b3J5JyxcclxuICAgICAgICAndGltZVRlbXBsYXRlU2VydmljZSddO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgJHNjb3BlOiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlICR0aW1lb3V0OiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGxheWVyOiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGkxOG5GYWN0b3J5OiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIHRpbWVUZW1wbGF0ZVNlcnZpY2U6IElUaW1lVGVtcGxhdGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgdGhpcy5pbml0VGFibGVQYXJhbXMoKTtcclxuICAgICAgICB0aGlzLmdldFRhYmxlTGlzdEJ5TGlzdFBhcmFtcyh0aGlzLmZpbmRMaXN0UGFyYW1zKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tIGFib3V0IHRhYmxlXHJcbiAgICAvL+aQnOe0olxyXG4gICAgZ2V0TGlzdEJ5U2VhcmNoID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZmluZExpc3RQYXJhbXMuY3VycmVudFBhZ2UgPSAxO1xyXG4gICAgICAgIHRoaXMuZ2V0VGFibGVMaXN0QnlMaXN0UGFyYW1zKHRoaXMuZmluZExpc3RQYXJhbXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICBpbml0VGFibGVQYXJhbXMoKSB7XHJcbiAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcyA9IG5ldyBUaW1lVGVtcGxhdGVMaXN0UGFyYW1zKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZmluZExpc3RQYXJhbXMuY3VycmVudFBhZ2UgPSB0aGlzLnBhZ2VQYXJhbXMuY3VycmVudFBhZ2U7XHJcbiAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcy5wYWdlU2l6ZSA9IHRoaXMucGFnZVBhcmFtcy5wYWdlU2l6ZTtcclxuICAgICAgICAvLyAg5qih5p2/57G75Z6LXHJcbiAgICAgICAgdGhpcy5CdXR0b25MaXN0ID0gW1xyXG4gICAgICAgICAgICB7dmFsdWU6ICdhbGwnLCB0ZXh0OiAn5YWo6YOoJ30sXHJcbiAgICAgICAgICAgIHt2YWx1ZTogJ3Blb3BsZUNvbnRyb2wnLCB0ZXh0OiAn5Lq65YOP5biD5o6nJ30sXHJcbiAgICAgICAgICAgIHt2YWx1ZTogJ1ZlaGljbGVDb250cm9sJywgdGV4dDogJ+i9pui+huW4g+aOpyd9LFxyXG4gICAgICAgICAgICB7dmFsdWU6ICdNYWNDb250cm9sJywgdGV4dDogJ01BQ+W4g+aOpyd9LFxyXG4gICAgICAgICAgICB7dmFsdWU6ICdwZW9wbGVTdHJ1Y3R1cmUnLCB0ZXh0OiAn5Lq65YOP57uT5p6E5YyWJ30sXHJcbiAgICAgICAgICAgIHt2YWx1ZTogJ1ZlaGljbGVTdHJ1Y3R1cmUnLCB0ZXh0OiAn6L2m6L6G57uT5p6E5YyWJ30sXHJcbiAgICAgICAgXVxyXG5cclxuICAgICAgICAvLyDooahcclxuICAgICAgICB0aGlzLnRIZWFkTGlzdCA9IFtcclxuICAgICAgICAgICAge2ZpZWxkOiBcIk5hbWVcIiwgdGl0bGU6IFwiRFBfQ09ORklHX0NPTU1PTl8wM1wifSxcclxuICAgICAgICAgICAge2ZpZWxkOiBcIkNvZGVcIiwgdGl0bGU6IFwiRFBfQ09ORklHX0NPTU1PTl80NVwifSxcclxuICAgICAgICAgICAge2ZpZWxkOiBcIkRlc2NyaXB0aW9uXCIsIHRpdGxlOiBcIkRQX0NPTkZJR19DT01NT05fMzRcIn0sXHJcbiAgICAgICAgICAgIHtmaWVsZDogXCJib3R0b21zXCIsIHRpdGxlOiBcIkRQX0NPTkZJR19DT01NT05fMzVcIn1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHRoaXMudEJvZHlMaXN0ID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgLy/ojrflj5YgdGFibGUg5YiX6KGo5pWw5o2uXHJcbiAgICBnZXRUYWJsZUxpc3RCeUxpc3RQYXJhbXMocmVxUGFyYW1zOiBUaW1lVGVtcGxhdGVMaXN0UGFyYW1zKSB7XHJcblxyXG4gICAgICAgIHRoaXMudGltZVRlbXBsYXRlU2VydmljZS5maW5kQnlMaXN0UGFyYW1zKHJlcVBhcmFtcykudGhlbigocmVzcDogYW55KTogdm9pZCA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBhZ2VQYXJhbXMgPSBuZXcgUGFnZVBhcmFtcygpO1xyXG4gICAgICAgICAgICAgICAgcGFnZVBhcmFtcy5zZXRDdXJyZW50UGFnZShyZXFQYXJhbXMuY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcGFnZVBhcmFtcy5zZXRQYWdlU2l6ZShyZXFQYXJhbXMucGFnZVNpemUpO1xyXG4gICAgICAgICAgICAgICAgcGFnZVBhcmFtcy5zZXRUb3RhbENvdW50KHJlc3AuZGF0YS5Ub3RhbENvdW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFnZVBhcmFtcyA9IHBhZ2VQYXJhbXM7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcyA9IHJlcVBhcmFtcztcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VEJvZHlMaXN0KHJlc3AuZGF0YS5SZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH07XHJcblxyXG4gICAgLy/ljZXliKDpmaRcclxuICAgIGRlbGV0ZUJ5SWQoX2luZGV4OiBUaW1lVGVtcGxhdGUpIHtcclxuICAgICAgICBsZXQgdGl0bGVTdHIgPSB0aGlzLmkxOG5GYWN0b3J5KFwiRFBfQ09ORklHX1JVTlBMQU5fMDdcIiwge3ZhbHVlOiBfaW5kZXguTmFtZX0pO1xyXG4gICAgICAgIHRoaXMubGF5ZXIuY29uZmlybSh0aXRsZVN0ciwge1xyXG4gICAgICAgICAgICBpY29uOiAwLFxyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5pMThuRmFjdG9yeSgnRFBfQ09ORklHX0NPTU1PTl80MicpLFxyXG4gICAgICAgICAgICBhcmVhOiBbXCI1MDBweFwiLCBcIjIwMHB4XCJdLFxyXG4gICAgICAgICAgICBidG46IFt0aGlzLmkxOG5GYWN0b3J5KCdEUF9DT05GSUdfQ09NTU9OXzA1JyksIHRoaXMuaTE4bkZhY3RvcnkoJ0RQX0NPTkZJR19DT01NT05fMTknKV1cclxuICAgICAgICB9LCAoaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxheWVyLmNsb3NlKGluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5zdWJtaXREZWxldGUoW19pbmRleC5JRF0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLy/lpJrkuKrliKDpmaRcclxuICAgIGRlbGV0ZUJ5SWRzKCkge1xyXG4gICAgICAgIGxldCBzZWxlY3RlZERhdGFMaXN0OiBBcnJheTxUaW1lVGVtcGxhdGU+ID0gdGhpcy5nZXRTZWxlY3RlZExpc3QoKTtcclxuICAgICAgICBpZiAoIXNlbGVjdGVkRGF0YUxpc3QgfHwgc2VsZWN0ZWREYXRhTGlzdC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiPT09PT09PT09PT09XCIsIFwi5b2T5YmN5pyq6YCJ5oup5pWw5o2uXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpZHM6IEFycmF5PHN0cmluZz4gPSBbXTtcclxuXHJcbiAgICAgICAgc2VsZWN0ZWREYXRhTGlzdC5mb3JFYWNoKChzZXJ2ZXI6IFRpbWVUZW1wbGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICBpZHMucHVzaChzZXJ2ZXIuSUQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBsZXQgc2hvd1RleHQgPSB0aGlzLmkxOG5GYWN0b3J5KFwiRFBfQ09ORklHX1JVTlBMQU5fMDhcIiwge3ZhbHVlOiBpZHMubGVuZ3RofSk7XHJcbiAgICAgICAgdGhpcy5sYXllci5jb25maXJtKHNob3dUZXh0LCB7XHJcbiAgICAgICAgICAgIGljb246IDAsXHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmkxOG5GYWN0b3J5KCdEUF9DT05GSUdfQ09NTU9OXzQyJyksXHJcbiAgICAgICAgICAgIGFyZWE6IFtcIjUwMHB4XCIsIFwiMjAwcHhcIl0sXHJcbiAgICAgICAgICAgIGJ0bjogW3RoaXMuaTE4bkZhY3RvcnkoJ0RQX0NPTkZJR19DT01NT05fMDUnKSwgdGhpcy5pMThuRmFjdG9yeSgnRFBfQ09ORklHX0NPTU1PTl8xOScpXVxyXG4gICAgICAgIH0sIChpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubGF5ZXIuY2xvc2UoaW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnN1Ym1pdERlbGV0ZShpZHMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzdWJtaXREZWxldGUoaWRzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgICAgICAgdGhpcy50aW1lVGVtcGxhdGVTZXJ2aWNlLmRlbGV0ZUJ5SWRzKGlkcykudGhlbigocmVzcDogUmVzcG9uc2VSZXN1bHQ8YW55PikgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzcC5jb2RlID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcy5jdXJyZW50UGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFRhYmxlTGlzdEJ5TGlzdFBhcmFtcyh0aGlzLmZpbmRMaXN0UGFyYW1zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6YCJ5oup5p+Q5LiA5p2h5pWw5o2uXHJcbiAgICAgKiBAdGltZTogMjAxNy0wNC0yMSAxOTo0MzowN1xyXG4gICAgICogQHBhcmFtczpcclxuICAgICAqIEByZXR1cm46XHJcbiAgICAgKi9cclxuICAgIGFmdGVyQ2hhbmdlQ2hlY2socmVzdWx0TGlzdDogQXJyYXk8Ym9vbGVhbj4sIGlzQ2hlY2tBbGw6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkTGlzdCA9IHJlc3VsdExpc3Q7XHJcbiAgICAgICAgdGhpcy5pc1NlbGVjdEFsbCA9IGlzQ2hlY2tBbGw7XHJcbiAgICB9O1xyXG5cclxuICAgIC8v6I635Y+W5b2T5YmN5bey6KKr6YCJ5Lit5YiX6KGoXHJcbiAgICBnZXRTZWxlY3RlZExpc3QoKTogQXJyYXk8VGltZVRlbXBsYXRlPiB7XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkRGF0YUxpc3Q6IEFycmF5PFRpbWVUZW1wbGF0ZT4gPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5zZWxlY3RlZExpc3QpIHtcclxuICAgICAgICAgICAgdGhpcy50Qm9keUxpc3QuZm9yRWFjaCgodmFsOiBUaW1lVGVtcGxhdGUsIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkTGlzdFtpbmRleF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZERhdGFMaXN0LnB1c2godmFsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZWxlY3RlZERhdGFMaXN0O1xyXG4gICAgfTtcclxuXHJcbiAgICBzZXRUQm9keUxpc3QoZGF0YUxpc3Q6IEFycmF5PFRpbWVUZW1wbGF0ZT4pIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhTGlzdClcclxuICAgICAgICBpZiAoZGF0YUxpc3QgJiYgZGF0YUxpc3QubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnRCb2R5TGlzdCA9IGRhdGFMaXN0O1xyXG4gICAgICAgICAgICB0aGlzLnRhYmxlTm9EYXRhID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50Qm9keUxpc3QgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy50YWJsZU5vRGF0YSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvL2Fib3V0IHBhZ2UgY2xpY2tcclxuICAgIGNoYW5nZVBhZ2UobnVtOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLmZpbmRMaXN0UGFyYW1zLmN1cnJlbnRQYWdlID0gbnVtO1xyXG4gICAgICAgIHRoaXMuZ2V0VGFibGVMaXN0QnlMaXN0UGFyYW1zKHRoaXMuZmluZExpc3RQYXJhbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZVBhZ2VTaXplKG51bTogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcy5jdXJyZW50UGFnZSA9IDE7XHJcbiAgICAgICAgdGhpcy5maW5kTGlzdFBhcmFtcy5wYWdlU2l6ZSA9IG51bTtcclxuICAgICAgICB0aGlzLmdldFRhYmxlTGlzdEJ5TGlzdFBhcmFtcyh0aGlzLmZpbmRMaXN0UGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLWFib3V0IHVwZGF0ZSBtb2RlbFxyXG4gICAgLyoqIGNyZWF0ZSBieSB6eHFcclxuICAgICAqICDkv67mlLnov5DooYzorqHliJJcclxuICAgICAqIEB0aW1lOiAyMDE3LTA2LTI2IDEyOjE0OjUxXHJcbiAgICAgKiBAcGFyYW1zOlxyXG4gICAgICogQHJldHVybjpcclxuICAgICAqL1xyXG4gICAgdXBkYXRlTW9kZWwgKG1vZGVsOiBUaW1lVGVtcGxhdGVFeCk6IHZvaWQgIHtcclxuICAgICAgICB0aGlzLm9wZW5TYXZlT3JVcGRhdGVNb2RhbCh0cnVlLCBtb2RlbCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKiBjcmVhdGUgYnkgenhxXHJcbiAgICAgKiAg5re75Yqg6L+Q6KGM6K6h5YiSXHJcbiAgICAgKiBAdGltZTogMjAxNy0wNi0yNiAxMjoxNDo1MVxyXG4gICAgICogQHBhcmFtczpcclxuICAgICAqIEByZXR1cm46XHJcbiAgICAgKi9cclxuICAgIGFkZE1vZGVsKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub3BlblNhdmVPclVwZGF0ZU1vZGFsKGZhbHNlLCBudWxsKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmiZPlvIDmt7vliqDjgIHnvJbovpHnlKjmiLfotYTmlpnnqpflj6NcclxuICAgICAqIEB0aW1lOiAyMDE3LTA0LTE5IDE3OjAzOjMwXHJcbiAgICAgKiBAcGFyYW1zOiBpc1VwZGF0ZeOAgWRhdGEg5LiN5Lyg5YiZ6buY6K6k5re75Yqg5pON5L2cXHJcbiAgICAgKiBAcmV0dXJuOlxyXG4gICAgICovXHJcbiAgICBvcGVuU2F2ZU9yVXBkYXRlTW9kYWwoaXNVcGRhdGU6IGJvb2xlYW4sIG1vZGVsRGF0YTogVGltZVRlbXBsYXRlRXgpIHtcclxuXHJcbiAgICAgICAgbGV0IHNjb3BlOiB7IGlzVXBkYXRlOiBib29sZWFuLCB0aW1lVHBsTW9kZWw6IFRpbWVUZW1wbGF0ZUV4LCAkZGVzdHJveTogRnVuY3Rpb24gfSA9IHRoaXMuJHNjb3BlLiRuZXcoKTtcclxuICAgICAgICBsZXQgdGl0bGVTdHIgPSAnJztcclxuICAgICAgICBpZiAoaXNVcGRhdGUpIHtcclxuICAgICAgICAgICAgc2NvcGUuaXNVcGRhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBzY29wZS50aW1lVHBsTW9kZWwgPSBtb2RlbERhdGE7XHJcbiAgICAgICAgICAgIHRpdGxlU3RyID0gdGhpcy5pMThuRmFjdG9yeSgnRFBfQ09ORklHX0NPTU1PTl8zOCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmlzVXBkYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRpdGxlU3RyID0gdGhpcy5pMThuRmFjdG9yeSgnRFBfQ09ORklHX0NPTU1PTl80MCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxheWVyLm9wZW4oe1xyXG4gICAgICAgICAgICB0eXBlOiAxLFxyXG4gICAgICAgICAgICAvL3Njcm9sbGJhcjpmYWxzZSxcclxuICAgICAgICAgICAgdGl0bGU6IHRpdGxlU3RyLFxyXG4gICAgICAgICAgICBjb250ZW50OiBydW5QbGFuUG9wdXBIdG1sLFxyXG4gICAgICAgICAgICBza2luOiAndXBkYXRlLXJ1blBsYW4tbGF5ZXInLFxyXG4gICAgICAgICAgICBzY29wZTogc2NvcGUsXHJcbiAgICAgICAgICAgIGFyZWE6IFtcImF1dG9cIiwgXCJhdXRvXCJdLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoaWQ6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaWQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLiRkZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS50aGVuKChpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub3BlbkNsb3NlTGF5ZXJXYXRjaCgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldFVwZGF0ZUxheWVySW5kZXgoaW5kZXgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqICDmoIfor4blvZPliY0g57yW6L6RbGF5ZXIgbW9kYWxcclxuICAgICAqIEB0aW1lOiAyMDE3LTA0LTE5IDE3OjA2OjQ4XHJcbiAgICAgKiBAcGFyYW1zOlxyXG4gICAgICogQHJldHVybjpcclxuICAgICAqL1xyXG4gICAgc2V0VXBkYXRlTGF5ZXJJbmRleChpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVMYXllckluZGV4ID0gaW5kZXg7XHJcbiAgICB9O1xyXG5cclxuICAgIGNsb3NlVXBkYXRlTGF5ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5sYXllci5jbG9zZSh0aGlzLnVwZGF0ZUxheWVySW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVwZGF0ZUxheWVySW5kZXgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlTGF5ZXJJbmRleDtcclxuICAgIH07XHJcblxyXG4gICAgb3BlbkNsb3NlTGF5ZXJXYXRjaCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMudXBkYXRlTGF5ZXJJbmRleCkge1xyXG4gICAgICAgICAgICB0aGlzLiRzY29wZS4kb24oJ2FkZC5ydW5wbGFuLnBvcHVwJywgKGV2ZW46IGFueSwgaXNGcmVzaD86IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpc0ZyZXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUYWJsZUxpc3RCeUxpc3RQYXJhbXModGhpcy5maW5kTGlzdFBhcmFtcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlVXBkYXRlTGF5ZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuYXBwLmNvbnRyb2xsZXIoJ3J1blBsYW5Db250cm9sbGVyJywgUnVuUGxhbkNvbnRyb2xsZXIpOyJdfQ==

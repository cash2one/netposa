define(["require", "exports", "../../common/app/main.app", "../../../core/entity/ex/IodEx", "../../../core/entity/Area", "../../common/directive/tree/tree-params", "../../common/services/iod.service", "angular"], function (require, exports, main_app_1, IodEx_1, Area_1, tree_params_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var IodTypesEnum = [
        { key: 'WiFi', value: 'Wi-Fi' },
        { key: 'EFENCE', value: '电子围栏' },
        { key: 'RmpGate', value: '卡口' }
    ];
    var IodPopupController = (function () {
        function IodPopupController($scope, $rootScope, iodService, $q, $timeout) {
            this.$scope = $scope;
            this.$rootScope = $rootScope;
            this.iodService = iodService;
            this.$q = $q;
            this.$timeout = $timeout;
            this.Area = new Area_1.Area();
            this.Iod = new IodEx_1.IodEx();
            this.treeParams = new tree_params_1.TreeDataParams();
            this.isRootIod = false;
            this.IodTypes = IodTypesEnum;
            this.curdType = this.$scope.curdType;
            this.proxyList = this.$scope.proxyListForIod;
            this.$scope.$on("$destroy", function () {
                console.warn("销毁了弹出框");
            });
            this.initParams();
        }
        IodPopupController.prototype.changeTypeSelect = function () {
            var _this = this;
            angular.forEach(this.proxyList, function (val) {
                if (!_this.Iod.ProxyServerID) {
                    _this.Iod.Port = null;
                }
                if (val.ID === _this.Iod.ProxyServerID) {
                    _this.Iod.Port = val.Port;
                }
            });
        };
        IodPopupController.prototype.initParams = function () {
            var _this = this;
            if (this.curdType === 'add' && this.$scope.currentArea) {
                this.Iod.ParentArea = {};
                this.Iod.ParentArea.ID = this.$scope.currentArea.ID;
                this.Iod.ParentArea.Name = this.$scope.currentArea.Name;
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.$scope.treeDatas;
                    _this.treeParams.defaultSelectTreeId = _this.$scope.currentArea.ID;
                });
            }
            else if (this.curdType === 'edit' && this.$scope.currentIod) {
                this.Iod = this.$scope.currentIod;
                this.$timeout(function () {
                    _this.treeParams.treeDatas = _this.$scope.treeDatas;
                    _this.Iod.AreaID ? (_this.treeParams.defaultSelectTreeId = _this.Iod.AreaID) : (_this.isRootIod = true);
                });
            }
            this.treeParams.treeId = "iodPopupIodTree";
            this.treeParams.isDefaultSelected = true;
            this.treeParams.onClick = function (event, treeId, treeNode) {
                console.log(treeNode);
                _this.$timeout(function () {
                    _this.Iod.ParentArea = treeNode;
                    _this.isShowIodTree = false;
                });
            };
        };
        IodPopupController.prototype.submitAction = function () {
            if (this.curdType === 'add') {
                this.saveIod();
            }
            else {
                this.editIod();
            }
        };
        IodPopupController.prototype.saveIod = function () {
            var _this = this;
            if (!this.validate())
                return;
            this.iodService.save(this.Iod).then(function (res) {
                if (res.code === 200) {
                    return null;
                }
                else {
                    return _this.$q.reject(res.code);
                }
            }).then(function () {
                _this.cancelIodPopup(true);
            });
        };
        IodPopupController.prototype.editIod = function () {
            var _this = this;
            if (!this.validate())
                return;
            this.iodService.edit(this.Iod).then(function (res) {
                console.log("editIod complete", res);
                if (res.code === 200) {
                    return null;
                }
                else {
                    return _this.$q.reject(res.code);
                }
            }).then(function () {
                _this.cancelIodPopup(true);
            });
        };
        IodPopupController.prototype.validate = function () {
            var result = true;
            if (!this.Iod.Code) {
                result = false;
            }
            else if (!this.Iod.Name) {
                result = false;
            }
            else if (!this.Iod.IpAddress) {
                result = false;
            }
            else if (!this.Iod.Port) {
                result = false;
            }
            return result;
        };
        IodPopupController.prototype.cancelIodPopup = function (refresh) {
            this.$rootScope.$broadcast('iod.closePopup', refresh);
        };
        IodPopupController.$inject = ['$scope', '$rootScope', 'iodService', '$q', '$timeout'];
        return IodPopupController;
    }());
    main_app_1.app
        .controller('iodPopupController', IodPopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9pb2QvaW9kLnBvcHVwLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBaUJBLElBQU0sWUFBWSxHQUFxQjtRQUNuQyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRTtRQUMvQixFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRTtRQUNoQyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRTtLQUNsQyxDQUFDO0lBRUY7UUFZSSw0QkFDWSxNQUFXLEVBQ1gsVUFBZSxFQUNmLFVBQXVCLEVBQ3ZCLEVBQU8sRUFDUCxRQUFhO1lBSmIsV0FBTSxHQUFOLE1BQU0sQ0FBSztZQUNYLGVBQVUsR0FBVixVQUFVLENBQUs7WUFDZixlQUFVLEdBQVYsVUFBVSxDQUFhO1lBQ3ZCLE9BQUUsR0FBRixFQUFFLENBQUs7WUFDUCxhQUFRLEdBQVIsUUFBUSxDQUFLO1lBZHpCLFNBQUksR0FBUyxJQUFJLFdBQUksRUFBRSxDQUFDO1lBQ3hCLFFBQUcsR0FBVSxJQUFJLGFBQUssRUFBRSxDQUFDO1lBQ3pCLGVBQVUsR0FBMkIsSUFBSSw0QkFBYyxFQUFVLENBQUM7WUFJbEUsY0FBUyxHQUFZLEtBQUssQ0FBQztZQUMzQixhQUFRLEdBQXFCLFlBQVksQ0FBQztZQVN0QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1lBQ3JDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUM7WUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO2dCQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBRXRCLENB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QUcsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUF5SDlFLHlCQUFDO0tBMUhELEFBMEhDLElBQUE7SUFFRCxjQUFHO1NBQ0UsVUFBVSxDQUFDLG9CQUFvQixFQUFFLGtCQUFrQixDQUFDLENBQUMiLCJmaWxlIjoibW9kdWxlL2Jhc2Vjb25maWcvaW9kL2lvZC5wb3B1cC5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgZGVsbCBvbiAyMDE3LzMvMjkuXHJcbiAqL1xyXG5pbXBvcnQgeyBhcHAgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgJy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9pb2Quc2VydmljZSc7XHJcbmltcG9ydCB7IElvZEV4IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L2V4L0lvZEV4XCI7XHJcbmltcG9ydCB7IEFyZWEgfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9lbnRpdHkvQXJlYVwiO1xyXG5pbXBvcnQgeyBBcmVhRXggfSBmcm9tIFwiLi4vLi4vLi4vY29yZS9lbnRpdHkvZXgvQXJlYUV4XCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlUmVzdWx0IH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQgeyBJSW9kU2VydmljZSB9IGZyb20gXCIuLi8uLi9jb21tb24vc2VydmljZXMvaW9kLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgVHJlZURhdGFQYXJhbXMgfSBmcm9tIFwiLi4vLi4vY29tbW9uL2RpcmVjdGl2ZS90cmVlL3RyZWUtcGFyYW1zXCI7XHJcbmltcG9ydCB7IFByb3h5U2VydmVyIH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L1Byb3h5U2VydmVyXCI7XHJcbmltcG9ydCAnYW5ndWxhcic7XHJcbmRlY2xhcmUgbGV0IGFuZ3VsYXI6IGFueTtcclxuaW50ZXJmYWNlIElJb2RUeXBlcyB7XHJcbiAgICBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZ1xyXG59XHJcbmNvbnN0IElvZFR5cGVzRW51bTogQXJyYXk8SUlvZFR5cGVzPiA9IFtcclxuICAgIHsga2V5OiAnV2lGaScsIHZhbHVlOiAnV2ktRmknIH0sXHJcbiAgICB7IGtleTogJ0VGRU5DRScsIHZhbHVlOiAn55S15a2Q5Zu05qCPJyB9LFxyXG4gICAgeyBrZXk6ICdSbXBHYXRlJywgdmFsdWU6ICfljaHlj6MnIH1cclxuXTtcclxuXHJcbmNsYXNzIElvZFBvcHVwQ29udHJvbGxlciB7XHJcbiAgICBzdGF0aWMgJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnaW9kU2VydmljZScsICckcScsICckdGltZW91dCddO1xyXG4gICAgY3VyZFR5cGU6IHN0cmluZztcclxuICAgIEFyZWE6IEFyZWEgPSBuZXcgQXJlYSgpO1xyXG4gICAgSW9kOiBJb2RFeCA9IG5ldyBJb2RFeCgpO1xyXG4gICAgdHJlZVBhcmFtczogVHJlZURhdGFQYXJhbXM8QXJlYUV4PiA9IG5ldyBUcmVlRGF0YVBhcmFtczxBcmVhRXg+KCk7XHJcbiAgICBpc1Nob3dJb2RUcmVlOiBib29sZWFuO1xyXG4gICAgLy8g5piv5ZCm5piv5qC55Yy65Z+fLCDlj6rmnInlnKjkv67mlLnmk43kvZzml7bnlJ/mlYhcclxuICAgIC8vIOW9k+WJjeWMuuWfn+aYr+agueWMuuWfn+aXtiwg5LiN5YWB6K646YCJ5oup5qC557uT54K5XHJcbiAgICBpc1Jvb3RJb2Q6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIElvZFR5cGVzOiBBcnJheTxJSW9kVHlwZXM+ID0gSW9kVHlwZXNFbnVtO1xyXG4gICAgcHJveHlMaXN0OiBBcnJheTxQcm94eVNlcnZlcj47XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlICRzY29wZTogYW55LFxyXG4gICAgICAgIHByaXZhdGUgJHJvb3RTY29wZTogYW55LFxyXG4gICAgICAgIHByaXZhdGUgaW9kU2VydmljZTogSUlvZFNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSAkcTogYW55LFxyXG4gICAgICAgIHByaXZhdGUgJHRpbWVvdXQ6IGFueVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5jdXJkVHlwZSA9IHRoaXMuJHNjb3BlLmN1cmRUeXBlO1xyXG4gICAgICAgIHRoaXMucHJveHlMaXN0ID0gdGhpcy4kc2NvcGUucHJveHlMaXN0Rm9ySW9kO1xyXG4gICAgICAgIHRoaXMuJHNjb3BlLiRvbihcIiRkZXN0cm95XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKFwi6ZSA5q+B5LqG5by55Ye65qGGXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLmluaXRQYXJhbXMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgY2hhbmdlVHlwZVNlbGVjdCgpIHtcclxuICAgICAgICBhbmd1bGFyLmZvckVhY2godGhpcy5wcm94eUxpc3QsICh2YWw6IFByb3h5U2VydmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLklvZC5Qcm94eVNlcnZlcklEKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuSW9kLlBvcnQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWwuSUQgPT09IHRoaXMuSW9kLlByb3h5U2VydmVySUQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuSW9kLlBvcnQgPSB2YWwuUG9ydDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXRQYXJhbXMoKSB7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmN1cmRUeXBlID09PSAnYWRkJyAmJiB0aGlzLiRzY29wZS5jdXJyZW50QXJlYSkge1xyXG4gICAgICAgICAgICB0aGlzLklvZC5QYXJlbnRBcmVhID0ge30gYXMgQXJlYTtcclxuICAgICAgICAgICAgdGhpcy5Jb2QuUGFyZW50QXJlYS5JRCA9IHRoaXMuJHNjb3BlLmN1cnJlbnRBcmVhLklEO1xyXG4gICAgICAgICAgICB0aGlzLklvZC5QYXJlbnRBcmVhLk5hbWUgPSB0aGlzLiRzY29wZS5jdXJyZW50QXJlYS5OYW1lO1xyXG4gICAgICAgICAgICB0aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlRGF0YXMgPSB0aGlzLiRzY29wZS50cmVlRGF0YXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRyZWVQYXJhbXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHRoaXMuJHNjb3BlLmN1cnJlbnRBcmVhLklEO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5qCR6IqC54K56buY6K6k6YCJ5Lit55qE5piv5b2T5YmN6YCJ5oup55qE54i26IqC54K5aWRcclxuICAgICAgICAgICAgLy8g5Yid5aeL5YyW5qCR6IqC54K5XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5jdXJkVHlwZSA9PT0gJ2VkaXQnICYmIHRoaXMuJHNjb3BlLmN1cnJlbnRJb2QpIHtcclxuICAgICAgICAgICAgdGhpcy5Jb2QgPSB0aGlzLiRzY29wZS5jdXJyZW50SW9kO1xyXG4gICAgICAgICAgICB0aGlzLiR0aW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlRGF0YXMgPSB0aGlzLiRzY29wZS50cmVlRGF0YXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLklvZC5BcmVhSUQgPyAodGhpcy50cmVlUGFyYW1zLmRlZmF1bHRTZWxlY3RUcmVlSWQgPSB0aGlzLklvZC5BcmVhSUQpIDogKHRoaXMuaXNSb290SW9kID0gdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudHJlZVBhcmFtcy50cmVlSWQgPSBcImlvZFBvcHVwSW9kVHJlZVwiO1xyXG4gICAgICAgIHRoaXMudHJlZVBhcmFtcy5pc0RlZmF1bHRTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy50cmVlUGFyYW1zLm9uQ2xpY2sgPSAoZXZlbnQ6IE1vdXNlRXZlbnQsIHRyZWVJZDogc3RyaW5nLCB0cmVlTm9kZTogQXJlYUV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRyZWVOb2RlKTtcclxuICAgICAgICAgICAgdGhpcy4kdGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLklvZC5QYXJlbnRBcmVhID0gdHJlZU5vZGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd0lvZFRyZWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgc3VibWl0QWN0aW9uKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cmRUeXBlID09PSAnYWRkJykge1xyXG4gICAgICAgICAgICB0aGlzLnNhdmVJb2QoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmVkaXRJb2QoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzYXZlSW9kKCkge1xyXG4gICAgICAgIGlmICghdGhpcy52YWxpZGF0ZSgpKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5pb2RTZXJ2aWNlLnNhdmUodGhpcy5Jb2QpLnRoZW4oKHJlczogUmVzcG9uc2VSZXN1bHQ8c3RyaW5nPikgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgLy8g6LCD55So5YWz6Zet56qX5Y+j5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRxLnJlamVjdChyZXMuY29kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYW5jZWxJb2RQb3B1cCh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcbiAgICBlZGl0SW9kKCkge1xyXG4gICAgICAgIGlmICghdGhpcy52YWxpZGF0ZSgpKSByZXR1cm47XHJcbiAgICAgICAgdGhpcy5pb2RTZXJ2aWNlLmVkaXQodGhpcy5Jb2QpLnRoZW4oKHJlczogUmVzcG9uc2VSZXN1bHQ8c3RyaW5nPikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVkaXRJb2QgY29tcGxldGVcIiwgcmVzKTtcclxuICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJHEucmVqZWN0KHJlcy5jb2RlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmNhbmNlbElvZFBvcHVwKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdmFsaWRhdGUoKSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgaWYgKCF0aGlzLklvZC5Db2RlKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuSW9kLk5hbWUpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIGlmICghdGhpcy5Jb2QuSXBBZGRyZXNzKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuSW9kLlBvcnQpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbiAgICBjYW5jZWxJb2RQb3B1cChyZWZyZXNoPzogYm9vbGVhbikge1xyXG4gICAgICAgIHRoaXMuJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdpb2QuY2xvc2VQb3B1cCcsIHJlZnJlc2gpO1xyXG4gICAgfVxyXG59XHJcblxyXG5hcHBcclxuICAgIC5jb250cm9sbGVyKCdpb2RQb3B1cENvbnRyb2xsZXInLCBJb2RQb3B1cENvbnRyb2xsZXIpOyJdfQ==

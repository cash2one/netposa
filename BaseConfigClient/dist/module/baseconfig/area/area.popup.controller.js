define(["require", "exports", "../../common/app/main.app", "../../common/directive/tree/tree-params", "../../common/services/area.service"], function (require, exports, main_app_1, tree_params_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var AreaPopupController = (function () {
        function AreaPopupController($scope, $rootScope, areaService, $q, $timeout) {
            $scope.$on("$destroy", function () {
                console.error("销毁了弹出框");
            });
            var vm = this;
            vm.curdType = $scope.curdType;
            vm.Area = {};
            vm.treeParams = new tree_params_1.TreeDataParams();
            vm.treeParams.treeId = "areaPopupAreaTree";
            vm.treeParams.isDefaultSelected = true;
            vm.treeParams.onClick = treeSelectNode;
            if (vm.curdType === 'add') {
                vm.Area.ParentArea = {};
                vm.Area.ParentArea.ID = $scope.currentArea.ID;
                vm.Area.ParentArea.Name = $scope.currentArea.Name;
                vm.submit = saveArea;
                areaService.findListTree().then(function (datas) {
                    $timeout(function () {
                        vm.treeParams.treeDatas = datas;
                        vm.treeParams.defaultSelectTreeId = vm.Area.ParentArea.ID;
                    });
                });
            }
            else if (vm.curdType === 'edit') {
                vm.submit = editArea;
                console.log($scope.currentArea);
                $q.all([areaService.get($scope.currentArea.ID), areaService.findListTree()])
                    .then(function (res) {
                    var r0 = res[0];
                    var r1 = res[1];
                    if (r0.code !== 200) {
                        return $q.reject(r0.code);
                    }
                    $timeout(function () {
                        if (r0.data) {
                            vm.Area = r0.data;
                            console.log(vm.Area);
                            if (vm.Area.ParentID == null) {
                                vm.isRootArea = true;
                            }
                            else {
                                vm.treeParams.treeDatas = r1;
                                if (vm.Area && vm.Area.ParentArea) {
                                    vm.treeParams.defaultSelectTreeId = vm.Area.ParentArea.ID;
                                }
                            }
                        }
                    });
                });
            }
            vm.cancel = cancelAreaPopup;
            function treeSelectNode(event, treeId, treeNode) {
                $timeout(function () {
                    vm.Area.ParentArea = treeNode;
                    vm.isShowAreaTree = false;
                });
            }
            function saveArea() {
                if (!validate())
                    return;
                areaService.save(vm.Area).then(complete).then(closePopup);
                function complete(res) {
                    console.log(res);
                    if (res.code === 200) {
                        return null;
                    }
                    else {
                        return $q.reject(res.code);
                    }
                }
                function closePopup() {
                    $rootScope.$broadcast('area.closePopup', true);
                }
            }
            function editArea() {
                if (!validate())
                    return;
                areaService.edit(vm.Area).then(complete).then(closePopup);
                function complete(res) {
                    console.log("editArea complete", res);
                    if (res.code === 200) {
                        return null;
                    }
                    else {
                        return $q.reject(res.code);
                    }
                }
                function closePopup() {
                    $rootScope.$broadcast('area.closePopup', true);
                }
            }
            function validate() {
                var result = true;
                if (!vm.Area.Code) {
                    result = false;
                }
                else if (!vm.Area.Name) {
                    result = false;
                }
                return result;
            }
            function cancelAreaPopup() {
                $rootScope.$broadcast('area.closePopup');
            }
        }
        AreaPopupController.$inject = ['$scope', '$rootScope', 'areaService', '$q', '$timeout'];
        return AreaPopupController;
    }());
    main_app_1.app
        .controller('areaPopupController', AreaPopupController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvYmFzZWNvbmZpZy9hcmVhL2FyZWEucG9wdXAuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFXQTtRQVlJLDZCQUFZLE1BQVcsRUFBRSxVQUFlLEVBQUUsV0FBeUIsRUFBRSxFQUFPLEVBQUUsUUFBYTtZQUV2RixNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRTtnQkFDbkIsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsQ0FBQztZQUdILElBQUksRUFBRSxHQUFHLElBQUksQ0FBQztZQUNkLEVBQUUsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUM5QixFQUFFLENBQUMsSUFBSSxHQUFHLEVBQVksQ0FBQztZQUV2QixFQUFFLENBQUMsVUFBVSxHQUFHLElBQUksNEJBQWMsRUFBVSxDQUFDO1lBQzdDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLG1CQUFtQixDQUFDO1lBQzNDLEVBQUUsQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1lBQ3ZDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLGNBQWMsQ0FBQztZQUV2QyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsUUFBUSxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQVUsQ0FBQztnQkFDaEMsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO2dCQUM5QyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUM7Z0JBQ2xELEVBQUUsQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDO2dCQUVyQixXQUFXLENBQUMsWUFBWSxFQUFFLENBQUMsSUFB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QixNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNuQixDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDdkIsTUFBTSxHQUFHLEtBQUssQ0FBQztnQkFDbkIsQ0FBQztnQkFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQ2xCLENBQUM7WUFFRDtnQkFDSSxVQUFVLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNMLENBQUM7UUFsSU0sMkJBQU8sR0FBRyxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztRQW1JL0UsMEJBQUM7S0FwSUQsQUFvSUMsSUFBQTtJQUVELGNBQUc7U0FDRSxVQUFVLENBQUMscUJBQXFCLEVBQUUsbUJBQW1CLENBQUMsQ0FBQyIsImZpbGUiOiJtb2R1bGUvYmFzZWNvbmZpZy9hcmVhL2FyZWEucG9wdXAuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGRlbGwgb24gMjAxNy8zLzI5LlxyXG4gKi9cclxuaW1wb3J0IHthcHB9IGZyb20gXCIuLi8uLi9jb21tb24vYXBwL21haW4uYXBwXCI7XHJcbmltcG9ydCAnLi4vLi4vY29tbW9uL3NlcnZpY2VzL2FyZWEuc2VydmljZSc7XHJcbmltcG9ydCB7QXJlYX0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L0FyZWFcIjtcclxuaW1wb3J0IHtBcmVhRXh9IGZyb20gXCIuLi8uLi8uLi9jb3JlL2VudGl0eS9leC9BcmVhRXhcIjtcclxuaW1wb3J0IHtSZXNwb25zZVJlc3VsdH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvcGFyYW1zL3Jlc3VsdC9SZXNwb25zZVJlc3VsdFwiO1xyXG5pbXBvcnQge0lBcmVhU2VydmljZX0gZnJvbSBcIi4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9hcmVhLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtUcmVlRGF0YVBhcmFtc30gZnJvbSBcIi4uLy4uL2NvbW1vbi9kaXJlY3RpdmUvdHJlZS90cmVlLXBhcmFtc1wiO1xyXG5cclxuY2xhc3MgQXJlYVBvcHVwQ29udHJvbGxlciB7XHJcbiAgICBzdGF0aWMgJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnYXJlYVNlcnZpY2UnLCAnJHEnLCAnJHRpbWVvdXQnXTtcclxuICAgIGN1cmRUeXBlOiBzdHJpbmc7XHJcbiAgICBBcmVhOiBBcmVhRXg7XHJcbiAgICBzdWJtaXQ6IEZ1bmN0aW9uO1xyXG4gICAgY2FuY2VsOiBGdW5jdGlvbjtcclxuICAgIHRyZWVQYXJhbXM6IFRyZWVEYXRhUGFyYW1zPEFyZWFFeD47XHJcbiAgICBpc1Nob3dBcmVhVHJlZTogYm9vbGVhbjtcclxuICAgIC8vIOaYr+WQpuaYr+agueWMuuWfnywg5Y+q5pyJ5Zyo5L+u5pS55pON5L2c5pe255Sf5pWIXHJcbiAgICAvLyDlvZPliY3ljLrln5/mmK/moLnljLrln5/ml7YsIOS4jeWFgeiuuOmAieaLqeaguee7k+eCuVxyXG4gICAgaXNSb290QXJlYTogYm9vbGVhbjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcigkc2NvcGU6IGFueSwgJHJvb3RTY29wZTogYW55LCBhcmVhU2VydmljZTogSUFyZWFTZXJ2aWNlLCAkcTogYW55LCAkdGltZW91dDogYW55KSB7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oXCIkZGVzdHJveVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLplIDmr4HkuoblvLnlh7rmoYZcIik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIOWIneWni+WMluWPguaVsCwg5LuOcGFyZW50U2NvcGXkuK3ojrflj5bliLDlj4LmlbBcclxuICAgICAgICB2YXIgdm0gPSB0aGlzOyAvLyDkvb/nlKh0aGlz5pu/5LujJHNjb3BlXHJcbiAgICAgICAgdm0uY3VyZFR5cGUgPSAkc2NvcGUuY3VyZFR5cGU7XHJcbiAgICAgICAgdm0uQXJlYSA9IHt9IGFzIEFyZWFFeDtcclxuXHJcbiAgICAgICAgdm0udHJlZVBhcmFtcyA9IG5ldyBUcmVlRGF0YVBhcmFtczxBcmVhRXg+KCk7XHJcbiAgICAgICAgdm0udHJlZVBhcmFtcy50cmVlSWQgPSBcImFyZWFQb3B1cEFyZWFUcmVlXCI7XHJcbiAgICAgICAgdm0udHJlZVBhcmFtcy5pc0RlZmF1bHRTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgdm0udHJlZVBhcmFtcy5vbkNsaWNrID0gdHJlZVNlbGVjdE5vZGU7XHJcblxyXG4gICAgICAgIGlmICh2bS5jdXJkVHlwZSA9PT0gJ2FkZCcpIHtcclxuICAgICAgICAgICAgdm0uQXJlYS5QYXJlbnRBcmVhID0ge30gYXMgQXJlYTtcclxuICAgICAgICAgICAgdm0uQXJlYS5QYXJlbnRBcmVhLklEID0gJHNjb3BlLmN1cnJlbnRBcmVhLklEO1xyXG4gICAgICAgICAgICB2bS5BcmVhLlBhcmVudEFyZWEuTmFtZSA9ICRzY29wZS5jdXJyZW50QXJlYS5OYW1lO1xyXG4gICAgICAgICAgICB2bS5zdWJtaXQgPSBzYXZlQXJlYTtcclxuICAgICAgICAgICAgLy8g5p+l6K+i5qCR57uT54K55pWw5o2u5YaN5Yid5aeL5YyWXHJcbiAgICAgICAgICAgIGFyZWFTZXJ2aWNlLmZpbmRMaXN0VHJlZSgpLnRoZW4oKGRhdGFzOiBBcnJheTxBcmVhRXg+KT0+IHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KCgpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udHJlZVBhcmFtcy50cmVlRGF0YXMgPSBkYXRhcztcclxuICAgICAgICAgICAgICAgICAgICB2bS50cmVlUGFyYW1zLmRlZmF1bHRTZWxlY3RUcmVlSWQgPSB2bS5BcmVhLlBhcmVudEFyZWEuSUQ7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOagkeiKgueCuem7mOiupOmAieS4reeahOaYr+W9k+WJjemAieaLqeeahOeItuiKgueCuWlkXHJcbiAgICAgICAgICAgIC8vIOWIneWni+WMluagkeiKgueCuVxyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKHZtLmN1cmRUeXBlID09PSAnZWRpdCcpIHtcclxuICAgICAgICAgICAgdm0uc3VibWl0ID0gZWRpdEFyZWE7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5jdXJyZW50QXJlYSk7XHJcbiAgICAgICAgICAgICRxLmFsbChbYXJlYVNlcnZpY2UuZ2V0KCRzY29wZS5jdXJyZW50QXJlYS5JRCksIGFyZWFTZXJ2aWNlLmZpbmRMaXN0VHJlZSgpXSlcclxuICAgICAgICAgICAgICAgIC50aGVuKChyZXM6IFtSZXNwb25zZVJlc3VsdDxBcmVhRXg+LCBBcnJheTxBcmVhRXg+XSk9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHIwID0gcmVzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByMSA9IHJlc1sxXTtcclxuICAgICAgICAgICAgICAgICAgICBpZihyMC5jb2RlICE9PSAyMDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHIwLmNvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoKCk9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyMC5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5BcmVhID0gcjAuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZtLkFyZWEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodm0uQXJlYS5QYXJlbnRJRCA9PSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc1Jvb3RBcmVhID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRyZWVQYXJhbXMudHJlZURhdGFzID0gcjE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLkFyZWEgJiYgdm0uQXJlYS5QYXJlbnRBcmVhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRyZWVQYXJhbXMuZGVmYXVsdFNlbGVjdFRyZWVJZCA9IHZtLkFyZWEuUGFyZW50QXJlYS5JRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbEFyZWFQb3B1cDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdHJlZVNlbGVjdE5vZGUoZXZlbnQ6IE1vdXNlRXZlbnQsIHRyZWVJZDogc3RyaW5nLCB0cmVlTm9kZTogQXJlYUV4KSB7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KCgpPT57XHJcbiAgICAgICAgICAgICAgICB2bS5BcmVhLlBhcmVudEFyZWEgPSB0cmVlTm9kZTtcclxuICAgICAgICAgICAgICAgIHZtLmlzU2hvd0FyZWFUcmVlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlQXJlYSgpIHtcclxuICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZSgpKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBhcmVhU2VydmljZS5zYXZlKHZtLkFyZWEpLnRoZW4oY29tcGxldGUpLnRoZW4oY2xvc2VQb3B1cCk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZShyZXM6IFJlc3BvbnNlUmVzdWx0PHN0cmluZz4pIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuY29kZSA9PT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6LCD55So5YWz6Zet56qX5Y+j5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzLmNvZGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVBvcHVwKCkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhcmVhLmNsb3NlUG9wdXAnLCB0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZWRpdEFyZWEoKSB7XHJcbiAgICAgICAgICAgIGlmICghdmFsaWRhdGUoKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgYXJlYVNlcnZpY2UuZWRpdCh2bS5BcmVhKS50aGVuKGNvbXBsZXRlKS50aGVuKGNsb3NlUG9wdXApO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGUocmVzOiBSZXNwb25zZVJlc3VsdDxzdHJpbmc+KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVkaXRBcmVhIGNvbXBsZXRlXCIsIHJlcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlcy5jb2RlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VQb3B1cCgpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYXJlYS5jbG9zZVBvcHVwJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlKCkge1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKCF2bS5BcmVhLkNvZGUpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCF2bS5BcmVhLk5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWxBcmVhUG9wdXAoKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYXJlYS5jbG9zZVBvcHVwJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5hcHBcclxuICAgIC5jb250cm9sbGVyKCdhcmVhUG9wdXBDb250cm9sbGVyJywgQXJlYVBvcHVwQ29udHJvbGxlcik7Il19

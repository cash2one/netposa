define(["require", "exports", "../../common/app/main.app", "../../common/router/router.service", "./MenuEmus", "css!../style/IntelligentAnalysis.css", "../../common/factory/layerMsg.factory", "./analysisMmap.server", "../../common/services/map.service", "./page.controller", "es6-promise"], function (require, exports, main_app_1, router_service_1, MenuEmus_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var IntelligentAnalysisController = (function () {
        function IntelligentAnalysisController($scope, $stateParams, $timeout, i18nFactory, mapService, $q, $state, $sce, layerDec, analysisMmapServer) {
            var _this = this;
            this.$scope = $scope;
            this.$stateParams = $stateParams;
            this.$timeout = $timeout;
            this.i18nFactory = i18nFactory;
            this.mapService = mapService;
            this.$q = $q;
            this.$state = $state;
            this.$sce = $sce;
            this.layerDec = layerDec;
            this.analysisMmapServer = analysisMmapServer;
            this.mapId = "AnalysisMap";
            this.CurrentType = null;
            this.isShowMenuList = false;
            this.isShowItemPage = false;
            this.isShowCarIframe = false;
            this.CarMenuList = MenuEmus_1.initCarMenu();
            this.initPageAuth();
            this.initModuleData();
            this.analysisMmapServer.initMap().then(function () {
                _this.getSystemPoint().then(function (res) {
                    _this.analysisMmapServer.renderSystemPoint(_this.resetSystemPoint(res), true);
                });
            });
            this.$scope.$on("$destroy", function () {
                _this.analysisMmapServer.destory();
            });
            this.$scope.$on('showItemPage', function (event, flag) {
                _this.isShowItemPage = flag;
                _this.isShowMenuList = !flag;
                if (!_this.isShowItemPage) {
                    _this.$state.go('IntelligentAnalysis');
                }
            });
            var AnalysisType = localStorage.getItem("AnalysisType");
            if (AnalysisType) {
                this.changePageType(AnalysisType);
                localStorage.removeItem("AnalysisType");
            }
        }
        IntelligentAnalysisController.prototype.resetSystemPoint = function (arr) {
            arr.forEach(function (item, index) {
                if (item.IsRelate === 1) {
                    arr.splice(index, 1);
                }
            });
            return arr;
        };
        ;
        IntelligentAnalysisController.prototype.initPageAuth = function () {
            var faceList = [];
            var macList = [];
            var multiList = [];
            var moduleItems = router_service_1.default.getInstance().getModuleItemsWithGroup('IntelligentAnalysis');
            var carItem = MenuEmus_1.initCarMenu(), faceItems = MenuEmus_1.initFaceMenu(), macItems = MenuEmus_1.initMacMenu(), multiItems = MenuEmus_1.initMultiMenu();
            for (var l = 0; l < moduleItems.length; l++) {
                var module = moduleItems[l];
                var s = false;
                for (var i = 0; i < faceItems.length; i++) {
                    var item = faceItems[i];
                    if (item.path === module.key) {
                        s = true;
                        faceList.push(item);
                        break;
                    }
                }
                if (s)
                    continue;
                for (var i = 0; i < macItems.length; i++) {
                    var item = macItems[i];
                    if (item.path === module.key) {
                        s = true;
                        macList.push(item);
                        break;
                    }
                }
                if (s)
                    continue;
                for (var i = 0; i < multiItems.length; i++) {
                    var item = multiItems[i];
                    if (item.path === module.key) {
                        multiList.push(item);
                        break;
                    }
                }
            }
            this.FaceMenuList = faceList;
            this.MacMenuList = macList;
            this.MultiMenuList = multiList;
        };
        IntelligentAnalysisController.prototype.changePageType = function (type) {
            if (this.isShowItemPage) {
                this.$state.go('IntelligentAnalysis');
                this.isShowItemPage = false;
                this.CurrentType = type;
                this.isShowMenuList = true;
                if (this.CurrentType === 'Car') {
                    this.MenuList = this.CarMenuList;
                }
                else if (this.CurrentType === 'Face') {
                    this.MenuList = this.FaceMenuList;
                }
                else if (this.CurrentType === 'Mac') {
                    this.MenuList = this.MacMenuList;
                }
                else if (this.CurrentType === 'Multi') {
                    this.MenuList = this.MultiMenuList;
                }
                else {
                    return;
                }
                return;
            }
            if (this.CurrentType === type) {
                this.CurrentType = null;
                this.isShowMenuList = false;
            }
            else {
                this.CurrentType = type;
                this.isShowMenuList = true;
                if (this.CurrentType === 'Car') {
                    this.MenuList = this.CarMenuList;
                    this.isShowCarIframe = false;
                    this.iframeSrc = null;
                }
                else if (this.CurrentType === 'Face') {
                    this.MenuList = this.FaceMenuList;
                }
                else if (this.CurrentType === 'Mac') {
                    this.MenuList = this.MacMenuList;
                }
                else if (this.CurrentType === 'Multi') {
                    this.MenuList = this.MultiMenuList;
                }
                else {
                    return;
                }
            }
        };
        IntelligentAnalysisController.prototype.goMenu = function (item) {
            if (item.type === 'Car') {
                this.isShowCarIframe = true;
                this.isShowMenuList = false;
                this.CurrentType = null;
                this.iframeSrc = this.$sce.trustAsResourceUrl(item.path);
            }
            else {
                this.isShowCarIframe = false;
                this.iframeSrc = null;
                this.$state.go(item.path);
            }
        };
        IntelligentAnalysisController.prototype.initModuleData = function () {
            this.MenuList = angular.copy(this.CarMenuList);
        };
        IntelligentAnalysisController.prototype.getSystemPoint = function () {
            var _this = this;
            return this.mapService.getSystemPoints().then(function (res) {
                var arr = [];
                if (res.code === 200 && Array.isArray(res.data)) {
                    res.data.forEach(function (item) {
                        if (item.LayerType && item.Lat && item.Lon) {
                            arr.push(item);
                        }
                    });
                    var a_1 = [], b_1 = [], c_1 = [], d_1 = [], e_1 = [];
                    res.data.forEach(function (item) {
                        var type = item.LayerType.toLocaleLowerCase();
                        if (type.indexOf('camera') > -1) {
                            a_1.push(item);
                        }
                        if (type.indexOf('wifi') > -1) {
                            b_1.push(item);
                        }
                        if (type.indexOf('efence') > -1) {
                            c_1.push(item);
                        }
                        if (type.indexOf('rmpgate') > -1) {
                            d_1.push(item);
                        }
                        if (type.indexOf('lamppost') > -1) {
                            e_1.push(item);
                        }
                    });
                }
                else {
                    _this.layerDec.warnInfo('未获取到点位信息');
                }
                _this.$scope.systemPoint = arr;
                _this.$scope.$broadcast('points.ready', _this.$scope.systemPoint);
                return arr;
            });
        };
        IntelligentAnalysisController.$inject = ['$scope', '$stateParams', '$timeout', 'i18nFactory', 'mapService', '$q', '$state', '$sce', 'layerDec', 'analysisMmapServer'];
        return IntelligentAnalysisController;
    }());
    main_app_1.app.controller('IntelligentAnalysisController', IntelligentAnalysisController);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tb2R1bGUvSW50ZWxsaWdlbnRBbmFseXNpcy9tYWluL21haW4uY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUF3QkE7UUFjSSx1Q0FBb0IsTUFBVyxFQUNYLFlBQWlCLEVBQ2pCLFFBQWtCLEVBQ2xCLFdBQWdCLEVBQ2hCLFVBQXVCLEVBQ3ZCLEVBQU8sRUFDUCxNQUFXLEVBQ1gsSUFBUyxFQUNULFFBQW1CLEVBQ25CLGtCQUF1QztZQVQzRCxpQkFrQ0M7WUFsQ21CLFdBQU0sR0FBTixNQUFNLENBQUs7WUFDWCxpQkFBWSxHQUFaLFlBQVksQ0FBSztZQUNqQixhQUFRLEdBQVIsUUFBUSxDQUFVO1lBQ2xCLGdCQUFXLEdBQVgsV0FBVyxDQUFLO1lBQ2hCLGVBQVUsR0FBVixVQUFVLENBQWE7WUFDdkIsT0FBRSxHQUFGLEVBQUUsQ0FBSztZQUNQLFdBQU0sR0FBTixNQUFNLENBQUs7WUFDWCxTQUFJLEdBQUosSUFBSSxDQUFLO1lBQ1QsYUFBUSxHQUFSLFFBQVEsQ0FBVztZQUNuQix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQXFCO1lBckIzRCxVQUFLLEdBQVcsYUFBYSxDQUFDO1lBQzlCLGdCQUFXLEdBQVcsSUFBSSxDQUFDO1lBQzNCLG1CQUFjLEdBQVksS0FBSyxDQUFDO1lBQ2hDLG1CQUFjLEdBQVksS0FBSyxDQUFDO1lBQ2hDLG9CQUFlLEdBQVksS0FBSyxDQUFDO1lBRWpDLGdCQUFXLEdBQW9CLHNCQUFXLEVBQUUsQ0FBQztZQWdCekMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN0QixJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDO2dCQUNuQyxLQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBdUI7b0JBQy9DLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ2hGLENBQUMsQ0FBQyxDQUFBO1lBRU4sQ0FBQyxDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3hCLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN0QyxDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxVQUFDLEtBQVksRUFBRSxJQUFhO2dCQUN4RCxLQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztnQkFDM0IsS0FBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDNUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztvQkFDdkIsS0FBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDMUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSyxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUN6RCxFQUFFLENBQUEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO2dCQUNkLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ2xDLFlBQVksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDNUMsQ0FBQztRQUNMLENBQUM7UUFDTyx3REFBZ0IsR0FBeEIsVUFBeUIsR0FBdUI7WUFDNUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQWdCLEVBQUMsS0FBWTtnQkFDdEMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUMsQ0FBQSxDQUFDO29CQUNwQixHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBQyxDQUFDLENBQUMsQ0FBQTtnQkFDdkIsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQztRQUNmLENBQUM7UUFBQSxDQUFDO1FBRU0sb0RBQVksR0FBcEI7WUFDSSxJQUFJLFFBQVEsR0FBRyxFQUFxQixDQUFDO1lBQ3JDLElBQUksT0FBTyxHQUFHLEVBQXFCLENBQUM7WUFDcEMsSUFBSSxTQUFTLEdBQUcsRUFBcUIsQ0FBQztZQUN0QyxJQUFJLFdBQVcsR0FBRyx3QkFBYSxDQUFDLFdBQVcsRUFBRSxDQUFDLHVCQUF1QixDQUFDLHFCQUFxQixDQUFDLENBQUM7WUFDN0YsSUFBSSxPQUFPLEdBQUcsc0JBQVcsRUFBRSxFQUFlLFNBQVMsR0FBRyx1QkFBWSxFQUFFLEVBQUUsUUFBUSxHQUFHLHNCQUFXLEVBQUUsRUFDMUYsVUFBVSxHQUFHLHdCQUFhLEVBQUUsQ0FBQztZQUNqQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDMUMsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQ2QsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ3hDLElBQUksSUFBSSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQWEsQ0FBQztvQkFDcEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzt3QkFDM0IsQ0FBQyxHQUFHLElBQUksQ0FBQzt3QkFDVCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNwQixLQUFLLENBQUM7b0JBQ1YsQ0FBQztnQkFDTCxDQUFDO2dCQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFBQyxRQUFRLENBQUM7Z0JBQ2hCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUN2QyxJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFhLENBQUM7b0JBQ25DLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQzNCLENBQUMsR0FBRyxJQUFJLENBQUM7d0JBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDbkIsS0FBSyxDQUFDO29CQUNWLENBQUM7Z0JBQ0wsQ0FBQztnQkFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQUMsUUFBUSxDQUFDO2dCQUNoQixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDekMsSUFBSSxJQUFJLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBYSxDQUFDO29CQUNyQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUUzQixTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNyQixLQUFLLENBQUM7b0JBQ1YsQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQztZQUNELElBQUksQ0FBQyxZQUFZLEdBQUcsUUFBUSxDQUFDO1lBQzdCLElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO1lBQzNCLElBQUksQ0FBQyxhQUFhLEdBQUcsU0FBUyxDQUFDO1FBQ25DLENBQUM7UUFFRCxzREFBYyxHQUFkLFVBQWUsSUFBWTtZQUN2QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2dCQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztnQkFDM0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUM3QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQ3JDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDckMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFBO2dCQUNyQyxDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7b0JBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQTtnQkFDcEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUN0QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUE7Z0JBQ3RDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osTUFBTSxDQUFBO2dCQUNWLENBQUM7Z0JBQ0QsTUFBTSxDQUFBO1lBQ1YsQ0FBQztZQUdELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO1lBQ2hDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztnQkFDeEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7Z0JBQzNCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFDN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO29CQUNqQyxJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztvQkFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQzFCLENBQUM7Z0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDckMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFBO2dCQUNyQyxDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7b0JBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQTtnQkFDcEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUN0QyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUE7Z0JBQ3RDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osTUFBTSxDQUFBO2dCQUNWLENBQUM7WUFDTCxDQUFDO1FBQ0wsQ0FBQztRQUVELDhDQUFNLEdBQU4sVUFBTyxJQUFjO1lBQ2pCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO2dCQUM1QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztnQkFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3RCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osSUFBSSxDQUFDLGVBQWUsR0FBRyxLQUFLLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUIsQ0FBQztRQUVMLENBQUM7UUFFTyxzREFBYyxHQUF0QjtZQUNJLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbkQsQ0FBQztRQUdPLHNEQUFjLEdBQXRCO1lBQUEsaUJBb0NDO1lBbkNHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQXVDO2dCQUNsRixJQUFJLEdBQUcsR0FBRyxFQUF3QixDQUFDO2dCQUNuQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzlDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBaUI7d0JBQy9CLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDekMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDbkIsQ0FBQztvQkFDTCxDQUFDLENBQUMsQ0FBQztvQkFFSCxJQUFJLEdBQUMsR0FBRyxFQUF3QixFQUFFLEdBQUMsR0FBRyxFQUF3QixFQUFFLEdBQUMsR0FBRyxFQUF3QixFQUFFLEdBQUMsR0FBRyxFQUF3QixFQUFFLEdBQUMsR0FBRyxFQUF3QixDQUFBO29CQUN4SixHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQWlCO3dCQUMvQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLENBQUM7d0JBQzlDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM5QixHQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO3dCQUNoQixDQUFDO3dCQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM1QixHQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO3dCQUNoQixDQUFDO3dCQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM5QixHQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO3dCQUNoQixDQUFDO3dCQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUMvQixHQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO3dCQUNoQixDQUFDO3dCQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUNoQyxHQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO3dCQUNoQixDQUFDO29CQUNMLENBQUMsQ0FBQyxDQUFDO2dCQUNQLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ0osS0FBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUE7Z0JBQ3RDLENBQUM7Z0JBQ0QsS0FBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDO2dCQUM5QixLQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsS0FBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDaEUsTUFBTSxDQUFDLEdBQUcsQ0FBQztZQUNmLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQXJNTSxxQ0FBTyxHQUFHLENBQUMsUUFBUSxFQUFDLGNBQWMsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQXVNbEosb0NBQUM7S0F4TUQsQUF3TUMsSUFBQTtJQUVELGNBQUcsQ0FBQyxVQUFVLENBQUMsK0JBQStCLEVBQUUsNkJBQTZCLENBQUMsQ0FBQyIsImZpbGUiOiJtb2R1bGUvSW50ZWxsaWdlbnRBbmFseXNpcy9tYWluL21haW4uY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YXBwfSBmcm9tIFwiLi4vLi4vY29tbW9uL2FwcC9tYWluLmFwcFwiO1xyXG5pbXBvcnQgJ2NzcyEuLi9zdHlsZS9JbnRlbGxpZ2VudEFuYWx5c2lzLmNzcydcclxuLy8gaW1wb3J0ICdjc3MhLi4vc3R5bGUvYmFzZS5jc3MnXHJcbi8vIGltcG9ydCAnY3NzIS4uL3N0eWxlL0ZhY2VUcmFjay5jc3MnXHJcblxyXG4vLyDmnI3liqFcclxuaW1wb3J0IFwiLi4vLi4vY29tbW9uL2ZhY3RvcnkvbGF5ZXJNc2cuZmFjdG9yeVwiO1xyXG5pbXBvcnQge0lMYXllckRlY30gZnJvbSBcIi4uLy4uL2NvbW1vbi9mYWN0b3J5L2xheWVyTXNnLmZhY3RvcnlcIjtcclxuaW1wb3J0IFwiLi9hbmFseXNpc01tYXAuc2VydmVyXCI7XHJcbmltcG9ydCB7SUFuYWx5c2lzTW1hcFNlcnZlcn0gZnJvbSBcIi4vYW5hbHlzaXNNbWFwLnNlcnZlclwiO1xyXG5pbXBvcnQgJy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9tYXAuc2VydmljZSc7XHJcbmltcG9ydCB7SU1hcFNlcnZpY2V9IGZyb20gJy4uLy4uL2NvbW1vbi9zZXJ2aWNlcy9tYXAuc2VydmljZSc7XHJcblxyXG4vLyDlj4LmlbBcclxuaW1wb3J0IHtTeXN0ZW1Qb2ludH0gZnJvbSBcIi4uLy4uLy4uL2NvcmUvZW50aXR5L1N5c3RlbVBvaW50XCI7XHJcbmltcG9ydCB7UmVzcG9uc2VSZXN1bHR9IGZyb20gXCIuLi8uLi8uLi9jb3JlL3BhcmFtcy9yZXN1bHQvUmVzcG9uc2VSZXN1bHRcIjtcclxuaW1wb3J0IFJvdXRlclNlcnZpY2UgZnJvbSBcIi4uLy4uL2NvbW1vbi9yb3V0ZXIvcm91dGVyLnNlcnZpY2VcIjtcclxuaW1wb3J0IHtNZW51RW11cywgaW5pdENhck1lbnUsIGluaXRGYWNlTWVudSwgaW5pdE1hY01lbnUsIGluaXRNdWx0aU1lbnV9IGZyb20gJy4vTWVudUVtdXMnO1xyXG5cclxuaW1wb3J0ICcuL3BhZ2UuY29udHJvbGxlcidcclxuaW1wb3J0IFwiZXM2LXByb21pc2VcIjtcclxuXHJcbmRlY2xhcmUgbGV0ICQ6IGFueSwgYW5ndWxhcjogYW55O1xyXG5cclxuY2xhc3MgSW50ZWxsaWdlbnRBbmFseXNpc0NvbnRyb2xsZXIge1xyXG4gICAgc3RhdGljICRpbmplY3QgPSBbJyRzY29wZScsJyRzdGF0ZVBhcmFtcycsICckdGltZW91dCcsICdpMThuRmFjdG9yeScsICdtYXBTZXJ2aWNlJywgJyRxJywgJyRzdGF0ZScsICckc2NlJywgJ2xheWVyRGVjJywgJ2FuYWx5c2lzTW1hcFNlcnZlciddO1xyXG4gICAgbWFwSWQ6IHN0cmluZyA9IFwiQW5hbHlzaXNNYXBcIjtcclxuICAgIEN1cnJlbnRUeXBlOiBzdHJpbmcgPSBudWxsO1xyXG4gICAgaXNTaG93TWVudUxpc3Q6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGlzU2hvd0l0ZW1QYWdlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBpc1Nob3dDYXJJZnJhbWU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGlmcmFtZVNyYzogc3RyaW5nO1xyXG4gICAgQ2FyTWVudUxpc3Q6IEFycmF5PE1lbnVFbXVzPiA9IGluaXRDYXJNZW51KCk7XHJcbiAgICBGYWNlTWVudUxpc3Q6IEFycmF5PE1lbnVFbXVzPjtcclxuICAgIE1hY01lbnVMaXN0OiBBcnJheTxNZW51RW11cz47XHJcbiAgICBNdWx0aU1lbnVMaXN0OiBBcnJheTxNZW51RW11cz47XHJcbiAgICBNZW51TGlzdDogQXJyYXk8TWVudUVtdXM+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgJHNjb3BlOiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlICRzdGF0ZVBhcmFtczogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSAkdGltZW91dDogRnVuY3Rpb24sXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIGkxOG5GYWN0b3J5OiBhbnksXHJcbiAgICAgICAgICAgICAgICBwcml2YXRlIG1hcFNlcnZpY2U6IElNYXBTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSAkcTogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSAkc3RhdGU6IGFueSxcclxuICAgICAgICAgICAgICAgIHByaXZhdGUgJHNjZTogYW55LFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBsYXllckRlYzogSUxheWVyRGVjLFxyXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhbmFseXNpc01tYXBTZXJ2ZXI6IElBbmFseXNpc01tYXBTZXJ2ZXIpIHtcclxuICAgICAgICB0aGlzLmluaXRQYWdlQXV0aCgpO1xyXG4gICAgICAgIHRoaXMuaW5pdE1vZHVsZURhdGEoKTtcclxuICAgICAgICB0aGlzLmFuYWx5c2lzTW1hcFNlcnZlci5pbml0TWFwKCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0U3lzdGVtUG9pbnQoKS50aGVuKChyZXM6IEFycmF5PFN5c3RlbVBvaW50PikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbmFseXNpc01tYXBTZXJ2ZXIucmVuZGVyU3lzdGVtUG9pbnQodGhpcy5yZXNldFN5c3RlbVBvaW50KHJlcyksIHRydWUpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLiRzY29wZS4kb24oXCIkZGVzdHJveVwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYW5hbHlzaXNNbWFwU2VydmVyLmRlc3RvcnkoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLiRzY29wZS4kb24oJ3Nob3dJdGVtUGFnZScsIChldmVudDogRXZlbnQsIGZsYWc6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pc1Nob3dJdGVtUGFnZSA9IGZsYWc7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93TWVudUxpc3QgPSAhZmxhZztcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU2hvd0l0ZW1QYWdlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLiRzdGF0ZS5nbygnSW50ZWxsaWdlbnRBbmFseXNpcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8g5Yik5pat6buY6K6k5bGV56S65qih5Z2XXHJcbiAgICAgICAgbGV0ICBBbmFseXNpc1R5cGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIkFuYWx5c2lzVHlwZVwiKTtcclxuICAgICAgICBpZihBbmFseXNpc1R5cGUpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFuZ2VQYWdlVHlwZShBbmFseXNpc1R5cGUpO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcIkFuYWx5c2lzVHlwZVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwcml2YXRlIHJlc2V0U3lzdGVtUG9pbnQoYXJyOiBBcnJheTxTeXN0ZW1Qb2ludD4pOiBBcnJheTxTeXN0ZW1Qb2ludD57XHJcbiAgICAgICAgYXJyLmZvckVhY2goKGl0ZW06U3lzdGVtUG9pbnQsaW5kZXg6bnVtYmVyKT0+e1xyXG4gICAgICAgICAgICBpZihpdGVtLklzUmVsYXRlID09PSAxKXtcclxuICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsMSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBhcnI7XHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgaW5pdFBhZ2VBdXRoKCkge1xyXG4gICAgICAgIGxldCBmYWNlTGlzdCA9IFtdIGFzIEFycmF5PE1lbnVFbXVzPjtcclxuICAgICAgICBsZXQgbWFjTGlzdCA9IFtdIGFzIEFycmF5PE1lbnVFbXVzPjtcclxuICAgICAgICBsZXQgbXVsdGlMaXN0ID0gW10gYXMgQXJyYXk8TWVudUVtdXM+O1xyXG4gICAgICAgIGxldCBtb2R1bGVJdGVtcyA9IFJvdXRlclNlcnZpY2UuZ2V0SW5zdGFuY2UoKS5nZXRNb2R1bGVJdGVtc1dpdGhHcm91cCgnSW50ZWxsaWdlbnRBbmFseXNpcycpO1xyXG4gICAgICAgIGxldCBjYXJJdGVtID0gaW5pdENhck1lbnUoKS8q6L2m6L6G5pyq5ZCv55So6Lev55Sx5o6n5Yi2Ki8sIGZhY2VJdGVtcyA9IGluaXRGYWNlTWVudSgpLCBtYWNJdGVtcyA9IGluaXRNYWNNZW51KCksXHJcbiAgICAgICAgICAgIG11bHRpSXRlbXMgPSBpbml0TXVsdGlNZW51KCk7XHJcbiAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgPCBtb2R1bGVJdGVtcy5sZW5ndGg7IGwrKykge1xyXG4gICAgICAgICAgICBsZXQgbW9kdWxlID0gbW9kdWxlSXRlbXNbbF07XHJcbiAgICAgICAgICAgIGxldCBzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZUl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGZhY2VJdGVtc1tpXSBhcyBNZW51RW11cztcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnBhdGggPT09IG1vZHVsZS5rZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmYWNlTGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzKSBjb250aW51ZTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYWNJdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBtYWNJdGVtc1tpXSBhcyBNZW51RW11cztcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnBhdGggPT09IG1vZHVsZS5rZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBtYWNMaXN0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHMpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG11bHRpSXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbXVsdGlJdGVtc1tpXSBhcyBNZW51RW11cztcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnBhdGggPT09IG1vZHVsZS5rZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3MgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIG11bHRpTGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuRmFjZU1lbnVMaXN0ID0gZmFjZUxpc3Q7XHJcbiAgICAgICAgdGhpcy5NYWNNZW51TGlzdCA9IG1hY0xpc3Q7XHJcbiAgICAgICAgdGhpcy5NdWx0aU1lbnVMaXN0ID0gbXVsdGlMaXN0O1xyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZVBhZ2VUeXBlKHR5cGU6IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0aGlzLmlzU2hvd0l0ZW1QYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuJHN0YXRlLmdvKCdJbnRlbGxpZ2VudEFuYWx5c2lzJyk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93SXRlbVBhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5DdXJyZW50VHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93TWVudUxpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5DdXJyZW50VHlwZSA9PT0gJ0NhcicpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuTWVudUxpc3QgPSB0aGlzLkNhck1lbnVMaXN0O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuQ3VycmVudFR5cGUgPT09ICdGYWNlJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5NZW51TGlzdCA9IHRoaXMuRmFjZU1lbnVMaXN0XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5DdXJyZW50VHlwZSA9PT0gJ01hYycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuTWVudUxpc3QgPSB0aGlzLk1hY01lbnVMaXN0XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5DdXJyZW50VHlwZSA9PT0gJ011bHRpJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5NZW51TGlzdCA9IHRoaXMuTXVsdGlNZW51TGlzdFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuQ3VycmVudFR5cGUgPT09IHR5cGUpIHtcclxuICAgICAgICAgICAgdGhpcy5DdXJyZW50VHlwZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTaG93TWVudUxpc3QgPSBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLkN1cnJlbnRUeXBlID0gdHlwZTtcclxuICAgICAgICAgICAgdGhpcy5pc1Nob3dNZW51TGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLkN1cnJlbnRUeXBlID09PSAnQ2FyJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5NZW51TGlzdCA9IHRoaXMuQ2FyTWVudUxpc3Q7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2hvd0NhcklmcmFtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pZnJhbWVTcmMgPSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuQ3VycmVudFR5cGUgPT09ICdGYWNlJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5NZW51TGlzdCA9IHRoaXMuRmFjZU1lbnVMaXN0XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5DdXJyZW50VHlwZSA9PT0gJ01hYycpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuTWVudUxpc3QgPSB0aGlzLk1hY01lbnVMaXN0XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5DdXJyZW50VHlwZSA9PT0gJ011bHRpJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5NZW51TGlzdCA9IHRoaXMuTXVsdGlNZW51TGlzdFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ29NZW51KGl0ZW06IE1lbnVFbXVzKSB7XHJcbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ0NhcicpIHtcclxuICAgICAgICAgICAgdGhpcy5pc1Nob3dDYXJJZnJhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmlzU2hvd01lbnVMaXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuQ3VycmVudFR5cGUgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLmlmcmFtZVNyYyA9IHRoaXMuJHNjZS50cnVzdEFzUmVzb3VyY2VVcmwoaXRlbS5wYXRoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmlzU2hvd0NhcklmcmFtZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmlmcmFtZVNyYyA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMuJHN0YXRlLmdvKGl0ZW0ucGF0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGluaXRNb2R1bGVEYXRhKCkge1xyXG4gICAgICAgIHRoaXMuTWVudUxpc3QgPSBhbmd1bGFyLmNvcHkodGhpcy5DYXJNZW51TGlzdCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByaXZhdGUgZ2V0U3lzdGVtUG9pbnQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWFwU2VydmljZS5nZXRTeXN0ZW1Qb2ludHMoKS50aGVuKChyZXM6IFJlc3BvbnNlUmVzdWx0PEFycmF5PFN5c3RlbVBvaW50Pj4pID0+IHtcclxuICAgICAgICAgICAgbGV0IGFyciA9IFtdIGFzIEFycmF5PFN5c3RlbVBvaW50PjtcclxuICAgICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDAgJiYgQXJyYXkuaXNBcnJheShyZXMuZGF0YSkpIHtcclxuICAgICAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goKGl0ZW06IFN5c3RlbVBvaW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uTGF5ZXJUeXBlICYmIGl0ZW0uTGF0ICYmIGl0ZW0uTG9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBhID0gW10gYXMgQXJyYXk8U3lzdGVtUG9pbnQ+LCBiID0gW10gYXMgQXJyYXk8U3lzdGVtUG9pbnQ+LCBjID0gW10gYXMgQXJyYXk8U3lzdGVtUG9pbnQ+LCBkID0gW10gYXMgQXJyYXk8U3lzdGVtUG9pbnQ+LCBlID0gW10gYXMgQXJyYXk8U3lzdGVtUG9pbnQ+XHJcbiAgICAgICAgICAgICAgICByZXMuZGF0YS5mb3JFYWNoKChpdGVtOiBTeXN0ZW1Qb2ludCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0eXBlID0gaXRlbS5MYXllclR5cGUudG9Mb2NhbGVMb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5pbmRleE9mKCdjYW1lcmEnKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGEucHVzaChpdGVtKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5pbmRleE9mKCd3aWZpJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiLnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUuaW5kZXhPZignZWZlbmNlJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjLnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUuaW5kZXhPZigncm1wZ2F0ZScpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZC5wdXNoKGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLmluZGV4T2YoJ2xhbXBwb3N0JykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJEZWMud2FybkluZm8oJ+acquiOt+WPluWIsOeCueS9jeS/oeaBrycpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy4kc2NvcGUuc3lzdGVtUG9pbnQgPSBhcnI7XHJcbiAgICAgICAgICAgIHRoaXMuJHNjb3BlLiRicm9hZGNhc3QoJ3BvaW50cy5yZWFkeScsIHRoaXMuJHNjb3BlLnN5c3RlbVBvaW50KTtcclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuYXBwLmNvbnRyb2xsZXIoJ0ludGVsbGlnZW50QW5hbHlzaXNDb250cm9sbGVyJywgSW50ZWxsaWdlbnRBbmFseXNpc0NvbnRyb2xsZXIpOyJdfQ==
